{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/tslib/tslib.es6.js","webpack:///./build/ts-to-es6/src/libraries/Log.js","webpack:///./build/ts-to-es6/src/utils.js","webpack:///./build/ts-to-es6/src/models/AppState.js","webpack:///./build/ts-to-es6/src/models/ServiceWorkerState.js","webpack:///./build/ts-to-es6/src/services/Database.js","webpack:///./build/ts-to-es6/src/managers/SdkEnvironment.js","webpack:///./build/ts-to-es6/src/errors/TimeoutError.js","webpack:///./build/ts-to-es6/src/context/shared/utils/Utils.js","webpack:///./build/ts-to-es6/src/models/WindowEnvironmentKind.js","webpack:///./build/ts-to-es6/src/Event.js","webpack:///./node_modules/bowser/src/bowser.js","webpack:///./build/ts-to-es6/src/utils/OneSignalUtils.js","webpack:///./build/ts-to-es6/src/errors/InvalidArgumentError.js","webpack:///./build/ts-to-es6/src/Environment.js","webpack:///./build/ts-to-es6/src/errors/OneSignalError.js","webpack:///./build/ts-to-es6/src/errors/InvalidStateError.js","webpack:///./build/ts-to-es6/src/libraries/sw/Log.js","webpack:///./build/ts-to-es6/src/helpers/sw/CancelableTimeout.js","webpack:///./build/ts-to-es6/src/helpers/ServiceWorkerHelper.js","webpack:///./build/ts-to-es6/src/models/Session.js","webpack:///./build/ts-to-es6/src/models/EnvironmentKind.js","webpack:///./build/ts-to-es6/src/models/IntegrationKind.js","webpack:///./build/ts-to-es6/src/models/SubscriptionStateKind.js","webpack:///./build/ts-to-es6/src/OneSignalApiBase.js","webpack:///./build/ts-to-es6/src/models/Outcomes.js","webpack:///./build/ts-to-es6/src/errors/NotImplementedError.js","webpack:///./build/ts-to-es6/src/models/RawPushSubscription.js","webpack:///./build/ts-to-es6/src/errors/OneSignalApiError.js","webpack:///./build/ts-to-es6/src/utils/PermissionUtils.js","webpack:///./build/ts-to-es6/src/libraries/Emitter.js","webpack:///./build/ts-to-es6/src/models/DeliveryPlatformKind.js","webpack:///./build/ts-to-es6/src/models/DeviceRecord.js","webpack:///./build/ts-to-es6/src/models/PushDeviceRecord.js","webpack:///./build/ts-to-es6/src/models/EmailProfile.js","webpack:///./build/ts-to-es6/src/models/TestEnvironmentKind.js","webpack:///./build/ts-to-es6/src/utils/BrowserUtils.js","webpack:///./build/ts-to-es6/src/helpers/shared/OutcomesHelper.js","webpack:///./build/ts-to-es6/src/OneSignalApiSW.js","webpack:///./build/ts-to-es6/src/helpers/page/ServiceWorkerHelper.js","webpack:///./build/ts-to-es6/src/models/Subscription.js","webpack:///./build/ts-to-es6/src/services/IndexedDb.js","webpack:///./build/ts-to-es6/src/models/PermissionPromptType.js","webpack:///./node_modules/jsonp/index.js","webpack:///./build/ts-to-es6/src/utils/ReplayCallsOnOneSignal.js","webpack:///./build/ts-to-es6/src/entries/pageSdkInit.js","webpack:///./build/ts-to-es6/src/errors/NotSubscribedError.js","webpack:///./build/ts-to-es6/src/errors/SdkInitError.js","webpack:///./build/ts-to-es6/src/LimitStore.js","webpack:///./build/ts-to-es6/src/models/EmailDeviceRecord.js","webpack:///./build/ts-to-es6/src/OneSignalApiShared.js","webpack:///./build/ts-to-es6/src/CustomLink.js","webpack:///./build/ts-to-es6/src/models/NotificationPermission.js","webpack:///./build/ts-to-es6/src/helpers/PromptsHelper.js","webpack:///./build/ts-to-es6/src/managers/PermissionManager.js","webpack:///./build/ts-to-es6/src/utils/LocalStorage.js","webpack:///./build/ts-to-es6/src/helpers/EventHelper.js","webpack:///./build/ts-to-es6/src/managers/LegacyManager.js","webpack:///./build/ts-to-es6/src/modules/TimedLocalStorage.js","webpack:///./build/ts-to-es6/src/errors/PushPermissionNotGrantedError.js","webpack:///./build/ts-to-es6/src/context/browser/models/Browser.js","webpack:///./build/ts-to-es6/src/helpers/SubscriptionHelper.js","webpack:///./build/ts-to-es6/src/config/index.js","webpack:///./build/ts-to-es6/src/helpers/MainHelper.js","webpack:///./build/ts-to-es6/src/Postmam.js","webpack:///./build/ts-to-es6/src/modules/frames/SubscriptionModalHost.js","webpack:///./build/ts-to-es6/src/libraries/WorkerMessenger.js","webpack:///./build/ts-to-es6/src/services/DynamicResourceLoader.js","webpack:///./build/ts-to-es6/src/bell/AnimatedElement.js","webpack:///./build/ts-to-es6/src/bell/ActiveAnimatedElement.js","webpack:///./build/ts-to-es6/src/bell/Badge.js","webpack:///./build/ts-to-es6/src/bell/Message.js","webpack:///./build/ts-to-es6/src/bell/Button.js","webpack:///./build/ts-to-es6/src/bell/Dialog.js","webpack:///./build/ts-to-es6/src/bell/Launcher.js","webpack:///./build/ts-to-es6/src/bell/Bell.js","webpack:///./build/ts-to-es6/src/models/Path.js","webpack:///./build/ts-to-es6/src/errors/ServiceWorkerRegistrationError.js","webpack:///./build/ts-to-es6/src/managers/MetricsManager.js","webpack:///./build/ts-to-es6/src/errors/DeprecatedApiError.js","webpack:///./build/ts-to-es6/src/errors/SubscriptionError.js","webpack:///./build/ts-to-es6/src/managers/ServiceWorkerManager.js","webpack:///./build/ts-to-es6/src/modules/frames/SubscriptionPopupHost.js","webpack:///./build/ts-to-es6/src/utils/Encoding.js","webpack:///./build/ts-to-es6/src/helpers/InitHelper.js","webpack:///./build/ts-to-es6/src/helpers/TestHelper.js","webpack:///./build/ts-to-es6/src/managers/PageViewManager.js","webpack:///./build/ts-to-es6/src/managers/SubscriptionManager.js","webpack:///./build/ts-to-es6/src/helpers/ContextHelper.js","webpack:///./build/ts-to-es6/src/managers/UpdateManager.js","webpack:///./build/ts-to-es6/src/errors/AlreadySubscribedError.js","webpack:///./build/ts-to-es6/src/errors/PermissionMessageDismissedError.js","webpack:///./build/ts-to-es6/src/slidedown/LoadingIndicator.js","webpack:///./build/ts-to-es6/src/slidedown/constants.js","webpack:///./build/ts-to-es6/src/slidedown/Slidedown.js","webpack:///./build/ts-to-es6/src/slidedown/SlidedownElement.js","webpack:///./build/ts-to-es6/src/slidedown/RetryIndicator.js","webpack:///./build/ts-to-es6/src/models/Prompts.js","webpack:///./build/ts-to-es6/src/context/browser/utils/BrowserSupportsPush.js","webpack:///./build/ts-to-es6/src/context/browser/helpers/EnvironmentInfoHelper.js","webpack:///./build/ts-to-es6/src/utils/TagUtils.js","webpack:///./build/ts-to-es6/src/slidedown/TaggingContainer.js","webpack:///./build/ts-to-es6/src/managers/PromptsManager.js","webpack:///./build/ts-to-es6/src/utils/AwaitableTimeout.js","webpack:///./build/ts-to-es6/src/managers/sessionManager/page/SessionManager.js","webpack:///./build/ts-to-es6/src/managers/tagManager/page/TagManager.js","webpack:///./build/ts-to-es6/src/models/Context.js","webpack:///./build/ts-to-es6/src/models/AppConfig.js","webpack:///./build/ts-to-es6/src/helpers/ConfigHelper.js","webpack:///./build/ts-to-es6/src/OneSignalApi.js","webpack:///./build/ts-to-es6/src/managers/ConfigManager.js","webpack:///./build/ts-to-es6/src/modules/frames/RemoteFrame.js","webpack:///./build/ts-to-es6/src/modules/frames/ProxyFrame.js","webpack:///./build/ts-to-es6/src/modules/frames/SubscriptionModal.js","webpack:///./build/ts-to-es6/src/modules/frames/SubscriptionPopup.js","webpack:///./build/ts-to-es6/src/helpers/HttpHelper.js","webpack:///./build/ts-to-es6/src/modules/frames/ProxyFrameHost.js","webpack:///./build/ts-to-es6/src/managers/AltOriginManager.js","webpack:///./build/ts-to-es6/src/utils/ValidatorUtils.js","webpack:///./build/ts-to-es6/src/utils/ProcessOneSignalPushCalls.js","webpack:///./build/ts-to-es6/src/OneSignal.js","webpack:///(webpack)/buildin/global.js","webpack:///(webpack)/buildin/amd-define.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","setPrototypeOf","Array","assign","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Log","[object Object]","window","localStorage","level","getItem","toLowerCase","setItem","proxyMethodsCreated","undefined","createProxyMethods","methods","log","trace","info","warn","error","nativeMethod","keys","nativeMethodExists","console","methodToMapTo","shouldMap","shouldLog","bind","decodeHtmlEntities","text","_utils_BrowserUtils__WEBPACK_IMPORTED_MODULE_7__","removeDomElement","selector","els","document","querySelectorAll","length","parentNode","removeChild","awaitOneSignalInitAndSupported","OneSignal","initialized","emitter","once","EVENTS","SDK_INITIALIZED","isUsingSubscriptionWorkaround","_utils_OneSignalUtils__WEBPACK_IMPORTED_MODULE_5__","triggerNotificationPermissionChanged","updateIfIdentical","_utils_PermissionUtils__WEBPACK_IMPORTED_MODULE_6__","executeCallback","callback","args","logMethodCall","methodName","isValidEmail","email","match","addDomElement","targetSelectorOrElement","addOrder","elementHtml","targetElement","querySelector","Error","insertAdjacentHTML","clearDomElementChildren","element","firstChild","addCssClass","cssClass","classList","add","removeCssClass","remove","hasCssClass","contains","getConsoleStyle","style","_context_shared_utils_Utils__WEBPACK_IMPORTED_MODULE_8__","delay","durationMs","setTimeout","nothing","timeoutPromise","promise","milliseconds","indexOfAble","unsubscribeFromPush","_libraries_Log__WEBPACK_IMPORTED_MODULE_4__","_managers_SdkEnvironment__WEBPACK_IMPORTED_MODULE_1__","getWindowEnv","_models_WindowEnvironmentKind__WEBPACK_IMPORTED_MODULE_2__","ServiceWorker","self","registration","pushManager","getSubscription","subscription","unsubscribe","debug","proxyFrameHost","message","POSTMAM_COMMANDS","UNSUBSCRIBE_FROM_PUSH","reply","data","REMOTE_OPERATION_COMPLETE","navigator","serviceWorker","controller","ready","event","task","manualDestroy","variable","toString","taskWrapper","destroyEventListener","removeEventListener","type","addEventListener","getSdkLoadCount","__oneSignalSdkLoadCount","awaitSdkEvent","eventName","predicate","incrementSdkLoadCount","getPlatformNotificationIcon","notificationIcons","bowser__WEBPACK_IMPORTED_MODULE_9___default","a","safari","firefox","chrome","getDomElementOrStub","foundElement","createElement","deepCopy","obj","JSON","parse","stringify","AppState","ServiceWorkerState","Database_DatabaseEventName","DatabaseEventName","Database_Database","databaseName","this","Emitter","database","IndexedDb","databaseInstance","singletonInstance","databaseInstanceName","table","key","id","timestamp","SdkEnvironment","WindowEnvironmentKind","OneSignalUtils","getTestEnv","TestEnvironmentKind","None","shouldUsePostmam","tslib_es6","REMOTE_DATABASE_GET","applyDbResultFilter","REMOTE_DATABASE_GET_ALL","getAll","keypath","REMOTE_DATABASE_PUT","put","emit","SET","REMOTE_DATABASE_REMOVE","config","appIdStr","appId","subdomain","vapidPublicKey","externalUserId","authHash","externalIdToSave","Utils","getValueOrDefault","authHashToSave","appConfig","httpUseOneSignalCom","state","defaultNotificationUrl","defaultNotificationTitle","lastKnownPushEnabled","clickedNotifications","appState","clickedNotificationUrls","url","notificationDetails","workerVersion","updaterWorkerVersion","Subscription","deviceId","subscriptionToken","dbOptedOut","dbNotOptedOut","createdAt","expirationTime","optedOut","setDeviceId","profileJson","EmailProfile","deserialize","emailProfile","serialize","consent","sessionKey","session","allClickedNotifications","find","notification","URL","origin","notificationId","promises","map","sentDuringSession","all","on","getSession","Session","setSession","removeSession","setEmailProfile","getEmailProfile","setSubscription","setProvideUserConsent","getProvideUserConsent","workerState","setServiceWorkerState","getServiceWorkerState","setAppState","getAppState","setAppConfig","getAppConfig","getExternalUserId","getExternalUserIdAuthHash","getLastNotificationClicked","removeNotificationClickedById","removeAllNotificationClicked","resetSentUniqueOutcomes","getNotificationClickedByUrl","getNotificationClickedById","getNotificationReceivedById","setExternalUserId","RESOURCE_HTTP_PORT","API_URL_PORT","TURBINE_API_URL_PORT","TURBINE_ENDPOINTS","_models_EnvironmentKind__WEBPACK_IMPORTED_MODULE_1__","Production","usingProxyOrigin","_Environment__WEBPACK_IMPORTED_MODULE_7__","isSafari","_models_IntegrationKind__WEBPACK_IMPORTED_MODULE_5__","Secure","isTopFrame","top","isHttpsProtocol","location","protocol","context","_errors_InvalidArgumentError__WEBPACK_IMPORTED_MODULE_4__","Empty","SecureProxy","_utils_OneSignalUtils__WEBPACK_IMPORTED_MODULE_8__","isLocalhostAllowedAsSecureOrigin","hostname","InsecureProxy","isFrameContextInsecure","getRegistration","_helpers_ServiceWorkerHelper__WEBPACK_IMPORTED_MODULE_6__","isBrowser","ServiceWorkerGlobalScope","scope","_models_WindowEnvironmentKind__WEBPACK_IMPORTED_MODULE_3__","Unknown","href","indexOf","pathname","search","endsWith","getBuildEnv","Development","OneSignalSubscriptionPopup","Host","OneSignalProxyFrame","OneSignalSubscriptionModal","CustomIframe","_models_TestEnvironmentKind__WEBPACK_IMPORTED_MODULE_2__","buildEnv","Staging","EnumOutOfRange","getApiEnv","action","isTurbineEndpoint","port","some","turbine_endpoint","TimeoutError_TimeoutError","OneSignalError","super","Utils_Utils","charAt","toUpperCase","slice","defaultValue","_","hash","uriComponent","encodeURIComponent","race","str","targetLength","padString","version","osVersionParts","split","majorVersion","padStart","minorVersion","Number","subject","delimiter","maxParts","parts","skipParts","Math","max","join","toCheck","compareTo","parseVersionString","playerId","funcToExecute","enforceAppId","enforcePlayerId","isArray","errors","OneSignalApiError","MissingAppId","arrayToSort","predicateForProperty","descending","doItInPlace","internalArrayToSort","sort","b","propertyA","propertyB","__webpack_exports__","SILENT_EVENTS","RETRIGGER_REMOTE_EVENTS","LEGACY_EVENT_MAP","notificationPermissionChange","subscriptionChange","customPromptClick","Event","remoteTriggerEnv","_context_shared_utils_Utils__WEBPACK_IMPORTED_MODULE_5__","displayData","env","capitalize","_managers_SdkEnvironment__WEBPACK_IMPORTED_MODULE_2__","_Environment__WEBPACK_IMPORTED_MODULE_1__","legacyEventName","_triggerLegacy","opener","parent","subscriptionPopup","REMOTE_RETRIGGER_EVENT","eventData","proxyFrame","retriggerRemoteEvent","CustomEvent","bubbles","cancelable","detail","dispatchEvent","definition","t","detect","ua","getFirstMatch","regex","iosdevice","android","test","nexusMobile","nexusTablet","chromeos","silk","sailfish","tizen","webos","windowsphone","windows","mac","linux","edgeVersion","versionIdentifier","tablet","mobile","xbox","opera","samsungBrowser","coast","yandexbrowser","ucbrowser","maxthon","epiphany","puffin","sleipnir","kMeleon","msedge","msie","chromeBook","vivaldi","seamonkey","firefoxos","phantom","slimer","blackberry","touchpad","bada","qupzilla","chromium","googlebot","blink","webkit","gecko","ios","osVersion","getWindowsVersion","replace","osversion","osMajorVersion","x","bowser","userAgent","getVersionPrecision","arr","iterator","push","compareVersions","versions","precision","chunks","delta","chunk","reverse","isUnsupportedBrowser","minVersions","strictMode","_bowser","browser","String","browserList","browserItem","check","_detect","userConfig","allowLocalhostAsSecureOrigin","windowEnv","bowser__WEBPACK_IMPORTED_MODULE_0___default","internalIsUsingSubscriptionWorkaround","uuid","uuidStr","crypto","global","msCrypto","getRandomValues","Uint8Array","random","_Environment__WEBPACK_IMPORTED_MODULE_2__","InvalidArgumentReason","InvalidArgumentError","_OneSignalError__WEBPACK_IMPORTED_MODULE_0__","argName","reason","Malformed","argument","Environment","bowser__WEBPACK_IMPORTED_MODULE_2___default","TRADITIONAL_CHINESE_LANGUAGE_TAG","SIMPLIFIED_CHINESE_LANGUAGE_TAG","languageTag","language","languageSubtags","traditionalSubtag","simpleSubtag","substring","_managers_SdkEnvironment__WEBPACK_IMPORTED_MODULE_0__","_models_WindowEnvironmentKind__WEBPACK_IMPORTED_MODULE_1__","__SRC_STYLESHEETS_MD5_HASH__","writable","constructor","captureStackTrace","stack","InvalidStateReason","InvalidStateError","extra","RedundantPermissionMessage","extraInfo","permissionPromptType","_models_PermissionPromptType__WEBPACK_IMPORTED_MODULE_1__","PushPermissionAlreadyGranted","UnsupportedEnvironment","ServiceWorkerNotActivated","NoProxyFrame","description","CancelableTimeout_doNothing","CancelableTimeout_cancelableTimeout","delayInSeconds","delayInMilliseconds","timerId","clearTimeoutHandle","startedExecution","clearTimeout","cancel","ServiceWorkerHelper_ServiceWorkerHelper","page_ServiceWorkerHelper","workerFullPath","ServiceWorkerHelper_ServiceWorkerActiveState","WorkerA","workerBPath","getFullPath","WorkerB","ThirdParty","workerAPath","Bypassed","getBaseUrl","sessionThresholdInSeconds","sendOnFocusEnabled","deviceRecord","sessionOrigin","outcomesConfig","app_id","existingSession","Database","getCurrentSession","deviceType","device_type","clickedNotification","upsertSession","sendOnSessionCallIfNecessary","status","Active","lastDeactivatedTimestamp","currentTimestamp","Date","getTime","timeInSecondsBetweenTimestamps","lastActivatedTimestamp","finalizeSession","thresholdInSeconds","Inactive","timeSinceLastActivatedInSeconds","accumulatedDuration","cancelableFinalize","PlayerCreate","identifier","rawPushSubscription","RawPushSubscription","setFromW3cSubscription","fullDeviceRecord","PushDeviceRecord","newPlayerId","OneSignalApiSW","updateUserSession","startTimestamp","attribution","OutcomesHelper","getAttribution","sendSessionDuration","cleanupCurrentSession","timestamp1","timestamp2","floor","ServiceWorkerActiveState","SessionStatus","SessionOrigin","ONESIGNAL_SESSION_KEY","initializeNewSession","options","EnvironmentKind","IntegrationKind","SubscriptionStateKind","OneSignalApiBase","headers","method","_errors_OneSignalApiError__WEBPACK_IMPORTED_MODULE_3__","callHeaders","Headers","append","getOrigin","_Environment__WEBPACK_IMPORTED_MODULE_0__","contents","cache","body","fetch","getOneSignalApiUrl","response","json","identifyError","catch","err","_context_shared_utils_Utils__WEBPACK_IMPORTED_MODULE_2__","OutcomeAttributionType","NotImplementedError","existingW3cPushSubscription","w3cEndpoint","w3cP256dh","w3cAuth","existingSafariDeviceToken","safariDeviceToken","pushSubscription","endpoint","getKey","p256dh","auth","p256dh_base64encoded","btoa","fromCharCode","auth_base64encoded","existingPushSubscription","bundle","OneSignalApiErrorKind","PermissionUtils","newPermission","privateGetNotificationPermission","_services_Database__WEBPACK_IMPORTED_MODULE_1__","_Event__WEBPACK_IMPORTED_MODULE_2__","trigger","NATIVE_PROMPT_PERMISSIONCHANGED","to","_events","listener","that","fn","off","arguments","listeners","j","splice","removeAllListeners","shift","len","DeliveryPlatformKind","DeviceRecord","getLanguage","timezone","getTimezoneOffset","browserVersion","parseInt","isNaN","deviceModel","platform","sdkVersion","deliveryPlatform","getDeliveryPlatform","pushNotification","_utils_OneSignalUtils__WEBPACK_IMPORTED_MODULE_4__","redetectBrowserUserAgent","_DeliveryPlatformKind__WEBPACK_IMPORTED_MODULE_3__","Safari","Firefox","Edge","ChromeLike","serializedBundle","device_os","device_model","sdk","notification_types","subscriptionState","_errors_NotImplementedError__WEBPACK_IMPORTED_MODULE_2__","_DeviceRecord__WEBPACK_IMPORTED_MODULE_3__","web_auth","web_p256","pushRegistration","_SubscriptionStateKind__WEBPACK_IMPORTED_MODULE_2__","Subscribed","NotSubscribed","_errors_NotImplementedError__WEBPACK_IMPORTED_MODULE_1__","emailId","emailAddress","identifierAuthHash","BrowserUtils","decodeTextArea","innerHTML","SEND_OUTCOME","SEND_UNIQUE_OUTCOME","outcomeName","isUnique","outcomeMethodString","_utils__WEBPACK_IMPORTED_MODULE_5__","privateIsPushNotificationsEnabled","_libraries_Log__WEBPACK_IMPORTED_MODULE_3__","_services_Database__WEBPACK_IMPORTED_MODULE_2__","filter","reduce","acc","curr","notificationIds","previouslyAttributedArr","getAttributedNotifsByUniqueOutcomeName","outcomeAttribution","notifArr","_models_Outcomes__WEBPACK_IMPORTED_MODULE_1__","Unattributed","newNotificationIds","existingSentOutcome","currentSession","sentOutcome","sessionExistsAndWasPreviouslySent","sessionWasClearedButWasPreviouslySent","outcomeProps","weight","Direct","saveSentUniqueOutcome","updateManager","sendOutcomeDirect","Indirect","sendOutcomeInfluenced","wasSentDuringSession","sendOutcomeUnattributed","direct","enabled","indirect","timeframeMs","influencedTimePeriodMin","maxTimestamp","allReceivedNotification","influencedNotificationsLimit","allReceivedNotificationSorted","_context_shared_utils_Utils__WEBPACK_IMPORTED_MODULE_4__","sortArrayOfObjects","notif","matchingNotificationIds","notificationIdsToDelete","forEach","unattributed","NotSupported","_reject","_OneSignalApiBase__WEBPACK_IMPORTED_MODULE_1__","post","_models_SubscriptionStateKind__WEBPACK_IMPORTED_MODULE_2__","TemporaryWebRecord","enforceAppIdAndPlayerId","tslib__WEBPACK_IMPORTED_MODULE_0__","userId","serializedDeviceRecord","sessionDuration","payload","active_time","_models_Outcomes__WEBPACK_IMPORTED_MODULE_5__","notification_ids","ServiceWorkerHelper","_libraries_Log__WEBPACK_IMPORTED_MODULE_1__","DATABASE_VERSION","_libraries_Emitter__WEBPACK_IMPORTED_MODULE_1__","request","indexedDB","open","onerror","onDatabaseOpenError","onblocked","onDatabaseOpenBlocked","onupgradeneeded","onDatabaseUpgradeNeeded","onsuccess","onDatabaseError","onversionchange","onDatabaseVersionChange","openLock","preventDefault","target","_context_shared_utils_Utils__WEBPACK_IMPORTED_MODULE_3__","_libraries_Log__WEBPACK_IMPORTED_MODULE_2__","errorCode","db","oldVersion","createObjectStore","keyPath","_isNewVisitor","ensureDatabaseOpen","transaction","objectStore","jsonResult","cursor","openCursor","cursorResult","cursorResultKey","continue","store","delete","clear","PermissionPromptType","opts","script","timer","prefix","count","param","timeout","enc","getElementsByTagName","head","cleanup","noop","src","insertBefore","ReplayCallsOnOneSignal_ReplayCallsOnOneSignal","stubOneSignal","processAsArray","processAsES6Stub","item","SERVICE_WORKER_PATH","SERVICE_WORKER_UPDATER_PATH","currentLogLevel","setLevel","SERVICE_WORKER_PARAM","preExistingArray","directFunctionCallsArray","retValue","functionName","delayedPromise","utils","predefinedOneSignal","default","doReplay","pageSdkInit_oneSignalSdkInit","NotSubscribedError_NotSubscribedReason","NotSubscribedReason","SdkInitError_SdkInitErrorKind","SdkInitErrorKind","NotSubscribedError_NotSubscribedError","NoDeviceId","NoEmailSet","OptedOut","SdkInitError_SdkInitError","InvalidAppId","AppNotConfiguredForWebPush","MissingSubdomain","WrongSiteUrl","siteUrl","MultipleInitialization","MissingSafariWebId","LimitStore","LIMIT","values","EmailDeviceRecord_EmailDeviceRecord","pushDeviceRecordId","Email","identifier_auth_hash","device_player_id","OneSignalApiShared_OneSignalApiShared","playerIds","titles","icon","buttons","params","include_player_ids","isAnyWeb","web_buttons","headings","chrome_web_icon","firefox_icon","trimUndefined","success","emailRecord","parent_player_id","CustomLink_CustomLink","dynamicResourceLoader","loadSdkStylesheet","containerSelector","isInitialized","injectMarkup","isPushEnabled","isOptedOut","internalIsOptedOut","subscribeSelector","initSubscribeElement","explanationSelector","initExplanationElement","container","explanation","explanationClass","appendChild","subscribe","subscribeClass","markAsInitialized","textContent","setResetClass","setStateClass","setStyleClass","setSizeClass","setCustomColors","unsubscribeEnabled","setAttribute","subscriptionStateAttribute","optedOutAttribute","handleClick","getAttribute","autoAccept","environmentInfo","requiresUserInteraction","registerForPushNotifications","color","button","backgroundColor","subscribed","oldClassName","newClassName","size","resetClass","initializedAttribute","containerClass","NotificationPermission","PromptsHelper","promptOptions","slidedown","categories","tags","PermissionManager_PermissionManager","STORED_PERMISSION_KEY","safariWebId","reportedPermission","getReportedNotificationPermission","isPermissionEnvironmentAmbiguous","getInterpretedAmbiguousPermission","bowser_default","getSafariNotificationPermission","getOneSignalSubdomainNotificationPermission","getW3cNotificationPermission","permission","Notification","REMOTE_NOTIFICATION_PERMISSION","remoteNotificationPermission","Denied","isCurrentFrameContextCrossOrigin","isInsecureOrigin","topFrameOrigin","storedPermission","getStoredPermission","Default","LocalStorage_LocalStorage","setStoredPermission","getNotificationPermission","LocalStorage_IS_OPTED_OUT","LocalStorage_IS_PUSH_NOTIFICATIONS_ENABLED","LocalStorage_PAGE_VIEWS","Granted","EventHelper_EventHelper","checkAndTriggerSubscriptionChanged","subscriptionManager","getSubscriptionState","setIsPushNotificationsEnabled","triggerSubscriptionChanged","newSubscriptionState","onSubscriptionChanged_showWelcomeNotification","onSubscriptionChanged_sendCategorySlidedownTags","onSubscriptionChanged_evaluateNotifyButtonDisplayPredicate","onSubscriptionChanged_updateCustomLink","isSubscribed","isCategorySlidedownConfigured","tagManager","sendTags","__doNotShowWelcomeNotification","welcome_notification_opts","welcomeNotification","welcome_notification_disabled","title","unopenableWelcomeNotificationUrl","sendNotification","en","__isOneSignalWelcomeNotification","WELCOME_NOTIFICATION_SENT","notifyButton","displayPredicate","launcher","show","hide","initialize","customlink","SUBSCRIPTION_CHANGED","fireEventWithNotification","clickedNotificationInfo","now","NOTIFICATION_CLICKED","clickedNotificationUrl","pageClickedNotifications","urlWithoutTrailingSlash","LegacyManager_LegacyManager","promiseStub","oneSignal","environmentPolyfill","postmams","syncHashedEmail","environment","getEnv","isPopup","isIframe","postmamMessageFunc","messenger","postmamPostMessageFunc","postMessage","assignPostmamLegacyFunctions","postmamLikeObject","iframePostmam","popupPostmam","subscriptionModal","modalPostmam","TimedLocalStorage","expirationInMinutes","isLocalStorageSupported","expirationInMilliseconds","record","parsedRecord","removeItem","parsedRecordValue","PushPermissionNotGrantedError_PushPermissionNotGrantedErrorReason","PushPermissionNotGrantedErrorReason","PushPermissionNotGrantedError_PushPermissionNotGrantedError","Dismissed","Blocked","Browser","SubscriptionHelper_SubscriptionHelper","getIsPushNotificationsEnabled","internalRegisterForPush","pageViewManager","isFirstPageView","MainHelper_MainHelper","getDeviceId","createDeviceRecord","sessionManager","PageRefresh","_isRegisteringForPush","rawSubscription","registerSubscription","incrementPageViewCount","windowCreator","permissionManager","updateStoredPermission","REMOTE_NOTIFICATION_PERMISSION_CHANGED","forceUpdatePermission","close","FINISH_REMOTE_REGISTRATION","progress","deviceToken","existingDeviceToken","swSubscription","browserType","getRawPushSubscriptionForSafari","getRawPushSubscriptionWhenUsingSubscriptionWorkaround","isBrowserAndSupportsServiceWorkers","getRawPushSubscriptionFromServiceWorkerRegistration","SERVER_CONFIG_DEFAULTS_SESSION","reportingThreshold","enableOnSessionForUnsubcribed","enableOnFocus","SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS","pageViews","timeDelay","SERVER_CONFIG_DEFAULTS_SLIDEDOWN","actionMessage","acceptButton","cancelButton","categoryDefaults","updateMessage","positiveUpdateButton","negativeUpdateButton","savingText","currentPermission","existingUser","isAlreadyRegisteredWithOneSignal","MutedByApi","isOptedIn","sessionStorage","previousPermission","getAppId","autoPrompt","acceptButtonText","cancelButtonText","fullscreen","autoAcceptTitle","exampleNotificationTitleDesktop","exampleNotificationTitleMobile","exampleNotificationMessageDesktop","exampleNotificationMessageMobile","exampleNotificationCaption","caption","promptOptionsStr","getFullscreenPermissionMessageOptions","getPromptOptionsPostHash","legacyParams","legacyParamKey","legacyParamValue","allowedPromptOptions","encoded_value","clickResult","CUSTOM_PROMPT_CLICKED","includeSubscription","getRawPushSubscription","getCurrentNotificationType","Postmam_Postmam","windowReference","sendToOrigin","receiveFromOrigin","channel","MessageChannel","messagePort","isListening","isConnected","replies","HANDSHAKE_MESSAGE","CONNECTED_MESSAGE","onWindowMessagePostmanConnectReceived","onWindowPostMessageReceived","stopPostMessageReceive","isSafeOrigin","messageId","command","messageCommand","messageData","source","messageSource","messageBundle","messageBundleWithReply","replyFn","handshake","ports","onMessageReceived","start","port1","port2","originalMessageBundle","onReply","isReply","getRandomUuid","inputOrigin","safeOrigins","reducedHost","host","ex","messageOrigin","otherAllowedOrigins","generateSafeOrigins","SubscriptionModalHost_SubscriptionModalHost","registrationOptions","isPushNotificationsEnabled","notificationPermission","getPromptOptionsQueryString","modal","createHiddenSubscriptionDomModal","establishCrossOriginMessaging","iframeContainer","iframeContainerStyle","iframe","className","width","_windowWidth","height","_windowHeight","getElementById","existingInstance","startPostMessageReceive","MODAL_LOADED","onModalLoaded","MODAL_PROMPT_ACCEPTED","onModalAccepted","MODAL_PROMPT_REJECTED","onModalRejected","POPUP_CLOSING","onModalClosing","showSubscriptionDomModal","_sessionInitAlreadyRunning","dispose","triggerCustomPromptClicked","registerForPush","destroy","removeFrame","WorkerMessenger_WorkerMessengerCommand","WorkerMessengerCommand","WorkerMessenger_WorkerMessengerReplyBuffer","onceListenerOnly","targetRecord","listenersForCommand","listenerRecordIndex","WorkerMessenger_WorkerMessenger","clients","matchAll","includeUncontrolled","client","windowClient","isWorkerControllingPage","waitUntilWorkerControlsPage","directPostMessageToSW","listenIfPageUncontrolled","supportsServiceWorkers","onWorkerMessageReceivedFromPage","listenForPage","onPageMessageReceivedFromServiceWorker","listenerRecords","findListenersForMessage","listenersToRemove","listenersToCall","listenerRecord","deleteListenerRecord","addListener","deleteListenerRecords","deleteAllListenerRecords","active","serviceWorkerManager","getActiveState","helpers_ServiceWorkerHelper","_e","DynamicResourceLoader_DynamicResourceLoader","pathForEnv","getOneSignalResourceUrlPath","cssFileForEnv","getOneSignalCssFileName","loadIfNew","getSdkStylesVersionHash","load","domElement","onload","AnimatedElement_AnimatedElement","showClass","hideClass","targetTransitionEvents","nestedContentSelector","transitionCheckTimeout","hidden","SHOWING","destroyListenerFn","propertyName","SHOWN","shown","HIDING","HIDDEN","OneSignal_OneSignal","content","innerElement","nestedContent","showing","hiding","ActiveAnimatedElement_ActiveAnimatedElement","activeClass","inactiveClass","activeState","inactive","ACTIVATING","ACTIVE","INACTIVATING","INACTIVE","activating","inactivating","Badge_Badge","badgeNumber","setCustomColorsIfSpecified","Message_Message","bell","contentType","queued","TIMEOUT","TYPES","TIP","MESSAGE","QUEUED","duration","getTipForState","Bell_Bell","STATES","UNSUBSCRIBED","SUBSCRIBED","BLOCKED","badge","increment","dequeuedMessage","pop","decrement","numMessagesLeft","Button_Button","events","mouse","onHovering","onTap","passive","onHovered","onEndTap","onClick","isEmpty","getLast","HOVERING","HOVERED","pulse","activate","inactivate","BELL_CLICK","LAUNCHER_CLICK","unsubscribed","activateIfInactive","showDialogProcedure","_ignoreSubscriptionState","display","blocked","Dialog_Dialog","subscribeButtonId","unsubscribeButtonId","updateBellLauncherDialogBody","subscribeButtonSelectorId","unsubscribeButtonSelectorId","subscribeButton","unsubscribeButton","currentSetSubscription","footer","showCredit","notificationIconHtml","imageUrl","buttonHtml","instructionsHtml","SUBSCRIBE_CLICK","UNSUBSCRIBE_CLICK","Launcher_Launcher","wasInactive","MissingDomElement","resize","Bell_logoSvg","UNINITIALIZED","hovering","DEFAULT_SIZE","DEFAULT_POSITION","DEFAULT_THEME","enable","position","theme","showLauncherAfter","showBadgeAfter","setDefaultTextOptions","prenotify","colors","offset","_launcher","validateOptions","installEventHooks","updateState","STATE_CHANGED","TEXT_SUBS","prompt.native.grant","dialog","inactivateIfWasInactive","tip.state.unsubscribed","tip.state.subscribed","tip.state.blocked","message.prenotify","message.action.subscribed","message.action.resubscribed","message.action.subscribing","message.action.unsubscribed","dialog.main.title","dialog.main.button.subscribe","dialog.main.button.unsubscribe","dialog.blocked.title","dialog.blocked.message","disabled","clearIfWasInactive","dequeue","msg","waitUntilShown","icons","getNotificationIcons","bellState","setState","notOptedOut","doNotPrompt","wasHttpsNativePromptDismissed","resizeTo","addDefaultClasses","applyOffsetIfSpecified","patchSafariSvgFilterBug","isNotOptedOut","isHttpPromptAlreadyShown","enqueue","bellShadow","badgeShadow","dialogShadow","graphic","cssText","bottom","right","left","dialogButton","pulseRing","foregroundElements","addCssToHead","css","styleDom","createTextNode","isEnabled","newState","silent","lastState","from","_button","_badge","_message","_dialog","Path_Path","path","trim","indexOfDelimiter","QUERY_STRING","getWithoutQueryString","newPath","fileNameIndex","lastIndexOf","getFileName","pathWithoutFileName","ServiceWorkerRegistrationError_ServiceWorkerRegistrationError","statusText","MetricsManager_ApiUsageMetricKind","ApiUsageMetricKind","DeprecatedApiError_DeprecatedApiReason","DeprecatedApiReason","SubscriptionError_SubscriptionErrorReason","SubscriptionErrorReason","errors_ServiceWorkerRegistrationError","ServiceWorkerManager_ServiceWorkerManager","integration","getIntegration","Indeterminate","runCommand","SERVICE_WORKER_STATE","workerRegistration","installing","Installing","swFileName","activeSwFileName","swActiveStateByFileName","workerScriptPath","scriptURL","importedSw","URLSearchParams","fileName","proxyWorkerVersion","GET_WORKER_VERSION","NaN","workerMessenger","WorkerVersion","unicast","workerNeedsUpdate","getWorkerVersion","shouldInstallWorker","preInstallWorkerState","installAlternatingWorker","postInstallWorkerState","establishServiceWorkerChannel","NotificationDisplayed","NOTIFICATION_DISPLAYED","NotificationClicked","clickedListenerCallbackCount","GET_EVENT_LISTENER_COUNT","callbackCount","numberOfListeners","RedirectPage","SERVICEWORKER_COMMAND_REDIRECT","NotificationDismissed","NOTIFICATION_DISMISSED","isHttps","AreYouVisible","incomingPayload","focused","hasFocus","AreYouVisibleResponse","httpPayload","ARE_YOU_VISIBLE_REQUEST","fullWorkerPath","getServiceWorkerHref","encodeHashAsUriComponent","register","SubscriptionPopupHost_SubscriptionPopupHost","postData","promptType","parentHostname","popupWindow","openWindowViaPost","loadPromise","resolver","rejector","overrides","form","dualScreenLeft","screenLeft","screen","dualScreenTop","screenTop","thisWidth","innerWidth","documentElement","clientWidth","thisHeight","innerHeight","clientHeight","childWidth","childHeight","windowRef","input","submit","POPUP_BEGIN_MESSAGEPORT_COMMS","onBeginMessagePortCommunications","POPUP_LOADED","onPopupLoaded","POPUP_ACCEPTED","onPopupAccepted","POPUP_REJECTED","onPopupRejected","onPopupClosing","SET_SESSION_COUNT","onSetSessionCount","WINDOW_TIMEOUT","onWindowTimeout","onFinishingRegistrationRemotely","onRemoteRetriggerEvent","connect","sessionCount","setPageViewCount","POPUP_WINDOW_TIMEOUT","checkAndTriggerNotificationPermissionChanged","base64Encode","p1","MetricsManager_MetricEvent","MetricsManager_MetricEngagement","MetricsManager_ApiUsageMetricEvent","apiName","api","getPropertiesAsJson","MetricsManager_PageViewMetricEngagement","date","getUTCMonth","getUTCDate","getUTCFullYear","$add","$ignore_time","getDateUtc","MetricsManager_MetricsManager","isFeatureEnabled","mixpanelReportingToken","MIXPANEL_REPORTING_URL","queryParamsData","getEventName","properties","token","queryParams","requestOptions","engagement","$token","$distinct_id","getProfileName","getOperationData","shouldCollectPageView","reportEngagement","DeprecatedApiError_DeprecatedApiError","HttpPermissionRequest","reportUsage","SyncHashedEmail","apiKind","metricsManager","reportEvent","InitHelper_InitHelper","installWorker","SESSION_STARTED","sendOnSessionUpdateFromPage","visibilityState","sessionInit","postponeSessionInitUntilPageIsInFocus","doInitialize","setIsOptedOut","handleAutoResubscribe","forceSlidedownOverNative","categoryOptions","promptsManager","internalShowAutoPrompt","modalPrompt","subscriptionModalHost","httpPermissionRequest","loadSubscriptionPopup","getIsOptedOut","wasUserResubscribed","processExpiringSubscriptions","setupSessionEventListeners","sendOnSessionUpdate","autoResubscribe","SDK_INITIALIZED_PUBLIC","subscriptionPopupHost","isSubscriptionExpiring","integrationKind","registerSubscriptionInProxyFrame","PROCESS_EXPIRING_SUBSCRIPTIONS","newSubscription","SubscribeNew","storeInitialValues","installNativePromptPermissionChangedHook","setWelcomeNotificationFlag","showNotifyButton","showPromptsFromWebConfigEditor","create","emailDeviceRecord","permissions","_usingNativePermissionHook","query","onchange","opPromises","persistNotification","webhookOptions","webhooks","cors","notificationClickHandlerMatch","notificationClickHandlerAction","overridingPageTitle","pageTitle","siteName","loadFetchPolyfill","_initCalled","TestHelper_TestHelper","MARK_PROMPT_DISMISSED","dismissCount","dismissDays","dismissMinutes","PageViewManager_PageViewManager","incrementedPageViewCount","pageViewCountStr","SESSION_STORAGE_KEY_NAME","pageViewCount","newCountSingleTab","getPageViewCount","newCountAcrossTabs","getLocalPageViewCount","setLocalPageViewCount","SubscriptionError_SubscriptionError","InvalidSafariSetup","SubscriptionManager_SubscriptionManager","subscriptionStrategy","subscribeFcmFromWorker","subscribeSafari","subscribeFcmFromPage","createFromPushSubscription","newDeviceId","sendPlayerUpdate","sendPlayerCreate","associateSubscriptionWithEmail","REGISTERED","requestNotificationPermission","strategy","updatePlayer","results","requestPermission","pushSubscriptionDetails","PERMISSION_PROMPT_DISPLAYED","subscribeSafariPromptPermission","setFromSafariSubscription","requestPresubscribeNotificationPermission","registerFailedSubscription","ServiceWorkerStatus403","ServiceWorkerStatus404","subscribeWithVapidKey","swRegistration","pushPermission","permissionState","userVisibleOnly","onesignalVapidPublicKey","base64String","base64","repeat","rawData","atob","outputArray","charCodeAt","base64ToUint8Array","buffer","doPushUnsubscribe","newPushSubscription","isNewSubscription","doPushSubscribe","getVapidKeyForBrowser","updateSubscriptionTime","updateCreatedAt","applicationServerKey","subscriptionOptions","existingSubscription","isSubscriptionExpiringForSecureIntegration","SUBSCRIPTION_EXPIRATION_STATE","serviceWorkerState","serviceWorkerRegistration","subscriptionCreatedAt","ONE_YEAR","midpointExpirationTime","getSubscriptionStateForSecure","GET_SUBSCRIPTION_STATE","getSubscriptionStateForInsecure","isWorkerActive","helpers_ContextHelper","envPrefix","getBuildEnvPrefix","serviceWorkerManagerConfig","serviceWorkerPath","serviceWorkerUpdaterPath","serviceWorkerParam","subscriptionManagerConfig","UpdateManager_UpdateManager","onSessionSent","enableOnSession","PlayerOnSession","createUser","external_user_id","external_user_id_auth_hash","outcomeRequestData","sendOutcome","AlreadySubscribedError_AlreadySubscribedError","PermissionMessageDismissedError_PermissionMessageDismissedError","getLoadingIndicatorWithColor","SLIDEDOWN_CSS_CLASSES","allowButton","buttonIndicatorHolder","reset","savingStateButton","slideUp","slideDown","closeSlidedown","defaultIcon","loadingContainer","clearfix","SLIDEDOWN_CSS_IDS","normalSlidedown","SLIDEDOWN_BUTTON_CLASSES","alignRight","primary","secondary","slidedownButton","TAGGING_CONTAINER_CSS_CLASSES","categoryLabelInput","categoryLabelText","categoryLabel","checkmark","taggingContainer","taggingContainerCol","loadingMessage","TAGGING_CONTAINER_CSS_IDS","DEFAULT_ICON","COLORS","greyLoadingIndicator","whiteLoadingIndicator","TAGGING_CONTAINER_STRINGS","fetchingPreferences","Slidedown_Slidedown","ALLOW_CLICK","CANCEL_CLICK","CLOSED","getSlidedownPermissionMessageOptions","isShowingFailureState","savingButtonText","errorButtonText","isInUpdateMode","includes","positiveButtonText","negativeButtonText","slidedownElement","dialogProps","messageText","finalIcon","finalIconClass","slidedownBody","bodyMessage","slidedownBodyIcon","slidedownFooter","positiveButton","negativeButton","clearfix2","image","innerText","SlidedownElement_getSlidedownElement","slidedownContainer","dialogContainer","onSlidedownAllowed","onSlidedownCanceled","animationName","insertAdjacentElement","getTextSpan","getIndicatorHolder","getRetryIndicator","indicatorHolder","textHolder","DelayedPromptType","isMacOSSafariInIframe","vendor","EnvironmentInfoHelper_EnvironmentInfoHelper","getBrowser","getBrowserVersion","getOsVersion","canTalkToServiceWorker","Chrome","Opera","isMacOSSafari","Other","isSecureContext","TagUtils_TagUtils","convertedTags","localTags","remoteTags","finalTags","categoryArray","checked","category","existingPlayerTags","isTagObjectEmpty","categoriesCopy","markAllTagsAsSpecified","existingTagValue","tag","getCheckedStatusForTagValue","tagValue","TaggingContainer_TaggingContainer","remoteTagCategories","generateHtml","toggleCheckedTag","loadingMessageContainer","checkedTagCategories","getCheckedTagCategories","firstColumnArr","elem","secondColumnArr","firstColumnContainer","secondColumnContainer","getCategoryLabelElement","tagCategory","label","labelElement","labelSpan","inputElement","checkmarkSpan","wrappingDiv","isChecked","node","PromptsManager_PromptsManager","isAutoPromptShowing","eventHooksInstalled","force","SlidedownPermissionMessage","privateGetSubscription","userPromptOptions","native","nativePromptOptions","getDelayedPromptOptions","Native","isPageViewConditionMetForNative","isPageViewConditionMet","slidedownPromptOptions","Slidedown","isPageViewConditionMetForSlidedown","conditionMetWithNativeOptions","conditionMetWithSlidedownOptions","forceSlidedownWithNativeOptions","internalShowDelayedPrompt","timeDelaySeconds","getEnvironmentInfo","ms","internalShowNativePrompt","internalShowSlidedownPrompt","markHttpSlidedownShown","markHttpsNativePromptDismissed","checkIfAutoPromptShouldBeShown","slideDownOptions","installEventHooksForSlidedown","tagsForComponent","tagCategoryArray","existingTags","getTags","storeRemotePlayerTags","convertTagsApiToBooleans","mount","Slidedown_manageNotifyButtonStateWhileSlidedownShows","setFailureState","getValuesFromTaggingContainer","storeTagValuesToUpdate","setSaveState","promptOptionsForSpecificType","SessionManager_SessionManager","sessionThreshold","enableSessionDuration","outcomes","SessionUpsert","SESSION_UPSERT","SessionDeactivate","SESSION_DEACTIVATE","setupOnFocusAndOnBlurForSession","notifySWToUpsertSession","VisibilityVisible","focusHandler","isFocusEventSetup","blurHandler","isBlurEventSetup","notifySWToDeactivateSession","VisibilityHidden","BeforeUnload","Focus","Blur","sessionPromise","isVisibilityChangeEventSetup","handleVisibilityChange","isBeforeUnloadEventSetup","handleOnBeforeUnload","returnValue","handleOnFocus","handleOnBlur","TagManager_TagManager","tagsFromTaggingContainer","localTagsConvertedToApi","convertTagsBooleansToApi","finalTagsObject","getObjectDifference","Context_Context","getSubscriptionManager","getServiceWorkerManager","metrics","ConfigIntegrationKind","NotificationClickMatchBehavior","NotificationClickActionBehavior","ConfigHelper_IntegrationConfigurationKind","IntegrationConfigurationKind","OneSignalApi_OneSignalApi","getPlayer","jsonp_default","jsonpLib","downloadServerAppConfig","createEmailRecord","updateEmailRecord","logoutEmail","ConfigHelper_MAX_CATEGORIES","ConfigHelper_ConfigHelper","isValidUuid","serverConfig","getMergedConfig","checkRestrictedOrigin","code","restrictedOriginEnabled","doesCurrentOriginMatchConfigOrigin","configOrigin","Custom","WordPress","configuration","JavaScript","Dashboard","configIntegrationKind","getConfigIntegrationKind","getSubdomainForConfigIntegrationKind","setupBehavior","mergedUserConfig","getUserConfigForConfigIntegrationKind","siteInfo","http_use_onesignal_com","features","restrict_origin","mixpanel_reporting_token","safari_web_id","vapid_public_key","onesignal_vapid_public_key","receiveReceiptsEnable","receive_receipts_enable","valueOrDefault","enable_on_session","session_threshold","web_on_focus_enabled","kind","initialState","staticPrompts","defaultsFromServer","wholeUserConfig","customlinkUser","customlinkDefaults","promptOptionsConfig","limitCategoriesToMaxCount","autoRegister","getCustomLinkConfig","getIntegrationCapabilities","workerName","updaterWorkerName","registrationScope","subdomainName","proxyOrigin","getPromptOptionsForDashboardConfiguration","disable","hideWhenSubscribed","circle.background","main","circle.foreground","accent","badge.background","badge.foreground","badge.bordercolor","pulse.color","dialog.button.background.hovering","dialog.button.background.active","dialog.button.background","dialog.button.foreground","tooltip","subscribing","unsubscribing","notificationBehavior","persist","corsEnable","notification.displayed","notificationDisplayedHook","notification.clicked","notificationClickedHook","notification.dismissed","notificationDismissedHook","click","requiresUserPrivacyConsent","notification_attribution","minutes_since_displayed","limit","injectDefaultsIntoPromptOptions","integrationCapabilities","userValue","serverValue","proxyOriginEnabled","shouldUseServerConfigSubdomain","userProvidedSubdomain","capabilities","ConfigManager_ConfigManager","RemoteFrame_RemoteFrame","initOptions","write","rasterizedOptions","listen","ProxyFrame_ProxyFrame","CONNECTED","onMessengerConnect","IFRAME_POPUP_INITIALIZE","onProxyFrameInitializing","onRemoteNotificationPermission","onRemoteDatabaseGet","onRemoteDatabaseGetAll","onRemoteDatabasePut","onRemoteDatabaseRemove","onUnsubscribeFromPush","onMarkPromptDismissed","IS_SUBSCRIBED","onIsSubscribed","UNSUBSCRIBE_PROXY_FRAME","onUnsubscribeProxyFrame","onServiceWorkerState","onWorkerVersion","onSubscriptionExpirationState","onProcessExpiringSubscriptions","onGetSubscriptionState","onSessionUpsert","onSessionDeactivate","onAreYouVisibleRequest","ARE_YOU_VISIBLE_RESPONSE","onAreYouVisibleResponse","finishInitialization","hostInitOptions","pageUrl","initSaveState","saveInitOptions","retrievals","retrievalOpPromises","retrieval","insertions","insertionOpPromises","insertion","removals","removalOpPromises","removal","rebuild","SubscriptionModal_SubscriptionModal","SubscriptionPopup_SubscriptionPopup","onMessengerConnected","HttpHelper_HttpHelper","ensureBackwardsCompatibility","ProxyFrameHost_ProxyFrameHost","LOAD_TIMEOUT_MS","sandbox","onFrameLoad","contentWindow","onRemoteNotificationPermissionChanged","REQUEST_HOST_URL","onRequestHostUrl","onServiceWorkerCommandRedirect","onGetEventListenerCount","startsWith","_reply","AltOriginManager_AltOriginManager","iframeUrls","getOneSignalProxyIframeUrls","allProxyFrameHosts","iframeUrl","subscribedProxyFrameHosts","preferredProxyFrameHost","removeDuplicatedAltOriginSubscription","proxyFrameHosts","toUnsubscribeProxyFrameHosts","dupSubscribedHost","subscriptionDomain","getWildcardLegacySubscriptionDomain","legacyDomainUrl","urls","apiUrl","envSubdomainParts","lastParts","getCanonicalSubscriptionUrls","ValidatorUtils","allowNull","allowEmpty","parsedUrl","requireHttps","bool","array","ProcessOneSignalPushCalls_ProcessOneSignalPushCalls","oneSignalInstance","oneSignalFunction","isValidUrl","isIdentifierAuthHashDefined","isEmailAuthHashDefined","emailAuthHash","isIdentifierAuthHashMalformed","isEmailAuthHashIsMalformed","existingEmailProfile","newEmailProfile","isExistingEmailSaved","isExistingPushRecordSaved","emailPreviouslySavedAndDifferent","emailPreviouslySavedAndChanged","polyfillSafariFetch","errorIfInitAlreadyCalled","initializeConfig","pendingInit","delayedInit","__init","__initAlreadyCalled","onNotificationPermissionChange","_onSubscriptionChanged","onSdkInitialized","setupSessionEventListenersForHttp","discoverAltOrigin","internalInit","readyState","onreadystatechange","showHttpPrompt","internalShowCategorySlidedown","onComplete","emailOptions","deleteTags","isValidArray","tagsToSend","deletedTags","deletedTagKeys","sendExternalUserIdUpdate","fireStoredNotificationClicks","registrationId","isValidBoolean","getNotificationTypeFromOptIn","onInternalSubscriptionSet","doOptOut","subscriptionStatus","processItem","outcomeWeight","outcomesHelper","beforeOutcomeSend","send","Outcomes","newNotifsToAttributeWithOutcome","getNotifsToAttributeWithUniqueOutcome","shouldSendUnique","VERSION","_VERSION","sdkEnvironment","_notificationOpenedCallbacks","_idsAvailable_callback","_defaultLaunchURL","_isNotificationEnabledCallback","_subscriptionSet","modalUrl","_channel","timedLocalStorage","indexedDb","mainHelper","subscriptionHelper","httpHelper","eventHelper","initHelper","testHelper","_LOGGING","LOGGING","checkAndWipeUserSubscription","EmailDeviceRecord","_initHttp","initHttp","_initPopup","FINISH_REMOTE_REGISTRATION_IN_PROGRESS","TEST_INIT_OPTION_DISABLED","TEST_WOULD_DISPLAY","g","Function","eval"],"mappings":"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","file":"OneSignalPageSDKES6.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 39);\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = Object.setPrototypeOf ||\r\n    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);  }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { if (o[n]) i[n] = function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; }; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator];\r\n    return m ? m.call(o) : typeof __values === \"function\" ? __values(o) : o[Symbol.iterator]();\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export default class Log {\n    static shouldLog() {\n        try {\n            if (typeof window === \"undefined\" ||\n                typeof window.localStorage === \"undefined\") {\n                return false;\n            }\n            const level = window.localStorage.getItem(\"loglevel\");\n            if (level && level.toLowerCase() === \"trace\") {\n                return true;\n            }\n            else {\n                return false;\n            }\n        }\n        catch (e) {\n            /* LocalStorage may not be accessible on browser profiles that restrict 3rd party cookies */\n            return false;\n        }\n        ;\n    }\n    static setLevel(level) {\n        if (typeof window === \"undefined\" ||\n            typeof window.localStorage === \"undefined\") {\n            return;\n        }\n        try {\n            window.localStorage.setItem(\"loglevel\", level);\n            Log.proxyMethodsCreated = undefined;\n            Log.createProxyMethods();\n        }\n        catch (e) {\n            /* LocalStorage may not be accessible on browser profiles that restrict 3rd party cookies */\n            return;\n        }\n        ;\n    }\n    static createProxyMethods() {\n        if (typeof Log.proxyMethodsCreated !== \"undefined\") {\n            return;\n        }\n        else {\n            Log.proxyMethodsCreated = true;\n        }\n        const methods = {\n            \"log\": \"debug\",\n            \"trace\": \"trace\",\n            \"info\": \"info\",\n            \"warn\": \"warn\",\n            \"error\": \"error\"\n        };\n        for (const nativeMethod of Object.keys(methods)) {\n            const nativeMethodExists = typeof console[nativeMethod] !== \"undefined\";\n            const methodToMapTo = methods[nativeMethod];\n            const shouldMap = nativeMethodExists &&\n                ((typeof __LOGGING__ !== \"undefined\" && __LOGGING__ === true) ||\n                    (Log.shouldLog()) ||\n                    methodToMapTo === \"error\");\n            if (shouldMap) {\n                Log[methodToMapTo] = console[nativeMethod].bind(console);\n            }\n            else {\n                Log[methodToMapTo] = function () { };\n            }\n        }\n    }\n}\nLog.createProxyMethods();\n//# sourceMappingURL=Log.js.map","import SdkEnvironment from './managers/SdkEnvironment';\nimport { WindowEnvironmentKind } from './models/WindowEnvironmentKind';\nimport Database from './services/Database';\nimport Log from './libraries/Log';\nimport { OneSignalUtils } from './utils/OneSignalUtils';\nimport { PermissionUtils } from './utils/PermissionUtils';\nimport { BrowserUtils } from './utils/BrowserUtils';\nimport { Utils } from \"./context/shared/utils/Utils\";\nimport bowser from 'bowser';\nexport function isArray(variable) {\n    return Object.prototype.toString.call(variable) === '[object Array]';\n}\nexport function decodeHtmlEntities(text) {\n    return BrowserUtils.decodeHtmlEntities(text);\n}\nexport function removeDomElement(selector) {\n    var els = document.querySelectorAll(selector);\n    if (els.length > 0) {\n        for (let i = 0; i < els.length; i++) {\n            const parentNode = els[i].parentNode;\n            if (parentNode) {\n                parentNode.removeChild(els[i]);\n            }\n        }\n    }\n}\n/**\n * Helper method for public APIs that waits until OneSignal is initialized, rejects if push notifications are\n * not supported, and wraps these tasks in a Promise.\n */\nexport async function awaitOneSignalInitAndSupported() {\n    return new Promise(resolve => {\n        if (!OneSignal.initialized)\n            OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED, resolve);\n        else\n            resolve();\n    });\n}\n/**\n * Returns true if web push subscription occurs on a subdomain of OneSignal.\n * If true, our main IndexedDB is stored on the subdomain of onesignal.com, and not the user's site.\n * @remarks\n *   This method returns true if:\n *     - The browser is not Safari\n *         - Safari uses a different method of subscription and does not require our workaround\n *     - The init parameters contain a subdomain (even if the protocol is HTTPS)\n *         - HTTPS users using our subdomain workaround still have the main IndexedDB stored on our subdomain\n *        - The protocol of the current webpage is http:\n *   Exceptions are:\n *     - Safe hostnames like localhost and 127.0.0.1\n *          - Because we don't want users to get the wrong idea when testing on localhost that direct permission is supported on HTTP, we'll ignore these exceptions. HTTPS will always be required for direct permission\n *        - We are already in popup or iFrame mode, or this is called from the service worker\n */\nexport function isUsingSubscriptionWorkaround() {\n    return OneSignalUtils.isUsingSubscriptionWorkaround();\n}\nexport async function triggerNotificationPermissionChanged(updateIfIdentical = false) {\n    return PermissionUtils.triggerNotificationPermissionChanged(updateIfIdentical);\n}\n/**\n * JSON.stringify() but converts functions to \"[Function]\" so they aren't lost.\n * Helps when logging method calls.\n */\nexport function stringify(obj) {\n    return Utils.stringify(obj);\n}\nexport function executeCallback(callback, ...args) {\n    if (callback) {\n        return callback.apply(null, args);\n    }\n}\nexport function logMethodCall(methodName, ...args) {\n    return OneSignalUtils.logMethodCall(methodName, ...args);\n}\nexport function isValidEmail(email) {\n    return !!email &&\n        !!email.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])/);\n}\nexport function addDomElement(targetSelectorOrElement, addOrder, elementHtml) {\n    let targetElement;\n    if (typeof targetSelectorOrElement === 'string') {\n        targetElement = document.querySelector(targetSelectorOrElement);\n    }\n    else {\n        targetElement = targetSelectorOrElement;\n    }\n    if (targetElement) {\n        targetElement.insertAdjacentHTML(addOrder, elementHtml);\n        return;\n    }\n    throw new Error(`${targetSelectorOrElement} must be a CSS selector string or DOM Element object.`);\n}\nexport function clearDomElementChildren(targetSelectorOrElement) {\n    if (typeof targetSelectorOrElement === 'string') {\n        const element = document.querySelector(targetSelectorOrElement);\n        if (element === null) {\n            throw new Error(`Cannot find element with selector \"${targetSelectorOrElement}\"`);\n        }\n        while (element.firstChild) {\n            element.removeChild(element.firstChild);\n        }\n    }\n    else if (typeof targetSelectorOrElement === 'object') {\n        while (targetSelectorOrElement.firstChild) {\n            targetSelectorOrElement.removeChild(targetSelectorOrElement.firstChild);\n        }\n    }\n    else\n        throw new Error(`${targetSelectorOrElement} must be a CSS selector string or DOM Element object.`);\n}\nexport function addCssClass(targetSelectorOrElement, cssClass) {\n    if (typeof targetSelectorOrElement === 'string') {\n        const element = document.querySelector(targetSelectorOrElement);\n        if (element === null) {\n            throw new Error(`Cannot find element with selector \"${targetSelectorOrElement}\"`);\n        }\n        element.classList.add(cssClass);\n    }\n    else if (typeof targetSelectorOrElement === 'object') {\n        targetSelectorOrElement.classList.add(cssClass);\n    }\n    else {\n        throw new Error(`${targetSelectorOrElement} must be a CSS selector string or DOM Element object.`);\n    }\n}\nexport function removeCssClass(targetSelectorOrElement, cssClass) {\n    if (typeof targetSelectorOrElement === 'string') {\n        const element = document.querySelector(targetSelectorOrElement);\n        if (element === null) {\n            throw new Error(`Cannot find element with selector \"${targetSelectorOrElement}\"`);\n        }\n        element.classList.remove(cssClass);\n    }\n    else if (typeof targetSelectorOrElement === 'object') {\n        targetSelectorOrElement.classList.remove(cssClass);\n    }\n    else {\n        throw new Error(`${targetSelectorOrElement} must be a CSS selector string or DOM Element object.`);\n    }\n}\nexport function hasCssClass(targetSelectorOrElement, cssClass) {\n    if (typeof targetSelectorOrElement === 'string') {\n        const element = document.querySelector(targetSelectorOrElement);\n        if (element === null) {\n            throw new Error(`Cannot find element with selector \"${targetSelectorOrElement}\"`);\n        }\n        return element.classList.contains(cssClass);\n    }\n    else if (typeof targetSelectorOrElement === 'object') {\n        return targetSelectorOrElement.classList.contains(cssClass);\n    }\n    else {\n        throw new Error(`${targetSelectorOrElement} must be a CSS selector string or DOM Element object.`);\n    }\n}\n/**\n * var DEVICE_TYPES = {\n *  CHROME: 5,\n *  SAFARI: 7,\n *  FIREFOX: 8,\n *  EDGE: 12,\n *  UNKNOWN: -99\n * };\n */\nexport function getConsoleStyle(style) {\n    return Utils.getConsoleStyle(style);\n}\n/**\n * Returns a promise for the setTimeout() method.\n * @param durationMs\n * @returns {Promise} Returns a promise that resolves when the timeout is complete.\n */\nexport function delay(durationMs) {\n    return new Promise((resolve) => {\n        setTimeout(resolve, durationMs);\n    });\n}\nexport function nothing() {\n    return Promise.resolve();\n}\nexport function timeoutPromise(promise, milliseconds) {\n    return Utils.timeoutPromise(promise, milliseconds);\n}\nexport function when(condition, promiseIfTrue, promiseIfFalse) {\n    if (promiseIfTrue === undefined)\n        promiseIfTrue = nothing();\n    if (promiseIfFalse === undefined)\n        promiseIfFalse = nothing();\n    return (condition ? promiseIfTrue : promiseIfFalse);\n}\n/**\n * Returns true if match is in string; otherwise, returns false.\n */\nexport function contains(indexOfAble, match) {\n    return Utils.contains(indexOfAble, match);\n}\n/**\n * Returns the current object without keys that have undefined values.\n * Regardless of whether the return result is used, the passed-in object is destructively modified.\n * Only affects keys that the object directly contains (i.e. not those inherited via the object's prototype).\n * @param object\n */\nexport function trimUndefined(object) {\n    return Utils.trimUndefined(object);\n}\nexport function getRandomUuid() {\n    return OneSignalUtils.getRandomUuid();\n}\n/**\n * Returns true if the UUID is a string of 36 characters;\n * @param uuid\n * @returns {*|boolean}\n */\nexport function isValidUuid(uuid) {\n    return OneSignalUtils.isValidUuid(uuid);\n}\nexport function getUrlQueryParam(name) {\n    let url = window.location.href;\n    url = url.toLowerCase(); // This is just to avoid case sensitiveness\n    name = name.replace(/[\\[\\]]/g, \"\\\\$&\").toLowerCase(); // This is just to avoid case sensitiveness for query parameter name\n    var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"), results = regex.exec(url);\n    if (!results)\n        return null;\n    if (!results[2])\n        return '';\n    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n/**\n * Wipe OneSignal-related IndexedDB data on the \"correct\" computed origin, but OneSignal must be initialized first to use.\n */\nexport function wipeIndexedDb() {\n    Log.warn('OneSignal: Wiping IndexedDB data.');\n    return Promise.all([\n        Database.remove('Ids'),\n        Database.remove('NotificationOpened'),\n        Database.remove('Options')\n    ]);\n}\n/**\n * Capitalizes the first letter of the string.\n * @returns {string} The string with the first letter capitalized.\n */\nexport function capitalize(text) {\n    return Utils.capitalize(text);\n}\n/**\n * Unsubscribe from push notifications without removing the active service worker.\n */\nexport function unsubscribeFromPush() {\n    Log.warn('OneSignal: Unsubscribing from push.');\n    if (SdkEnvironment.getWindowEnv() !== WindowEnvironmentKind.ServiceWorker) {\n        return self.registration.pushManager.getSubscription()\n            .then((subscription) => {\n            if (subscription) {\n                return subscription.unsubscribe();\n            }\n            else\n                throw new Error('Cannot unsubscribe because not subscribed.');\n        });\n    }\n    else {\n        if (isUsingSubscriptionWorkaround()) {\n            return new Promise((resolve, reject) => {\n                Log.debug(\"Unsubscribe from push got called, and we're going to remotely execute it in HTTPS iFrame.\");\n                OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.UNSUBSCRIBE_FROM_PUSH, null, (reply) => {\n                    Log.debug(\"Unsubscribe from push succesfully remotely executed.\");\n                    if (reply.data === OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE) {\n                        resolve();\n                    }\n                    else {\n                        reject('Failed to remotely unsubscribe from push.');\n                    }\n                });\n            });\n        }\n        else {\n            if (!navigator.serviceWorker || !navigator.serviceWorker.controller)\n                return Promise.resolve();\n            return navigator.serviceWorker.ready\n                .then(registration => registration.pushManager)\n                .then(pushManager => pushManager.getSubscription())\n                .then((subscription) => {\n                if (subscription) {\n                    return subscription.unsubscribe();\n                }\n                else {\n                    return Promise.resolve();\n                }\n            });\n        }\n    }\n}\nexport function wait(milliseconds) {\n    return new Promise(resolve => setTimeout(resolve, milliseconds));\n}\n/**\n * Returns the part of the string after the first occurence of the specified search.\n * @param string The entire string.\n * @param search The text returned will be everything *after* search.\n * e.g. substringAfter('A white fox', 'white') => ' fox'\n */\nexport function substringAfter(string, search) {\n    return string.substr(string.indexOf(search) + search.length);\n}\nexport function once(targetSelectorOrElement, event, task, manualDestroy = false) {\n    if (!event) {\n        Log.error('Cannot call on() with no event: ', event);\n    }\n    if (!task) {\n        Log.error('Cannot call on() with no task: ', task);\n    }\n    if (typeof targetSelectorOrElement === 'string') {\n        let els = document.querySelectorAll(targetSelectorOrElement);\n        if (els.length > 0) {\n            for (let i = 0; i < els.length; i++)\n                once(els[i], event, task);\n        }\n    }\n    else if (isArray(targetSelectorOrElement)) {\n        for (let i = 0; i < targetSelectorOrElement.length; i++)\n            once(targetSelectorOrElement[i], event, task);\n    }\n    else if (typeof targetSelectorOrElement === 'object') {\n        var taskWrapper = (function () {\n            var internalTaskFunction = function (e) {\n                var destroyEventListener = function () {\n                    targetSelectorOrElement.removeEventListener(e.type, taskWrapper);\n                };\n                if (!manualDestroy) {\n                    destroyEventListener();\n                }\n                task(e, destroyEventListener);\n            };\n            return internalTaskFunction;\n        })();\n        targetSelectorOrElement.addEventListener(event, taskWrapper);\n    }\n    else\n        throw new Error(`${targetSelectorOrElement} must be a CSS selector string or DOM Element object.`);\n}\n/**\n * Returns the number of times the SDK has been loaded into the browser.\n * Expects a browser environment, otherwise this call will fail.\n */\nexport function getSdkLoadCount() {\n    return window.__oneSignalSdkLoadCount || 0;\n}\nexport async function awaitSdkEvent(eventName, predicate) {\n    return await new Promise(resolve => {\n        OneSignal.emitter.once(eventName, (event) => {\n            if (predicate) {\n                const predicateResult = predicate(event);\n                if (predicateResult)\n                    resolve(event);\n            }\n            else\n                resolve(event);\n        });\n    });\n}\n/**\n * Increments the counter describing the number of times the SDK has been loaded into the browser.\n * Expects a browser environment, otherwise this call will fail.\n */\nexport function incrementSdkLoadCount() {\n    window.__oneSignalSdkLoadCount = getSdkLoadCount() + 1;\n}\nexport function getPlatformNotificationIcon(notificationIcons) {\n    if (!notificationIcons)\n        return 'default-icon';\n    if (bowser.safari && notificationIcons.safari)\n        return notificationIcons.safari;\n    else if (bowser.firefox && notificationIcons.firefox)\n        return notificationIcons.firefox;\n    return notificationIcons.chrome ||\n        notificationIcons.firefox ||\n        notificationIcons.safari ||\n        'default-icon';\n}\nexport function getDomElementOrStub(selector) {\n    const foundElement = document.querySelector(selector);\n    if (!foundElement) {\n        Log.debug(`No instance of ${selector} found. Returning stub.`);\n        return document.createElement('div');\n    }\n    return foundElement;\n}\nexport function deepCopy(obj) {\n    return JSON.parse(JSON.stringify(obj));\n}\n//# sourceMappingURL=utils.js.map","class AppState {\n}\nexport { AppState };\n//# sourceMappingURL=AppState.js.map","class ServiceWorkerState {\n}\nexport { ServiceWorkerState };\n//# sourceMappingURL=ServiceWorkerState.js.map","import Emitter from \"../libraries/Emitter\";\nimport IndexedDb from \"./IndexedDb\";\nimport { AppState } from \"../models/AppState\";\nimport { ServiceWorkerState } from \"../models/ServiceWorkerState\";\nimport { Subscription } from \"../models/Subscription\";\nimport { TestEnvironmentKind } from \"../models/TestEnvironmentKind\";\nimport { WindowEnvironmentKind } from \"../models/WindowEnvironmentKind\";\nimport { EmailProfile } from \"../models/EmailProfile\";\nimport { ONESIGNAL_SESSION_KEY } from \"../models/Session\";\nimport SdkEnvironment from \"../managers/SdkEnvironment\";\nimport OneSignalUtils from \"../utils/OneSignalUtils\";\nimport Utils from \"../context/shared/utils/Utils\";\nimport Log from \"../libraries/Log\";\nvar DatabaseEventName;\n(function (DatabaseEventName) {\n    DatabaseEventName[DatabaseEventName[\"SET\"] = 0] = \"SET\";\n})(DatabaseEventName || (DatabaseEventName = {}));\nexport default class Database {\n    constructor(databaseName) {\n        this.databaseName = databaseName;\n        this.emitter = new Emitter();\n        this.database = new IndexedDb(this.databaseName);\n    }\n    static resetInstance() {\n        Database.databaseInstance = null;\n    }\n    static get singletonInstance() {\n        if (!Database.databaseInstanceName) {\n            Database.databaseInstanceName = \"ONE_SIGNAL_SDK_DB\";\n        }\n        if (!Database.databaseInstance) {\n            Database.databaseInstance = new Database(Database.databaseInstanceName);\n        }\n        return Database.databaseInstance;\n    }\n    static applyDbResultFilter(table, key, result) {\n        switch (table) {\n            case \"Options\":\n                if (result && key)\n                    return result.value;\n                else if (result && !key)\n                    return result;\n                else\n                    return null;\n            case \"Ids\":\n                if (result && key)\n                    return result.id;\n                else if (result && !key)\n                    return result;\n                else\n                    return null;\n            case \"NotificationOpened\":\n                if (result && key)\n                    return { data: result.data, timestamp: result.timestamp };\n                else if (result && !key)\n                    return result;\n                else\n                    return null;\n            default:\n                if (result)\n                    return result;\n                else\n                    return null;\n        }\n    }\n    shouldUsePostmam() {\n        return SdkEnvironment.getWindowEnv() !== WindowEnvironmentKind.ServiceWorker &&\n            OneSignalUtils.isUsingSubscriptionWorkaround() &&\n            SdkEnvironment.getTestEnv() === TestEnvironmentKind.None;\n    }\n    /**\n     * Asynchronously retrieves the value of the key at the table (if key is specified), or the entire table\n     * (if key is not specified).\n     * If on an iFrame or popup environment, retrieves from the correct IndexedDB database using cross-domain messaging.\n     * @param table The table to retrieve the value from.\n     * @param key The key in the table to retrieve the value of. Leave blank to get the entire table.\n     * @returns {Promise} Returns a promise that fulfills when the value(s) are available.\n     */\n    async get(table, key) {\n        if (this.shouldUsePostmam()) {\n            return await new Promise(async (resolve) => {\n                OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET, [{\n                        table: table,\n                        key: key\n                    }], (reply) => {\n                    const result = reply.data[0];\n                    resolve(result);\n                });\n            });\n        }\n        else {\n            const result = await this.database.get(table, key);\n            const cleanResult = Database.applyDbResultFilter(table, key, result);\n            return cleanResult;\n        }\n    }\n    async getAll(table) {\n        if (this.shouldUsePostmam()) {\n            return await new Promise(async (resolve) => {\n                OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET_ALL, {\n                    table: table\n                }, (reply) => {\n                    const result = reply.data;\n                    resolve(result);\n                });\n            });\n        }\n        else {\n            const result = await this.database.getAll(table);\n            return result;\n        }\n    }\n    /**\n     * Asynchronously puts the specified value in the specified table.\n     * @param table\n     * @param keypath\n     */\n    async put(table, keypath) {\n        await new Promise(async (resolve, reject) => {\n            if (SdkEnvironment.getWindowEnv() !== WindowEnvironmentKind.ServiceWorker &&\n                OneSignalUtils.isUsingSubscriptionWorkaround() &&\n                SdkEnvironment.getTestEnv() === TestEnvironmentKind.None) {\n                OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_PUT, [{ table: table, keypath: keypath }], (reply) => {\n                    if (reply.data === OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE) {\n                        resolve();\n                    }\n                    else {\n                        reject(`(Database) Attempted remote IndexedDB put(${table}, ${keypath}),` +\n                            `but did not get success response.`);\n                    }\n                });\n            }\n            else {\n                await this.database.put(table, keypath);\n                resolve();\n            }\n        });\n        this.emitter.emit(Database.EVENTS.SET, keypath);\n    }\n    /**\n     * Asynchronously removes the specified key from the table, or if the key is not specified, removes all\n     * keys in the table.\n     * @returns {Promise} Returns a promise containing a key that is fulfilled when deletion is completed.\n     */\n    remove(table, keypath) {\n        if (SdkEnvironment.getWindowEnv() !== WindowEnvironmentKind.ServiceWorker &&\n            OneSignalUtils.isUsingSubscriptionWorkaround() &&\n            SdkEnvironment.getTestEnv() === TestEnvironmentKind.None) {\n            return new Promise((resolve, reject) => {\n                OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_REMOVE, [{ table: table, keypath: keypath }], (reply) => {\n                    if (reply.data === OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE) {\n                        resolve();\n                    }\n                    else {\n                        reject(`(Database) Attempted remote IndexedDB remove(${table}, ${keypath}),` +\n                            `but did not get success response.`);\n                    }\n                });\n            });\n        }\n        else {\n            return this.database.remove(table, keypath);\n        }\n    }\n    async getAppConfig() {\n        const config = {};\n        const appIdStr = await this.get(\"Ids\", \"appId\");\n        config.appId = appIdStr;\n        config.subdomain = await this.get(\"Options\", \"subdomain\");\n        config.vapidPublicKey = await this.get(\"Options\", \"vapidPublicKey\");\n        return config;\n    }\n    async getExternalUserId() {\n        return await this.get(\"Ids\", \"externalUserId\");\n    }\n    async getExternalUserIdAuthHash() {\n        return await this.get(\"Ids\", \"externalUserIdAuthHash\");\n    }\n    async setExternalUserId(externalUserId, authHash) {\n        const emptyString = \"\";\n        const externalIdToSave = Utils.getValueOrDefault(externalUserId, emptyString);\n        const authHashToSave = Utils.getValueOrDefault(authHash, emptyString);\n        if (externalIdToSave === emptyString) {\n            await this.remove(\"Ids\", \"externalUserId\");\n        }\n        else {\n            await this.put(\"Ids\", { type: \"externalUserId\", id: externalIdToSave });\n        }\n        if (authHashToSave === emptyString) {\n            await this.remove(\"Ids\", \"externalUserIdAuthHash\");\n        }\n        else {\n            await this.put(\"Ids\", { type: \"externalUserIdAuthHash\", id: authHashToSave });\n        }\n    }\n    async setAppConfig(appConfig) {\n        if (appConfig.appId)\n            await this.put(\"Ids\", { type: \"appId\", id: appConfig.appId });\n        if (appConfig.subdomain)\n            await this.put(\"Options\", { key: \"subdomain\", value: appConfig.subdomain });\n        if (appConfig.httpUseOneSignalCom === true)\n            await this.put(\"Options\", { key: \"httpUseOneSignalCom\", value: true });\n        else if (appConfig.httpUseOneSignalCom === false)\n            await this.put(\"Options\", { key: \"httpUseOneSignalCom\", value: false });\n        if (appConfig.vapidPublicKey)\n            await this.put(\"Options\", { key: \"vapidPublicKey\", value: appConfig.vapidPublicKey });\n    }\n    async getAppState() {\n        const state = new AppState();\n        state.defaultNotificationUrl = await this.get(\"Options\", \"defaultUrl\");\n        state.defaultNotificationTitle = await this.get(\"Options\", \"defaultTitle\");\n        state.lastKnownPushEnabled = await this.get(\"Options\", \"isPushEnabled\");\n        state.clickedNotifications = await this.get(\"NotificationOpened\");\n        return state;\n    }\n    async setAppState(appState) {\n        if (appState.defaultNotificationUrl)\n            await this.put(\"Options\", { key: \"defaultUrl\", value: appState.defaultNotificationUrl });\n        if (appState.defaultNotificationTitle || appState.defaultNotificationTitle === \"\")\n            await this.put(\"Options\", { key: \"defaultTitle\", value: appState.defaultNotificationTitle });\n        if (appState.lastKnownPushEnabled != null)\n            await this.put(\"Options\", { key: \"isPushEnabled\", value: appState.lastKnownPushEnabled });\n        if (appState.clickedNotifications) {\n            const clickedNotificationUrls = Object.keys(appState.clickedNotifications);\n            for (const url of clickedNotificationUrls) {\n                const notificationDetails = appState.clickedNotifications[url];\n                if (notificationDetails) {\n                    await this.put(\"NotificationOpened\", {\n                        url: url,\n                        data: notificationDetails.data,\n                        timestamp: notificationDetails.timestamp\n                    });\n                }\n                else if (notificationDetails === null) {\n                    // If we get an object like:\n                    // { \"http://site.com/page\": null}\n                    // It means we need to remove that entry\n                    await this.remove(\"NotificationOpened\", url);\n                }\n            }\n        }\n    }\n    async getServiceWorkerState() {\n        const state = new ServiceWorkerState();\n        state.workerVersion = await this.get(\"Ids\", \"WORKER1_ONE_SIGNAL_SW_VERSION\");\n        state.updaterWorkerVersion = await this.get(\"Ids\", \"WORKER2_ONE_SIGNAL_SW_VERSION\");\n        return state;\n    }\n    async setServiceWorkerState(state) {\n        if (state.workerVersion)\n            await this.put(\"Ids\", { type: \"WORKER1_ONE_SIGNAL_SW_VERSION\", id: state.workerVersion });\n        if (state.updaterWorkerVersion)\n            await this.put(\"Ids\", { type: \"WORKER2_ONE_SIGNAL_SW_VERSION\", id: state.updaterWorkerVersion });\n    }\n    async getSubscription() {\n        const subscription = new Subscription();\n        subscription.deviceId = await this.get(\"Ids\", \"userId\");\n        subscription.subscriptionToken = await this.get(\"Ids\", \"registrationId\");\n        // The preferred database key to store our subscription\n        const dbOptedOut = await this.get(\"Options\", \"optedOut\");\n        // For backwards compatibility, we need to read from this if the above is not found\n        const dbNotOptedOut = await this.get(\"Options\", \"subscription\");\n        const createdAt = await this.get(\"Options\", \"subscriptionCreatedAt\");\n        const expirationTime = await this.get(\"Options\", \"subscriptionExpirationTime\");\n        if (dbOptedOut != null) {\n            subscription.optedOut = dbOptedOut;\n        }\n        else {\n            if (dbNotOptedOut == null) {\n                subscription.optedOut = false;\n            }\n            else {\n                subscription.optedOut = !dbNotOptedOut;\n            }\n        }\n        subscription.createdAt = createdAt;\n        subscription.expirationTime = expirationTime;\n        return subscription;\n    }\n    async setDeviceId(deviceId) {\n        await this.put(\"Ids\", { type: \"userId\", id: deviceId });\n    }\n    async setSubscription(subscription) {\n        if (subscription.deviceId) {\n            await this.setDeviceId(subscription.deviceId);\n        }\n        if (typeof subscription.subscriptionToken !== \"undefined\") {\n            // Allow null subscriptions to be set\n            await this.put(\"Ids\", { type: \"registrationId\", id: subscription.subscriptionToken });\n        }\n        if (subscription.optedOut != null) { // Checks if null or undefined, allows false\n            await this.put(\"Options\", { key: \"optedOut\", value: subscription.optedOut });\n        }\n        if (subscription.createdAt != null) {\n            await this.put(\"Options\", { key: \"subscriptionCreatedAt\", value: subscription.createdAt });\n        }\n        if (subscription.expirationTime != null) {\n            await this.put(\"Options\", { key: \"subscriptionExpirationTime\", value: subscription.expirationTime });\n        }\n        else {\n            await this.remove(\"Options\", \"subscriptionExpirationTime\");\n        }\n    }\n    async getEmailProfile() {\n        const profileJson = await this.get(\"Ids\", \"emailProfile\");\n        if (profileJson) {\n            return EmailProfile.deserialize(profileJson);\n        }\n        else {\n            return new EmailProfile();\n        }\n    }\n    async setEmailProfile(emailProfile) {\n        if (emailProfile) {\n            await this.put(\"Ids\", { type: \"emailProfile\", id: emailProfile.serialize() });\n        }\n    }\n    async setProvideUserConsent(consent) {\n        await this.put(\"Options\", { key: \"userConsent\", value: consent });\n    }\n    async getProvideUserConsent() {\n        return await this.get(\"Options\", \"userConsent\");\n    }\n    async getSession(sessionKey) {\n        return await this.get(\"Sessions\", sessionKey);\n    }\n    async setSession(session) {\n        await this.put(\"Sessions\", session);\n    }\n    async removeSession(sessionKey) {\n        await this.remove(\"Sessions\", sessionKey);\n    }\n    async getLastNotificationClicked(appId) {\n        let allClickedNotifications = [];\n        try {\n            allClickedNotifications = await this.getAll(\"NotificationClicked\");\n        }\n        catch (e) {\n            Log.error(\"Database.getNotificationClickedByUrl\", e);\n        }\n        const predicate = (notification) => notification.appId === appId;\n        return allClickedNotifications.find(predicate) || null;\n    }\n    async getNotificationClickedByUrl(url, appId) {\n        let allClickedNotifications = [];\n        try {\n            allClickedNotifications = await this.getAll(\"NotificationClicked\");\n        }\n        catch (e) {\n            Log.error(\"Database.getNotificationClickedByUrl\", e);\n        }\n        const predicate = (notification) => {\n            if (notification.appId !== appId) {\n                return false;\n            }\n            return new URL(url).origin === new URL(notification.url).origin;\n        };\n        return allClickedNotifications.find(predicate) || null;\n    }\n    async getNotificationClickedById(notificationId) {\n        return await this.get(\"NotificationClicked\", notificationId);\n    }\n    async getNotificationReceivedById(notificationId) {\n        return await this.get(\"NotificationReceived\", notificationId);\n    }\n    async removeNotificationClickedById(notificationId) {\n        await this.remove(\"NotificationClicked\", notificationId);\n    }\n    async removeAllNotificationClicked() {\n        await this.remove(\"NotificationClicked\");\n    }\n    async resetSentUniqueOutcomes() {\n        const outcomes = await this.getAll(\"SentUniqueOutcome\");\n        const promises = outcomes.map(o => {\n            o.sentDuringSession = null;\n            return Database.put(\"SentUniqueOutcome\", o);\n        });\n        await Promise.all(promises);\n    }\n    /**\n     * Asynchronously removes the Ids, NotificationOpened, and Options tables from the database and recreates them\n     * with blank values.\n     * @returns {Promise} Returns a promise that is fulfilled when rebuilding is completed, or rejects with an error.\n     */\n    static async rebuild() {\n        return Promise.all([\n            Database.singletonInstance.remove(\"Ids\"),\n            Database.singletonInstance.remove(\"NotificationOpened\"),\n            Database.singletonInstance.remove(\"Options\"),\n            Database.singletonInstance.remove(\"NotificationReceived\"),\n            Database.singletonInstance.remove(\"NotificationClicked\"),\n            Database.singletonInstance.remove(\"SentUniqueOutcome\")\n        ]);\n    }\n    // START: Static mappings to instance methods\n    static async on(...args) {\n        return Database.singletonInstance.emitter.on.apply(Database.singletonInstance.emitter, args);\n    }\n    static async getCurrentSession() {\n        return await Database.singletonInstance.getSession(ONESIGNAL_SESSION_KEY);\n    }\n    static async upsertSession(session) {\n        await Database.singletonInstance.setSession(session);\n    }\n    static async cleanupCurrentSession() {\n        await Database.singletonInstance.removeSession(ONESIGNAL_SESSION_KEY);\n    }\n    static async setEmailProfile(emailProfile) {\n        return await Database.singletonInstance.setEmailProfile(emailProfile);\n    }\n    static async getEmailProfile() {\n        return await Database.singletonInstance.getEmailProfile();\n    }\n    static async setSubscription(subscription) {\n        return await Database.singletonInstance.setSubscription(subscription);\n    }\n    static async getSubscription() {\n        return await Database.singletonInstance.getSubscription();\n    }\n    static async setProvideUserConsent(consent) {\n        return await Database.singletonInstance.setProvideUserConsent(consent);\n    }\n    static async getProvideUserConsent() {\n        return await Database.singletonInstance.getProvideUserConsent();\n    }\n    static async setServiceWorkerState(workerState) {\n        return await Database.singletonInstance.setServiceWorkerState(workerState);\n    }\n    static async getServiceWorkerState() {\n        return await Database.singletonInstance.getServiceWorkerState();\n    }\n    static async setAppState(appState) {\n        return await Database.singletonInstance.setAppState(appState);\n    }\n    static async getAppState() {\n        return await Database.singletonInstance.getAppState();\n    }\n    static async setAppConfig(appConfig) {\n        return await Database.singletonInstance.setAppConfig(appConfig);\n    }\n    static async getAppConfig() {\n        return await Database.singletonInstance.getAppConfig();\n    }\n    static async getExternalUserId() {\n        return await Database.singletonInstance.getExternalUserId();\n    }\n    static async getExternalUserIdAuthHash() {\n        return await Database.singletonInstance.getExternalUserIdAuthHash();\n    }\n    static async getLastNotificationClicked(appId) {\n        return await Database.singletonInstance.getLastNotificationClicked(appId);\n    }\n    static async removeNotificationClickedById(notificationId) {\n        return await Database.singletonInstance.removeNotificationClickedById(notificationId);\n    }\n    static async removeAllNotificationClicked() {\n        return await Database.singletonInstance.removeAllNotificationClicked();\n    }\n    static async resetSentUniqueOutcomes() {\n        return await Database.singletonInstance.resetSentUniqueOutcomes();\n    }\n    static async getNotificationClickedByUrl(url, appId) {\n        return await Database.singletonInstance.getNotificationClickedByUrl(url, appId);\n    }\n    static async getNotificationClickedById(notificationId) {\n        return await Database.singletonInstance.getNotificationClickedById(notificationId);\n    }\n    static async getNotificationReceivedById(notificationId) {\n        return await Database.singletonInstance.getNotificationReceivedById(notificationId);\n    }\n    static async setExternalUserId(externalUserId, authHash) {\n        await Database.singletonInstance.setExternalUserId(externalUserId, authHash);\n    }\n    static async setDeviceId(deviceId) {\n        await Database.singletonInstance.setDeviceId(deviceId);\n    }\n    static async remove(table, keypath) {\n        return await Database.singletonInstance.remove(table, keypath);\n    }\n    static async put(table, keypath) {\n        return await Database.singletonInstance.put(table, keypath);\n    }\n    static async get(table, key) {\n        return await Database.singletonInstance.get(table, key);\n    }\n    static async getAll(table) {\n        return await Database.singletonInstance.getAll(table);\n    }\n}\n/* End Temp Database Proxy */\nDatabase.EVENTS = DatabaseEventName;\n//# sourceMappingURL=Database.js.map","import { EnvironmentKind } from '../models/EnvironmentKind';\nimport { TestEnvironmentKind } from '../models/TestEnvironmentKind';\nimport { WindowEnvironmentKind } from '../models/WindowEnvironmentKind';\nimport { InvalidArgumentError, InvalidArgumentReason } from '../errors/InvalidArgumentError';\nimport { IntegrationKind } from \"../models/IntegrationKind\";\nimport ServiceWorkerHelper from \"../helpers/ServiceWorkerHelper\";\nimport Environment from \"../Environment\";\nimport OneSignalUtils from \"../utils/OneSignalUtils\";\nconst RESOURCE_HTTP_PORT = 4000;\nconst RESOURCE_HTTPS_PORT = 4001;\nconst API_URL_PORT = 3001;\nconst TURBINE_API_URL_PORT = 18080;\nconst TURBINE_ENDPOINTS = [\"outcomes\", \"on_focus\"];\nexport default class SdkEnvironment {\n    /**\n     * Returns development, staging, or production.\n     *\n     * The magic constants used to detect the environment is set or unset when\n     * building the SDK.\n     */\n    static getBuildEnv() {\n        if (typeof __BUILD_TYPE__ === \"undefined\") {\n            return EnvironmentKind.Production;\n        }\n        switch (__BUILD_TYPE__) {\n            case \"development\":\n                return EnvironmentKind.Development;\n            case \"staging\":\n                return EnvironmentKind.Staging;\n            case \"production\":\n                return EnvironmentKind.Production;\n            default:\n                return EnvironmentKind.Production;\n        }\n    }\n    /**\n     * Returns development staging, or production.\n     *\n     * Refers to which API environment should be used. These constants are set when building the SDK\n     */\n    static getApiEnv() {\n        if (typeof __API_TYPE__ === \"undefined\") {\n            return EnvironmentKind.Production;\n        }\n        switch (__API_TYPE__) {\n            case \"development\":\n                return EnvironmentKind.Development;\n            case \"staging\":\n                return EnvironmentKind.Staging;\n            case \"production\":\n                return EnvironmentKind.Production;\n            default:\n                return EnvironmentKind.Production;\n        }\n    }\n    /**\n     * Determines whether the current frame context executing this function is part of a:\n     *\n     *  a) HTTP site using a proxy subscription origin\n     *\n     *  b) or, HTTPS site using a proxy subscription origin\n     *\n     *  c) or, HTTPS site using its own origin for subscribing\n     *\n     * The determination affects permissions and subscription:\n     *\n     *  a) Because the parent (top frame) of the proxy origin frame is HTTP, the entire context is\n     *  insecure. In the proxy origin frame, notification permissions are always \"denied\", access to\n     *  the service worker's registration throws a security error, and no service worker controls the\n     *  proxy origin frame.\n     *\n     *  b) The context is secure. In the proxy origin frame, notification permissions are \"granted\" if\n     *  actually granted otherwise \"denied\" if either unprompted or blocked. The service worker\n     *  controls the proxy origin frame and access to the service worker's registration is allowed.\n     *  Requesting permissions from child frames is not allowed. Subscribing from child frames wasn't\n     *  allowed but is now allowed.\n     *\n     *  c) All features are allowed.\n     *\n     * @param usingProxyOrigin Using a subdomain of os.tc or onesignal.com for subscribing to push.\n     */\n    static async getIntegration(usingProxyOrigin) {\n        if (Environment.isSafari()) {\n            /* HTTP doesn't apply to Safari sites */\n            return IntegrationKind.Secure;\n        }\n        const isTopFrame = (window === window.top);\n        const isHttpsProtocol = window.location.protocol === \"https:\";\n        // For convenience, try to look up usingProxyOrigin instead of requiring it to be passed in\n        if (usingProxyOrigin === undefined) {\n            if (typeof OneSignal !== \"undefined\" && OneSignal.context && OneSignal.context.appConfig) {\n                usingProxyOrigin = !!OneSignal.context.appConfig.subdomain;\n            }\n            else {\n                throw new InvalidArgumentError(\"usingProxyOrigin\", InvalidArgumentReason.Empty);\n            }\n        }\n        /*\n          Executing from the top frame, we can easily determine whether we're HTTPS or HTTP.\n    \n          Executing from a child frame of any depth, we can check the current frame's protocol. If it's\n          HTTP it's definitely insecure. If it's HTTPS, we attempt to call\n          ServiceWorkerContainer.getRegistration and see if the call throws an error or succeeds. If the\n          call throws an error, we can assume some parent frame in the chain above us is insecure.\n         */\n        if (isTopFrame) {\n            if (isHttpsProtocol) {\n                return usingProxyOrigin ?\n                    IntegrationKind.SecureProxy :\n                    IntegrationKind.Secure;\n            }\n            else {\n                // If localhost and allowLocalhostAsSecureOrigin, it's still considered secure\n                if (OneSignalUtils.isLocalhostAllowedAsSecureOrigin() &&\n                    (location.hostname === 'localhost' || location.hostname === '127.0.0.1')) {\n                    return IntegrationKind.Secure;\n                }\n                /* The case of HTTP and not using a proxy origin isn't possible, because the SDK will throw\n                an initialization error stating a proxy origin is required for HTTP sites. */\n                return IntegrationKind.InsecureProxy;\n            }\n        }\n        else {\n            if (isHttpsProtocol) {\n                /* Check whether any parent frames are insecure */\n                const isFrameContextInsecure = await SdkEnvironment.isFrameContextInsecure();\n                if (isFrameContextInsecure) {\n                    return IntegrationKind.InsecureProxy;\n                }\n                else {\n                    return usingProxyOrigin ?\n                        IntegrationKind.SecureProxy :\n                        IntegrationKind.Secure;\n                }\n            }\n            else {\n                /*\n                Because this frame is insecure, the entire chain is insecure.\n        \n                The case of HTTP and not using a proxy origin isn't possible, because the SDK will throw an\n                initialization error stating a proxy origin is required for HTTP sites. */\n                return IntegrationKind.InsecureProxy;\n            }\n        }\n    }\n    /**\n     * From a child frame, returns true if the current frame context is insecure.\n     *\n     * This is used to check if isPushNotificationsEnabled() should grab the service worker\n     * registration. In an HTTPS iframe of an HTTP page, getting the service worker registration would\n     * throw an error.\n     *\n     * This method can trigger console warnings due to using ServiceWorkerContainer.getRegistration in\n     * an insecure frame.\n     */\n    static async isFrameContextInsecure() {\n        // If we are the top frame, or service workers aren't available, don't run this check\n        if (window === window.top ||\n            !('serviceWorker' in navigator) ||\n            typeof navigator.serviceWorker.getRegistration === 'undefined') {\n            return false;\n        }\n        // Will be null if there was an issue retrieving a status\n        const registrationResult = await ServiceWorkerHelper.getRegistration();\n        return !registrationResult;\n    }\n    static isInsecureOrigin() {\n        return window.location.protocol === \"http:\";\n    }\n    static getOrigin() {\n        if (Environment.isBrowser()) {\n            return window.location.origin;\n        }\n        else if (typeof self !== \"undefined\" && typeof ServiceWorkerGlobalScope !== \"undefined\") {\n            return self.registration.scope;\n        }\n        return \"Unknown\";\n    }\n    /**\n     * Describes the current frame context.\n     */\n    static getWindowEnv() {\n        if (typeof window === \"undefined\") {\n            if (typeof self !== \"undefined\" && typeof ServiceWorkerGlobalScope !== \"undefined\") {\n                return WindowEnvironmentKind.ServiceWorker;\n            }\n            else {\n                return WindowEnvironmentKind.Unknown;\n            }\n        }\n        else {\n            // If the window is the root top-most level\n            if (window === window.top) {\n                if (location.href.indexOf(\"initOneSignal\") !== -1 ||\n                    (location.pathname === '/subscribe' &&\n                        location.search === '') &&\n                        (location.hostname.endsWith('.onesignal.com') ||\n                            location.hostname.endsWith('.os.tc') ||\n                            (location.hostname.indexOf('.localhost') !== -1 &&\n                                SdkEnvironment.getBuildEnv() === EnvironmentKind.Development))) {\n                    return WindowEnvironmentKind.OneSignalSubscriptionPopup;\n                }\n                else {\n                    return WindowEnvironmentKind.Host;\n                }\n            }\n            else if (location.pathname === '/webPushIframe') {\n                return WindowEnvironmentKind.OneSignalProxyFrame;\n            }\n            else if (location.pathname === '/webPushModal') {\n                return WindowEnvironmentKind.OneSignalSubscriptionModal;\n            }\n            else {\n                return WindowEnvironmentKind.CustomIframe;\n            }\n        }\n    }\n    /**\n     * Describes whether the SDK is built in tests mode or not.\n     *\n     * This method is overriden when tests are run.\n     */\n    static getTestEnv() {\n        return typeof __TEST__ === \"undefined\" ?\n            TestEnvironmentKind.UnitTesting :\n            TestEnvironmentKind.None;\n    }\n    /**\n     * Returns build-specific prefixes used for operations like registering the\n     * service worker.\n     *\n     * For example, in staging the registered service worker filename is\n     * Staging-OneSignalSDKWorker.js.\n     */\n    static getBuildEnvPrefix(buildEnv = SdkEnvironment.getBuildEnv()) {\n        switch (buildEnv) {\n            case EnvironmentKind.Development:\n                return 'Dev-';\n            case EnvironmentKind.Staging:\n                return 'Staging-';\n            case EnvironmentKind.Production:\n                return '';\n            default:\n                throw new InvalidArgumentError('buildEnv', InvalidArgumentReason.EnumOutOfRange);\n        }\n    }\n    /**\n     * Returns the URL object representing the components of OneSignal's API\n     * endpoint.\n     */\n    static getOneSignalApiUrl(buildEnv = SdkEnvironment.getApiEnv(), action) {\n        const apiOrigin = (typeof __API_ORIGIN__ !== \"undefined\") ? __API_ORIGIN__ || \"localhost\" : \"localhost\";\n        switch (buildEnv) {\n            case EnvironmentKind.Development:\n                if (SdkEnvironment.isTurbineEndpoint(action)) {\n                    return new URL(`https://${apiOrigin}:${TURBINE_API_URL_PORT}/api/v1`);\n                }\n                return new URL(`https://${apiOrigin}:${API_URL_PORT}/api/v1`);\n            case EnvironmentKind.Staging:\n                return new URL(`https://${apiOrigin}/api/v1`);\n            case EnvironmentKind.Production:\n                return new URL('https://onesignal.com/api/v1');\n            default:\n                throw new InvalidArgumentError('buildEnv', InvalidArgumentReason.EnumOutOfRange);\n        }\n    }\n    static getOneSignalResourceUrlPath(buildEnv = SdkEnvironment.getBuildEnv()) {\n        const buildOrigin = (typeof __BUILD_ORIGIN__ !== \"undefined\") ? __BUILD_ORIGIN__ || \"localhost\" : \"localhost\";\n        const isHttps = (typeof __IS_HTTPS__ !== \"undefined\") ? __IS_HTTPS__ : true;\n        let origin;\n        const protocol = isHttps ? \"https\" : \"http\";\n        const port = isHttps ? RESOURCE_HTTPS_PORT : RESOURCE_HTTP_PORT;\n        switch (buildEnv) {\n            case EnvironmentKind.Development:\n                origin = `${protocol}://${buildOrigin}:${port}`;\n                break;\n            case EnvironmentKind.Staging:\n                origin = `https://${buildOrigin}`;\n                break;\n            case EnvironmentKind.Production:\n                origin = \"https://onesignal.com\";\n                break;\n            default:\n                throw new InvalidArgumentError('buildEnv', InvalidArgumentReason.EnumOutOfRange);\n        }\n        return new URL(`${origin}/sdks`);\n    }\n    static getOneSignalCssFileName(buildEnv = SdkEnvironment.getBuildEnv()) {\n        const baseFileName = \"OneSignalSDKStyles.css\";\n        switch (buildEnv) {\n            case EnvironmentKind.Development:\n                return `Dev-${baseFileName}`;\n            case EnvironmentKind.Staging:\n                return `Staging-${baseFileName}`;\n            case EnvironmentKind.Production:\n                return baseFileName;\n            default:\n                throw new InvalidArgumentError('buildEnv', InvalidArgumentReason.EnumOutOfRange);\n        }\n    }\n    static isTurbineEndpoint(action) {\n        if (!action) {\n            return false;\n        }\n        return TURBINE_ENDPOINTS.some(turbine_endpoint => action.indexOf(turbine_endpoint) > -1);\n    }\n}\n//# sourceMappingURL=SdkEnvironment.js.map","import OneSignalError from \"./OneSignalError\";\nexport default class TimeoutError extends OneSignalError {\n    constructor(message = \"The asynchronous operation has timed out.\") {\n        super(message);\n        this.message = message;\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, TimeoutError.prototype);\n    }\n}\n//# sourceMappingURL=TimeoutError.js.map","import TimeoutError from '../../../errors/TimeoutError';\nimport { OneSignalApiErrorKind, OneSignalApiError } from \"../../../errors/OneSignalApiError\";\nexport class Utils {\n    /**\n     * Returns true if match is in string; otherwise, returns false.\n     */\n    static contains(indexOfAble, match) {\n        if (!indexOfAble)\n            return false;\n        return indexOfAble.indexOf(match) !== -1;\n    }\n    static getConsoleStyle(style) {\n        if (style == 'code') {\n            return `padding: 0 1px 1px 5px;border: 1px solid #ddd;border-radius: 3px;font-family: Monaco,\"DejaVu Sans Mono\",\"Courier New\",monospace;color: #444;`;\n        }\n        else if (style == 'bold') {\n            return `font-weight: 600;color: rgb(51, 51, 51);`;\n        }\n        else if (style == 'alert') {\n            return `font-weight: 600;color: red;`;\n        }\n        else if (style == 'event') {\n            return `color: green;`;\n        }\n        else if (style == 'postmessage') {\n            return `color: orange;`;\n        }\n        else if (style == 'serviceworkermessage') {\n            return `color: purple;`;\n        }\n        else {\n            return '';\n        }\n    }\n    /**\n     * Returns the current object without keys that have undefined values.\n     * Regardless of whether the return result is used, the passed-in object is destructively modified.\n     * Only affects keys that the object directly contains (i.e. not those inherited via the object's prototype).\n     * @param object\n     */\n    static trimUndefined(object) {\n        for (var property in object) {\n            if (object.hasOwnProperty(property)) {\n                if (object[property] === undefined) {\n                    delete object[property];\n                }\n            }\n        }\n        return object;\n    }\n    /**\n     * Capitalizes the first letter of the string.\n     * @returns {string} The string with the first letter capitalized.\n     */\n    static capitalize(text) {\n        return text.charAt(0).toUpperCase() + text.slice(1);\n    }\n    static isNullOrUndefined(value) {\n        return typeof value === 'undefined' || value === null;\n    }\n    static valueOrDefault(value, defaultValue) {\n        if (typeof value === \"undefined\" || value === null) {\n            return defaultValue;\n        }\n        return value;\n    }\n    /**\n     * JSON.stringify() but converts functions to \"[Function]\" so they aren't lost.\n     * Helps when logging method calls.\n     */\n    static stringify(obj) {\n        return JSON.stringify(obj, (_, value) => {\n            if (typeof value === 'function') {\n                return \"[Function]\";\n            }\n            else {\n                return value;\n            }\n        }, 4);\n    }\n    static encodeHashAsUriComponent(hash) {\n        let uriComponent = '';\n        const keys = Object.keys(hash);\n        for (var key of keys) {\n            const value = hash[key];\n            uriComponent += `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n        }\n        return uriComponent;\n    }\n    static timeoutPromise(promise, milliseconds) {\n        const timeoutPromise = new Promise((_, reject) => {\n            setTimeout(() => {\n                reject(new TimeoutError());\n            }, milliseconds);\n        });\n        return Promise.race([promise, timeoutPromise]);\n    }\n    static getValueOrDefault(value, defaultValue) {\n        if (value !== undefined && value !== null) {\n            return value;\n        }\n        return defaultValue;\n    }\n    /**\n     * This is similar to ECMAScript2107 String.prototype.padStart.\n     * Switch to this after updating TypeScript and can confirm it gets transpiled down to ES6\n     * @param str - String to pad left\n     * @param targetLength - Length to make the string\n     * @param padString - String value of length one to pad with.\n     * @returns {string} - Resulting string padded\n     */\n    static padStart(str, targetLength, padString) {\n        let result = str;\n        while (result.length < targetLength) {\n            result = padString + result;\n        }\n        return result;\n    }\n    /**\n     * Returns trimmed version number\n     * e.g: \"10.01.30\" becomes \"10.01\"\n     * @param version - version number we want to check\n     */\n    static parseVersionString(version) {\n        const osVersionParts = version.toString().split(\".\");\n        const majorVersion = Utils.padStart(osVersionParts[0], 2, \"0\");\n        let minorVersion;\n        if (osVersionParts[1]) {\n            minorVersion = Utils.padStart(osVersionParts[1], 2, \"0\");\n        }\n        else {\n            minorVersion = \"00\";\n        }\n        return Number(`${majorVersion}.${minorVersion}`);\n    }\n    /**\n     * Gives back the last x number of parts providing a string with a delimiter.\n     * Example: lastParts(\"api.staging.onesignal.com\", \".\", 3) will return \"staging.onesignal.com\"\n     */\n    static lastParts(subject, delimiter, maxParts) {\n        const parts = subject.split(delimiter);\n        const skipParts = Math.max(parts.length - maxParts, 0);\n        return parts.slice(skipParts).join(delimiter);\n    }\n    /**\n     * Checks if a version is number is greater than or equal (AKA at least) to a specific compare\n     *   to version.\n     * Limited to only checking for major and minor version values, patch versions are ignored\n     * @param toCheck - Version we want to check\n     * @param compareTo - Version we want to be at or higher\n     * @returns {string} - Returns true if toCheck >= compareTo\n     */\n    static isVersionAtLeast(toCheck, compareTo) {\n        return this.parseVersionString(toCheck) >= compareTo;\n    }\n    static enforceAppId(appId) {\n        if (!appId) {\n            throw new Error(\"App id cannot be empty\");\n        }\n    }\n    static enforcePlayerId(playerId) {\n        if (!playerId) {\n            throw new Error(\"Player id cannot be empty\");\n        }\n    }\n    static async enforceAppIdAndPlayerId(appId, playerId, funcToExecute) {\n        Utils.enforceAppId(appId);\n        Utils.enforcePlayerId(playerId);\n        try {\n            return await funcToExecute();\n        }\n        catch (e) {\n            if (e && Array.isArray(e.errors) && e.errors.length > 0 &&\n                Utils.contains(e.errors[0], \"app_id not found\")) {\n                throw new OneSignalApiError(OneSignalApiErrorKind.MissingAppId);\n            }\n            else\n                throw e;\n        }\n    }\n    static sortArrayOfObjects(arrayToSort, predicateForProperty, descending = false, doItInPlace = true) {\n        const internalArrayToSort = doItInPlace ? arrayToSort : arrayToSort.slice();\n        internalArrayToSort.sort((a, b) => {\n            const propertyA = predicateForProperty(a);\n            const propertyB = predicateForProperty(b);\n            if (propertyA > propertyB) {\n                return !!descending ? -1 : 1;\n            }\n            if (propertyA < propertyB) {\n                return !!descending ? 1 : -1;\n            }\n            return 0;\n        });\n        return internalArrayToSort;\n    }\n}\nexport default Utils;\n//# sourceMappingURL=Utils.js.map","export var WindowEnvironmentKind;\n(function (WindowEnvironmentKind) {\n    /**\n     * A service worker environment.\n     */\n    WindowEnvironmentKind[\"ServiceWorker\"] = \"ServiceWorker\";\n    /**\n     * The top-level frame to the \"main\" client's site.\n     */\n    WindowEnvironmentKind[\"Host\"] = \"Host\";\n    /**\n     * Our subscription popup for alt-origin sites.\n     */\n    WindowEnvironmentKind[\"OneSignalSubscriptionPopup\"] = \"Popup\";\n    /**\n     * Our subscription modal for HTTPS sites, which loads in an iFrame.\n     */\n    WindowEnvironmentKind[\"OneSignalSubscriptionModal\"] = \"Modal\";\n    /**\n     * Our subscription helper iFrame.\n     */\n    WindowEnvironmentKind[\"OneSignalProxyFrame\"] = \"ProxyFrame\";\n    /**\n     * A custom iFrame on the site.\n     */\n    WindowEnvironmentKind[\"CustomIframe\"] = \"CustomFrame\";\n    /**\n     * An unknown window context type not matching any of the above.\n     */\n    WindowEnvironmentKind[\"Unknown\"] = \"Unknown\";\n})(WindowEnvironmentKind || (WindowEnvironmentKind = {}));\n//# sourceMappingURL=WindowEnvironmentKind.js.map","import Environment from './Environment';\nimport SdkEnvironment from './managers/SdkEnvironment';\nimport { WindowEnvironmentKind } from './models/WindowEnvironmentKind';\nimport Log from './libraries/Log';\nimport Utils from \"./context/shared/utils/Utils\";\nconst SILENT_EVENTS = [\n    'notifyButtonHovering',\n    'notifyButtonHover',\n    'notifyButtonButtonClick',\n    'notifyButtonLauncherClick',\n    'animatedElementHiding',\n    'animatedElementHidden',\n    'animatedElementShowing',\n    'animatedElementShown',\n    'activeAnimatedElementActivating',\n    'activeAnimatedElementActive',\n    'activeAnimatedElementInactivating',\n    'activeAnimatedElementInactive',\n    'dbRetrieved',\n    'dbSet',\n    'testEvent'\n];\nconst RETRIGGER_REMOTE_EVENTS = [\n    'onesignal.prompt.custom.clicked',\n    'onesignal.prompt.native.permissionchanged',\n    'onesignal.subscription.changed',\n    'onesignal.internal.subscriptionset',\n    'dbRebuilt',\n    'initialize',\n    'subscriptionSet',\n    'sendWelcomeNotification',\n    'subscriptionChange',\n    'notificationPermissionChange',\n    'dbSet',\n    'register',\n    'notificationDisplay',\n    'notificationDismiss',\n    'notificationClick',\n    'permissionPromptDisplay',\n    'testWouldDisplay',\n    'testInitOptionDisabled',\n    'popupWindowTimeout'\n];\nconst LEGACY_EVENT_MAP = {\n    'notificationPermissionChange': 'onesignal.prompt.native.permissionchanged',\n    'subscriptionChange': 'onesignal.subscription.changed',\n    'customPromptClick': 'onesignal.prompt.custom.clicked',\n};\nexport default class Event {\n    /**\n     * Triggers the specified event with optional custom data.\n     * @param eventName The string event name to be emitted.\n     * @param data Any JavaScript variable to be passed with the event.\n     * @param remoteTriggerEnv If this method is being called in a different environment (e.g. was triggered in iFrame but now retriggered on main host), this is the string of the original environment for logging purposes.\n     */\n    static async trigger(eventName, data, remoteTriggerEnv = null) {\n        if (!Utils.contains(SILENT_EVENTS, eventName)) {\n            let displayData = data;\n            let env = Utils.capitalize(SdkEnvironment.getWindowEnv().toString());\n            if (remoteTriggerEnv) {\n                env = `${env}  ${Utils.capitalize(remoteTriggerEnv)}`;\n            }\n            if (displayData || displayData === false) {\n                Log.debug(`(${env})  %c${eventName}:`, Utils.getConsoleStyle('event'), displayData);\n            }\n            else {\n                Log.debug(`(${env})  %c${eventName}`, Utils.getConsoleStyle('event'));\n            }\n        }\n        // Actually fire the event that can be listened to via OneSignal.on()\n        if (Environment.isBrowser()) {\n            if (eventName === OneSignal.EVENTS.SDK_INITIALIZED) {\n                if (OneSignal.initialized)\n                    return;\n                else\n                    OneSignal.initialized = true;\n            }\n            await OneSignal.emitter.emit(eventName, data);\n        }\n        if (LEGACY_EVENT_MAP.hasOwnProperty(eventName)) {\n            let legacyEventName = LEGACY_EVENT_MAP[eventName];\n            Event._triggerLegacy(legacyEventName, data);\n        }\n        // If this event was triggered in an iFrame or Popup environment, also trigger it on the host page\n        if (Environment.isBrowser() &&\n            (SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.OneSignalSubscriptionPopup ||\n                SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.OneSignalProxyFrame)) {\n            const creator = opener || parent;\n            if (!creator) {\n                Log.error(`Could not send event '${eventName}' back to host page because no creator (opener or parent) found!`);\n            }\n            else {\n                // But only if the event matches certain events\n                if (Utils.contains(RETRIGGER_REMOTE_EVENTS, eventName)) {\n                    if (SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.OneSignalSubscriptionPopup) {\n                        OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT, { eventName: eventName, eventData: data });\n                    }\n                    else {\n                        OneSignal.proxyFrame.retriggerRemoteEvent(eventName, data);\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Fires the event to be listened to via window.addEventListener().\n     * @param eventName The string event name.\n     * @param data Any JavaScript variable to be passed with the event.\n     * @private\n     */\n    static _triggerLegacy(eventName, data) {\n        const event = new CustomEvent(eventName, {\n            bubbles: true, cancelable: true, detail: data\n        });\n        // Fire the event that listeners can listen to via 'window.addEventListener()'\n        window.dispatchEvent(event);\n    }\n}\n//# sourceMappingURL=Event.js.map","/*!\n * Bowser - a browser detector\n * https://github.com/ded/bowser\n * MIT License | (c) Dustin Diaz 2015\n */\n\n!function (root, name, definition) {\n  if (typeof module != 'undefined' && module.exports) module.exports = definition()\n  else if (typeof define == 'function' && define.amd) define(name, definition)\n  else root[name] = definition()\n}(this, 'bowser', function () {\n  /**\n    * See useragents.js for examples of navigator.userAgent\n    */\n\n  var t = true\n\n  function detect(ua) {\n\n    function getFirstMatch(regex) {\n      var match = ua.match(regex);\n      return (match && match.length > 1 && match[1]) || '';\n    }\n\n    function getSecondMatch(regex) {\n      var match = ua.match(regex);\n      return (match && match.length > 1 && match[2]) || '';\n    }\n\n    var iosdevice = getFirstMatch(/(ipod|iphone|ipad)/i).toLowerCase()\n      , likeAndroid = /like android/i.test(ua)\n      , android = !likeAndroid && /android/i.test(ua)\n      , nexusMobile = /nexus\\s*[0-6]\\s*/i.test(ua)\n      , nexusTablet = !nexusMobile && /nexus\\s*[0-9]+/i.test(ua)\n      , chromeos = /CrOS/.test(ua)\n      , silk = /silk/i.test(ua)\n      , sailfish = /sailfish/i.test(ua)\n      , tizen = /tizen/i.test(ua)\n      , webos = /(web|hpw)os/i.test(ua)\n      , windowsphone = /windows phone/i.test(ua)\n      , samsungBrowser = /SamsungBrowser/i.test(ua)\n      , windows = !windowsphone && /windows/i.test(ua)\n      , mac = !iosdevice && !silk && /macintosh/i.test(ua)\n      , linux = !android && !sailfish && !tizen && !webos && /linux/i.test(ua)\n      , edgeVersion = getFirstMatch(/edge\\/(\\d+(\\.\\d+)?)/i)\n      , versionIdentifier = getFirstMatch(/version\\/(\\d+(\\.\\d+)?)/i)\n      , tablet = /tablet/i.test(ua) && !/tablet pc/i.test(ua)\n      , mobile = !tablet && /[^-]mobi/i.test(ua)\n      , xbox = /xbox/i.test(ua)\n      , result\n\n    if (/opera/i.test(ua)) {\n      //  an old Opera\n      result = {\n        name: 'Opera'\n      , opera: t\n      , version: versionIdentifier || getFirstMatch(/(?:opera|opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i)\n      }\n    } else if (/opr\\/|opios/i.test(ua)) {\n      // a new Opera\n      result = {\n        name: 'Opera'\n        , opera: t\n        , version: getFirstMatch(/(?:opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i) || versionIdentifier\n      }\n    }\n    else if (/SamsungBrowser/i.test(ua)) {\n      result = {\n        name: 'Samsung Internet for Android'\n        , samsungBrowser: t\n        , version: versionIdentifier || getFirstMatch(/(?:SamsungBrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/coast/i.test(ua)) {\n      result = {\n        name: 'Opera Coast'\n        , coast: t\n        , version: versionIdentifier || getFirstMatch(/(?:coast)[\\s\\/](\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/yabrowser/i.test(ua)) {\n      result = {\n        name: 'Yandex Browser'\n      , yandexbrowser: t\n      , version: versionIdentifier || getFirstMatch(/(?:yabrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/ucbrowser/i.test(ua)) {\n      result = {\n          name: 'UC Browser'\n        , ucbrowser: t\n        , version: getFirstMatch(/(?:ucbrowser)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/mxios/i.test(ua)) {\n      result = {\n        name: 'Maxthon'\n        , maxthon: t\n        , version: getFirstMatch(/(?:mxios)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/epiphany/i.test(ua)) {\n      result = {\n        name: 'Epiphany'\n        , epiphany: t\n        , version: getFirstMatch(/(?:epiphany)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/puffin/i.test(ua)) {\n      result = {\n        name: 'Puffin'\n        , puffin: t\n        , version: getFirstMatch(/(?:puffin)[\\s\\/](\\d+(?:\\.\\d+)?)/i)\n      }\n    }\n    else if (/sleipnir/i.test(ua)) {\n      result = {\n        name: 'Sleipnir'\n        , sleipnir: t\n        , version: getFirstMatch(/(?:sleipnir)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (/k-meleon/i.test(ua)) {\n      result = {\n        name: 'K-Meleon'\n        , kMeleon: t\n        , version: getFirstMatch(/(?:k-meleon)[\\s\\/](\\d+(?:\\.\\d+)+)/i)\n      }\n    }\n    else if (windowsphone) {\n      result = {\n        name: 'Windows Phone'\n      , windowsphone: t\n      }\n      if (edgeVersion) {\n        result.msedge = t\n        result.version = edgeVersion\n      }\n      else {\n        result.msie = t\n        result.version = getFirstMatch(/iemobile\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/msie|trident/i.test(ua)) {\n      result = {\n        name: 'Internet Explorer'\n      , msie: t\n      , version: getFirstMatch(/(?:msie |rv:)(\\d+(\\.\\d+)?)/i)\n      }\n    } else if (chromeos) {\n      result = {\n        name: 'Chrome'\n      , chromeos: t\n      , chromeBook: t\n      , chrome: t\n      , version: getFirstMatch(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)\n      }\n    } else if (/chrome.+? edge/i.test(ua)) {\n      result = {\n        name: 'Microsoft Edge'\n      , msedge: t\n      , version: edgeVersion\n      }\n    }\n    else if (/vivaldi/i.test(ua)) {\n      result = {\n        name: 'Vivaldi'\n        , vivaldi: t\n        , version: getFirstMatch(/vivaldi\\/(\\d+(\\.\\d+)?)/i) || versionIdentifier\n      }\n    }\n    else if (sailfish) {\n      result = {\n        name: 'Sailfish'\n      , sailfish: t\n      , version: getFirstMatch(/sailfish\\s?browser\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/seamonkey\\//i.test(ua)) {\n      result = {\n        name: 'SeaMonkey'\n      , seamonkey: t\n      , version: getFirstMatch(/seamonkey\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/firefox|iceweasel|fxios/i.test(ua)) {\n      result = {\n        name: 'Firefox'\n      , firefox: t\n      , version: getFirstMatch(/(?:firefox|iceweasel|fxios)[ \\/](\\d+(\\.\\d+)?)/i)\n      }\n      if (/\\((mobile|tablet);[^\\)]*rv:[\\d\\.]+\\)/i.test(ua)) {\n        result.firefoxos = t\n      }\n    }\n    else if (silk) {\n      result =  {\n        name: 'Amazon Silk'\n      , silk: t\n      , version : getFirstMatch(/silk\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/phantom/i.test(ua)) {\n      result = {\n        name: 'PhantomJS'\n      , phantom: t\n      , version: getFirstMatch(/phantomjs\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/slimerjs/i.test(ua)) {\n      result = {\n        name: 'SlimerJS'\n        , slimer: t\n        , version: getFirstMatch(/slimerjs\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (/blackberry|\\bbb\\d+/i.test(ua) || /rim\\stablet/i.test(ua)) {\n      result = {\n        name: 'BlackBerry'\n      , blackberry: t\n      , version: versionIdentifier || getFirstMatch(/blackberry[\\d]+\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (webos) {\n      result = {\n        name: 'WebOS'\n      , webos: t\n      , version: versionIdentifier || getFirstMatch(/w(?:eb)?osbrowser\\/(\\d+(\\.\\d+)?)/i)\n      };\n      /touchpad\\//i.test(ua) && (result.touchpad = t)\n    }\n    else if (/bada/i.test(ua)) {\n      result = {\n        name: 'Bada'\n      , bada: t\n      , version: getFirstMatch(/dolfin\\/(\\d+(\\.\\d+)?)/i)\n      };\n    }\n    else if (tizen) {\n      result = {\n        name: 'Tizen'\n      , tizen: t\n      , version: getFirstMatch(/(?:tizen\\s?)?browser\\/(\\d+(\\.\\d+)?)/i) || versionIdentifier\n      };\n    }\n    else if (/qupzilla/i.test(ua)) {\n      result = {\n        name: 'QupZilla'\n        , qupzilla: t\n        , version: getFirstMatch(/(?:qupzilla)[\\s\\/](\\d+(?:\\.\\d+)+)/i) || versionIdentifier\n      }\n    }\n    else if (/chromium/i.test(ua)) {\n      result = {\n        name: 'Chromium'\n        , chromium: t\n        , version: getFirstMatch(/(?:chromium)[\\s\\/](\\d+(?:\\.\\d+)?)/i) || versionIdentifier\n      }\n    }\n    else if (/chrome|crios|crmo/i.test(ua)) {\n      result = {\n        name: 'Chrome'\n        , chrome: t\n        , version: getFirstMatch(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)\n      }\n    }\n    else if (android) {\n      result = {\n        name: 'Android'\n        , version: versionIdentifier\n      }\n    }\n    else if (/safari|applewebkit/i.test(ua)) {\n      result = {\n        name: 'Safari'\n      , safari: t\n      }\n      if (versionIdentifier) {\n        result.version = versionIdentifier\n      }\n    }\n    else if (iosdevice) {\n      result = {\n        name : iosdevice == 'iphone' ? 'iPhone' : iosdevice == 'ipad' ? 'iPad' : 'iPod'\n      }\n      // WTF: version is not part of user agent in web apps\n      if (versionIdentifier) {\n        result.version = versionIdentifier\n      }\n    }\n    else if(/googlebot/i.test(ua)) {\n      result = {\n        name: 'Googlebot'\n      , googlebot: t\n      , version: getFirstMatch(/googlebot\\/(\\d+(\\.\\d+))/i) || versionIdentifier\n      }\n    }\n    else {\n      result = {\n        name: getFirstMatch(/^(.*)\\/(.*) /),\n        version: getSecondMatch(/^(.*)\\/(.*) /)\n     };\n   }\n\n    // set webkit or gecko flag for browsers based on these engines\n    if (!result.msedge && /(apple)?webkit/i.test(ua)) {\n      if (/(apple)?webkit\\/537\\.36/i.test(ua)) {\n        result.name = result.name || \"Blink\"\n        result.blink = t\n      } else {\n        result.name = result.name || \"Webkit\"\n        result.webkit = t\n      }\n      if (!result.version && versionIdentifier) {\n        result.version = versionIdentifier\n      }\n    } else if (!result.opera && /gecko\\//i.test(ua)) {\n      result.name = result.name || \"Gecko\"\n      result.gecko = t\n      result.version = result.version || getFirstMatch(/gecko\\/(\\d+(\\.\\d+)?)/i)\n    }\n\n    // set OS flags for platforms that have multiple browsers\n    if (!result.windowsphone && !result.msedge && (android || result.silk)) {\n      result.android = t\n    } else if (!result.windowsphone && !result.msedge && iosdevice) {\n      result[iosdevice] = t\n      result.ios = t\n    } else if (mac) {\n      result.mac = t\n    } else if (xbox) {\n      result.xbox = t\n    } else if (windows) {\n      result.windows = t\n    } else if (linux) {\n      result.linux = t\n    }\n\n    function getWindowsVersion (s) {\n      switch (s) {\n        case 'NT': return 'NT'\n        case 'XP': return 'XP'\n        case 'NT 5.0': return '2000'\n        case 'NT 5.1': return 'XP'\n        case 'NT 5.2': return '2003'\n        case 'NT 6.0': return 'Vista'\n        case 'NT 6.1': return '7'\n        case 'NT 6.2': return '8'\n        case 'NT 6.3': return '8.1'\n        case 'NT 10.0': return '10'\n        default: return undefined\n      }\n    }\n\n    // OS version extraction\n    var osVersion = '';\n    if (result.windows) {\n      osVersion = getWindowsVersion(getFirstMatch(/Windows ((NT|XP)( \\d\\d?.\\d)?)/i))\n    } else if (result.windowsphone) {\n      osVersion = getFirstMatch(/windows phone (?:os)?\\s?(\\d+(\\.\\d+)*)/i);\n    } else if (result.mac) {\n      osVersion = getFirstMatch(/Mac OS X (\\d+([_\\.\\s]\\d+)*)/i);\n      osVersion = osVersion.replace(/[_\\s]/g, '.');\n    } else if (iosdevice) {\n      osVersion = getFirstMatch(/os (\\d+([_\\s]\\d+)*) like mac os x/i);\n      osVersion = osVersion.replace(/[_\\s]/g, '.');\n    } else if (android) {\n      osVersion = getFirstMatch(/android[ \\/-](\\d+(\\.\\d+)*)/i);\n    } else if (result.webos) {\n      osVersion = getFirstMatch(/(?:web|hpw)os\\/(\\d+(\\.\\d+)*)/i);\n    } else if (result.blackberry) {\n      osVersion = getFirstMatch(/rim\\stablet\\sos\\s(\\d+(\\.\\d+)*)/i);\n    } else if (result.bada) {\n      osVersion = getFirstMatch(/bada\\/(\\d+(\\.\\d+)*)/i);\n    } else if (result.tizen) {\n      osVersion = getFirstMatch(/tizen[\\/\\s](\\d+(\\.\\d+)*)/i);\n    }\n    if (osVersion) {\n      result.osversion = osVersion;\n    }\n\n    // device type extraction\n    var osMajorVersion = !result.windows && osVersion.split('.')[0];\n    if (\n         tablet\n      || nexusTablet\n      || iosdevice == 'ipad'\n      || (android && (osMajorVersion == 3 || (osMajorVersion >= 4 && !mobile)))\n      || result.silk\n    ) {\n      result.tablet = t\n    } else if (\n         mobile\n      || iosdevice == 'iphone'\n      || iosdevice == 'ipod'\n      || android\n      || nexusMobile\n      || result.blackberry\n      || result.webos\n      || result.bada\n    ) {\n      result.mobile = t\n    }\n\n    // Graded Browser Support\n    // http://developer.yahoo.com/yui/articles/gbs\n    if (result.msedge ||\n        (result.msie && result.version >= 10) ||\n        (result.yandexbrowser && result.version >= 15) ||\n\t\t    (result.vivaldi && result.version >= 1.0) ||\n        (result.chrome && result.version >= 20) ||\n        (result.samsungBrowser && result.version >= 4) ||\n        (result.firefox && result.version >= 20.0) ||\n        (result.safari && result.version >= 6) ||\n        (result.opera && result.version >= 10.0) ||\n        (result.ios && result.osversion && result.osversion.split(\".\")[0] >= 6) ||\n        (result.blackberry && result.version >= 10.1)\n        || (result.chromium && result.version >= 20)\n        ) {\n      result.a = t;\n    }\n    else if ((result.msie && result.version < 10) ||\n        (result.chrome && result.version < 20) ||\n        (result.firefox && result.version < 20.0) ||\n        (result.safari && result.version < 6) ||\n        (result.opera && result.version < 10.0) ||\n        (result.ios && result.osversion && result.osversion.split(\".\")[0] < 6)\n        || (result.chromium && result.version < 20)\n        ) {\n      result.c = t\n    } else result.x = t\n\n    return result\n  }\n\n  var bowser = detect(typeof navigator !== 'undefined' ? navigator.userAgent || '' : '')\n\n  bowser.test = function (browserList) {\n    for (var i = 0; i < browserList.length; ++i) {\n      var browserItem = browserList[i];\n      if (typeof browserItem=== 'string') {\n        if (browserItem in bowser) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Get version precisions count\n   *\n   * @example\n   *   getVersionPrecision(\"1.10.3\") // 3\n   *\n   * @param  {string} version\n   * @return {number}\n   */\n  function getVersionPrecision(version) {\n    return version.split(\".\").length;\n  }\n\n  /**\n   * Array::map polyfill\n   *\n   * @param  {Array} arr\n   * @param  {Function} iterator\n   * @return {Array}\n   */\n  function map(arr, iterator) {\n    var result = [], i;\n    if (Array.prototype.map) {\n      return Array.prototype.map.call(arr, iterator);\n    }\n    for (i = 0; i < arr.length; i++) {\n      result.push(iterator(arr[i]));\n    }\n    return result;\n  }\n\n  /**\n   * Calculate browser version weight\n   *\n   * @example\n   *   compareVersions(['1.10.2.1',  '1.8.2.1.90'])    // 1\n   *   compareVersions(['1.010.2.1', '1.09.2.1.90']);  // 1\n   *   compareVersions(['1.10.2.1',  '1.10.2.1']);     // 0\n   *   compareVersions(['1.10.2.1',  '1.0800.2']);     // -1\n   *\n   * @param  {Array<String>} versions versions to compare\n   * @return {Number} comparison result\n   */\n  function compareVersions(versions) {\n    // 1) get common precision for both versions, for example for \"10.0\" and \"9\" it should be 2\n    var precision = Math.max(getVersionPrecision(versions[0]), getVersionPrecision(versions[1]));\n    var chunks = map(versions, function (version) {\n      var delta = precision - getVersionPrecision(version);\n\n      // 2) \"9\" -> \"9.0\" (for precision = 2)\n      version = version + new Array(delta + 1).join(\".0\");\n\n      // 3) \"9.0\" -> [\"000000000\"\", \"000000009\"]\n      return map(version.split(\".\"), function (chunk) {\n        return new Array(20 - chunk.length).join(\"0\") + chunk;\n      }).reverse();\n    });\n\n    // iterate in reverse order by reversed chunks array\n    while (--precision >= 0) {\n      // 4) compare: \"000000009\" > \"000000010\" = false (but \"9\" > \"10\" = true)\n      if (chunks[0][precision] > chunks[1][precision]) {\n        return 1;\n      }\n      else if (chunks[0][precision] === chunks[1][precision]) {\n        if (precision === 0) {\n          // all version chunks are same\n          return 0;\n        }\n      }\n      else {\n        return -1;\n      }\n    }\n  }\n\n  /**\n   * Check if browser is unsupported\n   *\n   * @example\n   *   bowser.isUnsupportedBrowser({\n   *     msie: \"10\",\n   *     firefox: \"23\",\n   *     chrome: \"29\",\n   *     safari: \"5.1\",\n   *     opera: \"16\",\n   *     phantom: \"534\"\n   *   });\n   *\n   * @param  {Object}  minVersions map of minimal version to browser\n   * @param  {Boolean} [strictMode = false] flag to return false if browser wasn't found in map\n   * @param  {String}  [ua] user agent string\n   * @return {Boolean}\n   */\n  function isUnsupportedBrowser(minVersions, strictMode, ua) {\n    var _bowser = bowser;\n\n    // make strictMode param optional with ua param usage\n    if (typeof strictMode === 'string') {\n      ua = strictMode;\n      strictMode = void(0);\n    }\n\n    if (strictMode === void(0)) {\n      strictMode = false;\n    }\n    if (ua) {\n      _bowser = detect(ua);\n    }\n\n    var version = \"\" + _bowser.version;\n    for (var browser in minVersions) {\n      if (minVersions.hasOwnProperty(browser)) {\n        if (_bowser[browser]) {\n          if (typeof minVersions[browser] !== 'string') {\n            throw new Error('Browser version in the minVersion map should be a string: ' + browser + ': ' + String(minVersions));\n          }\n\n          // browser version and min supported version.\n          return compareVersions([version, minVersions[browser]]) < 0;\n        }\n      }\n    }\n\n    return strictMode; // not found\n  }\n\n  /**\n   * Check if browser is supported\n   *\n   * @param  {Object} minVersions map of minimal version to browser\n   * @param  {Boolean} [strictMode = false] flag to return false if browser wasn't found in map\n   * @param  {String}  [ua] user agent string\n   * @return {Boolean}\n   */\n  function check(minVersions, strictMode, ua) {\n    return !isUnsupportedBrowser(minVersions, strictMode, ua);\n  }\n\n  bowser.isUnsupportedBrowser = isUnsupportedBrowser;\n  bowser.compareVersions = compareVersions;\n  bowser.check = check;\n\n  /*\n   * Set our detect method to the main bowser object so we can\n   * reuse it to test other user agents.\n   * This is needed to implement future tests.\n   */\n  bowser._detect = detect;\n\n  return bowser\n});\n","import bowser from \"bowser\";\nimport SdkEnvironment from \"../managers/SdkEnvironment\";\nimport Environment from \"../Environment\";\nimport { WindowEnvironmentKind } from \"../models/WindowEnvironmentKind\";\nimport Log from \"../libraries/Log\";\nimport { Utils } from \"../context/shared/utils/Utils\";\nexport class OneSignalUtils {\n    static getBaseUrl() {\n        return location.origin;\n    }\n    static isLocalhostAllowedAsSecureOrigin() {\n        return (OneSignal.config &&\n            OneSignal.config.userConfig &&\n            OneSignal.config.userConfig.allowLocalhostAsSecureOrigin === true);\n    }\n    /**\n     * Returns true if web push subscription occurs on a subdomain of OneSignal.\n     * If true, our main IndexedDB is stored on the subdomain of onesignal.com, and not the user\"s site.\n     * @remarks\n     *   This method returns true if:\n     *     - The browser is not Safari\n     *         - Safari uses a different method of subscription and does not require our workaround\n     *     - The init parameters contain a subdomain (even if the protocol is HTTPS)\n     *         - HTTPS users using our subdomain workaround still have the main IndexedDB stored on our subdomain\n     *        - The protocol of the current webpage is http:\n     *   Exceptions are:\n     *     - Safe hostnames like localhost and 127.0.0.1\n     *          - Because we don\"t want users to get the wrong idea when testing on localhost that direct permission is supported on HTTP, we\"ll ignore these exceptions. HTTPS will always be required for direct permission\n     *        - We are already in popup or iFrame mode, or this is called from the service worker\n     */\n    static isUsingSubscriptionWorkaround() {\n        const windowEnv = SdkEnvironment.getWindowEnv();\n        if (!OneSignal.config) {\n            throw new Error(`(${windowEnv.toString()}) isUsingSubscriptionWorkaround() cannot be called until OneSignal.config exists.`);\n        }\n        if (bowser.safari) {\n            return false;\n        }\n        const allowLocalhostAsSecureOrigin = this.isLocalhostAllowedAsSecureOrigin();\n        return OneSignalUtils.internalIsUsingSubscriptionWorkaround(OneSignal.config.subdomain, allowLocalhostAsSecureOrigin);\n    }\n    static internalIsUsingSubscriptionWorkaround(subdomain, allowLocalhostAsSecureOrigin) {\n        if (bowser.safari) {\n            return false;\n        }\n        if (allowLocalhostAsSecureOrigin === true &&\n            (location.hostname === \"localhost\" || location.hostname === \"127.0.0.1\")) {\n            return false;\n        }\n        const windowEnv = SdkEnvironment.getWindowEnv();\n        return ((windowEnv === WindowEnvironmentKind.Host || windowEnv === WindowEnvironmentKind.CustomIframe) &&\n            (!!subdomain || location.protocol === \"http:\"));\n    }\n    static redetectBrowserUserAgent() {\n        // During testing, the browser object may be initialized before the userAgent is injected\n        if (bowser.name === \"\" && bowser.version === \"\") {\n            return bowser._detect(navigator.userAgent);\n        }\n        return bowser;\n    }\n    /**\n     * Returns true if the UUID is a string of 36 characters;\n     * @param uuid\n     * @returns {*|boolean}\n     */\n    static isValidUuid(uuid) {\n        return /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(uuid);\n    }\n    static getRandomUuid() {\n        let uuidStr = '';\n        const crypto = typeof window === 'undefined' ? global.crypto : window.crypto || window.msCrypto;\n        if (crypto) {\n            uuidStr = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n                var r = (crypto.getRandomValues(new Uint8Array(1))[0] % 16) | 0, v = c == 'x' ? r : (r & 0x3) | 0x8;\n                return v.toString(16);\n            });\n        }\n        else {\n            uuidStr = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n                var r = (Math.random() * 16) | 0, v = c == 'x' ? r : (r & 0x3) | 0x8;\n                return v.toString(16);\n            });\n        }\n        return uuidStr;\n    }\n    static logMethodCall(methodName, ...args) {\n        return Log.debug(`Called %c${methodName}(${args.map(Utils.stringify).join(', ')})`, Utils.getConsoleStyle('code'), '.');\n    }\n    static isHttps() {\n        if (OneSignalUtils.isSafari()) {\n            return window.location.protocol === \"https:\";\n        }\n        return !OneSignalUtils.isUsingSubscriptionWorkaround();\n    }\n    static isSafari() {\n        return Environment.isBrowser() && typeof window.safari !== \"undefined\";\n    }\n}\nexport default OneSignalUtils;\n//# sourceMappingURL=OneSignalUtils.js.map","import OneSignalError from \"./OneSignalError\";\nexport var InvalidArgumentReason;\n(function (InvalidArgumentReason) {\n    InvalidArgumentReason[InvalidArgumentReason[\"Empty\"] = 0] = \"Empty\";\n    InvalidArgumentReason[InvalidArgumentReason[\"Malformed\"] = 1] = \"Malformed\";\n    InvalidArgumentReason[InvalidArgumentReason[\"EnumOutOfRange\"] = 2] = \"EnumOutOfRange\";\n})(InvalidArgumentReason || (InvalidArgumentReason = {}));\nexport class InvalidArgumentError extends OneSignalError {\n    constructor(argName, reason) {\n        switch (reason) {\n            case InvalidArgumentReason.Empty:\n                super(`Supply a non-empty value to '${argName}'.`);\n                break;\n            case InvalidArgumentReason.Malformed:\n                super(`The value for '${argName}' was malformed.`);\n                break;\n            case InvalidArgumentReason.EnumOutOfRange:\n                super(`The value for '${argName}' was out of range of the expected input enum.`);\n                break;\n        }\n        this.argument = argName;\n        this.reason = InvalidArgumentReason[reason];\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, InvalidArgumentError.prototype);\n    }\n}\n//# sourceMappingURL=InvalidArgumentError.js.map","import SdkEnvironment from './managers/SdkEnvironment';\nimport { WindowEnvironmentKind } from './models/WindowEnvironmentKind';\nimport bowser from 'bowser';\nexport default class Environment {\n    /**\n     * True if not in a service worker environment.\n     */\n    static isBrowser() {\n        return typeof window !== 'undefined';\n    }\n    static isSafari() {\n        return Environment.isBrowser() && bowser.safari;\n    }\n    static version() {\n        return (typeof __VERSION__ === \"undefined\" ? 1 : Number(__VERSION__));\n    }\n    static get TRADITIONAL_CHINESE_LANGUAGE_TAG() {\n        return ['tw', 'hant'];\n    }\n    static get SIMPLIFIED_CHINESE_LANGUAGE_TAG() {\n        return ['cn', 'hans'];\n    }\n    /* Specifications: https://tools.ietf.org/html/bcp47 */\n    static getLanguage() {\n        let languageTag = navigator.language;\n        if (languageTag) {\n            languageTag = languageTag.toLowerCase();\n            let languageSubtags = languageTag.split('-');\n            if (languageSubtags[0] == 'zh') {\n                // The language is zh-?\n                // We must categorize the language as either zh-Hans (simplified) or zh-Hant (traditional); OneSignal only supports these two Chinese variants\n                for (let traditionalSubtag of Environment.TRADITIONAL_CHINESE_LANGUAGE_TAG) {\n                    if (languageSubtags.indexOf(traditionalSubtag) !== -1) {\n                        return 'zh-Hant';\n                    }\n                }\n                for (let simpleSubtag of Environment.SIMPLIFIED_CHINESE_LANGUAGE_TAG) {\n                    if (languageSubtags.indexOf(simpleSubtag) !== -1) {\n                        return 'zh-Hans';\n                    }\n                }\n                return 'zh-Hant'; // Return Chinese traditional by default\n            }\n            else {\n                // Return the language subtag (it can be three characters, so truncate it down to 2 just to be sure)\n                return languageSubtags[0].substring(0, 2);\n            }\n        }\n        else {\n            return 'en';\n        }\n    }\n    static supportsServiceWorkers() {\n        const env = SdkEnvironment.getWindowEnv();\n        switch (env) {\n            case WindowEnvironmentKind.ServiceWorker:\n                return true;\n            default:\n                return typeof navigator !== \"undefined\" &&\n                    'serviceWorker' in navigator;\n        }\n    }\n    /*\n      Returns the MD5 hash of all stylesheets within the src/stylesheets\n      directory.\n     */\n    static getSdkStylesVersionHash() {\n        return (typeof __SRC_STYLESHEETS_MD5_HASH__ === \"undefined\" ? '2' : __SRC_STYLESHEETS_MD5_HASH__);\n    }\n}\n//# sourceMappingURL=Environment.js.map","export default class OneSignalError extends Error {\n    constructor(message = '') {\n        super(message);\n        // extending Error is weird and does not propagate `message`\n        Object.defineProperty(this, 'message', {\n            configurable: true,\n            enumerable: false,\n            value: message,\n            writable: true,\n        });\n        Object.defineProperty(this, 'name', {\n            configurable: true,\n            enumerable: false,\n            value: this.constructor.name,\n            writable: true,\n        });\n        if (Error.hasOwnProperty('captureStackTrace')) {\n            Error.captureStackTrace(this, this.constructor);\n            return;\n        }\n        Object.defineProperty(this, 'stack', {\n            configurable: true,\n            enumerable: false,\n            value: (new Error(message)).stack,\n            writable: true,\n        });\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, OneSignalError.prototype);\n    }\n}\n//# sourceMappingURL=OneSignalError.js.map","import OneSignalError from \"./OneSignalError\";\nimport { PermissionPromptType } from \"../models/PermissionPromptType\";\nexport var InvalidStateReason;\n(function (InvalidStateReason) {\n    InvalidStateReason[InvalidStateReason[\"MissingAppId\"] = 0] = \"MissingAppId\";\n    InvalidStateReason[InvalidStateReason[\"RedundantPermissionMessage\"] = 1] = \"RedundantPermissionMessage\";\n    InvalidStateReason[InvalidStateReason[\"PushPermissionAlreadyGranted\"] = 2] = \"PushPermissionAlreadyGranted\";\n    InvalidStateReason[InvalidStateReason[\"UnsupportedEnvironment\"] = 3] = \"UnsupportedEnvironment\";\n    InvalidStateReason[InvalidStateReason[\"MissingDomElement\"] = 4] = \"MissingDomElement\";\n    InvalidStateReason[InvalidStateReason[\"ServiceWorkerNotActivated\"] = 5] = \"ServiceWorkerNotActivated\";\n    InvalidStateReason[InvalidStateReason[\"NoProxyFrame\"] = 6] = \"NoProxyFrame\";\n})(InvalidStateReason || (InvalidStateReason = {}));\nexport class InvalidStateError extends OneSignalError {\n    constructor(reason, extra) {\n        switch (reason) {\n            case InvalidStateReason.MissingAppId:\n                super(`Missing required app ID.`);\n                break;\n            case InvalidStateReason.RedundantPermissionMessage:\n                let extraInfo = '';\n                if (extra && extra.permissionPromptType)\n                    extraInfo = `(${PermissionPromptType[extra.permissionPromptType]})`;\n                super(`Another permission message ${extraInfo} is being displayed.`);\n                break;\n            case InvalidStateReason.PushPermissionAlreadyGranted:\n                super(`Push permission has already been granted.`);\n                break;\n            case InvalidStateReason.UnsupportedEnvironment:\n                super(`The current environment does not support this operation.`);\n                break;\n            case InvalidStateReason.ServiceWorkerNotActivated:\n                super(`The service worker must be activated first.`);\n                break;\n            case InvalidStateReason.NoProxyFrame:\n                super(`No proxy frame.`);\n                break;\n        }\n        this.description = InvalidStateReason[reason];\n        this.reason = reason;\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, InvalidStateError.prototype);\n    }\n}\n//# sourceMappingURL=InvalidStateError.js.map","export default class Log {\n    static debug(...args) {\n        if (!!self.shouldLog) {\n            console.debug(...args);\n        }\n    }\n    static trace(...args) {\n        if (!!self.shouldLog) {\n            console.trace(...args);\n        }\n    }\n    static info(...args) {\n        if (!!self.shouldLog) {\n            console.info(...args);\n        }\n    }\n    static warn(...args) {\n        if (!!self.shouldLog) {\n            console.warn(...args);\n        }\n    }\n    static error(...args) {\n        if (!!self.shouldLog) {\n            console.error(...args);\n        }\n    }\n}\n//# sourceMappingURL=Log.js.map","import Log from \"../../libraries/sw/Log\";\nconst doNothing = () => {\n    Log.debug(\"Do nothing\");\n};\nexport function cancelableTimeout(callback, delayInSeconds) {\n    const delayInMilliseconds = delayInSeconds * 1000;\n    let timerId;\n    let clearTimeoutHandle = undefined;\n    const promise = new Promise((resolve, reject) => {\n        let startedExecution = false;\n        timerId = self.setTimeout(async () => {\n            startedExecution = true;\n            try {\n                await callback();\n                resolve();\n            }\n            catch (e) {\n                Log.error(\"Failed to execute callback\", e);\n                reject();\n            }\n        }, delayInMilliseconds);\n        clearTimeoutHandle = () => {\n            Log.debug(\"Cancel called\");\n            self.clearTimeout(timerId);\n            if (!startedExecution) {\n                resolve();\n            }\n        };\n    });\n    if (!clearTimeoutHandle) {\n        Log.warn(\"clearTimeoutHandle was not assigned.\");\n        return {\n            promise,\n            cancel: doNothing,\n        };\n    }\n    return {\n        promise,\n        cancel: clearTimeoutHandle,\n    };\n}\n//# sourceMappingURL=CancelableTimeout.js.map","import { OneSignalApiSW } from \"../OneSignalApiSW\";\nimport Log from \"../libraries/sw/Log\";\nimport { initializeNewSession, SessionOrigin, SessionStatus } from \"../models/Session\";\nimport { InvalidStateError, InvalidStateReason } from \"../errors/InvalidStateError\";\nimport { OneSignalUtils } from \"../utils/OneSignalUtils\";\nimport Database from \"../services/Database\";\nimport { PushDeviceRecord } from \"../models/PushDeviceRecord\";\nimport { RawPushSubscription } from '../models/RawPushSubscription';\nimport PageServiceWorkerHelper from \"./page/ServiceWorkerHelper\";\nimport OutcomesHelper from './shared/OutcomesHelper';\nimport { cancelableTimeout } from './sw/CancelableTimeout';\nexport default class ServiceWorkerHelper {\n    static async getRegistration() {\n        return await PageServiceWorkerHelper.getRegistration();\n    }\n    static getServiceWorkerHref(workerState, config) {\n        let workerFullPath = \"\";\n        // Determine which worker to install\n        if (workerState === ServiceWorkerActiveState.WorkerA)\n            workerFullPath = config.workerBPath.getFullPath();\n        else if (workerState === ServiceWorkerActiveState.WorkerB ||\n            workerState === ServiceWorkerActiveState.ThirdParty ||\n            workerState === ServiceWorkerActiveState.None)\n            workerFullPath = config.workerAPath.getFullPath();\n        else if (workerState === ServiceWorkerActiveState.Bypassed) {\n            /*\n              if the page is hard refreshed bypassing the cache, no service worker\n              will control the page.\n      \n              It doesn't matter if we try to reinstall an existing worker; still no\n              service worker will control the page after installation.\n             */\n            throw new InvalidStateError(InvalidStateReason.UnsupportedEnvironment);\n        }\n        return new URL(workerFullPath, OneSignalUtils.getBaseUrl()).href;\n    }\n    static async upsertSession(sessionThresholdInSeconds, sendOnFocusEnabled, deviceRecord, deviceId, sessionOrigin, outcomesConfig) {\n        if (!deviceId) {\n            Log.error(\"No deviceId provided for new session.\");\n            return;\n        }\n        if (!deviceRecord.app_id) {\n            Log.error(\"No appId provided for new session.\");\n            return;\n        }\n        const existingSession = await Database.getCurrentSession();\n        if (!existingSession) {\n            const appId = deviceRecord.app_id;\n            const session = initializeNewSession({ deviceId, appId, deviceType: deviceRecord.device_type });\n            // if there is a record about a clicked notification in our database, attribute session to it.\n            const clickedNotification = await Database.getLastNotificationClicked(appId);\n            if (clickedNotification) {\n                session.notificationId = clickedNotification.notificationId;\n            }\n            await Database.upsertSession(session);\n            await ServiceWorkerHelper.sendOnSessionCallIfNecessary(sessionOrigin, deviceRecord, deviceId, session);\n            return;\n        }\n        if (existingSession.status === SessionStatus.Active) {\n            Log.debug(\"Session already active\", existingSession);\n            return;\n        }\n        if (!existingSession.lastDeactivatedTimestamp) {\n            Log.debug(\"Session is in invalid state\", existingSession);\n            // TODO: possibly recover by re-starting session if deviceId is present?\n            return;\n        }\n        const currentTimestamp = new Date().getTime();\n        const timeSinceLastDeactivatedInSeconds = ServiceWorkerHelper.timeInSecondsBetweenTimestamps(currentTimestamp, existingSession.lastDeactivatedTimestamp);\n        if (timeSinceLastDeactivatedInSeconds <= sessionThresholdInSeconds) {\n            existingSession.status = SessionStatus.Active;\n            existingSession.lastActivatedTimestamp = currentTimestamp;\n            existingSession.lastDeactivatedTimestamp = null;\n            await Database.upsertSession(existingSession);\n            return;\n        }\n        // If failed to report/clean-up last time, we can attempt to try again here.\n        // TODO: Possibly check that it's not unreasonably long.\n        // TODO: Or couple with periodic ping for better results.\n        await ServiceWorkerHelper.finalizeSession(existingSession, sendOnFocusEnabled, outcomesConfig);\n        const session = initializeNewSession({ deviceId, appId: deviceRecord.app_id, deviceType: deviceRecord.device_type });\n        await Database.upsertSession(session);\n        await ServiceWorkerHelper.sendOnSessionCallIfNecessary(sessionOrigin, deviceRecord, deviceId, session);\n    }\n    static async deactivateSession(thresholdInSeconds, sendOnFocusEnabled, outcomesConfig) {\n        const existingSession = await Database.getCurrentSession();\n        if (!existingSession) {\n            Log.debug(\"No active session found. Cannot deactivate.\");\n            return undefined;\n        }\n        /**\n         * For 2 subsequent deactivate requests we need to make sure there is an active finalization timeout.\n         * Timer gets cleaned up before figuring out it's activate or deactivate.\n         * No update needed for the session, early return.\n         */\n        if (existingSession.status === SessionStatus.Inactive) {\n            return cancelableTimeout(() => ServiceWorkerHelper.finalizeSession(existingSession, sendOnFocusEnabled, outcomesConfig), thresholdInSeconds);\n        }\n        /**\n         * Can only be active or expired at this point, but more statuses may come in in the future.\n         * For anything but active, logging a warning and doing early return.\n         */\n        if (existingSession.status !== SessionStatus.Active) {\n            Log.warn(`Session in invalid state ${existingSession.status}. Cannot deactivate.`);\n            return undefined;\n        }\n        const currentTimestamp = new Date().getTime();\n        const timeSinceLastActivatedInSeconds = ServiceWorkerHelper.timeInSecondsBetweenTimestamps(currentTimestamp, existingSession.lastActivatedTimestamp);\n        existingSession.lastDeactivatedTimestamp = currentTimestamp;\n        existingSession.accumulatedDuration += timeSinceLastActivatedInSeconds;\n        existingSession.status = SessionStatus.Inactive;\n        const cancelableFinalize = cancelableTimeout(() => ServiceWorkerHelper.finalizeSession(existingSession, sendOnFocusEnabled, outcomesConfig), thresholdInSeconds);\n        await Database.upsertSession(existingSession);\n        return cancelableFinalize;\n    }\n    /**\n     * Sends on_session call on each new session initialization except the case\n     * when player create call occurs, e.g. first subscribed or re-subscribed cases after clearing cookies,\n     * since player#create call updates last_session field on player.\n     */\n    static async sendOnSessionCallIfNecessary(sessionOrigin, deviceRecord, deviceId, session) {\n        if (sessionOrigin === SessionOrigin.PlayerCreate) {\n            return;\n        }\n        if (!deviceRecord.identifier) {\n            const subscription = await self.registration.pushManager.getSubscription();\n            if (subscription) {\n                const rawPushSubscription = RawPushSubscription.setFromW3cSubscription(subscription);\n                const fullDeviceRecord = new PushDeviceRecord(rawPushSubscription).serialize();\n                deviceRecord.identifier = fullDeviceRecord.identifier;\n            }\n        }\n        const newPlayerId = await OneSignalApiSW.updateUserSession(deviceId, deviceRecord);\n        // If the returned player id is different, save the new id to indexed db and update session\n        if (newPlayerId !== deviceId) {\n            session.deviceId = newPlayerId;\n            await Promise.all([\n                Database.setDeviceId(newPlayerId),\n                Database.upsertSession(session),\n                Database.resetSentUniqueOutcomes()\n            ]);\n        }\n    }\n    static async finalizeSession(session, sendOnFocusEnabled, outcomesConfig) {\n        Log.debug(\"Finalize session\", `started: ${new Date(session.startTimestamp)}`, `duration: ${session.accumulatedDuration}s`);\n        if (sendOnFocusEnabled) {\n            Log.debug(`send on_focus reporting session duration -> ${session.accumulatedDuration}s`);\n            const attribution = await OutcomesHelper.getAttribution(outcomesConfig);\n            Log.debug(\"send on_focus with attribution\", attribution);\n            await OneSignalApiSW.sendSessionDuration(session.appId, session.deviceId, session.accumulatedDuration, session.deviceType, attribution);\n        }\n        await Promise.all([\n            Database.cleanupCurrentSession(),\n            Database.removeAllNotificationClicked()\n        ]);\n        Log.debug(\"Finalize session finished\", `started: ${new Date(session.startTimestamp)}`);\n    }\n    static timeInSecondsBetweenTimestamps(timestamp1, timestamp2) {\n        if (timestamp1 <= timestamp2) {\n            return 0;\n        }\n        return Math.floor((timestamp1 - timestamp2) / 1000);\n    }\n}\nexport var ServiceWorkerActiveState;\n(function (ServiceWorkerActiveState) {\n    /**\n     * OneSignalSDKWorker.js, or the equivalent custom file name, is active.\n     */\n    ServiceWorkerActiveState[\"WorkerA\"] = \"Worker A (Main)\";\n    /**\n     * OneSignalSDKUpdaterWorker.js, or the equivalent custom file name, is\n     * active.\n     *\n     * We no longer need to use this filename. We can update Worker A by appending\n     * a random query parameter to A.\n     */\n    ServiceWorkerActiveState[\"WorkerB\"] = \"Worker B (Updater)\";\n    /**\n     * A service worker is active, but it is neither OneSignalSDKWorker.js nor\n     * OneSignalSDKUpdaterWorker.js (or the equivalent custom file names as\n     * provided by user config).\n     */\n    ServiceWorkerActiveState[\"ThirdParty\"] = \"3rd Party\";\n    /**\n     * A service worker is currently installing and we can't determine its final state yet. Wait until\n     * the service worker is finished installing by checking for a controllerchange property..\n     */\n    ServiceWorkerActiveState[\"Installing\"] = \"Installing\";\n    /**\n     * No service worker is installed.\n     */\n    ServiceWorkerActiveState[\"None\"] = \"None\";\n    /**\n     * A service worker is active but not controlling the page. This can occur if\n     * the page is hard-refreshed bypassing the cache, which also bypasses service\n     * workers.\n     */\n    ServiceWorkerActiveState[\"Bypassed\"] = \"Bypassed\";\n    /**\n     * Service workers are not supported in this environment. This status is used\n     * on HTTP pages where it isn't possible to know whether a service worker is\n     * installed or not or in any of the other states.\n     */\n    ServiceWorkerActiveState[\"Indeterminate\"] = \"Indeterminate\";\n})(ServiceWorkerActiveState || (ServiceWorkerActiveState = {}));\n//# sourceMappingURL=ServiceWorkerHelper.js.map","export var SessionStatus;\n(function (SessionStatus) {\n    SessionStatus[\"Active\"] = \"active\";\n    SessionStatus[\"Inactive\"] = \"inactive\";\n    SessionStatus[\"Expired\"] = \"expired\";\n})(SessionStatus || (SessionStatus = {}));\nexport var SessionOrigin;\n(function (SessionOrigin) {\n    SessionOrigin[SessionOrigin[\"PlayerCreate\"] = 1] = \"PlayerCreate\";\n    SessionOrigin[SessionOrigin[\"PlayerOnSession\"] = 2] = \"PlayerOnSession\";\n    SessionOrigin[SessionOrigin[\"VisibilityVisible\"] = 3] = \"VisibilityVisible\";\n    SessionOrigin[SessionOrigin[\"VisibilityHidden\"] = 4] = \"VisibilityHidden\";\n    SessionOrigin[SessionOrigin[\"BeforeUnload\"] = 5] = \"BeforeUnload\";\n    SessionOrigin[SessionOrigin[\"PageRefresh\"] = 6] = \"PageRefresh\";\n    SessionOrigin[SessionOrigin[\"Focus\"] = 7] = \"Focus\";\n    SessionOrigin[SessionOrigin[\"Blur\"] = 8] = \"Blur\";\n})(SessionOrigin || (SessionOrigin = {}));\nexport const ONESIGNAL_SESSION_KEY = \"oneSignalSession\";\nexport function initializeNewSession(options) {\n    const currentTimestamp = new Date().getTime();\n    const sessionKey = options && options.sessionKey || ONESIGNAL_SESSION_KEY;\n    const notificationId = (options && options.notificationId) || null;\n    return {\n        sessionKey,\n        appId: options.appId,\n        deviceId: options.deviceId,\n        deviceType: options.deviceType,\n        startTimestamp: currentTimestamp,\n        accumulatedDuration: 0,\n        notificationId,\n        status: SessionStatus.Active,\n        lastDeactivatedTimestamp: null,\n        lastActivatedTimestamp: currentTimestamp,\n    };\n}\n//# sourceMappingURL=Session.js.map","/**\n * Build Environment Kind\n */\nexport var EnvironmentKind;\n(function (EnvironmentKind) {\n    EnvironmentKind[\"Development\"] = \"Development\";\n    EnvironmentKind[\"Staging\"] = \"Staging\";\n    EnvironmentKind[\"Production\"] = \"Production\";\n})(EnvironmentKind || (EnvironmentKind = {}));\n//# sourceMappingURL=EnvironmentKind.js.map","export var IntegrationKind;\n(function (IntegrationKind) {\n    /**\n     * An secure HTTPS site using its own origin for subscribing.\n     */\n    IntegrationKind[\"Secure\"] = \"Secure\";\n    /**\n     * A secure HTTPS site using a proxy subscription origin (e.g. subdomain.os.tc or\n     * subdomain.onesignal.com).\n     */\n    IntegrationKind[\"SecureProxy\"] = \"Secure Proxy\";\n    /**\n     * An insecure HTTP site using a proxy subscription origin (e.g. subdomain.os.tc or\n     * subdomain.onesignal.com).\n     */\n    IntegrationKind[\"InsecureProxy\"] = \"Insecure Proxy\";\n})(IntegrationKind || (IntegrationKind = {}));\n//# sourceMappingURL=IntegrationKind.js.map","export var SubscriptionStateKind;\n(function (SubscriptionStateKind) {\n    SubscriptionStateKind[SubscriptionStateKind[\"Default\"] = 0] = \"Default\";\n    SubscriptionStateKind[SubscriptionStateKind[\"Subscribed\"] = 1] = \"Subscribed\";\n    SubscriptionStateKind[SubscriptionStateKind[\"MutedByApi\"] = -2] = \"MutedByApi\";\n    SubscriptionStateKind[SubscriptionStateKind[\"NotSubscribed\"] = -10] = \"NotSubscribed\";\n    SubscriptionStateKind[SubscriptionStateKind[\"TemporaryWebRecord\"] = -20] = \"TemporaryWebRecord\";\n    SubscriptionStateKind[SubscriptionStateKind[\"PermissionRevoked\"] = -21] = \"PermissionRevoked\";\n    SubscriptionStateKind[SubscriptionStateKind[\"PushSubscriptionRevoked\"] = -22] = \"PushSubscriptionRevoked\";\n    SubscriptionStateKind[SubscriptionStateKind[\"ServiceWorkerStatus403\"] = -23] = \"ServiceWorkerStatus403\";\n    SubscriptionStateKind[SubscriptionStateKind[\"ServiceWorkerStatus404\"] = -24] = \"ServiceWorkerStatus404\";\n})(SubscriptionStateKind || (SubscriptionStateKind = {}));\n//# sourceMappingURL=SubscriptionStateKind.js.map","import Environment from './Environment';\nimport SdkEnvironment from './managers/SdkEnvironment';\nimport { Utils } from \"./context/shared/utils/Utils\";\nimport { OneSignalApiError, OneSignalApiErrorKind } from './errors/OneSignalApiError';\nimport Log from \"./libraries/Log\";\nexport class OneSignalApiBase {\n    static get(action, data, headers) {\n        return OneSignalApiBase.call('GET', action, data, headers);\n    }\n    static post(action, data, headers) {\n        return OneSignalApiBase.call('POST', action, data, headers);\n    }\n    static put(action, data, headers) {\n        return OneSignalApiBase.call('PUT', action, data, headers);\n    }\n    static delete(action, data, headers) {\n        return OneSignalApiBase.call('DELETE', action, data, headers);\n    }\n    static call(method, action, data, headers) {\n        if (method === \"GET\") {\n            if (action.indexOf(\"players\") > -1 && action.indexOf(\"app_id=\") === -1) {\n                console.error(\"Calls to player api are not permitted without app_id\");\n                return Promise.reject(new OneSignalApiError(OneSignalApiErrorKind.MissingAppId));\n            }\n        }\n        else {\n            if (action.indexOf(\"players\") > -1 && (!data || !data[\"app_id\"])) {\n                console.error(\"Calls to player api are not permitted without app_id\");\n                return Promise.reject(new OneSignalApiError(OneSignalApiErrorKind.MissingAppId));\n            }\n        }\n        let callHeaders = new Headers();\n        callHeaders.append(\"Origin\", SdkEnvironment.getOrigin());\n        callHeaders.append('SDK-Version', `onesignal/web/${Environment.version()}`);\n        callHeaders.append('Content-Type', 'application/json;charset=UTF-8');\n        if (headers) {\n            for (let key of Object.keys(headers)) {\n                callHeaders.append(key, headers[key]);\n            }\n        }\n        const contents = {\n            method: method || 'NO_METHOD_SPECIFIED',\n            headers: callHeaders,\n            cache: 'no-cache'\n        };\n        if (data)\n            contents.body = JSON.stringify(data);\n        let status;\n        return fetch(SdkEnvironment.getOneSignalApiUrl(undefined, action).toString() + '/' + action, contents)\n            .then(response => {\n            status = response.status;\n            return response.json();\n        })\n            .then(json => {\n            if (status >= 200 && status < 300)\n                return json;\n            else {\n                let error = OneSignalApiBase.identifyError(json);\n                if (error === 'no-user-id-error') {\n                    // TODO: This returns undefined\n                }\n                else {\n                    return Promise.reject(json);\n                }\n            }\n        })\n            .catch(err => {\n            Log.warn(`Could not complete request to /${action}`, err);\n            return Promise.reject(err);\n        });\n    }\n    static identifyError(error) {\n        if (!error || !error.errors) {\n            return 'no-error';\n        }\n        let errors = error.errors;\n        if (Utils.contains(errors, 'No user with this id found') ||\n            Utils.contains(errors, 'Could not find app_id for given player id.')) {\n            return 'no-user-id-error';\n        }\n        return 'unknown-error';\n    }\n}\nexport default OneSignalApiBase;\n//# sourceMappingURL=OneSignalApiBase.js.map","export var OutcomeAttributionType;\n(function (OutcomeAttributionType) {\n    OutcomeAttributionType[OutcomeAttributionType[\"Direct\"] = 1] = \"Direct\";\n    OutcomeAttributionType[OutcomeAttributionType[\"Indirect\"] = 2] = \"Indirect\";\n    OutcomeAttributionType[OutcomeAttributionType[\"Unattributed\"] = 3] = \"Unattributed\";\n    OutcomeAttributionType[OutcomeAttributionType[\"NotSupported\"] = 4] = \"NotSupported\";\n})(OutcomeAttributionType || (OutcomeAttributionType = {}));\n//# sourceMappingURL=Outcomes.js.map","import OneSignalError from \"./OneSignalError\";\nexport default class NotImplementedError extends OneSignalError {\n    constructor() {\n        super('This code is not implemented yet.');\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, NotImplementedError.prototype);\n    }\n}\n//# sourceMappingURL=NotImplementedError.js.map","export class RawPushSubscription {\n    /**\n     * Returns true if an existing recorded W3C or Safari subscription is\n     * identical to the current subscription.\n     */\n    isNewSubscription() {\n        if (this.existingW3cPushSubscription) {\n            if (!!this.existingW3cPushSubscription.w3cEndpoint !== !!this.w3cEndpoint) {\n                return true;\n            }\n            if (!!this.existingW3cPushSubscription.w3cEndpoint && !!this.w3cEndpoint &&\n                this.existingW3cPushSubscription.w3cEndpoint.toString() !== this.w3cEndpoint.toString()) {\n                return true;\n            }\n            if (this.existingW3cPushSubscription.w3cP256dh !== this.w3cP256dh) {\n                return true;\n            }\n            if (this.existingW3cPushSubscription.w3cAuth !== this.w3cAuth) {\n                return true;\n            }\n            return false;\n        }\n        else if (this.existingSafariDeviceToken) {\n            return this.existingSafariDeviceToken !== this.safariDeviceToken;\n        }\n        return true;\n    }\n    /**\n     * Given a native W3C browser push subscription, takes the endpoint, p256dh,\n     * and auth.\n     *\n     * @param pushSubscription A native browser W3C push subscription.\n     */\n    static setFromW3cSubscription(pushSubscription) {\n        const rawPushSubscription = new RawPushSubscription();\n        if (pushSubscription) {\n            rawPushSubscription.w3cEndpoint = new URL(pushSubscription.endpoint);\n            // Retrieve p256dh and auth for encrypted web push protocol\n            if (pushSubscription.getKey) {\n                // p256dh and auth are both ArrayBuffer\n                let p256dh = null;\n                try {\n                    p256dh = pushSubscription.getKey('p256dh');\n                }\n                catch (e) {\n                    // User is most likely running < Chrome < 50\n                }\n                let auth = null;\n                try {\n                    auth = pushSubscription.getKey('auth');\n                }\n                catch (e) {\n                    // User is most likely running < Firefox 45\n                }\n                if (p256dh) {\n                    // Base64 encode the ArrayBuffer (not URL-Safe, using standard Base64)\n                    let p256dh_base64encoded = btoa(String.fromCharCode.apply(null, new Uint8Array(p256dh)));\n                    rawPushSubscription.w3cP256dh = p256dh_base64encoded;\n                }\n                if (auth) {\n                    // Base64 encode the ArrayBuffer (not URL-Safe, using standard Base64)\n                    let auth_base64encoded = btoa(String.fromCharCode.apply(null, new Uint8Array(auth)));\n                    rawPushSubscription.w3cAuth = auth_base64encoded;\n                }\n            }\n        }\n        return rawPushSubscription;\n    }\n    /**\n     * Given a native browser Safari push subscription, sets the device token\n     * property.\n     *\n     * @param safariDeviceToken A native browser Safari push subscription.\n     */\n    setFromSafariSubscription(safariDeviceToken) {\n        this.safariDeviceToken = safariDeviceToken;\n    }\n    serialize() {\n        const serializedBundle = {\n            /* Old Parameters */\n            w3cEndpoint: this.w3cEndpoint ? this.w3cEndpoint.toString() : null,\n            w3cP256dh: this.w3cP256dh,\n            w3cAuth: this.w3cAuth,\n            safariDeviceToken: this.safariDeviceToken,\n            existingPushSubscription: this.existingW3cPushSubscription ? this.existingW3cPushSubscription.serialize() : null,\n            existingSafariDeviceToken: this.existingSafariDeviceToken\n        };\n        return serializedBundle;\n    }\n    // TODO: had a hard to debug bug here due to \"any\" type bypassing typescript validation.\n    // Check the usage and maybe change with strict type\n    static deserialize(bundle) {\n        const subscription = new RawPushSubscription();\n        if (!bundle) {\n            return subscription;\n        }\n        try {\n            subscription.w3cEndpoint = new URL(bundle.w3cEndpoint);\n        }\n        catch (e) {\n            // w3cEndpoint will be null for Safari\n        }\n        subscription.w3cP256dh = bundle.w3cP256dh;\n        subscription.w3cAuth = bundle.w3cAuth;\n        subscription.existingW3cPushSubscription = undefined;\n        if (bundle.existingW3cPushSubscription) {\n            subscription.existingW3cPushSubscription = RawPushSubscription.deserialize(bundle.existingW3cPushSubscription);\n        }\n        else if (bundle.existingPushSubscription) {\n            subscription.existingW3cPushSubscription = RawPushSubscription.deserialize(bundle.existingPushSubscription);\n        }\n        subscription.safariDeviceToken = bundle.safariDeviceToken;\n        subscription.existingSafariDeviceToken = bundle.existingSafariDeviceToken;\n        return subscription;\n    }\n}\n//# sourceMappingURL=RawPushSubscription.js.map","import OneSignalError from \"./OneSignalError\";\nexport var OneSignalApiErrorKind;\n(function (OneSignalApiErrorKind) {\n    OneSignalApiErrorKind[OneSignalApiErrorKind[\"MissingAppId\"] = 0] = \"MissingAppId\";\n})(OneSignalApiErrorKind || (OneSignalApiErrorKind = {}));\nexport class OneSignalApiError extends OneSignalError {\n    constructor(reason) {\n        switch (reason) {\n            case OneSignalApiErrorKind.MissingAppId:\n                super('The API call is missing an app ID.');\n                break;\n        }\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, OneSignalApiError.prototype);\n    }\n}\n//# sourceMappingURL=OneSignalApiError.js.map","import Database from \"../services/Database\";\nimport Event from '../Event';\nexport class PermissionUtils {\n    static async triggerNotificationPermissionChanged(updateIfIdentical = false) {\n        const newPermission = await OneSignal.privateGetNotificationPermission();\n        const previousPermission = await Database.get('Options', 'notificationPermission');\n        const shouldBeUpdated = newPermission !== previousPermission || updateIfIdentical;\n        if (!shouldBeUpdated) {\n            return;\n        }\n        await Database.put('Options', { key: 'notificationPermission', value: newPermission });\n        Event.trigger(OneSignal.EVENTS.NATIVE_PROMPT_PERMISSIONCHANGED, { to: newPermission });\n    }\n}\n//# sourceMappingURL=PermissionUtils.js.map","/**\n * Source: https://github.com/pazguille/emitter-es6\n */\n/**\n * Creates a new instance of Emitter.\n * @class\n * @returns {Object} emitter - An instance of Emitter.\n * @example\n * var emitter = new Emitter();\n */\nexport default class Emitter {\n    constructor() {\n        this._events = {};\n    }\n    /**\n     * Adds a listener to the collection for a specified event.\n     */\n    on(event, listener) {\n        this._events[event] = this._events[event] || [];\n        this._events[event].push(listener);\n        return this;\n    }\n    /**\n     * Adds a one time listener to the collection for a specified event. It will\n     * execute only once.\n     */\n    once(event, listener) {\n        const that = this;\n        function fn() {\n            that.off(event, fn);\n            listener.apply(this, arguments);\n        }\n        fn.listener = listener;\n        this.on(event, fn);\n        return this;\n    }\n    /**\n     * Removes a listener from the collection for a specified event.\n     */\n    off(event, listener) {\n        const listeners = this._events[event];\n        if (listeners !== undefined) {\n            for (let j = 0; j < listeners.length; j += 1) {\n                if (listeners[j] === listener || listeners[j].listener === listener) {\n                    listeners.splice(j, 1);\n                    break;\n                }\n            }\n            if (listeners.length === 0)\n                this.removeAllListeners(event);\n        }\n        return this;\n    }\n    /**\n     * Removes all listeners from the collection for a specified event.\n     */\n    removeAllListeners(event) {\n        try {\n            if (event)\n                delete this._events[event];\n            else\n                this._events = {};\n        }\n        catch (e) { }\n        return this;\n    }\n    /**\n     * Returns all listeners from the collection for a specified event.\n     * @public\n     * @function\n     * @name Emitter#listeners\n     * @param {String} event - Event name.\n     * @returns {Array}\n     * @example\n     * me.listeners('ready');\n     */\n    listeners(event) {\n        try {\n            return this._events[event];\n        }\n        catch (e) {\n            return undefined;\n        }\n    }\n    /**\n     * Returns number of listeners from the collection for a specified event.\n     * @public\n     * @function\n     * @name Emitter#numberOfListeners\n     * @param {String} event - Event name.\n     * @returns {number}\n     * @example\n     * me.numberOfListeners('ready');\n     */\n    numberOfListeners(event) {\n        const listeners = this.listeners(event);\n        if (listeners)\n            return listeners.length;\n        return 0;\n    }\n    /**\n     * Execute each item in the listener collection in order with the specified data.\n     * @param event - String of the event name\n     * @param args - Variable number of args to pass to the functions subscribe to the event\n     */\n    async emit(...args) {\n        const event = args.shift();\n        let listeners = this._events[event];\n        if (listeners !== undefined) {\n            listeners = listeners.slice(0);\n            const len = listeners.length;\n            for (let i = 0; i < len; i += 1)\n                await listeners[i].apply(this, args);\n        }\n        return this;\n    }\n}\n//# sourceMappingURL=Emitter.js.map","export var DeliveryPlatformKind;\n(function (DeliveryPlatformKind) {\n    DeliveryPlatformKind[DeliveryPlatformKind[\"ChromeLike\"] = 5] = \"ChromeLike\";\n    DeliveryPlatformKind[DeliveryPlatformKind[\"Safari\"] = 7] = \"Safari\";\n    DeliveryPlatformKind[DeliveryPlatformKind[\"Firefox\"] = 8] = \"Firefox\";\n    DeliveryPlatformKind[DeliveryPlatformKind[\"Edge\"] = 12] = \"Edge\";\n    DeliveryPlatformKind[DeliveryPlatformKind[\"Email\"] = 11] = \"Email\";\n})(DeliveryPlatformKind || (DeliveryPlatformKind = {}));\n//# sourceMappingURL=DeliveryPlatformKind.js.map","import bowser from 'bowser';\nimport Environment from '../Environment';\nimport NotImplementedError from '../errors/NotImplementedError';\nimport { DeliveryPlatformKind } from './DeliveryPlatformKind';\nimport { OneSignalUtils } from \"../utils/OneSignalUtils\";\n/**\n * Describes the fields of a OneSignal \"player\" device record.\n *\n * This is used when creating or modifying push and email records.\n */\nexport class DeviceRecord {\n    constructor() {\n        // TODO: Possible implementation for appId initialization\n        // this.appId = OneSignal.context.appConfig.appId;\n        this.language = Environment.getLanguage();\n        this.timezone = new Date().getTimezoneOffset() * -60;\n        const browserVersion = parseInt(String(bowser.version), 10);\n        this.browserVersion = isNaN(browserVersion) ? -1 : browserVersion;\n        this.deviceModel = navigator.platform;\n        this.sdkVersion = Environment.version().toString();\n        this.deliveryPlatform = this.getDeliveryPlatform();\n        // Unimplemented properties are appId, subscriptionState, and subscription\n    }\n    isSafari() {\n        return bowser.safari && window.safari !== undefined && window.safari.pushNotification !== undefined;\n    }\n    getDeliveryPlatform() {\n        // For testing purposes, allows changing the browser user agent\n        const browser = OneSignalUtils.redetectBrowserUserAgent();\n        if (this.isSafari()) {\n            return DeliveryPlatformKind.Safari;\n        }\n        else if (browser.firefox) {\n            return DeliveryPlatformKind.Firefox;\n        }\n        else if (browser.msedge) {\n            return DeliveryPlatformKind.Edge;\n        }\n        else {\n            return DeliveryPlatformKind.ChromeLike;\n        }\n    }\n    serialize() {\n        const serializedBundle = {\n            device_type: this.deliveryPlatform,\n            language: this.language,\n            timezone: this.timezone,\n            device_os: this.browserVersion,\n            device_model: this.deviceModel,\n            sdk: this.sdkVersion,\n            notification_types: this.subscriptionState,\n        };\n        if (this.appId) {\n            serializedBundle.app_id = this.appId;\n        }\n        return serializedBundle;\n    }\n    deserialize(_) { throw new NotImplementedError(); }\n}\n//# sourceMappingURL=DeviceRecord.js.map","import bowser from 'bowser';\nimport NotImplementedError from '../errors/NotImplementedError';\nimport { SubscriptionStateKind } from './SubscriptionStateKind';\nimport { DeviceRecord } from './DeviceRecord';\n/**\n * Describes a push notification device record.\n */\nexport class PushDeviceRecord extends DeviceRecord {\n    /**\n     * @param subscription Omitting this parameter does not void the record's identifier.\n     */\n    constructor(subscription) {\n        super();\n        this.subscription = subscription;\n    }\n    serialize() {\n        const serializedBundle = super.serialize();\n        if (this.subscription) {\n            serializedBundle.identifier = bowser.safari ?\n                this.subscription.safariDeviceToken :\n                this.subscription.w3cEndpoint ? this.subscription.w3cEndpoint.toString() : null;\n            serializedBundle.web_auth = this.subscription.w3cAuth;\n            serializedBundle.web_p256 = this.subscription.w3cP256dh;\n        }\n        return serializedBundle;\n    }\n    static createFromPushSubscription(appId, rawPushSubscription, subscriptionState) {\n        const pushRegistration = new PushDeviceRecord(rawPushSubscription);\n        pushRegistration.appId = appId;\n        pushRegistration.subscriptionState = rawPushSubscription ?\n            SubscriptionStateKind.Subscribed :\n            SubscriptionStateKind.NotSubscribed;\n        if (subscriptionState) {\n            pushRegistration.subscriptionState = subscriptionState;\n        }\n        return pushRegistration;\n    }\n    deserialize(_) { throw new NotImplementedError(); }\n}\n//# sourceMappingURL=PushDeviceRecord.js.map","export class EmailProfile {\n    constructor(emailId, emailAddress, identifierAuthHash) {\n        this.emailId = emailId;\n        this.emailAddress = emailAddress;\n        this.identifierAuthHash = identifierAuthHash;\n    }\n    serialize() {\n        return {\n            identifierAuthHash: this.identifierAuthHash,\n            emailAddress: this.emailAddress,\n            emailId: this.emailId,\n        };\n    }\n    static deserialize(bundle) {\n        return new EmailProfile(bundle.emailId, bundle.emailAddress, bundle.identifierAuthHash);\n    }\n}\n//# sourceMappingURL=EmailProfile.js.map","export var TestEnvironmentKind;\n(function (TestEnvironmentKind) {\n    TestEnvironmentKind[\"None\"] = \"None\";\n    TestEnvironmentKind[\"UnitTesting\"] = \"Unit Testing\";\n})(TestEnvironmentKind || (TestEnvironmentKind = {}));\n//# sourceMappingURL=TestEnvironmentKind.js.map","import Environment from \"../Environment\";\nexport class BrowserUtils {\n    static decodeHtmlEntities(text) {\n        if (Environment.isBrowser()) {\n            if (!BrowserUtils.decodeTextArea) {\n                BrowserUtils.decodeTextArea = document.createElement(\"textarea\");\n            }\n        }\n        if (BrowserUtils.decodeTextArea) {\n            BrowserUtils.decodeTextArea.innerHTML = text;\n            return BrowserUtils.decodeTextArea.value;\n        }\n        else {\n            // Not running in a browser environment, text cannot be decoded\n            return text;\n        }\n    }\n}\nBrowserUtils.decodeTextArea = null;\nexport default BrowserUtils;\n//# sourceMappingURL=BrowserUtils.js.map","import { OutcomeAttributionType } from '../../models/Outcomes';\nimport Database from \"../../services/Database\";\nimport Log from \"../../libraries/Log\";\nimport { Utils } from \"../../context/shared/utils/Utils\";\nimport { logMethodCall, awaitOneSignalInitAndSupported } from '../../utils';\nconst SEND_OUTCOME = \"sendOutcome\";\nconst SEND_UNIQUE_OUTCOME = \"sendUniqueOutcome\";\nexport default class OutcomesHelper {\n    /**\n     * @param  {string} appId\n     * @param  {OutcomesConfig} config - refers specifically to outcomes config\n     * @param  {boolean} isUnique\n     * @param  {string} outcomeName\n     */\n    constructor(appId, config, outcomeName, isUnique) {\n        this.outcomeName = outcomeName;\n        this.config = config;\n        this.appId = appId;\n        this.isUnique = isUnique;\n    }\n    /**\n     * Returns `OutcomeAttribution` object which includes\n     *    1) attribution type\n     *    2) notification ids\n     *\n     * Note: this just looks at notifications that fall within the attribution window and\n     *       does not check if they have been previously attributed (used in both sendOutcome & sendUniqueOutcome)\n     * @returns Promise\n     */\n    async getAttribution() {\n        return await OutcomesHelper.getAttribution(this.config);\n    }\n    /**\n     * Performs logging of method call and returns whether Outcomes are supported\n     * @param  {boolean} isUnique\n     * @returns Promise\n     */\n    async beforeOutcomeSend() {\n        const outcomeMethodString = this.isUnique ? SEND_UNIQUE_OUTCOME : SEND_OUTCOME;\n        logMethodCall(outcomeMethodString, this.outcomeName);\n        if (!this.config) {\n            Log.debug(\"Outcomes feature not supported by main application yet.\");\n            return false;\n        }\n        if (!this.outcomeName) {\n            Log.error(\"Outcome name is required\");\n            return false;\n        }\n        await awaitOneSignalInitAndSupported();\n        const isSubscribed = await OneSignal.privateIsPushNotificationsEnabled();\n        if (!isSubscribed) {\n            Log.warn(\"Reporting outcomes is supported only for subscribed users.\");\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Returns array of notification ids outcome is currently attributed with\n     * @param  {string} outcomeName\n     * @returns Promise\n     */\n    async getAttributedNotifsByUniqueOutcomeName() {\n        const sentOutcomes = await Database.getAll(\"SentUniqueOutcome\");\n        return sentOutcomes\n            .filter(o => o.outcomeName === this.outcomeName)\n            .reduce((acc, curr) => {\n            const notificationIds = curr.notificationIds || [];\n            return [...acc, ...notificationIds];\n        }, []);\n    }\n    /**\n     * Returns array of new notifications that have never been attributed to the outcome\n     * @param  {string} outcomeName\n     * @param  {string[]} notificationIds\n     */\n    async getNotifsToAttributeWithUniqueOutcome(notificationIds) {\n        const previouslyAttributedArr = await this.getAttributedNotifsByUniqueOutcomeName();\n        return notificationIds.filter(id => (previouslyAttributedArr.indexOf(id) === -1));\n    }\n    shouldSendUnique(outcomeAttribution, notifArr) {\n        // we should only send if type is unattributed OR there are notifs to attribute\n        if (outcomeAttribution.type === OutcomeAttributionType.Unattributed) {\n            return true;\n        }\n        return notifArr.length > 0;\n    }\n    async saveSentUniqueOutcome(newNotificationIds) {\n        const outcomeName = this.outcomeName;\n        const existingSentOutcome = await Database.get(\"SentUniqueOutcome\", outcomeName);\n        const currentSession = await Database.getCurrentSession();\n        const existingNotificationIds = !!existingSentOutcome ? existingSentOutcome.notificationIds : [];\n        const notificationIds = [...existingNotificationIds, ...newNotificationIds];\n        const timestamp = currentSession ? currentSession.startTimestamp : null;\n        await Database.put(\"SentUniqueOutcome\", {\n            outcomeName,\n            notificationIds,\n            sentDuringSession: timestamp\n        });\n    }\n    async wasSentDuringSession() {\n        const sentOutcome = await Database.get(\"SentUniqueOutcome\", this.outcomeName);\n        if (!sentOutcome) {\n            return false;\n        }\n        const session = await Database.getCurrentSession();\n        const sessionExistsAndWasPreviouslySent = session && sentOutcome.sentDuringSession === session.startTimestamp;\n        const sessionWasClearedButWasPreviouslySent = !session && !!sentOutcome.sentDuringSession;\n        return sessionExistsAndWasPreviouslySent || sessionWasClearedButWasPreviouslySent;\n    }\n    async send(outcomeProps) {\n        const { type, notificationIds, weight } = outcomeProps;\n        switch (type) {\n            case OutcomeAttributionType.Direct:\n                if (this.isUnique) {\n                    await this.saveSentUniqueOutcome(notificationIds);\n                }\n                await OneSignal.context.updateManager.sendOutcomeDirect(this.appId, notificationIds, this.outcomeName, weight);\n                return;\n            case OutcomeAttributionType.Indirect:\n                if (this.isUnique) {\n                    await this.saveSentUniqueOutcome(notificationIds);\n                }\n                await OneSignal.context.updateManager.sendOutcomeInfluenced(this.appId, notificationIds, this.outcomeName, weight);\n                return;\n            case OutcomeAttributionType.Unattributed:\n                if (this.isUnique) {\n                    if (await this.wasSentDuringSession()) {\n                        Log.warn(`(Unattributed) unique outcome was already sent during this session`);\n                        return;\n                    }\n                    await this.saveSentUniqueOutcome([]);\n                }\n                await OneSignal.context.updateManager.sendOutcomeUnattributed(this.appId, this.outcomeName, weight);\n                return;\n            default:\n                Log.warn(\"You are on a free plan. Please upgrade to use this functionality.\");\n                return;\n        }\n    }\n    // statics\n    /**\n     * Static method: returns `OutcomeAttribution` object which includes\n     *    1) attribution type\n     *    2) notification ids\n     *\n     * Note: this just looks at notifications that fall within the attribution window and\n     *       does not check if they have been previously attributed (used in both sendOutcome & sendUniqueOutcome)\n     * @param  {OutcomesConfig} config\n     * @returns Promise\n     */\n    static async getAttribution(config) {\n        /**\n         * Flow:\n         * 1. check if the url was opened as a result of a notif;\n         * 2. if so, send an api call reporting direct notification outcome\n         *    (currently takes into account the match strategy selected in the app's settings);\n         * 3. else check all received notifs within timeframe from config;\n         * 4. send an api call reporting an influenced outcome for each matching notification\n         *    respecting the limit from config too;\n         * 5. if no influencing notification found, report unattributed outcome to the api.\n         */\n        /* direct notifications */\n        if (config.direct && config.direct.enabled) {\n            const clickedNotifications = await Database.getAll(\"NotificationClicked\");\n            if (clickedNotifications.length > 0) {\n                return {\n                    type: OutcomeAttributionType.Direct,\n                    notificationIds: [clickedNotifications[0].notificationId]\n                };\n            }\n        }\n        /* influencing notifications */\n        if (config.indirect && config.indirect.enabled) {\n            const timeframeMs = config.indirect.influencedTimePeriodMin * 60 * 1000;\n            const beginningOfTimeframe = new Date(new Date().getTime() - timeframeMs);\n            const maxTimestamp = beginningOfTimeframe.getTime();\n            const allReceivedNotification = await Database.getAll(\"NotificationReceived\");\n            Log.debug(`\\tFound total of ${allReceivedNotification.length} received notifications`);\n            if (allReceivedNotification.length > 0) {\n                const max = config.indirect.influencedNotificationsLimit;\n                /**\n                 * To handle correctly the case when user got subscribed to a new app id\n                 * we check the appId on notifications to match the current app.\n                 */\n                const allReceivedNotificationSorted = Utils.sortArrayOfObjects(allReceivedNotification, (notif) => notif.timestamp, true, false);\n                const matchingNotificationIds = allReceivedNotificationSorted\n                    .filter(notif => notif.timestamp >= maxTimestamp)\n                    .slice(0, max)\n                    .map(notif => notif.notificationId);\n                Log.debug(`\\tTotal of ${matchingNotificationIds.length} received notifications are within reporting window.`);\n                // Deleting all unmatched received notifications\n                const notificationIdsToDelete = allReceivedNotificationSorted\n                    .filter(notif => matchingNotificationIds.indexOf(notif.notificationId) === -1)\n                    .map(notif => notif.notificationId);\n                notificationIdsToDelete.forEach(id => Database.remove(\"NotificationReceived\", id));\n                Log.debug(`\\t${notificationIdsToDelete.length} received notifications will be deleted.`);\n                if (matchingNotificationIds.length > 0) {\n                    return {\n                        type: OutcomeAttributionType.Indirect,\n                        notificationIds: matchingNotificationIds,\n                    };\n                }\n            }\n        }\n        /* unattributed outcome report */\n        if (config.unattributed && config.unattributed.enabled) {\n            return {\n                type: OutcomeAttributionType.Unattributed,\n                notificationIds: []\n            };\n        }\n        return {\n            type: OutcomeAttributionType.NotSupported,\n            notificationIds: [],\n        };\n    }\n}\n//# sourceMappingURL=OutcomesHelper.js.map","import { OneSignalApiBase } from \"./OneSignalApiBase\";\nimport { SubscriptionStateKind } from \"./models/SubscriptionStateKind\";\nimport Log from \"./libraries/Log\";\nimport { Utils } from \"./context/shared/utils/Utils\";\nimport { OutcomeAttributionType } from \"./models/Outcomes\";\nexport class OneSignalApiSW {\n    static async downloadServerAppConfig(appId) {\n        Utils.enforceAppId(appId);\n        return await new Promise((resolve, _reject) => {\n            resolve(OneSignalApiBase.get(`sync/${appId}/web`, null));\n        });\n    }\n    /**\n     * Given a GCM or Firefox subscription endpoint or Safari device token, returns the user ID from OneSignal's server.\n     * Used if the user clears his or her IndexedDB database and we need the user ID again.\n     */\n    static getUserIdFromSubscriptionIdentifier(appId, deviceType, identifier) {\n        // Calling POST /players with an existing identifier returns us that player ID\n        Utils.enforceAppId(appId);\n        return OneSignalApiBase.post(\"players\", {\n            app_id: appId,\n            device_type: deviceType,\n            identifier: identifier,\n            notification_types: SubscriptionStateKind.TemporaryWebRecord,\n        }).then((response) => {\n            if (response && response.id) {\n                return response.id;\n            }\n            else {\n                return null;\n            }\n        }).catch(e => {\n            Log.debug(\"Error getting user ID from subscription identifier:\", e);\n            return null;\n        });\n    }\n    static async updatePlayer(appId, playerId, options) {\n        const funcToExecute = async () => {\n            await OneSignalApiBase.put(`players/${playerId}`, Object.assign({ app_id: appId }, options));\n        };\n        return await Utils.enforceAppIdAndPlayerId(appId, playerId, funcToExecute);\n    }\n    static async updateUserSession(userId, serializedDeviceRecord) {\n        const funcToExecute = async () => {\n            const response = await OneSignalApiBase.post(`players/${userId}/on_session`, serializedDeviceRecord);\n            if (response.id) {\n                // A new user ID can be returned\n                return response.id;\n            }\n            else {\n                return userId;\n            }\n        };\n        return await Utils.enforceAppIdAndPlayerId(serializedDeviceRecord.app_id, userId, funcToExecute);\n    }\n    ;\n    static async sendSessionDuration(appId, deviceId, sessionDuration, deviceType, attribution) {\n        const funcToExecute = async () => {\n            const payload = {\n                app_id: appId,\n                type: 1,\n                state: \"ping\",\n                active_time: sessionDuration,\n                device_type: deviceType,\n            };\n            switch (attribution.type) {\n                case OutcomeAttributionType.Direct:\n                    payload.direct = true;\n                    payload.notification_ids = attribution.notificationIds;\n                    break;\n                case OutcomeAttributionType.Indirect:\n                    payload.direct = false;\n                    payload.notification_ids = attribution.notificationIds;\n                    break;\n                default:\n                    break;\n            }\n            await OneSignalApiBase.post(`players/${deviceId}/on_focus`, payload);\n        };\n        Utils.enforceAppIdAndPlayerId(appId, deviceId, funcToExecute);\n    }\n}\nexport default OneSignalApiSW;\n//# sourceMappingURL=OneSignalApiSW.js.map","import Log from \"../../libraries/Log\";\nexport default class ServiceWorkerHelper {\n    // Gets details on the service-worker (if any) that controls the current page\n    static async getRegistration() {\n        try {\n            // location.href is used for <base> tag compatibility when it is set to a different origin\n            return await navigator.serviceWorker.getRegistration(location.href);\n        }\n        catch (e) {\n            // This could be null in an HTTP context or error if the user doesn't accept cookies\n            Log.warn(\"[Service Worker Status] Error Checking service worker registration\", location.href, e);\n            return null;\n        }\n    }\n}\n//# sourceMappingURL=ServiceWorkerHelper.js.map","export class Subscription {\n    serialize() {\n        return {\n            deviceId: this.deviceId,\n            subscriptionToken: this.subscriptionToken,\n            optedOut: this.optedOut,\n            createdAt: this.createdAt,\n            expirationTime: this.expirationTime,\n        };\n    }\n    static deserialize(bundle) {\n        const subscription = new Subscription();\n        subscription.deviceId = bundle.deviceId;\n        subscription.subscriptionToken = bundle.subscriptionToken;\n        subscription.optedOut = bundle.optedOut;\n        subscription.createdAt = bundle.createdAt;\n        subscription.expirationTime = bundle.expirationTime;\n        return subscription;\n    }\n}\n//# sourceMappingURL=Subscription.js.map","import Emitter from '../libraries/Emitter';\nimport Log from '../libraries/Log';\nimport Utils from \"../context/shared/utils/Utils\";\nconst DATABASE_VERSION = 3;\nexport default class IndexedDb {\n    constructor(databaseName) {\n        this.databaseName = databaseName;\n        this.emitter = new Emitter();\n    }\n    open(databaseName) {\n        return new Promise(resolve => {\n            let request = undefined;\n            try {\n                // Open algorithm: https://www.w3.org/TR/IndexedDB/#h-opening\n                request = indexedDB.open(databaseName, DATABASE_VERSION);\n            }\n            catch (e) {\n                // Errors should be thrown on the request.onerror event, but just in case Firefox throws additional errors\n                // for profile schema too high\n            }\n            if (!request) {\n                return null;\n            }\n            request.onerror = this.onDatabaseOpenError;\n            request.onblocked = this.onDatabaseOpenBlocked;\n            request.onupgradeneeded = this.onDatabaseUpgradeNeeded;\n            request.onsuccess = () => {\n                this.database = request.result;\n                this.database.onerror = this.onDatabaseError;\n                this.database.onversionchange = this.onDatabaseVersionChange;\n                resolve(this.database);\n            };\n        });\n    }\n    async ensureDatabaseOpen() {\n        if (!this.openLock) {\n            this.openLock = this.open(this.databaseName);\n        }\n        return await this.openLock;\n    }\n    onDatabaseOpenError(event) {\n        // Prevent the error from bubbling: https://bugzilla.mozilla.org/show_bug.cgi?id=1331103#c3\n        /**\n         * To prevent error reporting tools like Sentry.io from picking up errors that\n         * the site owner can't do anything about and use up their quota, hide database open\n         * errors.\n         */\n        event.preventDefault();\n        const error = event.target.error;\n        if (Utils.contains(error.message, 'The operation failed for reasons unrelated to the database itself and not covered by any other error code') ||\n            Utils.contains(error.message, 'A mutation operation was attempted on a database that did not allow mutations')) {\n            Log.warn(\"OneSignal: IndexedDb web storage is not available on this origin since this profile's IndexedDb schema has been upgraded in a newer version of Firefox. See: https://bugzilla.mozilla.org/show_bug.cgi?id=1236557#c6\");\n        }\n        else {\n            Log.warn('OneSignal: Fatal error opening IndexedDb database:', error);\n        }\n    }\n    /**\n     * Error events bubble. Error events are targeted at the request that generated the error, then the event bubbles to\n     * the transaction, and then finally to the database object. If you want to avoid adding error handlers to every\n     * request, you can instead add a single error handler on the database object.\n     */\n    onDatabaseError(event) {\n        Log.debug('IndexedDb: Generic database error', event.target.errorCode);\n    }\n    /**\n     * Occurs when the upgradeneeded should be triggered because of a version change but the database is still in use\n     * (that is, not closed) somewhere, even after the versionchange event was sent.\n     */\n    onDatabaseOpenBlocked() {\n        Log.debug('IndexedDb: Blocked event');\n    }\n    /**\n     * Occurs when a database structure change (IDBOpenDBRequest.onupgradeneeded event or IDBFactory.deleteDatabase) was\n     * requested elsewhere (most probably in another window/tab on the same computer).\n     *\n     * versionchange Algorithm: https://www.w3.org/TR/IndexedDB/#h-versionchange-transaction-steps\n     *\n     * Ref: https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/onversionchange\n     */\n    onDatabaseVersionChange(_) {\n        Log.debug('IndexedDb: versionchange event');\n    }\n    /**\n     * Occurs when a new version of the database needs to be created, or has not been created before, or a new version\n     * of the database was requested to be opened when calling window.indexedDB.open.\n     *\n     * Ref: https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest/onupgradeneeded\n     */\n    onDatabaseUpgradeNeeded(event) {\n        Log.debug('IndexedDb: Database is being rebuilt or upgraded (upgradeneeded event).');\n        const db = event.target.result;\n        if (event.oldVersion < 1) {\n            db.createObjectStore(\"Ids\", { keyPath: \"type\" });\n            db.createObjectStore(\"NotificationOpened\", { keyPath: \"url\" });\n            db.createObjectStore(\"Options\", { keyPath: \"key\" });\n        }\n        if (event.oldVersion < 2) {\n            db.createObjectStore(\"Sessions\", { keyPath: \"sessionKey\" });\n            db.createObjectStore(\"NotificationReceived\", { keyPath: \"notificationId\" });\n            db.createObjectStore(\"NotificationClicked\", { keyPath: \"notificationId\" });\n        }\n        if (event.oldVersion < 3) {\n            db.createObjectStore(\"SentUniqueOutcome\", { keyPath: \"outcomeName\" });\n        }\n        // Wrap in conditional for tests\n        if (typeof OneSignal !== \"undefined\") {\n            OneSignal._isNewVisitor = true;\n        }\n    }\n    /**\n     * Asynchronously retrieves the value of the key at the table (if key is specified), or the entire table (if key is not specified).\n     * @param table The table to retrieve the value from.\n     * @param key The key in the table to retrieve the value of. Leave blank to get the entire table.\n     * @returns {Promise} Returns a promise that fulfills when the value(s) are available.\n     */\n    async get(table, key) {\n        const database = await this.ensureDatabaseOpen();\n        if (key) {\n            // Return a table-key value\n            return await new Promise((resolve, reject) => {\n                const request = database.transaction(table).objectStore(table).get(key);\n                request.onsuccess = () => {\n                    resolve(request.result);\n                };\n                request.onerror = () => {\n                    reject(request.error);\n                };\n            });\n        }\n        else {\n            // Return all values in table\n            return await new Promise((resolve, reject) => {\n                let jsonResult = {};\n                let cursor = database.transaction(table).objectStore(table).openCursor();\n                cursor.onsuccess = (event) => {\n                    const cursorResult = event.target.result;\n                    if (cursorResult) {\n                        let cursorResultKey = cursorResult.key;\n                        jsonResult[cursorResultKey] = cursorResult.value;\n                        cursorResult.continue();\n                    }\n                    else {\n                        resolve(jsonResult);\n                    }\n                };\n                cursor.onerror = () => {\n                    reject(cursor.error);\n                };\n            });\n        }\n    }\n    async getAll(table) {\n        return await new Promise(async (resolve, reject) => {\n            const database = await this.ensureDatabaseOpen();\n            let cursor = database.transaction(table).objectStore(table).openCursor();\n            const result = [];\n            cursor.onsuccess = (event) => {\n                const cursorResult = event.target.result;\n                if (cursorResult) {\n                    result.push(cursorResult.value);\n                    cursorResult.continue();\n                }\n                else {\n                    resolve(result);\n                }\n            };\n            cursor.onerror = () => {\n                reject(cursor.error);\n            };\n        });\n    }\n    /**\n     * Asynchronously puts the specified value in the specified table.\n     */\n    async put(table, key) {\n        await this.ensureDatabaseOpen();\n        return await new Promise((resolve, reject) => {\n            try {\n                let request = this.database.transaction([table], 'readwrite').objectStore(table).put(key);\n                request.onsuccess = () => {\n                    resolve(key);\n                };\n                request.onerror = (e) => {\n                    Log.error('Database PUT Transaction Error:', e);\n                    reject(e);\n                };\n            }\n            catch (e) {\n                Log.error('Database PUT Error:', e);\n                reject(e);\n            }\n        });\n    }\n    /**\n     * Asynchronously removes the specified key from the table, or if the key is not specified, removes all keys in the table.\n     * @returns {Promise} Returns a promise containing a key that is fulfilled when deletion is completed.\n     */\n    async remove(table, key) {\n        const database = await this.ensureDatabaseOpen();\n        return new Promise((resolve, reject) => {\n            try {\n                const store = database.transaction([table], \"readwrite\").objectStore(table);\n                // If key is present remove a single key from a table.\n                // Otherwise wipe the table\n                const request = key ? store.delete(key) : store.clear();\n                request.onsuccess = () => {\n                    resolve(key);\n                };\n                request.onerror = (e) => {\n                    Log.error('Database REMOVE Transaction Error:', e);\n                    reject(e);\n                };\n            }\n            catch (e) {\n                Log.error('Database REMOVE Error:', e);\n                reject(e);\n            }\n        });\n    }\n}\n//# sourceMappingURL=IndexedDb.js.map","export var PermissionPromptType;\n(function (PermissionPromptType) {\n    /**\n     * The \"main\" browser native permission request dialog when prompting for local or push notification permissions.\n     */\n    PermissionPromptType[PermissionPromptType[\"HttpsPermissionRequest\"] = 'HTTPS permission request'] = \"HttpsPermissionRequest\";\n    /**\n     * The \"popup\" to subdomain.onesignal.com.\n     */\n    PermissionPromptType[PermissionPromptType[\"FullscreenHttpPermissionMessage\"] = 'fullscreen HTTP permission message'] = \"FullscreenHttpPermissionMessage\";\n    /**\n     * The full-screen HTTPS modal with a dimmed backdrop.\n     */\n    PermissionPromptType[PermissionPromptType[\"FullscreenHttpsPermissionMessage\"] = 'fullscreen HTTPS permission message'] = \"FullscreenHttpsPermissionMessage\";\n    /**\n     * The \"sliding down\" prompt.\n     */\n    PermissionPromptType[PermissionPromptType[\"SlidedownPermissionMessage\"] = 'slidedown permission message'] = \"SlidedownPermissionMessage\";\n    /**\n     * The \"notify button\".\n     */\n    PermissionPromptType[PermissionPromptType[\"SubscriptionBell\"] = 'subscription bell'] = \"SubscriptionBell\";\n})(PermissionPromptType || (PermissionPromptType = {}));\n//# sourceMappingURL=PermissionPromptType.js.map","/**\n * Module exports.\n */\n\nmodule.exports = jsonp;\n\n/**\n * Callback index.\n */\n\nvar count = 0;\n\n/**\n * Noop function.\n */\n\nfunction noop(){}\n\n/**\n * JSONP handler\n *\n * Options:\n *  - param {String} qs parameter (`callback`)\n *  - prefix {String} qs parameter (`__jp`)\n *  - name {String} qs parameter (`prefix` + incr)\n *  - timeout {Number} how long after a timeout error is emitted (`60000`)\n *\n * @param {String} url\n * @param {Object|Function} optional options / callback\n * @param {Function} optional callback\n */\n\nfunction jsonp(url, opts, fn){\n  if ('function' == typeof opts) {\n    fn = opts;\n    opts = {};\n  }\n  if (!opts) opts = {};\n\n  var prefix = opts.prefix || '__jp';\n\n  // use the callback name that was passed if one was provided.\n  // otherwise generate a unique name by incrementing our counter.\n  var id = opts.name || (prefix + (count++));\n\n  var param = opts.param || 'callback';\n  var timeout = null != opts.timeout ? opts.timeout : 60000;\n  var enc = encodeURIComponent;\n  var target = document.getElementsByTagName('script')[0] || document.head;\n  var script;\n  var timer;\n\n\n  if (timeout) {\n    timer = setTimeout(function(){\n      cleanup();\n      if (fn) fn(new Error('Timeout'));\n    }, timeout);\n  }\n\n  function cleanup(){\n    if (script.parentNode) script.parentNode.removeChild(script);\n    window[id] = noop;\n    if (timer) clearTimeout(timer);\n  }\n\n  function cancel(){\n    if (window[id]) {\n      cleanup();\n    }\n  }\n\n  window[id] = function(data){\n    cleanup();\n    if (fn) fn(null, data);\n  };\n\n  // add qs component\n  url += (~url.indexOf('?') ? '&' : '?') + param + '=' + enc(id);\n  url = url.replace('?&', '?');\n\n  // create script\n  script = document.createElement('script');\n  script.src = url;\n  target.parentNode.insertBefore(script, target);\n\n  return cancel;\n}\n","import Log from \"../libraries/Log\";\nexport class ReplayCallsOnOneSignal {\n    static doReplay(stubOneSignal) {\n        if (!stubOneSignal)\n            return;\n        if (Array.isArray(stubOneSignal)) {\n            ReplayCallsOnOneSignal.processAsArray(stubOneSignal);\n        }\n        else if (stubOneSignal.constructor && stubOneSignal.constructor.name === \"OneSignalStubES6\") {\n            ReplayCallsOnOneSignal.processAsES6Stub(stubOneSignal);\n        }\n        else {\n            Log.error(\"window.OneSignal is an unexpected type! Should be an Array, OneSignalStubES6, or undefined.\");\n        }\n    }\n    static processAsArray(stubOneSignal) {\n        for (const item of stubOneSignal) {\n            try {\n                OneSignal.push(item);\n            }\n            catch (e) {\n                // Catch and log error here so other elements still run\n                Log.error(e);\n            }\n        }\n    }\n    static processAsES6Stub(stubOneSignal) {\n        // Transfer properties set;\n        if (stubOneSignal.SERVICE_WORKER_PATH)\n            OneSignal.SERVICE_WORKER_PATH = stubOneSignal.SERVICE_WORKER_PATH;\n        if (stubOneSignal.SERVICE_WORKER_UPDATER_PATH)\n            OneSignal.SERVICE_WORKER_UPDATER_PATH = stubOneSignal.SERVICE_WORKER_UPDATER_PATH;\n        if (stubOneSignal.currentLogLevel)\n            OneSignal.log.setLevel(stubOneSignal.currentLogLevel);\n        if (stubOneSignal.SERVICE_WORKER_PARAM)\n            OneSignal.SERVICE_WORKER_PARAM = stubOneSignal.SERVICE_WORKER_PARAM;\n        // 1. Process any array defined BEFORE stubOneSignal was loaded\n        if (stubOneSignal.preExistingArray) {\n            ReplayCallsOnOneSignal.processAsArray(stubOneSignal.preExistingArray);\n        }\n        // 2. Process any array defined AFTER stubOneSignal was loaded\n        //    Runs methods in order, including firing any promises\n        for (const item of stubOneSignal.directFunctionCallsArray) {\n            const functionToCall = OneSignal[item.functionName];\n            const retValue = functionToCall.apply(OneSignal, item.args);\n            if (item.delayedPromise && retValue instanceof Promise) {\n                retValue.then(function (...args) {\n                    if (item.delayedPromise && item.delayedPromise.resolve) {\n                        item.delayedPromise.resolve.apply(null, args);\n                    }\n                }).catch(function (...args) {\n                    if (item.delayedPromise && item.delayedPromise.reject) {\n                        item.delayedPromise.reject.apply(null, args);\n                    }\n                });\n            }\n        }\n    }\n}\n//# sourceMappingURL=ReplayCallsOnOneSignal.js.map","/**\n * This is OneSignalPageSDKES6.js (ES6)\n * Loaded from OneSignalSDK.js only if the browser supports push.\n */\nimport Log from \"../libraries/Log\";\nimport { incrementSdkLoadCount, getSdkLoadCount } from \"../utils\";\nimport { ReplayCallsOnOneSignal } from \"../utils/ReplayCallsOnOneSignal\";\nfunction oneSignalSdkInit() {\n    incrementSdkLoadCount();\n    if (getSdkLoadCount() > 1) {\n        Log.warn(`OneSignal: The web push SDK is included more than once. For optimal performance, please include our ` +\n            `SDK only once on your page.`);\n        Log.debug(`OneSignal: Exiting from SDK initialization to prevent double-initialization errors. ` +\n            `Occurred ${getSdkLoadCount()} times.`);\n        return;\n    }\n    // We're running in the host page, iFrame of the host page, or popup window\n    // Load OneSignal's web SDK\n    const predefinedOneSignal = window.OneSignal;\n    window.OneSignal = require('../OneSignal').default;\n    ReplayCallsOnOneSignal.doReplay(predefinedOneSignal);\n}\n// Only if running on page in browser\nif (typeof window !== \"undefined\")\n    oneSignalSdkInit();\n//# sourceMappingURL=pageSdkInit.js.map","import OneSignalError from \"./OneSignalError\";\nexport var NotSubscribedReason;\n(function (NotSubscribedReason) {\n    NotSubscribedReason[NotSubscribedReason[\"Unknown\"] = 0] = \"Unknown\";\n    NotSubscribedReason[NotSubscribedReason[\"NoDeviceId\"] = 1] = \"NoDeviceId\";\n    NotSubscribedReason[NotSubscribedReason[\"NoEmailSet\"] = 2] = \"NoEmailSet\";\n    NotSubscribedReason[NotSubscribedReason[\"OptedOut\"] = 3] = \"OptedOut\";\n})(NotSubscribedReason || (NotSubscribedReason = {}));\nexport class NotSubscribedError extends OneSignalError {\n    constructor(reason) {\n        switch (reason) {\n            case NotSubscribedReason.Unknown || NotSubscribedReason.NoDeviceId:\n                super('This operation can only be performed after the user is subscribed.');\n                break;\n            case NotSubscribedReason.NoEmailSet:\n                super('No email is currently set.');\n                break;\n            case NotSubscribedReason.OptedOut:\n                super('The user has manually opted out of receiving of notifications. This operation can only be performed after the user is fully resubscribed.');\n                break;\n        }\n        this.reason = NotSubscribedReason[reason];\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, NotSubscribedError.prototype);\n    }\n}\n//# sourceMappingURL=NotSubscribedError.js.map","import OneSignalError from \"./OneSignalError\";\nexport var SdkInitErrorKind;\n(function (SdkInitErrorKind) {\n    SdkInitErrorKind[SdkInitErrorKind[\"InvalidAppId\"] = 0] = \"InvalidAppId\";\n    SdkInitErrorKind[SdkInitErrorKind[\"AppNotConfiguredForWebPush\"] = 1] = \"AppNotConfiguredForWebPush\";\n    SdkInitErrorKind[SdkInitErrorKind[\"MissingSubdomain\"] = 2] = \"MissingSubdomain\";\n    SdkInitErrorKind[SdkInitErrorKind[\"WrongSiteUrl\"] = 3] = \"WrongSiteUrl\";\n    SdkInitErrorKind[SdkInitErrorKind[\"MultipleInitialization\"] = 4] = \"MultipleInitialization\";\n    SdkInitErrorKind[SdkInitErrorKind[\"MissingSafariWebId\"] = 5] = \"MissingSafariWebId\";\n    SdkInitErrorKind[SdkInitErrorKind[\"Unknown\"] = 6] = \"Unknown\";\n})(SdkInitErrorKind || (SdkInitErrorKind = {}));\nexport class SdkInitError extends OneSignalError {\n    constructor(reason, extra) {\n        switch (reason) {\n            case SdkInitErrorKind.InvalidAppId:\n                super('OneSignal: This app ID does not match any existing app. Double check your app ID.');\n                break;\n            case SdkInitErrorKind.AppNotConfiguredForWebPush:\n                super('OneSignal: This app ID does not have any web platforms enabled. Double check your app ID, or see step 1 on our setup guide (https://goo.gl/01h7fZ).');\n                break;\n            case SdkInitErrorKind.MissingSubdomain:\n                super('OneSignal: Non-HTTPS pages require a subdomain of OneSignal to be chosen on your dashboard. See step 1.4 on our setup guide (https://goo.gl/xip6JB).');\n                break;\n            case SdkInitErrorKind.WrongSiteUrl:\n                if (extra && extra.siteUrl) {\n                    super(`OneSignal: This web push config can only be used on ${new URL(extra.siteUrl).origin}. Your current origin is ${location.origin}.`);\n                }\n                else {\n                    super('OneSignal: This web push config can not be used on the current site.');\n                }\n                break;\n            case SdkInitErrorKind.MultipleInitialization:\n                super('OneSignal: The OneSignal web SDK can only be initialized once. Extra initializations are ignored. Please remove calls initializing the SDK more than once.');\n                break;\n            case SdkInitErrorKind.MissingSafariWebId:\n                super('OneSignal: Safari browser support on Mac OS X requires the Safari web platform to be enabled. Please see the Safari Support steps in our web setup guide.');\n                break;\n            case SdkInitErrorKind.Unknown:\n                super('OneSignal: An unknown initialization error occurred.');\n                break;\n        }\n        this.reason = SdkInitErrorKind[reason];\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, SdkInitError.prototype);\n    }\n}\n//# sourceMappingURL=SdkInitError.js.map","/*\n LimitStore.put('colorado', 'rocky');\n [\"rocky\"]\n LimitStore.put('colorado', 'mountain');\n [\"rocky\", \"mountain\"]\n LimitStore.put('colorado', 'national');\n [\"mountain\", \"national\"]\n LimitStore.put('colorado', 'park');\n [\"national\", \"park\"]\n */\nexport default class LimitStore {\n    static put(key, value) {\n        if (LimitStore.store[key] === undefined) {\n            LimitStore.store[key] = [null, null];\n        }\n        LimitStore.store[key].push(value);\n        if (LimitStore.store[key].length == LimitStore.LIMIT + 1) {\n            LimitStore.store[key].shift();\n        }\n        return LimitStore.store[key];\n    }\n    static get(key) {\n        if (LimitStore.store[key] === undefined) {\n            LimitStore.store[key] = [null, null];\n        }\n        return LimitStore.store[key];\n    }\n    static getFirst(key) {\n        return LimitStore.get(key)[0];\n    }\n    static getLast(key) {\n        return LimitStore.get(key)[1];\n    }\n    static remove(key) {\n        delete LimitStore.store[key];\n    }\n    static isEmpty(key) {\n        let values = LimitStore.get(key);\n        return values[0] === null && values[1] === null;\n    }\n}\nLimitStore.store = {};\nLimitStore.LIMIT = 2;\n//# sourceMappingURL=LimitStore.js.map","import NotImplementedError from '../errors/NotImplementedError';\nimport { DeliveryPlatformKind } from './DeliveryPlatformKind';\nimport { DeviceRecord } from './DeviceRecord';\n/**\n * Describes an email device record.\n */\nexport class EmailDeviceRecord extends DeviceRecord {\n    /**\n     * @param email Omitting this parameter does not void the record's identifier.\n     */\n    constructor(email, identifierAuthHash, pushDeviceRecordId) {\n        super();\n        this.email = email;\n        this.identifierAuthHash = identifierAuthHash;\n        this.pushDeviceRecordId = pushDeviceRecordId;\n        this.deliveryPlatform = DeliveryPlatformKind.Email;\n    }\n    serialize() {\n        const serializedBundle = super.serialize();\n        if (this.email) {\n            serializedBundle.identifier = this.email;\n        }\n        if (this.identifierAuthHash) {\n            serializedBundle.identifier_auth_hash = this.identifierAuthHash;\n        }\n        if (this.pushDeviceRecordId) {\n            serializedBundle.device_player_id = this.pushDeviceRecordId;\n        }\n        return serializedBundle;\n    }\n    deserialize(_) { throw new NotImplementedError(); }\n}\n//# sourceMappingURL=EmailDeviceRecord.js.map","import { OneSignalApiErrorKind, OneSignalApiError } from './errors/OneSignalApiError';\nimport { EmailDeviceRecord } from './models/EmailDeviceRecord';\nimport OneSignalApiBase from \"./OneSignalApiBase\";\nimport Utils from \"./context/shared/utils/Utils\";\nimport Log from \"./libraries/Log\";\nexport default class OneSignalApiShared {\n    static getPlayer(appId, playerId) {\n        Utils.enforceAppId(appId);\n        Utils.enforcePlayerId(playerId);\n        return OneSignalApiBase.get(`players/${playerId}?app_id=${appId}`);\n    }\n    static updatePlayer(appId, playerId, options) {\n        Utils.enforceAppId(appId);\n        Utils.enforcePlayerId(playerId);\n        return OneSignalApiBase.put(`players/${playerId}`, Object.assign({ app_id: appId }, options));\n    }\n    static sendNotification(appId, playerIds, titles, contents, url, icon, data, buttons) {\n        var params = {\n            app_id: appId,\n            contents: contents,\n            include_player_ids: playerIds,\n            isAnyWeb: true,\n            data: data,\n            web_buttons: buttons\n        };\n        if (titles) {\n            params.headings = titles;\n        }\n        if (url) {\n            params.url = url;\n        }\n        if (icon) {\n            params.chrome_web_icon = icon;\n            params.firefox_icon = icon;\n        }\n        Utils.trimUndefined(params);\n        return OneSignalApiBase.post('notifications', params);\n    }\n    static async createUser(deviceRecord) {\n        const serializedDeviceRecord = deviceRecord.serialize();\n        Utils.enforceAppId(serializedDeviceRecord.app_id);\n        const response = await OneSignalApiBase.post(`players`, serializedDeviceRecord);\n        if (response && response.success)\n            return response.id;\n        return null;\n    }\n    static async createEmailRecord(appConfig, emailProfile, pushDeviceRecordId) {\n        Utils.enforceAppId(appConfig.appId);\n        const emailRecord = new EmailDeviceRecord(emailProfile.emailAddress, emailProfile.identifierAuthHash, pushDeviceRecordId);\n        emailRecord.appId = appConfig.appId;\n        const response = await OneSignalApiBase.post(`players`, emailRecord.serialize());\n        if (response && response.success) {\n            return response.id;\n        }\n        else {\n            return null;\n        }\n    }\n    static async updateEmailRecord(appConfig, emailProfile, pushDeviceRecordId) {\n        Utils.enforceAppId(appConfig.appId);\n        Utils.enforcePlayerId(emailProfile.emailId);\n        const emailRecord = new EmailDeviceRecord(emailProfile.emailAddress, emailProfile.identifierAuthHash, pushDeviceRecordId);\n        emailRecord.appId = appConfig.appId;\n        const response = await OneSignalApiBase.put(`players/${emailProfile.emailId}`, emailRecord.serialize());\n        if (response && response.success) {\n            return response.id;\n        }\n        else {\n            return null;\n        }\n    }\n    static async logoutEmail(appConfig, emailProfile, deviceId) {\n        Utils.enforceAppId(appConfig.appId);\n        Utils.enforcePlayerId(deviceId);\n        const response = await OneSignalApiBase.post(`players/${deviceId}/email_logout`, {\n            app_id: appConfig.appId,\n            parent_player_id: emailProfile.emailId,\n            identifier_auth_hash: emailProfile.identifierAuthHash ? emailProfile.identifierAuthHash : undefined\n        });\n        if (response && response.success) {\n            return true;\n        }\n        else {\n            return false;\n        }\n    }\n    static async updateUserSession(userId, deviceRecord) {\n        try {\n            const serializedDeviceRecord = deviceRecord.serialize();\n            Utils.enforceAppId(serializedDeviceRecord.app_id);\n            Utils.enforcePlayerId(userId);\n            const response = await OneSignalApiBase.post(`players/${userId}/on_session`, serializedDeviceRecord);\n            if (response.id) {\n                // A new user ID can be returned\n                return response.id;\n            }\n            else {\n                return userId;\n            }\n        }\n        catch (e) {\n            if (e && Array.isArray(e.errors) && e.errors.length > 0 &&\n                Utils.contains(e.errors[0], 'app_id not found')) {\n                throw new OneSignalApiError(OneSignalApiErrorKind.MissingAppId);\n            }\n            else\n                throw e;\n        }\n    }\n    static async sendOutcome(data) {\n        Log.info(\"Outcome payload:\", data);\n        try {\n            await OneSignalApiBase.post(\"outcomes/measure\", data);\n        }\n        catch (e) {\n            Log.error(\"sendOutcome\", e);\n        }\n    }\n}\n//# sourceMappingURL=OneSignalApiShared.js.map","import { hasCssClass, addCssClass, removeCssClass } from \"./utils\";\nimport Log from \"./libraries/Log\";\nexport class CustomLink {\n    static async initialize(config) {\n        if (!config || !config.enabled) {\n            return;\n        }\n        Log.info(\"Inititalize CustomLink\");\n        const sdkStylesLoadResult = await OneSignal.context.dynamicResourceLoader.loadSdkStylesheet();\n        if (sdkStylesLoadResult !== 0 /* Loaded */) {\n            Log.debug('Not initializing custom link button because styles failed to load.');\n            return;\n        }\n        const containerElements = document.querySelectorAll(CustomLink.containerSelector);\n        containerElements.forEach((element) => {\n            if (!CustomLink.isInitialized(element)) {\n                CustomLink.injectMarkup(element, config);\n            }\n        });\n        const isPushEnabled = await OneSignal.privateIsPushNotificationsEnabled();\n        const isOptedOut = await OneSignal.internalIsOptedOut();\n        const subscribeElements = document.querySelectorAll(CustomLink.subscribeSelector);\n        subscribeElements.forEach((element) => CustomLink.initSubscribeElement(element, config, isPushEnabled, isOptedOut));\n        const explanationElements = document.querySelectorAll(CustomLink.explanationSelector);\n        explanationElements.forEach((element) => CustomLink.initExplanationElement(element, config, isPushEnabled));\n    }\n    static injectMarkup(container, config) {\n        if (!config.text) {\n            Log.error(\"CustomLink: required property 'text' is missing in the config\");\n            return;\n        }\n        // Clearing out the contents of the container first\n        container.innerHTML = '';\n        if (config.text.explanation) {\n            const explanation = document.createElement(\"p\");\n            addCssClass(explanation, CustomLink.explanationClass);\n            container.appendChild(explanation);\n        }\n        if (config.text.subscribe) {\n            const subscribe = document.createElement(\"button\");\n            addCssClass(subscribe, CustomLink.subscribeClass);\n            container.appendChild(subscribe);\n        }\n        CustomLink.markAsInitialized(container);\n    }\n    static initSubscribeElement(element, config, isPushEnabled, isOptedOut) {\n        if (config.text && config.text.subscribe) {\n            if (!isPushEnabled) {\n                element.textContent = config.text.subscribe;\n            }\n        }\n        if (config.text && config.text.unsubscribe) {\n            if (isPushEnabled) {\n                element.textContent = config.text.unsubscribe;\n            }\n        }\n        CustomLink.setResetClass(element);\n        CustomLink.setStateClass(element, isPushEnabled);\n        CustomLink.setStyleClass(element, config);\n        CustomLink.setSizeClass(element, config);\n        CustomLink.setCustomColors(element, config);\n        if (config.unsubscribeEnabled !== true) {\n            addCssClass(element, \"hide\");\n        }\n        element.setAttribute(CustomLink.subscriptionStateAttribute, isPushEnabled.toString());\n        element.setAttribute(CustomLink.optedOutAttribute, isOptedOut.toString());\n        if (!CustomLink.isInitialized(element)) {\n            element.addEventListener(\"click\", () => {\n                Log.info(\"CustomLink: subscribe clicked\");\n                CustomLink.handleClick(element);\n            });\n            CustomLink.markAsInitialized(element);\n        }\n    }\n    static async handleClick(element) {\n        const state = element.getAttribute(CustomLink.subscriptionStateAttribute) === \"true\";\n        const optedOut = element.getAttribute(CustomLink.optedOutAttribute) === \"true\";\n        if (state) {\n            const isPushEnabled = await OneSignal.privateIsPushNotificationsEnabled();\n            if (isPushEnabled) {\n                await OneSignal.setSubscription(false);\n            }\n        }\n        else {\n            if (!optedOut) {\n                const autoAccept = !OneSignal.environmentInfo.requiresUserInteraction;\n                const options = { autoAccept };\n                await OneSignal.registerForPushNotifications(options);\n            }\n            else {\n                await OneSignal.setSubscription(true);\n            }\n        }\n    }\n    static initExplanationElement(element, config, isPushEnabled) {\n        if (config.text && config.text.explanation) {\n            element.textContent = config.text.explanation;\n        }\n        CustomLink.setResetClass(element);\n        CustomLink.setStateClass(element, isPushEnabled);\n        CustomLink.setSizeClass(element, config);\n        if (config.unsubscribeEnabled !== true) {\n            addCssClass(element, \"hide\");\n        }\n    }\n    // Using stricter HTMLElement class for element parameter to access style property\n    static setCustomColors(element, config) {\n        if (config.style === \"button\" && config.color && config.color.button && config.color.text) {\n            element.style.backgroundColor = config.color.button;\n            element.style.color = config.color.text;\n        }\n        else if (config.style === \"link\" && config.color && config.color.text) {\n            element.style.color = config.color.text;\n        }\n    }\n    static setStateClass(element, subscribed) {\n        const oldClassName = subscribed ? \"state-unsubscribed\" : \"state-subscribed\";\n        const newClassName = subscribed ? \"state-subscribed\" : \"state-unsubscribed\";\n        if (hasCssClass(element, oldClassName)) {\n            removeCssClass(element, oldClassName);\n        }\n        if (!hasCssClass(element, newClassName)) {\n            addCssClass(element, newClassName);\n        }\n    }\n    static setStyleClass(element, config) {\n        if (!config || !config.style) {\n            return;\n        }\n        const newClassName = config.style;\n        if (!hasCssClass(element, newClassName)) {\n            addCssClass(element, newClassName);\n        }\n    }\n    static setSizeClass(element, config) {\n        if (!config || !config.size) {\n            return;\n        }\n        const newClassName = config.size;\n        if (!hasCssClass(element, newClassName)) {\n            addCssClass(element, newClassName);\n        }\n    }\n    static setResetClass(element) {\n        const newClassName = CustomLink.resetClass;\n        if (!hasCssClass(element, newClassName)) {\n            addCssClass(element, newClassName);\n        }\n    }\n    static markAsInitialized(element) {\n        element.setAttribute(CustomLink.initializedAttribute, \"true\");\n    }\n    static isInitialized(element) {\n        return element.getAttribute(CustomLink.initializedAttribute) === \"true\";\n    }\n}\nCustomLink.initializedAttribute = \"data-cl-initialized\";\nCustomLink.subscriptionStateAttribute = \"data-cl-state\";\nCustomLink.optedOutAttribute = \"data-cl-optedout\";\nCustomLink.containerClass = \"onesignal-customlink-container\";\nCustomLink.containerSelector = `.${CustomLink.containerClass}`;\nCustomLink.subscribeClass = \"onesignal-customlink-subscribe\";\nCustomLink.subscribeSelector = `.${CustomLink.subscribeClass}`;\nCustomLink.explanationClass = \"onesignal-customlink-explanation\";\nCustomLink.explanationSelector = `.${CustomLink.explanationClass}`;\nCustomLink.resetClass = \"onesignal-reset\";\nexport default CustomLink;\n//# sourceMappingURL=CustomLink.js.map","export var NotificationPermission;\n(function (NotificationPermission) {\n    /**\n     * The user has not granted notification permissions and may have just dismissed the notification permission prompt.\n     */\n    NotificationPermission[\"Default\"] = \"default\";\n    /**\n     * The user has granted notification permissions.\n     */\n    NotificationPermission[\"Granted\"] = \"granted\";\n    /**\n     * The user has blocked notifications.\n     */\n    NotificationPermission[\"Denied\"] = \"denied\";\n})(NotificationPermission || (NotificationPermission = {}));\n//# sourceMappingURL=NotificationPermission.js.map","export default class PromptsHelper {\n    static isCategorySlidedownConfigured(context) {\n        const { promptOptions } = context.appConfig.userConfig;\n        if (!promptOptions || !promptOptions.slidedown || !promptOptions.slidedown.categories) {\n            return false;\n        }\n        return (!!promptOptions.slidedown.categories.tags && promptOptions.slidedown.categories.tags.length > 0);\n    }\n}\n//# sourceMappingURL=PromptsHelper.js.map","import OneSignalUtils from '../utils/OneSignalUtils';\nimport bowser from 'bowser';\nimport { InvalidArgumentError, InvalidArgumentReason } from '../errors/InvalidArgumentError';\nimport { NotificationPermission } from '../models/NotificationPermission';\nimport SdkEnvironment from '../managers/SdkEnvironment';\nimport LocalStorage from '../utils/LocalStorage';\n/**\n * A permission manager to consolidate the different quirks of obtaining and evaluating permissions\n * across Safari, Chrome, and Firefox.\n */\nexport default class PermissionManager {\n    static get STORED_PERMISSION_KEY() {\n        return 'storedNotificationPermission';\n    }\n    /**\n     * Returns an interpreted version of the browser's notification permission.\n     *\n     * On some environments, it isn't possible to obtain the actual notification\n     * permission. For example, starting with Chrome 62+, cross-origin iframes and\n     * insecure origins can no longer accurately detect the default notification\n     * permission state.\n     *\n     * For cross-origin iframes, returned permissions are correct except that\n     * \"denied\" is returned instead of \"default\".\n     *\n     * For insecure origins, returned permissions are always \"denied\". This\n     * differs from cross-origin iframes where the cross-origin iframes are\n     * acurrate if returning \"granted\", but insecure origins will always return\n     * \"denied\" regardless of the actual permission.\n     *\n     * This method therefore returns the notification permission best suited for\n     * our SDK, and it may not always be accurate. On most environments (i.e. not\n     * Chrome 62+), the returned permission will be accurate.\n     *\n     * @param safariWebId The Safari web ID necessary to access the permission\n     * state on Safari.\n     */\n    async getNotificationPermission(safariWebId) {\n        const reportedPermission = await this.getReportedNotificationPermission(safariWebId);\n        if (await this.isPermissionEnvironmentAmbiguous(reportedPermission))\n            return await this.getInterpretedAmbiguousPermission(reportedPermission);\n        return reportedPermission;\n    }\n    /**\n     * Returns the browser's actual notification permission as reported without any modifications.\n     *\n     * One challenge is determining the frame context our permission query needs to run in:\n     *\n     *   - For a regular top-level HTTPS site, query our current top-level frame\n     *\n     *   - For a custom web push setup in a child HTTPS iframe, query our current child iframe (even\n     *     though the returned permission is ambiguous on Chrome 62+ if our origin is different from\n     *     that of the top-level frame)\n     *\n     *   - For a regular HTTP site, query OneSignal's child subdomain.os.tc or subdomain.onesignal.com\n     *     iframe\n     *\n     *   - For a regular HTTP site embedded in a child iframe, still query the nested child's\n     *     OneSignal subdomain.os.tc or subdomain.onesignal.com iframe\n     *\n     * This simplifies into determining whether the web push setup is using OneSignal's subdomain. If\n     * not, we assume the current frame context, regardless of whether it is a child or top-level\n     * frame, is the current context to run the permission query in.\n     *\n     * @param safariWebId The Safari web ID necessary to access the permission state on Safari.\n     */\n    async getReportedNotificationPermission(safariWebId) {\n        if (bowser.safari)\n            return PermissionManager.getSafariNotificationPermission(safariWebId);\n        // Is this web push setup using subdomain.os.tc or subdomain.onesignal.com?\n        if (OneSignalUtils.isUsingSubscriptionWorkaround())\n            return await this.getOneSignalSubdomainNotificationPermission(safariWebId);\n        else {\n            const reportedPermission = this.getW3cNotificationPermission();\n            if (await this.isPermissionEnvironmentAmbiguous(reportedPermission)) {\n                return await this.getInterpretedAmbiguousPermission(reportedPermission);\n            }\n            return this.getW3cNotificationPermission();\n        }\n    }\n    /**\n     * Returns the Safari browser's notification permission as reported by the browser.\n     *\n     * @param safariWebId The Safari web ID necessary to access the permission state on Safari.\n     */\n    static getSafariNotificationPermission(safariWebId) {\n        if (safariWebId)\n            return window.safari.pushNotification.permission(safariWebId).permission;\n        throw new InvalidArgumentError('safariWebId', InvalidArgumentReason.Empty);\n    }\n    /**\n     * Returns the notification permission as reported by the browser for non-Safari browsers. This\n     * includes Chrome, Firefox, Opera, Yandex, and every browser following the Notification API\n     * standard.\n     */\n    getW3cNotificationPermission() {\n        return window.Notification.permission;\n    }\n    /**\n     * Returns the notification permission as reported by the browser for the OneSignal subdomain\n     * iframe.\n     *\n     * @param safariWebId The Safari web ID necessary to access the permission state on Safari.\n     */\n    async getOneSignalSubdomainNotificationPermission(safariWebId) {\n        return new Promise(resolve => {\n            OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION, { safariWebId: safariWebId }, (reply) => {\n                const remoteNotificationPermission = reply.data;\n                resolve(remoteNotificationPermission);\n            });\n        });\n    }\n    /**\n     * To interpret the browser's reported notification permission, we need to know whether we're in\n     * an environment where the returned permission should be treated ambiguously.\n     *\n     * The reported permission should only be treated ambiguously if:\n     *\n     *   - We're not on Safari or Firefox (Chromium, Chrome, Opera, and Yandex will all eventually\n     *     share the same Chrome 62+ codebase)\n     *\n     *   - And the reported permission is \"denied\"\n     *\n     *   - And the current frame context is either a cross-origin iframe or insecure\n     */\n    async isPermissionEnvironmentAmbiguous(permission) {\n        // For testing purposes, allows changing the browser user agent\n        const browser = OneSignalUtils.redetectBrowserUserAgent();\n        return (!browser.safari &&\n            !browser.firefox &&\n            permission === NotificationPermission.Denied &&\n            (this.isCurrentFrameContextCrossOrigin() ||\n                await SdkEnvironment.isFrameContextInsecure() ||\n                OneSignalUtils.isUsingSubscriptionWorkaround() ||\n                SdkEnvironment.isInsecureOrigin()));\n    }\n    /**\n     * Returns true if we're a cross-origin iframe.\n     *\n     * This means:\n     *\n     *   - We're not the top-level frame\n     *   - We're unable to access to the top-level frame's origin, or we can access the origin but it\n     *     is different. On most browsers, accessing the top-level origin should throw an exception.\n     */\n    isCurrentFrameContextCrossOrigin() {\n        let topFrameOrigin;\n        try {\n            // Accessing a cross-origin top-level frame's origin should throw an error\n            topFrameOrigin = window.top.location.origin;\n        }\n        catch (e) {\n            // We're in a cross-origin child iframe\n            return true;\n        }\n        return window.top !== window &&\n            topFrameOrigin !== window.location.origin;\n    }\n    /**\n     * To workaround Chrome 62+'s permission ambiguity for \"denied\" permissions,\n     * we assume the permission is \"default\" until we actually record the\n     * permission being \"denied\" or \"granted\".\n     *\n     * This allows our best-effort approach to subscribe new users, and upon\n     * subscribing, if we discover the actual permission to be denied, we record\n     * this for next time.\n     *\n     * @param reportedPermission The notification permission as reported by the\n     * browser without any modifications.\n     */\n    async getInterpretedAmbiguousPermission(reportedPermission) {\n        switch (reportedPermission) {\n            case NotificationPermission.Denied:\n                const storedPermission = this.getStoredPermission();\n                if (storedPermission) {\n                    // If we've recorded the last known actual browser permission, return that\n                    return storedPermission;\n                }\n                else {\n                    // If we don't have any stored permission, assume default\n                    return NotificationPermission.Default;\n                }\n            default:\n                return reportedPermission;\n        }\n    }\n    getStoredPermission() {\n        return LocalStorage.getStoredPermission();\n    }\n    setStoredPermission(permission) {\n        LocalStorage.setStoredPermission(permission);\n    }\n    async updateStoredPermission() {\n        // TODO verify if `OneSignal.config.safariWebId` should be passed as a parameter\n        const permission = await this.getNotificationPermission();\n        return this.setStoredPermission(permission);\n    }\n}\n//# sourceMappingURL=PermissionManager.js.map","import { NotificationPermission } from '../models/NotificationPermission';\nimport PermissionManager from '../managers/PermissionManager';\nconst IS_OPTED_OUT = \"isOptedOut\";\nconst IS_PUSH_NOTIFICATIONS_ENABLED = \"isPushNotificationsEnabled\";\nconst PAGE_VIEWS = \"os_pageViews\";\nexport default class LocalStorage {\n    static getIsOptedOut() {\n        return localStorage.getItem(IS_OPTED_OUT) === \"true\";\n    }\n    static getIsPushNotificationsEnabled() {\n        return localStorage.getItem(IS_PUSH_NOTIFICATIONS_ENABLED) === \"true\";\n    }\n    static setIsOptedOut(value) {\n        localStorage.setItem(IS_OPTED_OUT, value.toString());\n    }\n    static setIsPushNotificationsEnabled(value) {\n        localStorage.setItem(IS_PUSH_NOTIFICATIONS_ENABLED, value.toString());\n    }\n    static setStoredPermission(value) {\n        localStorage.setItem(PermissionManager.STORED_PERMISSION_KEY, value);\n    }\n    static getStoredPermission() {\n        var permission = localStorage.getItem(PermissionManager.STORED_PERMISSION_KEY) || \"default\";\n        switch (permission) {\n            case \"granted\":\n                return NotificationPermission.Granted;\n            case \"denied\":\n                return NotificationPermission.Denied;\n            default:\n                return NotificationPermission.Default;\n        }\n    }\n    static setLocalPageViewCount(count) {\n        localStorage.setItem(PAGE_VIEWS, count.toString());\n    }\n    static getLocalPageViewCount() {\n        return Number(localStorage.getItem(PAGE_VIEWS));\n    }\n}\n//# sourceMappingURL=LocalStorage.js.map","import Event from '../Event';\nimport LimitStore from '../LimitStore';\nimport OneSignalApiShared from '../OneSignalApiShared';\nimport Database from '../services/Database';\nimport Log from '../libraries/Log';\nimport { CustomLink } from \"../CustomLink\";\nimport { OneSignalUtils } from \"../utils/OneSignalUtils\";\nimport { BrowserUtils } from \"../utils/BrowserUtils\";\nimport PromptsHelper from './PromptsHelper';\nimport LocalStorage from '../utils/LocalStorage';\nexport default class EventHelper {\n    static onNotificationPermissionChange() {\n        EventHelper.checkAndTriggerSubscriptionChanged();\n    }\n    static async onInternalSubscriptionSet(optedOut) {\n        LimitStore.put('subscription.optedOut', optedOut);\n    }\n    static async checkAndTriggerSubscriptionChanged() {\n        OneSignalUtils.logMethodCall('checkAndTriggerSubscriptionChanged');\n        const context = OneSignal.context;\n        const subscriptionState = await context.subscriptionManager.getSubscriptionState();\n        const isPushEnabled = await OneSignal.privateIsPushNotificationsEnabled();\n        const appState = await Database.getAppState();\n        const { lastKnownPushEnabled } = appState;\n        const didStateChange = (lastKnownPushEnabled === null ||\n            isPushEnabled !== lastKnownPushEnabled);\n        if (!didStateChange)\n            return;\n        Log.info(`The user's subscription state changed from ` +\n            `${lastKnownPushEnabled === null ? '(not stored)' : lastKnownPushEnabled}  ${subscriptionState.subscribed}`);\n        LocalStorage.setIsPushNotificationsEnabled(isPushEnabled);\n        appState.lastKnownPushEnabled = isPushEnabled;\n        await Database.setAppState(appState);\n        EventHelper.triggerSubscriptionChanged(isPushEnabled);\n    }\n    static async _onSubscriptionChanged(newSubscriptionState) {\n        EventHelper.onSubscriptionChanged_showWelcomeNotification(newSubscriptionState);\n        EventHelper.onSubscriptionChanged_sendCategorySlidedownTags(newSubscriptionState);\n        EventHelper.onSubscriptionChanged_evaluateNotifyButtonDisplayPredicate();\n        EventHelper.onSubscriptionChanged_updateCustomLink();\n    }\n    static async onSubscriptionChanged_sendCategorySlidedownTags(isSubscribed) {\n        if (isSubscribed !== true) {\n            return;\n        }\n        const { context } = OneSignal;\n        if (PromptsHelper.isCategorySlidedownConfigured(context)) {\n            await OneSignal.context.tagManager.sendTags(false);\n        }\n    }\n    static async onSubscriptionChanged_showWelcomeNotification(isSubscribed) {\n        if (OneSignal.__doNotShowWelcomeNotification) {\n            Log.debug('Not showing welcome notification because user has previously subscribed.');\n            return;\n        }\n        if (isSubscribed === true) {\n            const { deviceId } = await Database.getSubscription();\n            const { appId } = await Database.getAppConfig();\n            let welcome_notification_opts = OneSignal.config.userConfig.welcomeNotification;\n            let welcome_notification_disabled = welcome_notification_opts !== undefined && welcome_notification_opts['disable'] === true;\n            let title = welcome_notification_opts !== undefined &&\n                welcome_notification_opts['title'] !== undefined &&\n                welcome_notification_opts['title'] !== null\n                ? welcome_notification_opts['title']\n                : '';\n            let message = welcome_notification_opts !== undefined &&\n                welcome_notification_opts['message'] !== undefined &&\n                welcome_notification_opts['message'] !== null &&\n                welcome_notification_opts['message'].length > 0\n                ? welcome_notification_opts['message']\n                : 'Thanks for subscribing!';\n            let unopenableWelcomeNotificationUrl = new URL(location.href).origin + '?_osp=do_not_open';\n            let url = welcome_notification_opts && welcome_notification_opts['url'] && welcome_notification_opts['url'].length > 0\n                ? welcome_notification_opts['url']\n                : unopenableWelcomeNotificationUrl;\n            title = BrowserUtils.decodeHtmlEntities(title);\n            message = BrowserUtils.decodeHtmlEntities(message);\n            if (!welcome_notification_disabled) {\n                Log.debug('Sending welcome notification.');\n                OneSignalApiShared.sendNotification(appId, [deviceId], { en: title }, { en: message }, url, null, { __isOneSignalWelcomeNotification: true }, undefined);\n                Event.trigger(OneSignal.EVENTS.WELCOME_NOTIFICATION_SENT, {\n                    title: title,\n                    message: message,\n                    url: url\n                });\n            }\n        }\n    }\n    static async onSubscriptionChanged_evaluateNotifyButtonDisplayPredicate() {\n        if (!OneSignal.config.userConfig.notifyButton)\n            return;\n        const displayPredicate = OneSignal.config.userConfig.notifyButton.displayPredicate;\n        if (displayPredicate && typeof displayPredicate === \"function\" && OneSignal.notifyButton) {\n            const predicateResult = await displayPredicate();\n            if (predicateResult !== false) {\n                Log.debug('Showing notify button because display predicate returned true.');\n                OneSignal.notifyButton.launcher.show();\n            }\n            else {\n                Log.debug('Hiding notify button because display predicate returned false.');\n                OneSignal.notifyButton.launcher.hide();\n            }\n        }\n    }\n    static async onSubscriptionChanged_updateCustomLink() {\n        if (OneSignal.config.userConfig.promptOptions) {\n            await CustomLink.initialize(OneSignal.config.userConfig.promptOptions.customlink);\n        }\n    }\n    static triggerSubscriptionChanged(to) {\n        Event.trigger(OneSignal.EVENTS.SUBSCRIPTION_CHANGED, to);\n    }\n    /**\n     * When notifications are clicked, because the site isn't open, the notification is stored in the database. The next\n     * time the page opens, the event is triggered if its less than 5 minutes (usually page opens instantly from click).\n     *\n     * This method is fired for both HTTPS and HTTP sites, so for HTTP sites, the host URL needs to be used, not the\n     * subdomain.onesignal.com URL.\n     */\n    static async fireStoredNotificationClicks(url = document.URL) {\n        async function fireEventWithNotification(clickedNotificationInfo) {\n            // Remove the notification from the recently clicked list\n            // Once this page processes this retroactively provided clicked event, nothing should get the same event\n            const appState = await Database.getAppState();\n            appState.clickedNotifications[clickedNotificationInfo.url] = null;\n            await Database.setAppState(appState);\n            /* Clicked notifications look like:\n            {\n              \"url\": \"https://notify.tech\",\n              \"data\": {\n                \"id\": \"f44dfcc7-e8cd-47c6-af7e-e2b7ac68afca\",\n                \"heading\": \"Example Notification\",\n                \"content\": \"This is an example notification.\",\n                \"icon\": \"https://onesignal.com/images/notification_logo.png\"\n                (there would be a URL field here if it was set)\n              },\n              \"timestamp\": 1490998270607\n            }\n            */\n            const { data: notification, timestamp } = clickedNotificationInfo;\n            if (timestamp) {\n                const minutesSinceNotificationClicked = (Date.now() - timestamp) / 1000 / 60;\n                if (minutesSinceNotificationClicked > 5)\n                    return;\n            }\n            Event.trigger(OneSignal.EVENTS.NOTIFICATION_CLICKED, notification);\n        }\n        const appState = await Database.getAppState();\n        /* Is the flag notificationClickHandlerMatch: origin enabled?\n    \n           If so, this means we should provide a retroactive notification.clicked event as long as there exists any recently clicked\n           notification that matches this site's origin.\n    \n           Otherwise, the default behavior is to only provide a retroactive notification.clicked event if this page's URL exactly\n           matches the notification's URL.\n        */\n        const notificationClickHandlerMatch = await Database.get('Options', 'notificationClickHandlerMatch');\n        if (notificationClickHandlerMatch === 'origin') {\n            for (const clickedNotificationUrl of Object.keys(appState.clickedNotifications)) {\n                // Using notificationClickHandlerMatch: 'origin', as long as the notification's URL's origin matches our current tab's origin,\n                // fire the clicked event\n                if (new URL(clickedNotificationUrl).origin === location.origin) {\n                    const clickedNotification = appState.clickedNotifications[clickedNotificationUrl];\n                    await fireEventWithNotification(clickedNotification);\n                }\n            }\n        }\n        else {\n            /*\n              If a user is on https://site.com, document.URL and location.href both report the page's URL as https://site.com/.\n              This causes checking for notifications for the current URL to fail, since there is a notification for https://site.com,\n              but there is no notification for https://site.com/.\n      \n              As a workaround, if there are no notifications for https://site.com/, we'll do a check for https://site.com.\n            */\n            var pageClickedNotifications = appState.clickedNotifications[url];\n            if (pageClickedNotifications) {\n                await fireEventWithNotification(pageClickedNotifications);\n            }\n            else if (!pageClickedNotifications && url.endsWith('/')) {\n                var urlWithoutTrailingSlash = url.substring(0, url.length - 1);\n                pageClickedNotifications = appState.clickedNotifications[urlWithoutTrailingSlash];\n                if (pageClickedNotifications) {\n                    await fireEventWithNotification(pageClickedNotifications);\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=EventHelper.js.map","import { WindowEnvironmentKind } from '../models/WindowEnvironmentKind';\nimport SdkEnvironment from './SdkEnvironment';\n/**\n * Creates method proxies for once-supported methods.\n */\nexport default class LegacyManager {\n    static promiseStub() {\n        return {\n            then: LegacyManager.promiseStub,\n            catch: LegacyManager.promiseStub\n        };\n    }\n    static ensureBackwardsCompatibility(oneSignal) {\n        LegacyManager.environmentPolyfill(oneSignal);\n        LegacyManager.postmams(oneSignal);\n        oneSignal.syncHashedEmail = LegacyManager.promiseStub;\n    }\n    static environmentPolyfill(oneSignal) {\n        oneSignal.environment = {};\n        oneSignal.environment.getEnv = function () { return ''; };\n        oneSignal.environment.isPopup = function () {\n            return SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.OneSignalSubscriptionPopup;\n        };\n        oneSignal.environment.isIframe = function () {\n            return SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.OneSignalProxyFrame;\n        };\n    }\n    static postmams(oneSignal) {\n        const postmamMessageFunc = function message() {\n            this.messenger.message.apply(this.messenger, arguments);\n        };\n        const postmamPostMessageFunc = function postMessage() {\n            this.messenger.postMessage.apply(this.messenger, arguments);\n        };\n        function assignPostmamLegacyFunctions(postmamLikeObject) {\n            postmamLikeObject.message = postmamMessageFunc;\n            postmamLikeObject.postMessage = postmamPostMessageFunc;\n        }\n        if (oneSignal.proxyFrame) {\n            oneSignal.iframePostmam = oneSignal.proxyFrame;\n            assignPostmamLegacyFunctions(oneSignal.iframePostmam);\n        }\n        if (oneSignal.subscriptionPopup) {\n            oneSignal.popupPostmam = oneSignal.subscriptionPopup;\n            assignPostmamLegacyFunctions(oneSignal.popupPostmam);\n        }\n        if (oneSignal.subscriptionModal) {\n            oneSignal.modalPostmam = oneSignal.subscriptionModal;\n            assignPostmamLegacyFunctions(oneSignal.modalPostmam);\n        }\n    }\n}\n//# sourceMappingURL=LegacyManager.js.map","/**\n * LocalStorage with expiring keys.\n *\n * Used when synchronous data access is required, like when clicking the notify button to show the\n * popup conditionally based on a storage value. IndexedDb and cross-frame communication is\n * asynchronous and loses the direct user action privilege required to show a popup.\n */\nexport default class TimedLocalStorage {\n    /**\n     * Performs a feature test to determine whether LocalStorage is accessible. For example, a user's\n     * browser preferences set to prevent saving website data will disable LocalStorage.\n     */\n    static isLocalStorageSupported() {\n        try {\n            if (typeof localStorage === \"undefined\") {\n                return false;\n            }\n            localStorage.getItem(\"test\");\n            return true;\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    /**\n     * Sets a key in LocalStorage with an expiration time measured in minutes.\n     */\n    static setItem(key, value, expirationInMinutes) {\n        if (!TimedLocalStorage.isLocalStorageSupported()) {\n            return;\n        }\n        const expirationInMilliseconds = typeof expirationInMinutes !== \"undefined\" ?\n            expirationInMinutes * 60 * 1000 :\n            0;\n        const record = {\n            value: JSON.stringify(value),\n            timestamp: typeof expirationInMinutes !== \"undefined\" ?\n                new Date().getTime() + expirationInMilliseconds :\n                undefined,\n        };\n        localStorage.setItem(key, JSON.stringify(record));\n    }\n    /**\n     * Retrieves a key from LocalStorage if the expiration time when the key was set hasn't already\n     * expired.\n     */\n    static getItem(key) {\n        if (!TimedLocalStorage.isLocalStorageSupported()) {\n            return null;\n        }\n        const record = localStorage.getItem(key);\n        let parsedRecord;\n        try {\n            parsedRecord = JSON.parse(record);\n        }\n        catch (e) {\n            return null;\n        }\n        if (parsedRecord === null) {\n            return null;\n        }\n        if (parsedRecord.timestamp &&\n            new Date().getTime() >= parsedRecord.timestamp) {\n            localStorage.removeItem(key);\n            return null;\n        }\n        let parsedRecordValue = parsedRecord.value;\n        try {\n            parsedRecordValue = JSON.parse(parsedRecord.value);\n        }\n        catch (e) {\n            return parsedRecordValue;\n        }\n        return parsedRecordValue;\n    }\n    /**\n     * Removes an item from LocalStorage.\n     */\n    static removeItem(key) {\n        if (!TimedLocalStorage.isLocalStorageSupported()) {\n            return null;\n        }\n        localStorage.removeItem(key);\n    }\n}\n//# sourceMappingURL=TimedLocalStorage.js.map","import OneSignalError from \"./OneSignalError\";\nexport var PushPermissionNotGrantedErrorReason;\n(function (PushPermissionNotGrantedErrorReason) {\n    PushPermissionNotGrantedErrorReason[PushPermissionNotGrantedErrorReason[\"Blocked\"] = 0] = \"Blocked\";\n    PushPermissionNotGrantedErrorReason[PushPermissionNotGrantedErrorReason[\"Dismissed\"] = 1] = \"Dismissed\";\n    PushPermissionNotGrantedErrorReason[PushPermissionNotGrantedErrorReason[\"Default\"] = 2] = \"Default\";\n})(PushPermissionNotGrantedErrorReason || (PushPermissionNotGrantedErrorReason = {}));\nexport default class PushPermissionNotGrantedError extends OneSignalError {\n    constructor(reason) {\n        switch (reason) {\n            case PushPermissionNotGrantedErrorReason.Dismissed:\n                super('The user dismissed the permission prompt.');\n                break;\n            case PushPermissionNotGrantedErrorReason.Blocked:\n                super('Notification permissions are blocked.');\n                break;\n            case PushPermissionNotGrantedErrorReason.Default:\n                super('Notification permissions have not been granted yet.');\n                break;\n        }\n        this.reason = reason;\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, PushPermissionNotGrantedError.prototype);\n    }\n}\n//# sourceMappingURL=PushPermissionNotGrantedError.js.map","export var Browser;\n(function (Browser) {\n    Browser[\"Safari\"] = \"safari\";\n    Browser[\"Firefox\"] = \"firefox\";\n    Browser[\"Chrome\"] = \"chrome\";\n    Browser[\"Opera\"] = \"opera\";\n    Browser[\"Edge\"] = \"edge\";\n    Browser[\"Other\"] = \"other\";\n})(Browser || (Browser = {}));\n//# sourceMappingURL=Browser.js.map","import PushPermissionNotGrantedError from '../errors/PushPermissionNotGrantedError';\nimport { PushPermissionNotGrantedErrorReason } from '../errors/PushPermissionNotGrantedError';\nimport { WindowEnvironmentKind } from '../models/WindowEnvironmentKind';\nimport EventHelper from './EventHelper';\nimport { InvalidStateError, InvalidStateReason } from '../errors/InvalidStateError';\nimport { NotificationPermission } from '../models/NotificationPermission';\nimport { RawPushSubscription } from '../models/RawPushSubscription';\nimport Log from '../libraries/Log';\nimport SdkEnvironment from '../managers/SdkEnvironment';\nimport { PermissionUtils } from \"../utils/PermissionUtils\";\nimport LocalStorage from '../utils/LocalStorage';\nimport { SessionOrigin } from \"../models/Session\";\nimport MainHelper from \"./MainHelper\";\nimport PageServiceWorkerHelper from \"./page/ServiceWorkerHelper\";\nimport { Browser } from \"../context/browser/models/Browser\";\nexport default class SubscriptionHelper {\n    static async registerForPush() {\n        const isPushEnabled = LocalStorage.getIsPushNotificationsEnabled();\n        return await SubscriptionHelper.internalRegisterForPush(isPushEnabled);\n    }\n    static async internalRegisterForPush(isPushEnabled) {\n        const context = OneSignal.context;\n        let subscription = null;\n        /*\n          Within the same page navigation (the same session), do not register for\n          push if the user is already subscribed, otherwise the user will have its\n          session count incremented on each page refresh. However, if the user is\n          not subscribed, subscribe.\n        */\n        if (isPushEnabled && !context.pageViewManager.isFirstPageView()) {\n            Log.debug('Not registering for push because the user is subscribed and this is not the first page view.');\n            Log.debug(\"But we want to rekindle their session.\");\n            const deviceId = await MainHelper.getDeviceId();\n            if (deviceId) {\n                const deviceRecord = await MainHelper.createDeviceRecord(OneSignal.config.appId, true);\n                await OneSignal.context.sessionManager.upsertSession(deviceId, deviceRecord, SessionOrigin.PageRefresh);\n            }\n            else {\n                Log.error(\"Should have been impossible to have push as enabled but no device id.\");\n            }\n            return null;\n        }\n        if (typeof OneSignal !== \"undefined\") {\n            if (OneSignal._isRegisteringForPush)\n                return null;\n            else\n                OneSignal._isRegisteringForPush = true;\n        }\n        switch (SdkEnvironment.getWindowEnv()) {\n            case WindowEnvironmentKind.Host:\n            case WindowEnvironmentKind.OneSignalSubscriptionModal:\n                try {\n                    const rawSubscription = await context.subscriptionManager.subscribe(0 /* ResubscribeExisting */);\n                    subscription = await context.subscriptionManager.registerSubscription(rawSubscription);\n                    context.pageViewManager.incrementPageViewCount();\n                    await PermissionUtils.triggerNotificationPermissionChanged();\n                    await EventHelper.checkAndTriggerSubscriptionChanged();\n                }\n                catch (e) {\n                    Log.info(e);\n                }\n                break;\n            case WindowEnvironmentKind.OneSignalSubscriptionPopup:\n                /*\n                  This is the code for the HTTP popup.\n                 */\n                const windowCreator = opener || parent;\n                let rawSubscription;\n                // Update the stored permission first, so we know the real value even if the user closes the\n                // popup\n                await context.permissionManager.updateStoredPermission();\n                try {\n                    /* If the user doesn't grant permissions, a PushPermissionNotGrantedError will be thrown here. */\n                    rawSubscription = await context.subscriptionManager.subscribe(1 /* SubscribeNew */);\n                    // Update the permission to granted\n                    await context.permissionManager.updateStoredPermission();\n                }\n                catch (e) {\n                    // Update the permission to denied or default\n                    await context.permissionManager.updateStoredPermission();\n                    if (e instanceof PushPermissionNotGrantedError) {\n                        switch (e.reason) {\n                            case PushPermissionNotGrantedErrorReason.Blocked:\n                                await context.permissionManager.updateStoredPermission();\n                                /* Force update false, because the iframe installs a native\n                                permission change handler that will be triggered when the user\n                                clicks out of the popup back to the parent page */\n                                OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION_CHANGED, {\n                                    permission: NotificationPermission.Denied,\n                                    forceUpdatePermission: false\n                                });\n                                break;\n                            case PushPermissionNotGrantedErrorReason.Dismissed:\n                                /* Force update true because default permissions (before\n                                prompting) -> default permissions (after prompting) isn't a\n                                change, but we still want to be notified about it */\n                                OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION_CHANGED, {\n                                    permission: NotificationPermission.Default,\n                                    forceUpdatePermission: true\n                                });\n                                break;\n                        }\n                    }\n                    /*\n                      Popup native permission request was blocked or dismissed\n                      Close the window\n                    */\n                    if (windowCreator) {\n                        window.close();\n                        return null;\n                    }\n                }\n                OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.FINISH_REMOTE_REGISTRATION, {\n                    rawPushSubscription: rawSubscription.serialize()\n                }, (message) => {\n                    if (message.data.progress === true) {\n                        Log.debug('Got message from host page that remote reg. is in progress, closing popup.');\n                        if (windowCreator) {\n                            window.close();\n                        }\n                    }\n                    else {\n                        Log.debug('Got message from host page that remote reg. could not be finished.');\n                    }\n                });\n                break;\n            default:\n                if (typeof OneSignal !== \"undefined\")\n                    OneSignal._isRegisteringForPush = false;\n                throw new InvalidStateError(InvalidStateReason.UnsupportedEnvironment);\n        }\n        if (typeof OneSignal !== \"undefined\")\n            OneSignal._isRegisteringForPush = false;\n        return subscription;\n    }\n    static getRawPushSubscriptionForSafari(safariWebId) {\n        const subscription = new RawPushSubscription();\n        const { deviceToken: existingDeviceToken } = window.safari.pushNotification.permission(safariWebId);\n        subscription.existingSafariDeviceToken = existingDeviceToken;\n        return subscription;\n    }\n    static async getRawPushSubscriptionFromServiceWorkerRegistration() {\n        const registration = await PageServiceWorkerHelper.getRegistration();\n        if (!registration) {\n            return null;\n        }\n        const swSubscription = await registration.pushManager.getSubscription();\n        if (!swSubscription) {\n            return null;\n        }\n        return RawPushSubscription.setFromW3cSubscription(swSubscription);\n    }\n    static async getRawPushSubscriptionWhenUsingSubscriptionWorkaround() {\n        // we would need to message service worker to get it. we'll get it from inside if necessary\n        return null;\n    }\n    static async getRawPushSubscription(environmentInfo, safariWebId) {\n        if (environmentInfo.browserType === Browser.Safari) {\n            return SubscriptionHelper.getRawPushSubscriptionForSafari(safariWebId);\n        }\n        if (environmentInfo.isUsingSubscriptionWorkaround) {\n            return SubscriptionHelper.getRawPushSubscriptionWhenUsingSubscriptionWorkaround();\n        }\n        if (environmentInfo.isBrowserAndSupportsServiceWorkers) {\n            return await SubscriptionHelper.getRawPushSubscriptionFromServiceWorkerRegistration();\n        }\n        return null;\n    }\n}\n//# sourceMappingURL=SubscriptionHelper.js.map","export const SERVER_CONFIG_DEFAULTS_SESSION = {\n    reportingThreshold: 30,\n    enableOnSessionForUnsubcribed: false,\n    enableOnFocus: true,\n};\nexport const SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS = {\n    pageViews: 1,\n    timeDelay: 0\n};\nexport const SERVER_CONFIG_DEFAULTS_SLIDEDOWN = {\n    actionMessage: \"We'd like to show you notifications for the latest news and updates.\",\n    acceptButton: \"Allow\",\n    cancelButton: \"Cancel\",\n    categoryDefaults: {\n        updateMessage: \"Update your push notification subscription preferences.\",\n        positiveUpdateButton: \"Save Preferences\",\n        negativeUpdateButton: \"Cancel\"\n    },\n    savingText: \"Saving...\",\n};\n//# sourceMappingURL=index.js.map","import { InvalidStateError, InvalidStateReason } from '../errors/InvalidStateError';\nimport Event from '../Event';\nimport SdkEnvironment from '../managers/SdkEnvironment';\nimport Database from '../services/Database';\nimport TimedLocalStorage from '../modules/TimedLocalStorage';\nimport Log from '../libraries/Log';\nimport { SubscriptionStateKind } from '../models/SubscriptionStateKind';\nimport { NotificationPermission } from \"../models/NotificationPermission\";\nimport { PushDeviceRecord } from \"../models/PushDeviceRecord\";\nimport { OneSignalUtils } from \"../utils/OneSignalUtils\";\nimport { PermissionUtils } from \"../utils/PermissionUtils\";\nimport { Utils } from \"../context/shared/utils/Utils\";\nimport SubscriptionHelper from \"./SubscriptionHelper\";\nimport { SERVER_CONFIG_DEFAULTS_SLIDEDOWN } from '../config';\nexport default class MainHelper {\n    static async getCurrentNotificationType() {\n        const currentPermission = await OneSignal.context.permissionManager.getNotificationPermission(OneSignal.context.appConfig.safariWebId);\n        if (currentPermission === NotificationPermission.Default) {\n            return SubscriptionStateKind.Default;\n        }\n        if (currentPermission === NotificationPermission.Denied) {\n            // Due to this issue https://github.com/OneSignal/OneSignal-Website-SDK/issues/289 we cannot reliably detect\n            // \"default\" permission in HTTP context. Browser reports denied for both \"default\" and \"denied\" statuses.\n            // Returning SubscriptionStateKind.Default for this case.\n            return (OneSignalUtils.isUsingSubscriptionWorkaround()) ?\n                SubscriptionStateKind.Default :\n                SubscriptionStateKind.NotSubscribed;\n        }\n        const existingUser = await OneSignal.context.subscriptionManager.isAlreadyRegisteredWithOneSignal();\n        if (currentPermission === NotificationPermission.Granted && existingUser) {\n            const isPushEnabled = await OneSignal.privateIsPushNotificationsEnabled();\n            return isPushEnabled ? SubscriptionStateKind.Subscribed : SubscriptionStateKind.MutedByApi;\n        }\n        return SubscriptionStateKind.Default;\n    }\n    /**\n     * If the user has manually opted out of notifications (OneSignal.setSubscription), returns -2; otherwise returns 1.\n     * @param isOptedIn The result of OneSignal.getSubscription().\n     */\n    static getNotificationTypeFromOptIn(isOptedIn) {\n        if (isOptedIn == true || isOptedIn == null) {\n            return SubscriptionStateKind.Subscribed;\n        }\n        else {\n            return SubscriptionStateKind.MutedByApi;\n        }\n    }\n    /**\n     * Returns true if a LocalStorage entry exists for noting the user dismissed the native prompt.\n     */\n    static wasHttpsNativePromptDismissed() {\n        return TimedLocalStorage.getItem('onesignal-notification-prompt') === 'dismissed';\n    }\n    /**\n     * Stores a flag in sessionStorage that we've already shown the HTTP slidedown to this user and that we should not\n     * show it again until they open a new window or tab to the site.\n     */\n    static markHttpSlidedownShown() {\n        sessionStorage.setItem('ONESIGNAL_HTTP_PROMPT_SHOWN', 'true');\n    }\n    /**\n     * Returns true if the HTTP slidedown was already shown inside the same session.\n     */\n    static isHttpPromptAlreadyShown() {\n        return sessionStorage.getItem('ONESIGNAL_HTTP_PROMPT_SHOWN') == 'true';\n    }\n    static async checkAndTriggerNotificationPermissionChanged() {\n        const previousPermission = await Database.get('Options', 'notificationPermission');\n        const currentPermission = await OneSignal.getNotificationPermission();\n        if (previousPermission !== currentPermission) {\n            await PermissionUtils.triggerNotificationPermissionChanged();\n            await Database.put('Options', {\n                key: 'notificationPermission',\n                value: currentPermission\n            });\n        }\n    }\n    static async getNotificationIcons() {\n        const appId = await MainHelper.getAppId();\n        if (!appId) {\n            throw new InvalidStateError(InvalidStateReason.MissingAppId);\n        }\n        const url = `${SdkEnvironment.getOneSignalApiUrl().toString()}/apps/${appId}/icon`;\n        const response = await fetch(url);\n        const data = await response.json();\n        if (data.errors) {\n            Log.error(`API call %c${url}`, Utils.getConsoleStyle('code'), 'failed with:', data.errors);\n            throw new Error('Failed to get notification icons.');\n        }\n        return data;\n    }\n    static getSlidedownPermissionMessageOptions(promptOptions) {\n        if (!promptOptions || !promptOptions.slidedown) {\n            const actionMessage = !!promptOptions ? promptOptions.actionMessage :\n                SERVER_CONFIG_DEFAULTS_SLIDEDOWN.actionMessage;\n            const acceptButtonText = !!promptOptions ? promptOptions.acceptButtonText :\n                SERVER_CONFIG_DEFAULTS_SLIDEDOWN.acceptButton;\n            const cancelButtonText = !!promptOptions ? promptOptions.cancelButtonText :\n                SERVER_CONFIG_DEFAULTS_SLIDEDOWN.cancelButton;\n            return {\n                enabled: false,\n                autoPrompt: false,\n                actionMessage,\n                acceptButtonText,\n                cancelButtonText,\n            };\n        }\n        // slidedown prompt options are defined\n        const { categories } = promptOptions.slidedown;\n        if (!!categories) {\n            categories.positiveUpdateButton = Utils.getValueOrDefault(categories.positiveUpdateButton, SERVER_CONFIG_DEFAULTS_SLIDEDOWN.categoryDefaults.positiveUpdateButton);\n            categories.negativeUpdateButton = Utils.getValueOrDefault(categories.negativeUpdateButton, SERVER_CONFIG_DEFAULTS_SLIDEDOWN.categoryDefaults.negativeUpdateButton);\n            categories.updateMessage = Utils.getValueOrDefault(categories.updateMessage, SERVER_CONFIG_DEFAULTS_SLIDEDOWN.categoryDefaults.updateMessage);\n        }\n        return {\n            enabled: promptOptions.slidedown.enabled,\n            autoPrompt: promptOptions.slidedown.autoPrompt,\n            actionMessage: promptOptions.slidedown.actionMessage || SERVER_CONFIG_DEFAULTS_SLIDEDOWN.actionMessage,\n            acceptButtonText: promptOptions.slidedown.acceptButtonText || SERVER_CONFIG_DEFAULTS_SLIDEDOWN.acceptButton,\n            cancelButtonText: promptOptions.slidedown.cancelButtonText || SERVER_CONFIG_DEFAULTS_SLIDEDOWN.cancelButton,\n            categories\n        };\n    }\n    static getFullscreenPermissionMessageOptions(promptOptions) {\n        if (!promptOptions) {\n            return null;\n        }\n        if (!promptOptions.fullscreen) {\n            return promptOptions;\n        }\n        return {\n            autoAcceptTitle: promptOptions.fullscreen.autoAcceptTitle,\n            actionMessage: promptOptions.fullscreen.actionMessage,\n            exampleNotificationTitleDesktop: promptOptions.fullscreen.title,\n            exampleNotificationTitleMobile: promptOptions.fullscreen.title,\n            exampleNotificationMessageDesktop: promptOptions.fullscreen.message,\n            exampleNotificationMessageMobile: promptOptions.fullscreen.message,\n            exampleNotificationCaption: promptOptions.fullscreen.caption,\n            acceptButtonText: promptOptions.fullscreen.acceptButton,\n            cancelButtonText: promptOptions.fullscreen.cancelButton,\n        };\n    }\n    static getPromptOptionsQueryString() {\n        let promptOptions = MainHelper.getFullscreenPermissionMessageOptions(OneSignal.config.userConfig.promptOptions);\n        let promptOptionsStr = '';\n        if (promptOptions) {\n            let hash = MainHelper.getPromptOptionsPostHash();\n            for (let key of Object.keys(hash)) {\n                var value = hash[key];\n                promptOptionsStr += '&' + key + '=' + value;\n            }\n        }\n        return promptOptionsStr;\n    }\n    static getPromptOptionsPostHash() {\n        let promptOptions = MainHelper.getFullscreenPermissionMessageOptions(OneSignal.config.userConfig.promptOptions);\n        if (promptOptions) {\n            var legacyParams = {\n                exampleNotificationTitleDesktop: 'exampleNotificationTitle',\n                exampleNotificationMessageDesktop: 'exampleNotificationMessage',\n                exampleNotificationTitleMobile: 'exampleNotificationTitle',\n                exampleNotificationMessageMobile: 'exampleNotificationMessage'\n            };\n            for (let legacyParamKey of Object.keys(legacyParams)) {\n                let legacyParamValue = legacyParams[legacyParamKey];\n                if (promptOptions[legacyParamKey]) {\n                    promptOptions[legacyParamValue] = promptOptions[legacyParamKey];\n                }\n            }\n            var allowedPromptOptions = [\n                'autoAcceptTitle',\n                'siteName',\n                'autoAcceptTitle',\n                'subscribeText',\n                'showGraphic',\n                'actionMessage',\n                'exampleNotificationTitle',\n                'exampleNotificationMessage',\n                'exampleNotificationCaption',\n                'acceptButtonText',\n                'cancelButtonText',\n                'timeout'\n            ];\n            var hash = {};\n            for (var i = 0; i < allowedPromptOptions.length; i++) {\n                var key = allowedPromptOptions[i];\n                var value = promptOptions[key];\n                var encoded_value = encodeURIComponent(value);\n                if (value || value === false || value === '') {\n                    hash[key] = encoded_value;\n                }\n            }\n        }\n        return hash;\n    }\n    static triggerCustomPromptClicked(clickResult) {\n        Event.trigger(OneSignal.EVENTS.CUSTOM_PROMPT_CLICKED, {\n            result: clickResult\n        });\n    }\n    static async getAppId() {\n        if (OneSignal.config.appId) {\n            return Promise.resolve(OneSignal.config.appId);\n        }\n        else {\n            const appId = await Database.get('Ids', 'appId');\n            return appId;\n        }\n    }\n    static async createDeviceRecord(appId, includeSubscription = false) {\n        let subscription;\n        if (includeSubscription) {\n            // TODO: refactor to replace config with dependency injection\n            const rawSubscription = await SubscriptionHelper.getRawPushSubscription(OneSignal.environmentInfo, OneSignal.config.safariWebId);\n            if (rawSubscription) {\n                subscription = rawSubscription;\n            }\n        }\n        const deviceRecord = new PushDeviceRecord(subscription);\n        deviceRecord.appId = appId;\n        deviceRecord.subscriptionState = await MainHelper.getCurrentNotificationType();\n        return deviceRecord;\n    }\n    static async getDeviceId() {\n        const subscription = await OneSignal.database.getSubscription();\n        return subscription.deviceId || undefined;\n    }\n}\n//# sourceMappingURL=MainHelper.js.map","import Environment from './Environment';\nimport SdkEnvironment from './managers/SdkEnvironment';\nimport Emitter from './libraries/Emitter';\nimport Log from './libraries/Log';\nimport { Utils } from \"./context/shared/utils/Utils\";\nimport { OneSignalUtils } from \"./utils/OneSignalUtils\";\n/**\n * Establishes a cross-domain MessageChannel between the current browsing context (this page) and another (an iFrame, popup, or parent page).\n */\nexport default class Postmam {\n    /**\n     * Initializes Postmam with settings but does not establish a connection a channel or set up any message listeners.\n     * @param windowReference The window to postMessage() the initial MessageChannel port to.\n     * @param sendToOrigin The origin that will receive the initial postMessage with the transferred message channel port object.\n     * @param receiveFromOrigin The origin to allow incoming messages from. If messages do not come from this origin they will be discarded. Only affects the initial handshake.\n     * @remarks The initiating (client) page must call this after the page has been loaded so that the other page has a chance to receive the initial handshake message. The receiving (server) page must set up a message listener to catch the initial handshake message.\n     */\n    constructor(windowReference, sendToOrigin, receiveFromOrigin) {\n        this.windowReference = windowReference;\n        this.sendToOrigin = sendToOrigin;\n        this.receiveFromOrigin = receiveFromOrigin;\n        if (!window || !window.postMessage) {\n            throw new Error('Must pass in a valid window reference supporting postMessage():' + windowReference);\n        }\n        if (!sendToOrigin || !receiveFromOrigin) {\n            throw new Error('Invalid origin. Must be set.');\n        }\n        this.emitter = new Emitter();\n        this.channel = new MessageChannel();\n        this.messagePort = null;\n        this.isListening = false;\n        this.isConnected = false;\n        this.replies = {};\n    }\n    static get HANDSHAKE_MESSAGE() {\n        return \"onesignal.postmam.handshake\";\n    }\n    static get CONNECTED_MESSAGE() {\n        return \"onesignal.postmam.connected\";\n    }\n    /**\n     * Opens a message event listener to listen for a Postmam handshake from another browsing context. This listener is closed as soon as the connection is established.\n     */\n    listen() {\n        Log.debug('(Postmam) Called listen().');\n        if (this.isListening) {\n            Log.debug('(Postmam) Already listening for Postmam connections.');\n            return;\n        }\n        if (!Environment.isBrowser()) {\n            return;\n        }\n        this.isListening = true;\n        Log.debug('(Postmam) Listening for Postmam connections.', this);\n        // One of the messages will contain our MessageChannel port\n        window.addEventListener('message', this.onWindowMessagePostmanConnectReceived.bind(this));\n    }\n    startPostMessageReceive() {\n        window.addEventListener('message', this.onWindowPostMessageReceived.bind(this));\n    }\n    stopPostMessageReceive() {\n        window.removeEventListener('message', this.onWindowPostMessageReceived);\n    }\n    destroy() {\n        this.stopPostMessageReceive();\n        this.emitter.removeAllListeners();\n    }\n    onWindowPostMessageReceived(e) {\n        // Discard messages from unexpected origins; messages come frequently from other origins\n        if (!this.isSafeOrigin(e.origin)) {\n            // Log.debug(`(Postmam) Discarding message because ${e.origin} is not an allowed origin:`, e.data);\n            return;\n        }\n        //Log.debug(`(Postmam) (onWindowPostMessageReceived) (${SdkEnvironment.getWindowEnv().toString()}):`, e);\n        let { id: messageId, command: messageCommand, data: messageData, source: messageSource } = e.data;\n        if (messageCommand === Postmam.CONNECTED_MESSAGE) {\n            this.emitter.emit('connect');\n            this.isConnected = true;\n            return;\n        }\n        let messageBundle = {\n            id: messageId,\n            command: messageCommand,\n            data: messageData,\n            source: messageSource\n        };\n        let messageBundleWithReply = Object.assign({ reply: this.reply.bind(this, messageBundle) }, messageBundle);\n        if (this.replies.hasOwnProperty(messageId)) {\n            Log.info('(Postmam) This message is a reply.');\n            let replyFn = this.replies[messageId].bind(window);\n            let replyFnReturnValue = replyFn(messageBundleWithReply);\n            if (replyFnReturnValue === false) {\n                delete this.replies[messageId];\n            }\n        }\n        else {\n            this.emitter.emit(messageCommand, messageBundleWithReply);\n        }\n    }\n    onWindowMessagePostmanConnectReceived(e) {\n        const env = SdkEnvironment.getWindowEnv().toString();\n        Log.debug(`(Postmam) (${env}) Window postmessage for Postman connect received:`, e);\n        // Discard messages from unexpected origins; messages come frequently from other origins\n        if (!this.isSafeOrigin(e.origin)) {\n            // Log.debug(`(Postmam) Discarding message because ${e.origin} is not an allowed origin:`, e.data)\n            return;\n        }\n        var { handshake } = e.data;\n        if (handshake !== Postmam.HANDSHAKE_MESSAGE) {\n            Log.info('(Postmam) Got a postmam message, but not our expected handshake:', e.data);\n            // This was not our expected handshake message\n            return;\n        }\n        else {\n            Log.info('(Postmam) Got our expected Postmam handshake message (and connecting...):', e.data);\n            // This was our expected handshake message\n            // Remove our message handler so we don't get spammed with cross-domain messages\n            window.removeEventListener('message', this.onWindowMessagePostmanConnectReceived);\n            // Get the message port\n            this.messagePort = e.ports[0];\n            this.messagePort.addEventListener('message', this.onMessageReceived.bind(this), false);\n            Log.info('(Postmam) Removed previous message event listener for handshakes, replaced with main message listener.');\n            this.messagePort.start();\n            this.isConnected = true;\n            Log.info(`(Postmam) (${env}) Connected.`);\n            this.message(Postmam.CONNECTED_MESSAGE);\n            this.emitter.emit('connect');\n        }\n    }\n    /**\n     * Establishes a message channel with a listening Postmam on another browsing context.\n     * @remarks Only call this if listen() is called on another page.\n     */\n    connect() {\n        Log.info(`(Postmam) (${SdkEnvironment.getWindowEnv().toString()}) Establishing a connection to ${this.sendToOrigin}.`);\n        this.messagePort = this.channel.port1;\n        this.messagePort.addEventListener('message', this.onMessageReceived.bind(this), false);\n        this.messagePort.start();\n        this.windowReference.postMessage({\n            handshake: Postmam.HANDSHAKE_MESSAGE\n        }, this.sendToOrigin, [this.channel.port2]);\n    }\n    onMessageReceived(e) {\n        //Log.debug(`(Postmam) (${SdkEnvironment.getWindowEnv().toString()}):`, e.data);\n        if (!e.data) {\n            Log.debug(`(${SdkEnvironment.getWindowEnv().toString()}) Received an empty Postmam message:`, e);\n            return;\n        }\n        let { id: messageId, command: messageCommand, data: messageData, source: messageSource } = e.data;\n        if (messageCommand === Postmam.CONNECTED_MESSAGE) {\n            this.emitter.emit('connect');\n            this.isConnected = true;\n            return;\n        }\n        let messageBundle = {\n            id: messageId,\n            command: messageCommand,\n            data: messageData,\n            source: messageSource\n        };\n        let messageBundleWithReply = Object.assign({ reply: this.reply.bind(this, messageBundle) }, messageBundle);\n        if (this.replies.hasOwnProperty(messageId)) {\n            let replyFn = this.replies[messageId].bind(window);\n            let replyFnReturnValue = replyFn(messageBundleWithReply);\n            if (replyFnReturnValue === false) {\n                delete this.replies[messageId];\n            }\n        }\n        else {\n            this.emitter.emit(messageCommand, messageBundleWithReply);\n        }\n    }\n    reply(originalMessageBundle, data, onReply) {\n        const messageBundle = {\n            id: originalMessageBundle.id,\n            command: originalMessageBundle.command,\n            data: data,\n            source: SdkEnvironment.getWindowEnv().toString(),\n            isReply: true\n        };\n        if (typeof onReply === 'function') {\n            this.replies[messageBundle.id] = onReply;\n        }\n        this.messagePort.postMessage(messageBundle);\n    }\n    /**\n     * Sends via window.postMessage.\n     */\n    postMessage(command, data, onReply) {\n        if (!command || command == '') {\n            throw new Error(\"(Postmam) Postmam command must not be empty.\");\n        }\n        if (typeof data === 'function') {\n            Log.debug('You passed a function to data, did you mean to pass null?');\n            return;\n        }\n        const messageBundle = {\n            id: OneSignalUtils.getRandomUuid(),\n            command: command,\n            data: data,\n            source: SdkEnvironment.getWindowEnv().toString()\n        };\n        if (typeof onReply === 'function') {\n            this.replies[messageBundle.id] = onReply;\n        }\n        this.windowReference.postMessage(messageBundle, '*');\n    }\n    /**\n     * Sends via MessageChannel.port.postMessage\n     */\n    message(command, data, onReply) {\n        if (!command || command == '') {\n            throw new Error(\"(Postmam) Postmam command must not be empty.\");\n        }\n        if (typeof data === 'function') {\n            Log.debug('You passed a function to data, did you mean to pass null?');\n            return;\n        }\n        const messageBundle = {\n            id: OneSignalUtils.getRandomUuid(),\n            command: command,\n            data: data,\n            source: SdkEnvironment.getWindowEnv().toString()\n        };\n        if (typeof onReply === 'function') {\n            this.replies[messageBundle.id] = onReply;\n        }\n        this.messagePort.postMessage(messageBundle);\n    }\n    /**\n     * If the provided Site URL on the dashboard, which restricts the post message origin, uses the https:// protocol\n     * Then relax the postMessage restriction to also allow the http:// protocol for the same domain.\n     */\n    generateSafeOrigins(inputOrigin) {\n        // Trims trailing slashes and other undesirable artifacts\n        const safeOrigins = [];\n        try {\n            const url = new URL(inputOrigin);\n            let reducedHost = url.host;\n            if (url.host.indexOf('www.') === 0) {\n                reducedHost = url.host.replace('www.', '');\n            }\n            if (url.protocol === 'https:') {\n                safeOrigins.push(`https://${reducedHost}`);\n                safeOrigins.push(`https://www.${reducedHost}`);\n            }\n            else if (url.protocol === 'http:') {\n                safeOrigins.push(`http://${reducedHost}`);\n                safeOrigins.push(`http://www.${reducedHost}`);\n                safeOrigins.push(`https://${reducedHost}`);\n                safeOrigins.push(`https://www.${reducedHost}`);\n            }\n        }\n        catch (ex) {\n            // Invalid URL: Users can enter '*' or 'https://*.google.com' which is invalid.\n        }\n        return safeOrigins;\n    }\n    isSafeOrigin(messageOrigin) {\n        if (!OneSignal.config) {\n            var subdomain = \"x\";\n        }\n        else {\n            var subdomain = OneSignal.config.subdomain;\n        }\n        const otherAllowedOrigins = this.generateSafeOrigins(this.receiveFromOrigin);\n        return ( // messageOrigin === '' || TODO: See if messageOrigin can be blank\n        messageOrigin === 'https://onesignal.com' ||\n            messageOrigin === `https://${subdomain || ''}.onesignal.com` ||\n            messageOrigin === `https://${subdomain || ''}.os.tc` ||\n            messageOrigin === `https://${subdomain || ''}.os.tc:3001` ||\n            (messageOrigin === SdkEnvironment.getOneSignalApiUrl().origin) ||\n            this.receiveFromOrigin === '*' ||\n            Utils.contains(otherAllowedOrigins, messageOrigin));\n    }\n    async on(...args) {\n        return this.emitter.on.apply(this.emitter, args);\n    }\n    async off(...args) {\n        return this.emitter.off.apply(this.emitter, args);\n    }\n    async once(...args) {\n        return this.emitter.once.apply(this.emitter, args);\n    }\n}\n//# sourceMappingURL=Postmam.js.map","import Event from '../../Event';\nimport MainHelper from '../../helpers/MainHelper';\nimport SubscriptionHelper from '../../helpers/SubscriptionHelper';\nimport SdkEnvironment from '../../managers/SdkEnvironment';\nimport Postmam from '../../Postmam';\nimport Log from '../../libraries/Log';\n/**\n * The actual OneSignal proxy frame contents / implementation, that is loaded\n * into the iFrame URL as subdomain.onesignal.com/webPushIFrame or\n * subdomain.os.tc/webPushIFrame. *\n */\nexport default class SubscriptionModalHost {\n    constructor(appId, registrationOptions) {\n        this.appId = appId;\n        this.registrationOptions = registrationOptions;\n    }\n    /**\n     * Loads the messenger on the iFrame to communicate with the host page and\n     * assigns init options to an iFrame-only initialization of OneSignal.\n     *\n     * Our main host page will wait for all iFrame scripts to complete since the\n     * host page uses the iFrame onload event to begin sending handshake messages\n     * to the iFrame.\n     *\n     * There is no load timeout here; the iFrame initializes it scripts and waits\n     * forever for the first handshake message.\n     */\n    async load() {\n        const isPushEnabled = await OneSignal.isPushNotificationsEnabled();\n        const notificationPermission = await OneSignal.getNotificationPermission();\n        this.url = SdkEnvironment.getOneSignalApiUrl();\n        this.url.pathname = 'webPushModal';\n        this.url.search = `${MainHelper.getPromptOptionsQueryString()}&id=${this.appId}&httpsPrompt=true&pushEnabled=${isPushEnabled}&permissionBlocked=${notificationPermission === 'denied'}&promptType=modal`;\n        Log.info(`Loading iFrame for HTTPS subscription modal at ${this.url.toString()}`);\n        this.modal = this.createHiddenSubscriptionDomModal(this.url.toString());\n        this.establishCrossOriginMessaging();\n    }\n    createHiddenSubscriptionDomModal(url) {\n        let iframeContainer = document.createElement('div');\n        iframeContainer.setAttribute('id', 'OneSignal-iframe-modal');\n        iframeContainer.setAttribute('style', 'display:none !important');\n        iframeContainer.innerHTML = '<div id=\"notif-permission\" style=\"background: rgba(0, 0, 0, 0.7); position: fixed;' +\n            ' top: 0; left: 0; right: 0; bottom: 0; z-index: 3000000000; display: flex;' +\n            ' align-items: center; justify-content: center;\"></div>';\n        document.body.appendChild(iframeContainer);\n        let iframeContainerStyle = document.createElement('style');\n        iframeContainerStyle.innerHTML = `@media (max-width: 560px) { .OneSignal-permission-iframe { width: 100%; height: 100%;} }`;\n        document.getElementsByTagName('head')[0].appendChild(iframeContainerStyle);\n        let iframe = document.createElement(\"iframe\");\n        iframe.className = \"OneSignal-permission-iframe\";\n        iframe.setAttribute('frameborder', '0');\n        iframe.width = OneSignal._windowWidth.toString();\n        iframe.height = OneSignal._windowHeight.toString();\n        iframe.src = url;\n        document.getElementById(\"notif-permission\").appendChild(iframe);\n        return iframe;\n    }\n    removeFrame() {\n        const existingInstance = document.querySelector('#OneSignal-iframe-modal');\n        if (existingInstance) {\n            existingInstance.remove();\n        }\n    }\n    showSubscriptionDomModal() {\n        const iframeContainer = document.getElementById('OneSignal-iframe-modal');\n        iframeContainer.setAttribute('style', '');\n    }\n    establishCrossOriginMessaging() {\n        this.messenger = new Postmam(this.modal, this.url.origin, this.url.origin);\n        this.messenger.startPostMessageReceive();\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.MODAL_LOADED, this.onModalLoaded.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.MODAL_PROMPT_ACCEPTED, this.onModalAccepted.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.MODAL_PROMPT_REJECTED, this.onModalRejected.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_CLOSING, this.onModalClosing.bind(this));\n    }\n    onModalLoaded(_) {\n        this.showSubscriptionDomModal();\n        Event.trigger('modalLoaded');\n    }\n    async onModalAccepted(_) {\n        Log.debug('User accepted the HTTPS modal prompt.', location.origin);\n        OneSignal._sessionInitAlreadyRunning = false;\n        this.dispose();\n        MainHelper.triggerCustomPromptClicked('granted');\n        Log.debug('Calling setSubscription(true)');\n        await SubscriptionHelper.registerForPush();\n        await OneSignal.setSubscription(true);\n    }\n    onModalRejected(_) {\n        Log.debug('User rejected the HTTPS modal prompt.');\n        OneSignal._sessionInitAlreadyRunning = false;\n        this.dispose();\n        MainHelper.triggerCustomPromptClicked('denied');\n    }\n    onModalClosing(_) {\n        Log.info('Detected modal is closing.');\n        this.dispose();\n    }\n    dispose() {\n        if (this.messenger) {\n            // Removes all events\n            this.messenger.destroy();\n        }\n        this.removeFrame();\n    }\n    /**\n     * Shortcut method to messenger.message().\n     */\n    message() {\n        this.messenger.message.apply(this.messenger, arguments);\n    }\n}\n//# sourceMappingURL=SubscriptionModalHost.js.map","import { InvalidArgumentError, InvalidArgumentReason } from '../errors/InvalidArgumentError';\nimport SdkEnvironment from '../managers/SdkEnvironment';\nimport { ServiceWorkerActiveState } from '../helpers/ServiceWorkerHelper';\nimport { WindowEnvironmentKind } from '../models/WindowEnvironmentKind';\nimport Environment from '../Environment';\nimport Log from './Log';\n/**\n * NOTE: This file contains a mix of code that runs in ServiceWorker and Page contexts\n*/\nexport var WorkerMessengerCommand;\n(function (WorkerMessengerCommand) {\n    WorkerMessengerCommand[\"WorkerVersion\"] = \"GetWorkerVersion\";\n    WorkerMessengerCommand[\"Subscribe\"] = \"Subscribe\";\n    WorkerMessengerCommand[\"SubscribeNew\"] = \"SubscribeNew\";\n    WorkerMessengerCommand[\"AmpSubscriptionState\"] = \"amp-web-push-subscription-state\";\n    WorkerMessengerCommand[\"AmpSubscribe\"] = \"amp-web-push-subscribe\";\n    WorkerMessengerCommand[\"AmpUnsubscribe\"] = \"amp-web-push-unsubscribe\";\n    WorkerMessengerCommand[\"NotificationDisplayed\"] = \"notification.displayed\";\n    WorkerMessengerCommand[\"NotificationClicked\"] = \"notification.clicked\";\n    WorkerMessengerCommand[\"NotificationDismissed\"] = \"notification.dismissed\";\n    WorkerMessengerCommand[\"RedirectPage\"] = \"command.redirect\";\n    WorkerMessengerCommand[\"SessionUpsert\"] = \"os.session.upsert\";\n    WorkerMessengerCommand[\"SessionDeactivate\"] = \"os.session.deactivate\";\n    WorkerMessengerCommand[\"AreYouVisible\"] = \"os.page_focused_request\";\n    WorkerMessengerCommand[\"AreYouVisibleResponse\"] = \"os.page_focused_response\";\n    WorkerMessengerCommand[\"SetLogging\"] = \"os.set_sw_logging\";\n})(WorkerMessengerCommand || (WorkerMessengerCommand = {}));\nexport class WorkerMessengerReplyBuffer {\n    constructor() {\n        this.replies = {};\n    }\n    addListener(command, callback, onceListenerOnly) {\n        const record = { callback, onceListenerOnly };\n        const replies = this.replies[command.toString()];\n        if (replies)\n            replies.push(record);\n        else\n            this.replies[command.toString()] = [record];\n    }\n    findListenersForMessage(command) {\n        return this.replies[command.toString()] || [];\n    }\n    deleteListenerRecords(command) {\n        this.replies[command.toString()] = null;\n    }\n    deleteAllListenerRecords() {\n        this.replies = {};\n    }\n    deleteListenerRecord(command, targetRecord) {\n        const listenersForCommand = this.replies[command.toString()];\n        if (listenersForCommand == null)\n            return;\n        for (let listenerRecordIndex = listenersForCommand.length - 1; listenerRecordIndex >= 0; listenerRecordIndex--) {\n            const listenerRecord = listenersForCommand[listenerRecordIndex];\n            if (listenerRecord === targetRecord) {\n                listenersForCommand.splice(listenerRecordIndex, 1);\n            }\n        }\n    }\n}\n/**\n* A Promise-based PostMessage helper to ease back-and-forth replies between\n* service workers and window frames.\n*/\nexport class WorkerMessenger {\n    constructor(context, replies = new WorkerMessengerReplyBuffer()) {\n        this.context = context;\n        this.replies = replies;\n    }\n    /**\n     * Broadcasts a message from a service worker to all clients, including uncontrolled clients.\n     */\n    async broadcast(command, payload) {\n        if (SdkEnvironment.getWindowEnv() !== WindowEnvironmentKind.ServiceWorker)\n            return;\n        const clients = await self.clients.matchAll({ type: 'window', includeUncontrolled: true });\n        for (const client of clients) {\n            Log.debug(`[Worker Messenger] [SW -> Page] Broadcasting '${command.toString()}' to window client ${client.url}.`);\n            client.postMessage({\n                command: command,\n                payload: payload\n            });\n        }\n    }\n    /*\n      For pages:\n  \n        Sends a postMessage() to the service worker controlling the page.\n  \n        Waits until the service worker is controlling the page before sending the\n        message.\n     */\n    async unicast(command, payload, windowClient) {\n        const env = SdkEnvironment.getWindowEnv();\n        if (env === WindowEnvironmentKind.ServiceWorker) {\n            if (!windowClient) {\n                throw new InvalidArgumentError('windowClient', InvalidArgumentReason.Empty);\n            }\n            else {\n                Log.debug(`[Worker Messenger] [SW -> Page] Unicasting '${command.toString()}' to window client ${windowClient.url}.`);\n                windowClient.postMessage({\n                    command: command,\n                    payload: payload\n                });\n            }\n        }\n        else {\n            if (!(await this.isWorkerControllingPage())) {\n                Log.debug(\"[Worker Messenger] The page is not controlled by the service worker yet. Waiting...\", self.registration);\n            }\n            await this.waitUntilWorkerControlsPage();\n            Log.debug(`[Worker Messenger] [Page -> SW] Unicasting '${command.toString()}' to service worker.`);\n            this.directPostMessageToSW(command, payload);\n        }\n    }\n    directPostMessageToSW(command, payload) {\n        Log.debug(`[Worker Messenger] [Page -> SW] Direct command '${command.toString()}' to service worker.`);\n        navigator.serviceWorker.controller.postMessage({\n            command: command,\n            payload: payload\n        });\n    }\n    /**\n     * Due to https://github.com/w3c/ServiceWorker/issues/1156, listen() must\n     * synchronously add self.addEventListener('message') if we are running in the\n     * service worker.\n     *\n     * @param listenIfPageUncontrolled If true, begins listening for service\n     * worker messages even if the service worker does not control this page. This\n     * parameter is set to true on HTTPS iframes expecting service worker messages\n     * that live under an HTTP page.\n     */\n    async listen(listenIfPageUncontrolled) {\n        if (!Environment.supportsServiceWorkers())\n            return;\n        const env = SdkEnvironment.getWindowEnv();\n        if (env === WindowEnvironmentKind.ServiceWorker) {\n            self.addEventListener('message', this.onWorkerMessageReceivedFromPage.bind(this));\n            Log.debug('[Worker Messenger] Service worker is now listening for messages.');\n        }\n        else\n            await this.listenForPage(listenIfPageUncontrolled);\n    }\n    /**\n     * Listens for messages for the service worker.\n     *\n     * Waits until the service worker is controlling the page before listening for\n     * messages.\n     */\n    async listenForPage(listenIfPageUncontrolled) {\n        if (!listenIfPageUncontrolled) {\n            if (!(await this.isWorkerControllingPage())) {\n                Log.debug(`(${location.origin}) [Worker Messenger] The page is not controlled by the service worker yet. Waiting...`, self.registration);\n            }\n            await this.waitUntilWorkerControlsPage();\n            Log.debug(`(${location.origin}) [Worker Messenger] The page is now controlled by the service worker.`);\n        }\n        navigator.serviceWorker.addEventListener('message', this.onPageMessageReceivedFromServiceWorker.bind(this));\n        Log.debug(`(${location.origin}) [Worker Messenger] Page is now listening for messages.`);\n    }\n    onWorkerMessageReceivedFromPage(event) {\n        const data = event.data;\n        /* If this message doesn't contain our expected fields, discard the message */\n        /* The payload may be null. AMP web push sends commands to our service worker in the format:\n    \n           { command: \"amp-web-push-subscription-state\", payload: null }\n           { command: \"amp-web-push-unsubscribe\", payload: null }\n           { command: \"amp-web-push-subscribe\", payload: null }\n    \n        */\n        if (!data || !data.command) {\n            return;\n        }\n        const listenerRecords = this.replies.findListenersForMessage(data.command);\n        const listenersToRemove = [];\n        const listenersToCall = [];\n        Log.debug(`[Worker Messenger] Service worker received message:`, event.data);\n        for (let listenerRecord of listenerRecords) {\n            if (listenerRecord.onceListenerOnly) {\n                listenersToRemove.push(listenerRecord);\n            }\n            listenersToCall.push(listenerRecord);\n        }\n        for (let i = listenersToRemove.length - 1; i >= 0; i--) {\n            const listenerRecord = listenersToRemove[i];\n            this.replies.deleteListenerRecord(data.command, listenerRecord);\n        }\n        for (let listenerRecord of listenersToCall) {\n            listenerRecord.callback.apply(null, [data.payload]);\n        }\n    }\n    /*\n    Occurs when the page receives a message from the service worker.\n  \n    A map of callbacks is checked to see if anyone is listening to the specific\n    message topic. If no one is listening to the message, it is discarded;\n    otherwise, the listener callback is executed.\n    */\n    onPageMessageReceivedFromServiceWorker(event) {\n        const data = event.data;\n        /* If this message doesn't contain our expected fields, discard the message */\n        if (!data || !data.command) {\n            return;\n        }\n        const listenerRecords = this.replies.findListenersForMessage(data.command);\n        const listenersToRemove = [];\n        const listenersToCall = [];\n        Log.debug(`[Worker Messenger] Page received message:`, event.data);\n        for (let listenerRecord of listenerRecords) {\n            if (listenerRecord.onceListenerOnly) {\n                listenersToRemove.push(listenerRecord);\n            }\n            listenersToCall.push(listenerRecord);\n        }\n        for (let i = listenersToRemove.length - 1; i >= 0; i--) {\n            const listenerRecord = listenersToRemove[i];\n            this.replies.deleteListenerRecord(data.command, listenerRecord);\n        }\n        for (let listenerRecord of listenersToCall) {\n            listenerRecord.callback.apply(null, [data.payload]);\n        }\n    }\n    /*\n      Subscribes a callback to be notified every time a service worker sends a\n      message to the window frame with the specific command.\n     */\n    on(command, callback) {\n        this.replies.addListener(command, callback, false);\n    }\n    /*\n    Subscribes a callback to be notified the next time a service worker sends a\n    message to the window frame with the specific command.\n  \n    The callback is executed once at most.\n    */\n    once(command, callback) {\n        this.replies.addListener(command, callback, true);\n    }\n    /**\n      Unsubscribe a callback from being notified about service worker messages\n      with the specified command.\n     */\n    off(command) {\n        if (command) {\n            this.replies.deleteListenerRecords(command);\n        }\n        else {\n            this.replies.deleteAllListenerRecords();\n        }\n    }\n    /*\n      Service worker postMessage() communication relies on the property\n      navigator.serviceWorker.controller to be non-null. The controller property\n      references the active service worker controlling the page. Without this\n      property, there is no service worker to message.\n  \n      The controller property is set when a service worker has successfully\n      registered, installed, and activated a worker, and when a page isn't loaded\n      in a hard refresh mode bypassing the cache.\n  \n      It's possible for a service worker to take a second page load to be fully\n      activated.\n     */\n    async isWorkerControllingPage() {\n        const env = SdkEnvironment.getWindowEnv();\n        if (env === WindowEnvironmentKind.ServiceWorker)\n            return !!self.registration.active;\n        else {\n            const workerState = await this.context.serviceWorkerManager.getActiveState();\n            return workerState === ServiceWorkerActiveState.WorkerA ||\n                workerState === ServiceWorkerActiveState.WorkerB;\n        }\n    }\n    /**\n     * For pages, waits until one of our workers is activated.\n     *\n     * For service workers, waits until the registration is active.\n     */\n    async waitUntilWorkerControlsPage() {\n        return new Promise(async (resolve) => {\n            if (await this.isWorkerControllingPage())\n                resolve();\n            else {\n                const env = SdkEnvironment.getWindowEnv();\n                if (env === WindowEnvironmentKind.ServiceWorker) {\n                    self.addEventListener('activate', async (_e) => {\n                        if (await this.isWorkerControllingPage())\n                            resolve();\n                    });\n                }\n                else {\n                    navigator.serviceWorker.addEventListener('controllerchange', async (_e) => {\n                        if (await this.isWorkerControllingPage())\n                            resolve();\n                    });\n                }\n            }\n        });\n    }\n}\n//# sourceMappingURL=WorkerMessenger.js.map","import SdkEnvironment from '../managers/SdkEnvironment';\nimport Environment from '../Environment';\nexport class DynamicResourceLoader {\n    constructor() {\n        this.cache = {};\n    }\n    getCache() {\n        // Cache is private; return a cloned copy just for testing\n        return Object.assign({}, this.cache);\n    }\n    async loadSdkStylesheet() {\n        const pathForEnv = SdkEnvironment.getOneSignalResourceUrlPath();\n        const cssFileForEnv = SdkEnvironment.getOneSignalCssFileName();\n        return await this.loadIfNew(0 /* Stylesheet */, new URL(`${pathForEnv}/${cssFileForEnv}?v=${Environment.getSdkStylesVersionHash()}`));\n    }\n    async loadFetchPolyfill() {\n        return await this.loadIfNew(1 /* Script */, new URL('https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js'));\n    }\n    /**\n     * Attempts to load a resource by adding it to the document's <head>.\n     * Caches any previous load attempt's result and does not retry loading a previous resource.\n     */\n    async loadIfNew(type, url) {\n        // Load for first time\n        if (!this.cache[url.toString()]) {\n            this.cache[url.toString()] = DynamicResourceLoader.load(type, url);\n        }\n        // Resource is loading; multiple calls can be made to this while the same resource is loading\n        // Waiting on the Promise is what we want here\n        return await this.cache[url.toString()];\n    }\n    /**\n     * Attempts to load a resource by adding it to the document's <head>.\n     * Each call creates a new DOM element and fetch attempt.\n     */\n    static async load(type, url) {\n        try {\n            await new Promise((resolve, reject) => {\n                switch (type) {\n                    case 1 /* Script */:\n                        var domElement = document.createElement('script');\n                        domElement.setAttribute('type', 'text/javascript');\n                        domElement.setAttribute('async', 'async');\n                        domElement.setAttribute('src', url.toString());\n                        break;\n                    case 0 /* Stylesheet */:\n                        var domElement = document.createElement('link');\n                        domElement.setAttribute('rel', 'stylesheet');\n                        domElement.setAttribute('href', url.toString());\n                        break;\n                }\n                domElement.onerror = reject;\n                domElement.onload = resolve;\n                document.querySelector('head').appendChild(domElement);\n            });\n            return 0 /* Loaded */;\n        }\n        catch (e) {\n            return 1 /* Failed */;\n        }\n    }\n}\n//# sourceMappingURL=DynamicResourceLoader.js.map","import { addCssClass, removeCssClass, contains, once } from '../utils';\nimport OneSignalEvent from '../Event';\nimport Log from '../libraries/Log';\nimport OneSignal from '../OneSignal';\nexport default class AnimatedElement {\n    /**\n     * Abstracts common DOM operations like hiding and showing transitionable elements into chainable promises.\n     * @param selector {string} The CSS selector of the element.\n     * @param showClass {string} The CSS class name to add to show the element.\n     * @param hideClass {string} The CSS class name to remove to hide the element.\n     * @param state {string} The current state of the element, defaults to 'shown'.\n     * @param targetTransitionEvents {string} An array of properties (e.g. ['transform', 'opacity']) to look for on transitionend of show() and hide() to know the transition is complete. As long as one matches, the transition is considered complete.\n     * @param nestedContentSelector {string} The CSS selector targeting the nested element within the current element. This nested element will be used for content getters and setters.\n     */\n    constructor(selector, showClass, hideClass, state = 'shown', targetTransitionEvents = ['opacity', 'transform'], nestedContentSelector, transitionCheckTimeout = 500) {\n        this.selector = selector;\n        this.showClass = showClass;\n        this.hideClass = hideClass;\n        this.state = state;\n        this.targetTransitionEvents = targetTransitionEvents;\n        this.nestedContentSelector = nestedContentSelector;\n        this.transitionCheckTimeout = transitionCheckTimeout;\n    }\n    /**\n     * Asynchronously shows an element by applying its {showClass} CSS class.\n     *\n     * Returns a promise that is resolved with this element when it has completed its transition.\n     */\n    show() {\n        if (!this.hidden) {\n            return Promise.resolve(this);\n        }\n        else\n            return new Promise((resolve) => {\n                this.state = 'showing';\n                OneSignalEvent.trigger(AnimatedElement.EVENTS.SHOWING, this);\n                const element = this.element;\n                if (!element) {\n                    Log.error(`(show) could not find animated element with selector ${this.selector}`);\n                }\n                else {\n                    if (this.hideClass)\n                        removeCssClass(element, this.hideClass);\n                    if (this.showClass)\n                        addCssClass(element, this.showClass);\n                }\n                if (this.targetTransitionEvents.length == 0) {\n                    return resolve(this);\n                }\n                else {\n                    var timerId = setTimeout(() => {\n                        Log.debug(`Element did not completely show (state: ${this.state}).`);\n                    }, this.transitionCheckTimeout);\n                    once(this.element, 'transitionend', (event, destroyListenerFn) => {\n                        if (event.target === this.element &&\n                            contains(this.targetTransitionEvents, event.propertyName)) {\n                            clearTimeout(timerId);\n                            // Uninstall the event listener for transitionend\n                            destroyListenerFn();\n                            this.state = 'shown';\n                            OneSignalEvent.trigger(AnimatedElement.EVENTS.SHOWN, this);\n                            return resolve(this);\n                        }\n                    }, true);\n                }\n            });\n    }\n    /**\n     * Asynchronously hides an element by applying its {hideClass} CSS class.\n     * @returns {Promise} Returns a promise that is resolved with this element when it has completed its transition.\n     */\n    hide() {\n        if (!this.shown) {\n            return Promise.resolve(this);\n        }\n        else\n            return new Promise((resolve) => {\n                this.state = 'hiding';\n                OneSignalEvent.trigger(AnimatedElement.EVENTS.HIDING, this);\n                const element = this.element;\n                if (!element) {\n                    Log.error(`(hide) could not find animated element with selector ${this.selector}`);\n                }\n                else {\n                    if (this.showClass)\n                        removeCssClass(element, this.showClass);\n                    if (this.hideClass)\n                        addCssClass(element, this.hideClass);\n                }\n                if (this.targetTransitionEvents.length == 0) {\n                    return resolve(this);\n                }\n                else {\n                    once(this.element, 'transitionend', (event, destroyListenerFn) => {\n                        var timerId = setTimeout(() => {\n                            Log.debug(`Element did not completely hide (state: ${this.state}).`);\n                        }, this.transitionCheckTimeout);\n                        if (event.target === this.element &&\n                            contains(this.targetTransitionEvents, event.propertyName)) {\n                            clearTimeout(timerId);\n                            // Uninstall the event listener for transitionend\n                            destroyListenerFn();\n                            this.state = 'hidden';\n                            OneSignalEvent.trigger(AnimatedElement.EVENTS.HIDDEN, this);\n                            return resolve(this);\n                        }\n                    }, true);\n                }\n            });\n    }\n    /**\n     * Asynchronously waits for an element to finish transitioning to being shown.\n     * @returns {Promise} Returns a promise that is resolved with this element when it has completed its transition.\n     */\n    waitUntilShown() {\n        if (this.state === 'shown')\n            return Promise.resolve(this);\n        else\n            return new Promise((resolve) => {\n                OneSignal.emitter.once(AnimatedElement.EVENTS.SHOWN, (event) => {\n                    if (event === this) {\n                        return resolve(this);\n                    }\n                });\n            });\n    }\n    /**\n     * Asynchronously waits for an element to finish transitioning to being hidden.\n     * @returns {Promise} Returns a promise that is resolved with this element when it has completed its transition.\n     */\n    waitUntilHidden() {\n        if (this.state === 'hidden')\n            return Promise.resolve(this);\n        else\n            return new Promise((resolve) => {\n                OneSignal.emitter.once(AnimatedElement.EVENTS.HIDDEN, (event) => {\n                    if (event === this) {\n                        return resolve(this);\n                    }\n                });\n            });\n    }\n    static get EVENTS() {\n        return {\n            SHOWING: 'animatedElementShowing',\n            SHOWN: 'animatedElementShown',\n            HIDING: 'animatedElementHiding',\n            HIDDEN: 'animatedElementHidden',\n        };\n    }\n    /**\n     * Returns the native element's innerHTML property.\n     * @returns {string} Returns the native element's innerHTML property.\n     */\n    get content() {\n        if (!this.element) {\n            return \"\";\n        }\n        if (this.nestedContentSelector) {\n            const innerElement = this.element.querySelector(this.nestedContentSelector);\n            return innerElement ? innerElement.innerHTML : \"\";\n        }\n        else {\n            return this.element.innerHTML;\n        }\n    }\n    /**\n     * Sets the native element's innerHTML property.\n     * @param value {string} The HTML to set to the element.\n     */\n    set content(value) {\n        if (!this.element) {\n            return;\n        }\n        if (this.nestedContentSelector) {\n            const nestedContent = this.element.querySelector(this.nestedContentSelector);\n            if (nestedContent) {\n                nestedContent.innerHTML = value;\n            }\n        }\n        else {\n            this.element.innerHTML = value;\n        }\n    }\n    /**\n     * Returns the native {Element} via document.querySelector().\n     * @returns {Element | null} Returns the native {Element} via document.querySelector() or {null} if not found.\n     */\n    get element() {\n        return document.querySelector(this.selector);\n    }\n    /* States an element can be in */\n    /**\n     * Synchronously returns the last known state of the element.\n     * @returns {boolean} Returns true if the element was last known to be transitioning to being shown.\n     */\n    get showing() {\n        return this.state === 'showing';\n    }\n    /**\n     * Synchronously returns the last known state of the element.\n     * @returns {boolean} Returns true if the element was last known to be already shown.\n     */\n    get shown() {\n        return this.state === 'shown';\n    }\n    /**\n     * Synchronously returns the last known state of the element.\n     * @returns {boolean} Returns true if the element was last known to be transitioning to hiding.\n     */\n    get hiding() {\n        return this.state === 'hiding';\n    }\n    /**\n     * Synchronously returns the last known state of the element.\n     * @returns {boolean} Returns true if the element was last known to be already hidden.\n     */\n    get hidden() {\n        return this.state === 'hidden';\n    }\n}\n//# sourceMappingURL=AnimatedElement.js.map","import OneSignalEvent from '../Event';\nimport { addCssClass, contains, once, removeCssClass } from '../utils';\nimport AnimatedElement from './AnimatedElement';\nimport Log from '../libraries/Log';\nimport OneSignal from '../OneSignal';\nexport default class ActiveAnimatedElement extends AnimatedElement {\n    /**\n     * Abstracts common DOM operations like hiding and showing transitionable elements into chainable promises.\n     * @param selector {string} The CSS selector of the element.\n     * @param showClass {string} The CSS class name to add to show the element.\n     * @param hideClass {string} The CSS class name to remove to hide the element.\n     * @param activeClass {string} The CSS class name to add to activate the element.\n     * @param inactiveClass {string} The CSS class name to remove to inactivate the element.\n     * @param state {string} The current state of the element, defaults to 'shown'.\n     * @param activeState {string} The current state of the element, defaults to 'active'.\n     * @param targetTransitionEvents {string} An array of properties (e.g. ['transform', 'opacity']) to look for on transitionend of show() and hide() to know the transition is complete. As long as one matches, the transition is considered complete.\n     * @param nestedContentSelector {string} The CSS selector targeting the nested element within the current element. This nested element will be used for content getters and setters.\n     */\n    constructor(selector, showClass, hideClass, activeClass, inactiveClass, state = 'shown', activeState = 'active', targetTransitionEvents = ['opacity', 'transform'], nestedContentSelector) {\n        super(selector, showClass, hideClass, state, targetTransitionEvents);\n        this.selector = selector;\n        this.showClass = showClass;\n        this.hideClass = hideClass;\n        this.activeClass = activeClass;\n        this.inactiveClass = inactiveClass;\n        this.state = state;\n        this.activeState = activeState;\n        this.targetTransitionEvents = targetTransitionEvents;\n        this.nestedContentSelector = nestedContentSelector;\n    }\n    /**\n     * Asynchronously activates an element by applying its {activeClass} CSS class.\n     * @returns {Promise} Returns a promise that is resolved with this element when it has completed its transition.\n     */\n    activate() {\n        if (!this.inactive || !this.shown) {\n            return Promise.resolve(this);\n        }\n        else\n            return new Promise((resolve) => {\n                this.activeState = 'activating';\n                OneSignalEvent.trigger(ActiveAnimatedElement.EVENTS.ACTIVATING, this);\n                const element = this.element;\n                if (!element) {\n                    Log.error(\"Could not find active animated element\");\n                }\n                else {\n                    if (this.inactiveClass)\n                        removeCssClass(element, this.inactiveClass);\n                    if (this.activeClass)\n                        addCssClass(element, this.activeClass);\n                }\n                if (this.shown) {\n                    if (this.targetTransitionEvents.length == 0) {\n                        return resolve(this);\n                    }\n                    else {\n                        var timerId = setTimeout(() => {\n                            Log.debug(`Element did not completely activate (state: ${this.state}, activeState: ${this.activeState}).`);\n                        }, this.transitionCheckTimeout);\n                        once(this.element, 'transitionend', (event, destroyListenerFn) => {\n                            if (event.target === this.element &&\n                                contains(this.targetTransitionEvents, event.propertyName)) {\n                                clearTimeout(timerId);\n                                // Uninstall the event listener for transitionend\n                                destroyListenerFn();\n                                this.activeState = 'active';\n                                OneSignalEvent.trigger(ActiveAnimatedElement.EVENTS.ACTIVE, this);\n                                return resolve(this);\n                            }\n                        }, true);\n                    }\n                }\n                else {\n                    Log.debug(`Ending activate() transition (alternative).`);\n                    this.activeState = 'active';\n                    OneSignalEvent.trigger(ActiveAnimatedElement.EVENTS.ACTIVE, this);\n                    return resolve(this);\n                }\n            });\n    }\n    /**\n     * Asynchronously activates an element by applying its {activeClass} CSS class.\n     * @returns {Promise} Returns a promise that is resolved with this element when it has completed its transition.\n     */\n    inactivate() {\n        if (!this.active) {\n            return Promise.resolve(this);\n        }\n        else\n            return new Promise((resolve) => {\n                this.activeState = 'inactivating';\n                OneSignalEvent.trigger(ActiveAnimatedElement.EVENTS.INACTIVATING, this);\n                const element = this.element;\n                if (!element) {\n                    Log.error(\"Could not find active animated element\");\n                }\n                else {\n                    if (this.activeClass)\n                        removeCssClass(element, this.activeClass);\n                    if (this.inactiveClass)\n                        addCssClass(element, this.inactiveClass);\n                }\n                if (this.shown) {\n                    if (this.targetTransitionEvents.length == 0) {\n                        return resolve(this);\n                    }\n                    else {\n                        var timerId = setTimeout(() => {\n                            Log.debug(`Element did not completely inactivate (state: ${this.state}, activeState: ${this.activeState}).`);\n                        }, this.transitionCheckTimeout);\n                        once(this.element, 'transitionend', (event, destroyListenerFn) => {\n                            if (event.target === this.element &&\n                                contains(this.targetTransitionEvents, event.propertyName)) {\n                                clearTimeout(timerId);\n                                // Uninstall the event listener for transitionend\n                                destroyListenerFn();\n                                this.activeState = 'inactive';\n                                OneSignalEvent.trigger(ActiveAnimatedElement.EVENTS.INACTIVE, this);\n                                return resolve(this);\n                            }\n                        }, true);\n                    }\n                }\n                else {\n                    this.activeState = 'inactive';\n                    OneSignalEvent.trigger(ActiveAnimatedElement.EVENTS.INACTIVE, this);\n                    return resolve(this);\n                }\n            });\n    }\n    /**\n     * Asynchronously waits for an element to finish transitioning to being active.\n     * @returns {Promise} Returns a promise that is resolved with this element when it has completed its transition.\n     */\n    waitUntilActive() {\n        if (this.active)\n            return Promise.resolve(this);\n        else\n            return new Promise((resolve) => {\n                OneSignal.emitter.once(ActiveAnimatedElement.EVENTS.ACTIVE, (event) => {\n                    if (event === this) {\n                        return resolve(this);\n                    }\n                });\n            });\n    }\n    /**\n     * Asynchronously waits for an element to finish transitioning to being inactive.\n     * @returns {Promise} Returns a promise that is resolved with this element when it has completed its transition.\n     */\n    waitUntilInactive() {\n        if (this.inactive)\n            return Promise.resolve(this);\n        else\n            return new Promise((resolve) => {\n                OneSignal.emitter.once(ActiveAnimatedElement.EVENTS.INACTIVE, (event) => {\n                    if (event === this) {\n                        return resolve(this);\n                    }\n                });\n            });\n    }\n    static get EVENTS() {\n        return Object.assign({}, AnimatedElement.EVENTS, {\n            ACTIVATING: 'activeAnimatedElementActivating',\n            ACTIVE: 'activeAnimatedElementActive',\n            INACTIVATING: 'activeAnimatedElementInactivating',\n            INACTIVE: 'activeAnimatedElementInactive',\n        });\n    }\n    /**\n     * Synchronously returns the last known state of the element.\n     * @returns {boolean} Returns true if the element was last known to be transitioning to being activated.\n     */\n    get activating() {\n        return this.activeState === 'activating';\n    }\n    /**\n     * Synchronously returns the last known state of the element.\n     * @returns {boolean} Returns true if the element was last known to be already active.\n     */\n    get active() {\n        return this.activeState === 'active';\n    }\n    /**\n     * Synchronously returns the last known state of the element.\n     * @returns {boolean} Returns true if the element was last known to be transitioning to inactive.\n     */\n    get inactivating() {\n        return this.activeState === 'inactivating';\n    }\n    /**\n     * Synchronously returns the last known state of the element.\n     * @returns {boolean} Returns true if the element was last known to be already inactive.\n     */\n    get inactive() {\n        return this.activeState === 'inactive';\n    }\n}\n//# sourceMappingURL=ActiveAnimatedElement.js.map","import ActiveAnimatedElement from './ActiveAnimatedElement';\nexport default class Badge extends ActiveAnimatedElement {\n    constructor() {\n        super('.onesignal-bell-launcher-badge', 'onesignal-bell-launcher-badge-opened', null, 'onesignal-bell-launcher-badge-active', null, 'hidden');\n    }\n    increment() {\n        // If it IS a number (is not not a number)\n        if (!isNaN(this.content)) {\n            let badgeNumber = +this.content; // Coerce to int\n            badgeNumber += 1;\n            this.content = badgeNumber.toString();\n        }\n    }\n    show() {\n        const promise = super.show();\n        OneSignal.notifyButton.setCustomColorsIfSpecified();\n        return promise;\n    }\n    decrement() {\n        // If it IS a number (is not not a number)\n        if (!isNaN(this.content)) {\n            let badgeNumber = +this.content; // Coerce to int\n            badgeNumber -= 1;\n            if (badgeNumber > 0)\n                this.content = badgeNumber.toString();\n            else\n                this.content = '';\n        }\n    }\n}\n//# sourceMappingURL=Badge.js.map","import { decodeHtmlEntities, delay, getConsoleStyle, nothing } from '../utils';\nimport AnimatedElement from './AnimatedElement';\nimport Bell from './Bell';\nimport Log from '../libraries/Log';\nexport default class Message extends AnimatedElement {\n    constructor(bell) {\n        super('.onesignal-bell-launcher-message', 'onesignal-bell-launcher-message-opened', undefined, 'hidden', ['opacity', 'transform'], '.onesignal-bell-launcher-message-body');\n        this.bell = bell;\n        this.contentType = '';\n        this.queued = [];\n    }\n    static get TIMEOUT() {\n        return 2500;\n    }\n    static get TYPES() {\n        return {\n            TIP: 'tip',\n            MESSAGE: 'message',\n            QUEUED: 'queued' // This message was a user-queued message\n        };\n    }\n    display(type, content, duration = 0) {\n        Log.debug(`Calling %cdisplay(${type}, ${content}, ${duration}).`, getConsoleStyle('code'));\n        return (this.shown ? this.hide() : nothing())\n            .then(() => {\n            this.content = decodeHtmlEntities(content);\n            this.contentType = type;\n        })\n            .then(() => {\n            return this.show();\n        })\n            .then(() => delay(duration))\n            .then(() => {\n            return this.hide();\n        })\n            .then(() => {\n            // Reset back to normal content type so stuff can show a gain\n            this.content = this.getTipForState();\n            this.contentType = 'tip';\n        });\n    }\n    getTipForState() {\n        if (this.bell.state === Bell.STATES.UNSUBSCRIBED)\n            return this.bell.options.text['tip.state.unsubscribed'];\n        else if (this.bell.state === Bell.STATES.SUBSCRIBED)\n            return this.bell.options.text['tip.state.subscribed'];\n        else if (this.bell.state === Bell.STATES.BLOCKED)\n            return this.bell.options.text['tip.state.blocked'];\n        return \"\";\n    }\n    enqueue(message) {\n        this.queued.push(decodeHtmlEntities(message));\n        return new Promise((resolve) => {\n            if (this.bell.badge.shown) {\n                this.bell.badge.hide()\n                    .then(() => this.bell.badge.increment())\n                    .then(() => this.bell.badge.show())\n                    .then(resolve);\n            }\n            else {\n                this.bell.badge.increment();\n                if (this.bell.initialized)\n                    this.bell.badge.show().then(resolve);\n                else\n                    resolve();\n            }\n        });\n    }\n    dequeue(message) {\n        let dequeuedMessage = this.queued.pop(message);\n        return new Promise((resolve) => {\n            if (this.bell.badge.shown) {\n                this.bell.badge.hide()\n                    .then(() => this.bell.badge.decrement())\n                    .then((numMessagesLeft) => {\n                    if (numMessagesLeft > 0) {\n                        return this.bell.badge.show();\n                    }\n                    else {\n                        return Promise.resolve(this);\n                    }\n                })\n                    .then(resolve(dequeuedMessage));\n            }\n            else {\n                this.bell.badge.decrement();\n                resolve(dequeuedMessage);\n            }\n        });\n    }\n}\n//# sourceMappingURL=Message.js.map","import { removeDomElement, addDomElement, isUsingSubscriptionWorkaround } from \"../utils\";\nimport Event from \"../Event\";\nimport ActiveAnimatedElement from \"./ActiveAnimatedElement\";\nimport Bell from \"./Bell\";\nimport LimitStore from \"../LimitStore\";\nimport Message from \"./Message\";\nimport OneSignal from '../OneSignal';\nexport default class Button extends ActiveAnimatedElement {\n    constructor(bell) {\n        super('.onesignal-bell-launcher-button', undefined, undefined, 'onesignal-bell-launcher-button-active', undefined, 'shown', '');\n        this.bell = bell;\n        this.events = {\n            mouse: 'bell.launcher.button.mouse'\n        };\n        const element = this.element;\n        if (element) {\n            element.addEventListener('touchstart', () => {\n                this.onHovering();\n                this.onTap();\n            }, { passive: true });\n            element.addEventListener('mouseenter', () => {\n                this.onHovering();\n            });\n            element.addEventListener('mouseleave', () => {\n                this.onHovered();\n            });\n            element.addEventListener('touchmove', () => {\n                this.onHovered();\n            }, { passive: true });\n            element.addEventListener('mousedown', () => {\n                this.onTap();\n            });\n            element.addEventListener('mouseup', () => {\n                this.onEndTap();\n            });\n            element.addEventListener('click', () => {\n                this.onHovered();\n                this.onClick();\n            });\n        }\n    }\n    onHovering() {\n        if (LimitStore.isEmpty(this.events.mouse) || LimitStore.getLast(this.events.mouse) === 'out') {\n            Event.trigger(Bell.EVENTS.HOVERING);\n        }\n        LimitStore.put(this.events.mouse, 'over');\n    }\n    onHovered() {\n        LimitStore.put(this.events.mouse, 'out');\n        Event.trigger(Bell.EVENTS.HOVERED);\n    }\n    onTap() {\n        this.pulse();\n        this.activate();\n        this.bell.badge.activate();\n    }\n    onEndTap() {\n        this.inactivate();\n        this.bell.badge.inactivate();\n    }\n    onClick() {\n        Event.trigger(Bell.EVENTS.BELL_CLICK);\n        Event.trigger(Bell.EVENTS.LAUNCHER_CLICK);\n        if (this.bell.message.shown && this.bell.message.contentType == Message.TYPES.MESSAGE) {\n            // A message is being shown, it'll disappear soon\n            return;\n        }\n        var optedOut = LimitStore.getLast('subscription.optedOut');\n        if (this.bell.unsubscribed) {\n            if (optedOut) {\n                // The user is manually opted out, but still \"really\" subscribed\n                this.bell.launcher.activateIfInactive().then(() => {\n                    this.bell.showDialogProcedure();\n                });\n            }\n            else {\n                // The user is actually subscribed, register him for notifications\n                OneSignal.registerForPushNotifications();\n                this.bell._ignoreSubscriptionState = true;\n                OneSignal.emitter.once(OneSignal.EVENTS.SUBSCRIPTION_CHANGED, () => {\n                    this.bell.message.display(Message.TYPES.MESSAGE, this.bell.options.text['message.action.subscribed'], Message.TIMEOUT).then(() => {\n                        this.bell._ignoreSubscriptionState = false;\n                        this.bell.launcher.inactivate();\n                    });\n                });\n            }\n        }\n        else if (this.bell.subscribed) {\n            this.bell.launcher.activateIfInactive().then(() => {\n                this.bell.showDialogProcedure();\n            });\n        }\n        else if (this.bell.blocked) {\n            if (isUsingSubscriptionWorkaround()) {\n                // Show the HTTP popup so users can re-allow notifications\n                OneSignal.registerForPushNotifications();\n            }\n            else {\n                this.bell.launcher.activateIfInactive().then(() => {\n                    this.bell.showDialogProcedure();\n                });\n            }\n        }\n        return this.bell.message.hide();\n    }\n    pulse() {\n        removeDomElement('.pulse-ring');\n        if (this.element) {\n            addDomElement(this.element, 'beforeend', '<div class=\"pulse-ring\"></div>');\n        }\n        this.bell.setCustomColorsIfSpecified();\n    }\n}\n//# sourceMappingURL=Button.js.map","import bowser from 'bowser';\nimport Event from '../Event';\nimport SdkEnvironment from '../managers/SdkEnvironment';\nimport { addDomElement, clearDomElementChildren, getPlatformNotificationIcon } from '../utils';\nimport AnimatedElement from './AnimatedElement';\nimport Bell from './Bell';\nexport default class Dialog extends AnimatedElement {\n    constructor(bell) {\n        super('.onesignal-bell-launcher-dialog', 'onesignal-bell-launcher-dialog-opened', undefined, 'hidden', ['opacity', 'transform'], '.onesignal-bell-launcher-dialog-body');\n        this.bell = bell;\n        this.subscribeButtonId = '#onesignal-bell-container .onesignal-bell-launcher #subscribe-button';\n        this.unsubscribeButtonId = '#onesignal-bell-container .onesignal-bell-launcher #unsubscribe-button';\n        this.notificationIcons = null;\n    }\n    show() {\n        return this.updateBellLauncherDialogBody()\n            .then(() => super.show());\n    }\n    get subscribeButtonSelectorId() {\n        return 'subscribe-button';\n    }\n    get unsubscribeButtonSelectorId() {\n        return 'unsubscribe-button';\n    }\n    get subscribeButton() {\n        return this.element ? this.element.querySelector('#' + this.subscribeButtonSelectorId) : null;\n    }\n    get unsubscribeButton() {\n        return this.element ? this.element.querySelector('#' + this.unsubscribeButtonSelectorId) : null;\n    }\n    updateBellLauncherDialogBody() {\n        return OneSignal.getSubscription().then((currentSetSubscription) => {\n            if (this.nestedContentSelector) {\n                clearDomElementChildren(this.nestedContentSelector);\n            }\n            let contents = 'Nothing to show.';\n            var footer = '';\n            if (this.bell.options.showCredit) {\n                footer = `<div class=\"divider\"></div><div class=\"kickback\">Powered by <a href=\"https://onesignal.com\" class=\"kickback\" target=\"_blank\">OneSignal</a></div>`;\n            }\n            if (this.bell.state === Bell.STATES.SUBSCRIBED && currentSetSubscription === true ||\n                this.bell.state === Bell.STATES.UNSUBSCRIBED && currentSetSubscription === false) {\n                let notificationIconHtml = '';\n                let imageUrl = getPlatformNotificationIcon(this.notificationIcons);\n                if (imageUrl != 'default-icon') {\n                    notificationIconHtml = `<div class=\"push-notification-icon\"><img src=\"${imageUrl}\"></div>`;\n                }\n                else {\n                    notificationIconHtml = `<div class=\"push-notification-icon push-notification-icon-default\"></div>`;\n                }\n                let buttonHtml = '';\n                if (this.bell.state !== Bell.STATES.SUBSCRIBED)\n                    buttonHtml = `<button type=\"button\" class=\"action\" id=\"${this.subscribeButtonSelectorId}\">${this.bell.options.text['dialog.main.button.subscribe']}</button>`;\n                else\n                    buttonHtml = `<button type=\"button\" class=\"action\" id=\"${this.unsubscribeButtonSelectorId}\">${this.bell.options.text['dialog.main.button.unsubscribe']}</button>`;\n                contents = `<h1>${this.bell.options.text['dialog.main.title']}</h1><div class=\"divider\"></div><div class=\"push-notification\">${notificationIconHtml}<div class=\"push-notification-text-container\"><div class=\"push-notification-text push-notification-text-short\"></div><div class=\"push-notification-text\"></div><div class=\"push-notification-text push-notification-text-medium\"></div><div class=\"push-notification-text\"></div><div class=\"push-notification-text push-notification-text-medium\"></div></div></div><div class=\"action-container\">${buttonHtml}</div>${footer}`;\n            }\n            else if (this.bell.state === Bell.STATES.BLOCKED) {\n                let imageUrl = null;\n                if (bowser.chrome) {\n                    if (!bowser.mobile && !bowser.tablet)\n                        imageUrl = '/bell/chrome-unblock.jpg';\n                }\n                else if (bowser.firefox)\n                    imageUrl = '/bell/firefox-unblock.jpg';\n                else if (bowser.safari)\n                    imageUrl = '/bell/safari-unblock.jpg';\n                else if (bowser.msedge)\n                    imageUrl = '/bell/edge-unblock.png';\n                let instructionsHtml = '';\n                if (imageUrl) {\n                    imageUrl = SdkEnvironment.getOneSignalApiUrl().origin + imageUrl;\n                    instructionsHtml = `<a href=\"${imageUrl}\" target=\"_blank\"><img src=\"${imageUrl}\"></a></div>`;\n                }\n                if ((bowser.mobile || bowser.tablet) && bowser.chrome) {\n                    instructionsHtml = `<ol><li>Access <strong>Settings</strong> by tapping the three menu dots <strong></strong></li><li>Click <strong>Site settings</strong> under Advanced.</li><li>Click <strong>Notifications</strong>.</li><li>Find and click this entry for this website.</li><li>Click <strong>Notifications</strong> and set it to <strong>Allow</strong>.</li></ol>`;\n                }\n                contents = `<h1>${this.bell.options.text['dialog.blocked.title']}</h1><div class=\"divider\"></div><div class=\"instructions\"><p>${this.bell.options.text['dialog.blocked.message']}</p>${instructionsHtml}</div>${footer}`;\n            }\n            if (this.nestedContentSelector) {\n                addDomElement(this.nestedContentSelector, 'beforeend', contents);\n            }\n            if (this.subscribeButton) {\n                this.subscribeButton.addEventListener('click', () => {\n                    /*\n                      The welcome notification should only be shown if the user is\n                      subscribing for the first time and resubscribing via the notify\n                      button.\n          \n                      If permission is already granted, __doNotShowWelcomeNotification is\n                      set to true to prevent showing a notification, but we actually want\n                      a notification shown in this resubscription case.\n                     */\n                    OneSignal.__doNotShowWelcomeNotification = false;\n                    Event.trigger(Bell.EVENTS.SUBSCRIBE_CLICK);\n                });\n            }\n            if (this.unsubscribeButton) {\n                this.unsubscribeButton.addEventListener('click', () => Event.trigger(Bell.EVENTS.UNSUBSCRIBE_CLICK));\n            }\n            this.bell.setCustomColorsIfSpecified();\n        });\n    }\n}\n//# sourceMappingURL=Dialog.js.map","import { InvalidStateError, InvalidStateReason } from '../errors/InvalidStateError';\nimport { addCssClass, contains, hasCssClass, nothing, once, removeCssClass } from '../utils';\nimport ActiveAnimatedElement from './ActiveAnimatedElement';\nimport Log from '../libraries/Log';\nexport default class Launcher extends ActiveAnimatedElement {\n    constructor(bell) {\n        super('.onesignal-bell-launcher', 'onesignal-bell-launcher-active', undefined, undefined, 'onesignal-bell-launcher-inactive', 'hidden', 'active');\n        this.bell = bell;\n        this.wasInactive = false;\n    }\n    async resize(size) {\n        if (!this.element) {\n            // Notify button doesn't exist\n            throw new InvalidStateError(InvalidStateReason.MissingDomElement);\n        }\n        // If the size is the same, do nothing and resolve an empty promise\n        if ((size === 'small' && hasCssClass(this.element, 'onesignal-bell-launcher-sm')) ||\n            (size === 'medium' && hasCssClass(this.element, 'onesignal-bell-launcher-md')) ||\n            (size === 'large' && hasCssClass(this.element, 'onesignal-bell-launcher-lg'))) {\n            return Promise.resolve(this);\n        }\n        removeCssClass(this.element, 'onesignal-bell-launcher-sm');\n        removeCssClass(this.element, 'onesignal-bell-launcher-md');\n        removeCssClass(this.element, 'onesignal-bell-launcher-lg');\n        if (size === 'small') {\n            addCssClass(this.element, 'onesignal-bell-launcher-sm');\n        }\n        else if (size === 'medium') {\n            addCssClass(this.element, 'onesignal-bell-launcher-md');\n        }\n        else if (size === 'large') {\n            addCssClass(this.element, 'onesignal-bell-launcher-lg');\n        }\n        else {\n            throw new Error('Invalid OneSignal bell size ' + size);\n        }\n        if (!this.shown) {\n            return this;\n        }\n        else {\n            return await new Promise((resolve) => {\n                // Once the launcher has finished shrinking down\n                if (this.targetTransitionEvents.length == 0) {\n                    return resolve(this);\n                }\n                else {\n                    var timerId = setTimeout(() => {\n                        Log.debug(`Launcher did not completely resize (state: ${this.state}, activeState: ${this.activeState}).`);\n                    }, this.transitionCheckTimeout);\n                    once(this.element, 'transitionend', (event, destroyListenerFn) => {\n                        if (event.target === this.element &&\n                            contains(this.targetTransitionEvents, event.propertyName)) {\n                            clearTimeout(timerId);\n                            // Uninstall the event listener for transitionend\n                            destroyListenerFn();\n                            return resolve(this);\n                        }\n                    }, true);\n                }\n            });\n        }\n    }\n    activateIfInactive() {\n        if (this.inactive) {\n            this.wasInactive = true;\n            return this.activate();\n        }\n        else\n            return nothing();\n    }\n    inactivateIfWasInactive() {\n        if (this.wasInactive) {\n            this.wasInactive = false;\n            return this.inactivate();\n        }\n        else\n            return nothing();\n    }\n    clearIfWasInactive() {\n        this.wasInactive = false;\n    }\n    inactivate() {\n        return this.bell.message.hide()\n            .then(() => {\n            if (this.bell.badge.content.length > 0) {\n                return this.bell.badge.hide()\n                    .then(() => Promise.all([super.inactivate(), this.resize('small')]))\n                    .then(() => this.bell.badge.show());\n            }\n            else {\n                return Promise.all([super.inactivate(), this.resize('small')]);\n            }\n        });\n    }\n    activate() {\n        if (this.bell.badge.content.length > 0) {\n            return this.bell.badge.hide()\n                .then(() => Promise.all([super.activate(), this.resize(this.bell.options.size)]));\n        }\n        else {\n            return Promise.all([super.activate(), this.resize(this.bell.options.size)]);\n        }\n    }\n}\n//# sourceMappingURL=Launcher.js.map","import bowser from 'bowser';\nimport { NotificationPermission } from \"../models/NotificationPermission\";\nimport OneSignalEvent from '../Event';\nimport MainHelper from '../helpers/MainHelper';\nimport { addCssClass, addDomElement, contains, decodeHtmlEntities, delay, nothing, once, removeDomElement, isUsingSubscriptionWorkaround } from '../utils';\nimport Badge from './Badge';\nimport Button from './Button';\nimport Dialog from './Dialog';\nimport Launcher from './Launcher';\nimport Message from './Message';\nimport Log from '../libraries/Log';\nimport OneSignal from \"../OneSignal\";\nvar logoSvg = `<svg class=\"onesignal-bell-svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"99.7\" height=\"99.7\" viewBox=\"0 0 99.7 99.7\"><circle class=\"background\" cx=\"49.9\" cy=\"49.9\" r=\"49.9\"/><path class=\"foreground\" d=\"M50.1 66.2H27.7s-2-.2-2-2.1c0-1.9 1.7-2 1.7-2s6.7-3.2 6.7-5.5S33 52.7 33 43.3s6-16.6 13.2-16.6c0 0 1-2.4 3.9-2.4 2.8 0 3.8 2.4 3.8 2.4 7.2 0 13.2 7.2 13.2 16.6s-1 11-1 13.3c0 2.3 6.7 5.5 6.7 5.5s1.7.1 1.7 2c0 1.8-2.1 2.1-2.1 2.1H50.1zm-7.2 2.3h14.5s-1 6.3-7.2 6.3-7.3-6.3-7.3-6.3z\"/><ellipse class=\"stroke\" cx=\"49.9\" cy=\"49.9\" rx=\"37.4\" ry=\"36.9\"/></svg>`;\nexport default class Bell {\n    constructor(config, launcher) {\n        this.state = Bell.STATES.UNINITIALIZED;\n        this._ignoreSubscriptionState = false;\n        this.hovering = false;\n        this.initialized = false;\n        this.DEFAULT_SIZE = \"medium\";\n        this.DEFAULT_POSITION = \"bottom-right\";\n        this.DEFAULT_THEME = \"default\";\n        this.options = {\n            enable: config.enable || false,\n            size: config.size || this.DEFAULT_SIZE,\n            position: config.position || this.DEFAULT_POSITION,\n            theme: config.theme || this.DEFAULT_THEME,\n            showLauncherAfter: config.showLauncherAfter || 10,\n            showBadgeAfter: config.showBadgeAfter || 300,\n            text: this.setDefaultTextOptions(config.text || {}),\n            prenotify: config.prenotify,\n            showCredit: config.showCredit,\n            colors: config.colors,\n            offset: config.offset,\n        };\n        if (launcher) {\n            this._launcher = launcher;\n        }\n        if (!this.options.enable)\n            return;\n        this.validateOptions(this.options);\n        this.state = Bell.STATES.UNINITIALIZED;\n        this._ignoreSubscriptionState = false;\n        this.installEventHooks();\n        this.updateState();\n    }\n    static get EVENTS() {\n        return {\n            STATE_CHANGED: 'notifyButtonStateChange',\n            LAUNCHER_CLICK: 'notifyButtonLauncherClick',\n            BELL_CLICK: 'notifyButtonButtonClick',\n            SUBSCRIBE_CLICK: 'notifyButtonSubscribeClick',\n            UNSUBSCRIBE_CLICK: 'notifyButtonUnsubscribeClick',\n            HOVERING: 'notifyButtonHovering',\n            HOVERED: 'notifyButtonHover'\n        };\n    }\n    static get STATES() {\n        return {\n            UNINITIALIZED: 'uninitialized',\n            SUBSCRIBED: 'subscribed',\n            UNSUBSCRIBED: 'unsubscribed',\n            BLOCKED: 'blocked',\n        };\n    }\n    static get TEXT_SUBS() {\n        return {\n            'prompt.native.grant': {\n                default: 'Allow',\n                chrome: 'Allow',\n                firefox: 'Always Receive Notifications',\n                safari: 'Allow'\n            }\n        };\n    }\n    showDialogProcedure() {\n        if (!this.dialog.shown) {\n            this.dialog.show()\n                .then(() => {\n                once(document, 'click', (e, destroyEventListener) => {\n                    let wasDialogClicked = this.dialog.element.contains(e.target);\n                    if (wasDialogClicked) {\n                    }\n                    else {\n                        destroyEventListener();\n                        if (this.dialog.shown) {\n                            this.dialog.hide()\n                                .then(() => {\n                                this.launcher.inactivateIfWasInactive();\n                            });\n                        }\n                    }\n                }, true);\n            });\n        }\n    }\n    validateOptions(options) {\n        if (!options.size || !contains(['small', 'medium', 'large'], options.size))\n            throw new Error(`Invalid size ${options.size} for notify button. Choose among 'small', 'medium', or 'large'.`);\n        if (!options.position || !contains(['bottom-left', 'bottom-right'], options.position))\n            throw new Error(`Invalid position ${options.position} for notify button. Choose either 'bottom-left', or 'bottom-right'.`);\n        if (!options.theme || !contains(['default', 'inverse'], options.theme))\n            throw new Error(`Invalid theme ${options.theme} for notify button. Choose either 'default', or 'inverse'.`);\n        if (!options.showLauncherAfter || options.showLauncherAfter < 0)\n            throw new Error(`Invalid delay duration of ${this.options.showLauncherAfter} for showing the notify button. Choose a value above 0.`);\n        if (!options.showBadgeAfter || options.showBadgeAfter < 0)\n            throw new Error(`Invalid delay duration of ${this.options.showBadgeAfter} for showing the notify button's badge. Choose a value above 0.`);\n    }\n    setDefaultTextOptions(text) {\n        const finalText = {\n            'tip.state.unsubscribed': text['tip.state.unsubscribed'] || 'Subscribe to notifications',\n            'tip.state.subscribed': text['tip.state.subscribed'] || \"You're subscribed to notifications\",\n            'tip.state.blocked': text['tip.state.blocked'] || \"You've blocked notifications\",\n            'message.prenotify': text['message.prenotify'] || \"Click to subscribe to notifications\",\n            'message.action.subscribed': text['message.action.subscribed'] || \"Thanks for subscribing!\",\n            'message.action.resubscribed': text['message.action.resubscribed'] || \"You're subscribed to notifications\",\n            'message.action.subscribing': text['message.action.subscribing'] || \"Click <strong>{{prompt.native.grant}}</strong> to receive notifications\",\n            'message.action.unsubscribed': text['message.action.unsubscribed'] || \"You won't receive notifications again\",\n            'dialog.main.title': text['dialog.main.title'] || 'Manage Site Notifications',\n            'dialog.main.button.subscribe': text['dialog.main.button.subscribe'] || 'SUBSCRIBE',\n            'dialog.main.button.unsubscribe': text['dialog.main.button.unsubscribe'] || 'UNSUBSCRIBE',\n            'dialog.blocked.title': text['dialog.blocked.title'] || 'Unblock Notifications',\n            'dialog.blocked.message': text['dialog.blocked.message'] || 'Follow these instructions to allow notifications:',\n        };\n        return finalText;\n    }\n    installEventHooks() {\n        // Install event hooks\n        OneSignal.emitter.on(Bell.EVENTS.SUBSCRIBE_CLICK, () => {\n            this.dialog.subscribeButton.disabled = true;\n            this._ignoreSubscriptionState = true;\n            OneSignal.setSubscription(true)\n                .then(() => {\n                this.dialog.subscribeButton.disabled = false;\n                return this.dialog.hide();\n            })\n                .then(() => {\n                return this.message.display(Message.TYPES.MESSAGE, this.options.text['message.action.resubscribed'], Message.TIMEOUT);\n            })\n                .then(() => {\n                this._ignoreSubscriptionState = false;\n                this.launcher.clearIfWasInactive();\n                return this.launcher.inactivate();\n            })\n                .then(() => {\n                return this.updateState();\n            });\n        });\n        OneSignal.emitter.on(Bell.EVENTS.UNSUBSCRIBE_CLICK, () => {\n            this.dialog.unsubscribeButton.disabled = true;\n            OneSignal.setSubscription(false)\n                .then(() => {\n                this.dialog.unsubscribeButton.disabled = false;\n                return this.dialog.hide();\n            })\n                .then(() => {\n                this.launcher.clearIfWasInactive();\n                return this.launcher.activate();\n            })\n                .then(() => {\n                return this.message.display(Message.TYPES.MESSAGE, this.options.text['message.action.unsubscribed'], Message.TIMEOUT);\n            })\n                .then(() => {\n                return this.updateState();\n            });\n        });\n        OneSignal.emitter.on(Bell.EVENTS.HOVERING, () => {\n            this.hovering = true;\n            this.launcher.activateIfInactive();\n            // If there's already a message being force shown, do not override\n            if (this.message.shown || this.dialog.shown) {\n                this.hovering = false;\n                return;\n            }\n            // If the message is a message and not a tip, don't show it (only show tips)\n            // Messages will go away on their own\n            if (this.message.contentType === Message.TYPES.MESSAGE) {\n                this.hovering = false;\n                return;\n            }\n            new Promise(resolve => {\n                // If a message is being shown\n                if (this.message.queued.length > 0) {\n                    return this.message.dequeue().then((msg) => {\n                        this.message.content = msg;\n                        this.message.contentType = Message.TYPES.QUEUED;\n                        resolve();\n                    });\n                }\n                else {\n                    this.message.content = decodeHtmlEntities(this.message.getTipForState());\n                    this.message.contentType = Message.TYPES.TIP;\n                    resolve();\n                }\n            }).then(() => {\n                return this.message.show();\n            })\n                .then(() => {\n                this.hovering = false;\n            });\n        });\n        OneSignal.emitter.on(Bell.EVENTS.HOVERED, () => {\n            // If a message is displayed (and not a tip), don't control it. Visitors have no control over messages\n            if (this.message.contentType === Message.TYPES.MESSAGE) {\n                return;\n            }\n            if (!this.dialog.hidden) {\n                // If the dialog is being brought up when clicking button, don't shrink\n                return;\n            }\n            if (this.hovering) {\n                this.hovering = false;\n                // Hovering still being true here happens on mobile where the message could still be showing (i.e. animating) when a HOVERED event fires\n                // In other words, you tap on mobile, HOVERING fires, and then HOVERED fires immediately after because of the way mobile click events work\n                // Basically only happens if HOVERING and HOVERED fire within a few milliseconds of each other\n                this.message.waitUntilShown()\n                    .then(() => delay(Message.TIMEOUT))\n                    .then(() => this.message.hide())\n                    .then(() => {\n                    if (this.launcher.wasInactive && this.dialog.hidden) {\n                        this.launcher.inactivate();\n                        this.launcher.wasInactive = false;\n                    }\n                });\n            }\n            if (this.message.shown) {\n                this.message.hide()\n                    .then(() => {\n                    if (this.launcher.wasInactive && this.dialog.hidden) {\n                        this.launcher.inactivate();\n                        this.launcher.wasInactive = false;\n                    }\n                });\n            }\n        });\n        OneSignal.emitter.on(OneSignal.EVENTS.SUBSCRIPTION_CHANGED, async (isSubscribed) => {\n            if (isSubscribed == true) {\n                if (this.badge.shown && this.options.prenotify) {\n                    this.badge.hide();\n                }\n                if (this.dialog.notificationIcons === null) {\n                    const icons = await MainHelper.getNotificationIcons();\n                    this.dialog.notificationIcons = icons;\n                }\n            }\n            OneSignal.getNotificationPermission((permission) => {\n                let bellState;\n                if (isSubscribed) {\n                    bellState = Bell.STATES.SUBSCRIBED;\n                }\n                else if (permission === NotificationPermission.Denied) {\n                    bellState = Bell.STATES.BLOCKED;\n                }\n                else {\n                    bellState = Bell.STATES.UNSUBSCRIBED;\n                }\n                this.setState(bellState, this._ignoreSubscriptionState);\n            });\n        });\n        OneSignal.emitter.on(Bell.EVENTS.STATE_CHANGED, (state) => {\n            if (!this.launcher.element) {\n                // Notify button doesn't exist\n                return;\n            }\n            if (state.to === Bell.STATES.SUBSCRIBED) {\n                this.launcher.inactivate();\n            }\n            else if (state.to === Bell.STATES.UNSUBSCRIBED ||\n                Bell.STATES.BLOCKED) {\n                this.launcher.activate();\n            }\n        });\n        OneSignal.emitter.on(OneSignal.EVENTS.NATIVE_PROMPT_PERMISSIONCHANGED, () => {\n            this.updateState();\n        });\n    }\n    addDefaultClasses() {\n        // Add default classes\n        const container = this.container;\n        if (this.options.position === 'bottom-left') {\n            if (container) {\n                addCssClass(container, 'onesignal-bell-container-bottom-left');\n            }\n            addCssClass(this.launcher.selector, 'onesignal-bell-launcher-bottom-left');\n        }\n        else if (this.options.position === 'bottom-right') {\n            if (container) {\n                addCssClass(container, 'onesignal-bell-container-bottom-right');\n            }\n            addCssClass(this.launcher.selector, 'onesignal-bell-launcher-bottom-right');\n        }\n        else {\n            throw new Error('Invalid OneSignal notify button position ' + this.options.position);\n        }\n        if (this.options.theme === 'default') {\n            addCssClass(this.launcher.selector, 'onesignal-bell-launcher-theme-default');\n        }\n        else if (this.options.theme === 'inverse') {\n            addCssClass(this.launcher.selector, 'onesignal-bell-launcher-theme-inverse');\n        }\n        else {\n            throw new Error('Invalid OneSignal notify button theme ' + this.options.theme);\n        }\n    }\n    async create() {\n        if (!this.options.enable)\n            return;\n        const sdkStylesLoadResult = await OneSignal.context.dynamicResourceLoader.loadSdkStylesheet();\n        if (sdkStylesLoadResult !== 0 /* Loaded */) {\n            Log.debug('Not showing notify button because styles failed to load.');\n            return;\n        }\n        // Remove any existing bell\n        if (this.container) {\n            removeDomElement('#onesignal-bell-container');\n        }\n        // Insert the bell container\n        addDomElement('body', 'beforeend', '<div id=\"onesignal-bell-container\" class=\"onesignal-bell-container onesignal-reset\"></div>');\n        if (this.container) {\n            // Insert the bell launcher\n            addDomElement(this.container, 'beforeend', '<div id=\"onesignal-bell-launcher\" class=\"onesignal-bell-launcher\"></div>');\n        }\n        // Insert the bell launcher button\n        addDomElement(this.launcher.selector, 'beforeend', '<div class=\"onesignal-bell-launcher-button\"></div>');\n        // Insert the bell launcher badge\n        addDomElement(this.launcher.selector, 'beforeend', '<div class=\"onesignal-bell-launcher-badge\"></div>');\n        // Insert the bell launcher message\n        addDomElement(this.launcher.selector, 'beforeend', '<div class=\"onesignal-bell-launcher-message\"></div>');\n        addDomElement(this.message.selector, 'beforeend', '<div class=\"onesignal-bell-launcher-message-body\"></div>');\n        // Insert the bell launcher dialog\n        addDomElement(this.launcher.selector, 'beforeend', '<div class=\"onesignal-bell-launcher-dialog\"></div>');\n        addDomElement(this.dialog.selector, 'beforeend', '<div class=\"onesignal-bell-launcher-dialog-body\"></div>');\n        // Install events\n        // Add visual elements\n        addDomElement(this.button.selector, 'beforeend', logoSvg);\n        const isPushEnabled = await OneSignal.isPushNotificationsEnabled();\n        const notOptedOut = await OneSignal.getSubscription();\n        const doNotPrompt = await MainHelper.wasHttpsNativePromptDismissed();\n        // Resize to small instead of specified size if enabled, otherwise there's a jerking motion where the bell, at a different size than small, jerks sideways to go from large -> small or medium -> small\n        let resizeTo = (isPushEnabled ? 'small' : (this.options.size || this.DEFAULT_SIZE));\n        await this.launcher.resize(resizeTo);\n        this.addDefaultClasses();\n        this.applyOffsetIfSpecified();\n        this.setCustomColorsIfSpecified();\n        this.patchSafariSvgFilterBug();\n        Log.info('Showing the notify button.');\n        await (isPushEnabled ? this.launcher.inactivate() : nothing())\n            .then(() => OneSignal.getSubscription())\n            .then((isNotOptedOut) => {\n            if ((isPushEnabled || !isNotOptedOut) && this.dialog.notificationIcons === null) {\n                return MainHelper.getNotificationIcons().then((icons) => {\n                    this.dialog.notificationIcons = icons;\n                });\n            }\n            else\n                return nothing();\n        })\n            .then(() => delay(this.options.showLauncherAfter || 0))\n            .then(() => {\n            if (isUsingSubscriptionWorkaround() &&\n                notOptedOut &&\n                doNotPrompt !== true && !isPushEnabled &&\n                (OneSignal.config.userConfig.promptOptions.autoPrompt === true) &&\n                !MainHelper.isHttpPromptAlreadyShown()) {\n                Log.debug('Not showing notify button because slidedown will be shown.');\n                return nothing();\n            }\n            else {\n                return this.launcher.show();\n            }\n        })\n            .then(() => {\n            return delay(this.options.showBadgeAfter || 0);\n        })\n            .then(() => {\n            if (this.options.prenotify && !isPushEnabled && OneSignal._isNewVisitor) {\n                return this.message.enqueue(this.options.text['message.prenotify'])\n                    .then(() => this.badge.show());\n            }\n            else\n                return nothing();\n        })\n            .then(() => this.initialized = true);\n    }\n    patchSafariSvgFilterBug() {\n        if (!(bowser.safari && Number(bowser.version) >= 9.1)) {\n            let bellShadow = `drop-shadow(0 2px 4px rgba(34,36,38,0.35));`;\n            let badgeShadow = `drop-shadow(0 2px 4px rgba(34,36,38,0));`;\n            let dialogShadow = `drop-shadow(0px 2px 2px rgba(34,36,38,.15));`;\n            this.graphic.setAttribute('style', `filter: ${bellShadow}; -webkit-filter: ${bellShadow};`);\n            this.badge.element.setAttribute('style', `filter: ${badgeShadow}; -webkit-filter: ${badgeShadow};`);\n            this.dialog.element.setAttribute('style', `filter: ${dialogShadow}; -webkit-filter: ${dialogShadow};`);\n        }\n        if (bowser.safari) {\n            this.badge.element.setAttribute('style', `display: none;`);\n        }\n    }\n    applyOffsetIfSpecified() {\n        let offset = this.options.offset;\n        if (offset) {\n            const element = this.launcher.element;\n            if (!element) {\n                Log.error(\"Could not find bell dom element\");\n                return;\n            }\n            // Reset styles first\n            element.style.cssText = '';\n            if (offset.bottom) {\n                element.style.cssText += `bottom: ${offset.bottom};`;\n            }\n            if (this.options.position === 'bottom-right') {\n                if (offset.right) {\n                    element.style.cssText += `right: ${offset.right};`;\n                }\n            }\n            else if (this.options.position === 'bottom-left') {\n                if (offset.left) {\n                    element.style.cssText += `left: ${offset.left};`;\n                }\n            }\n        }\n    }\n    setCustomColorsIfSpecified() {\n        // Some common vars first\n        let dialogButton = this.dialog.element.querySelector('button.action');\n        let pulseRing = this.button.element.querySelector('.pulse-ring');\n        // Reset added styles first\n        this.graphic.querySelector('.background').style.cssText = '';\n        let foregroundElements = this.graphic.querySelectorAll('.foreground');\n        for (let i = 0; i < foregroundElements.length; i++) {\n            let element = foregroundElements[i];\n            element.style.cssText = '';\n        }\n        this.graphic.querySelector('.stroke').style.cssText = '';\n        this.badge.element.style.cssText = '';\n        if (dialogButton) {\n            dialogButton.style.cssText = '';\n            dialogButton.style.cssText = '';\n        }\n        if (pulseRing) {\n            pulseRing.style.cssText = '';\n        }\n        // Set new styles\n        if (this.options.colors) {\n            let colors = this.options.colors;\n            if (colors['circle.background']) {\n                this.graphic.querySelector('.background').style.cssText += `fill: ${colors['circle.background']}`;\n            }\n            if (colors['circle.foreground']) {\n                let foregroundElements = this.graphic.querySelectorAll('.foreground');\n                for (let i = 0; i < foregroundElements.length; i++) {\n                    let element = foregroundElements[i];\n                    element.style.cssText += `fill: ${colors['circle.foreground']}`;\n                }\n                this.graphic.querySelector('.stroke').style.cssText += `stroke: ${colors['circle.foreground']}`;\n            }\n            if (colors['badge.background']) {\n                this.badge.element.style.cssText += `background: ${colors['badge.background']}`;\n            }\n            if (colors['badge.bordercolor']) {\n                this.badge.element.style.cssText += `border-color: ${colors['badge.bordercolor']}`;\n            }\n            if (colors['badge.foreground']) {\n                this.badge.element.style.cssText += `color: ${colors['badge.foreground']}`;\n            }\n            if (dialogButton) {\n                if (colors['dialog.button.background']) {\n                    this.dialog.element.querySelector('button.action').style.cssText += `background: ${colors['dialog.button.background']}`;\n                }\n                if (colors['dialog.button.foreground']) {\n                    this.dialog.element.querySelector('button.action').style.cssText += `color: ${colors['dialog.button.foreground']}`;\n                }\n                if (colors['dialog.button.background.hovering']) {\n                    this.addCssToHead('onesignal-background-hover-style', `#onesignal-bell-container.onesignal-reset .onesignal-bell-launcher .onesignal-bell-launcher-dialog button.action:hover { background: ${colors['dialog.button.background.hovering']} !important; }`);\n                }\n                if (colors['dialog.button.background.active']) {\n                    this.addCssToHead('onesignal-background-active-style', `#onesignal-bell-container.onesignal-reset .onesignal-bell-launcher .onesignal-bell-launcher-dialog button.action:active { background: ${colors['dialog.button.background.active']} !important; }`);\n                }\n            }\n            if (pulseRing) {\n                if (colors['pulse.color']) {\n                    this.button.element.querySelector('.pulse-ring').style.cssText = `border-color: ${colors['pulse.color']}`;\n                }\n            }\n        }\n    }\n    addCssToHead(id, css) {\n        let existingStyleDom = document.getElementById(id);\n        if (existingStyleDom)\n            return;\n        let styleDom = document.createElement('style');\n        styleDom.id = id;\n        styleDom.type = 'text/css';\n        styleDom.appendChild(document.createTextNode(css));\n        document.head.appendChild(styleDom);\n    }\n    /**\n     * Updates the current state to the correct new current state. Returns a promise.\n     */\n    updateState() {\n        Promise.all([\n            OneSignal.privateIsPushNotificationsEnabled(),\n            OneSignal.privateGetNotificationPermission()\n        ])\n            .then(([isEnabled, permission]) => {\n            this.setState(isEnabled ? Bell.STATES.SUBSCRIBED : Bell.STATES.UNSUBSCRIBED);\n            if (permission === NotificationPermission.Denied) {\n                this.setState(Bell.STATES.BLOCKED);\n            }\n        });\n    }\n    /**\n     * Updates the current state to the specified new state.\n     * @param newState One of ['subscribed', 'unsubscribed'].\n     */\n    setState(newState, silent = false) {\n        let lastState = this.state;\n        this.state = newState;\n        if (lastState !== newState && !silent) {\n            OneSignalEvent.trigger(Bell.EVENTS.STATE_CHANGED, { from: lastState, to: newState });\n            // Update anything that should be changed here in the new state\n        }\n        // Update anything that should be reset to the same state\n    }\n    get container() {\n        return document.querySelector('#onesignal-bell-container');\n    }\n    get graphic() {\n        return this.button.element.querySelector('svg');\n    }\n    get launcher() {\n        if (!this._launcher)\n            this._launcher = new Launcher(this);\n        return this._launcher;\n    }\n    get button() {\n        if (!this._button)\n            this._button = new Button(this);\n        return this._button;\n    }\n    get badge() {\n        if (!this._badge)\n            this._badge = new Badge();\n        return this._badge;\n    }\n    get message() {\n        if (!this._message)\n            this._message = new Message(this);\n        return this._message;\n    }\n    get dialog() {\n        if (!this._dialog)\n            this._dialog = new Dialog(this);\n        return this._dialog;\n    }\n    get subscribed() {\n        return this.state === Bell.STATES.SUBSCRIBED;\n    }\n    get unsubscribed() {\n        return this.state === Bell.STATES.UNSUBSCRIBED;\n    }\n    get blocked() {\n        return this.state === Bell.STATES.BLOCKED;\n    }\n}\n//# sourceMappingURL=Bell.js.map","import { InvalidArgumentError, InvalidArgumentReason } from '../errors/InvalidArgumentError';\n/**\n * Represents a normalized path.\n *\n * Paths spaces are trimmed.\n * Paths without file names will never contain trailing slashes, except for empty paths.\n */\nexport default class Path {\n    constructor(path) {\n        if (!path)\n            throw new InvalidArgumentError('path', InvalidArgumentReason.Empty);\n        this.path = path.trim();\n    }\n    getQueryString() {\n        // If there are no ? characters, return null\n        // If there are multiple ?, return the substring starting after the first ? all the way to the end\n        const indexOfDelimiter = this.path.indexOf('?');\n        if (indexOfDelimiter === -1) {\n            return null;\n        }\n        if (this.path.length > indexOfDelimiter) {\n            // Return the substring *after the first ? to the end\n            return this.path.substring(indexOfDelimiter + 1);\n        }\n        else {\n            // The last character is ?\n            return null;\n        }\n    }\n    getWithoutQueryString() {\n        return this.path.split(Path.QUERY_STRING)[0];\n    }\n    getFileName() {\n        return this.getWithoutQueryString().split('\\\\').pop().split('/').pop();\n    }\n    getFileNameWithQuery() {\n        return this.path.split('\\\\').pop().split('/').pop();\n    }\n    getFullPath() {\n        return this.path;\n    }\n    getPathWithoutFileName() {\n        const newPath = this.getWithoutQueryString();\n        const fileNameIndex = newPath.lastIndexOf(this.getFileName());\n        let pathWithoutFileName = newPath.substring(0, fileNameIndex);\n        pathWithoutFileName = pathWithoutFileName.replace(/[\\\\\\/]$/, '');\n        return pathWithoutFileName;\n    }\n}\nPath.QUERY_STRING = '?';\n//# sourceMappingURL=Path.js.map","import OneSignalError from './OneSignalError';\nexport class ServiceWorkerRegistrationError extends OneSignalError {\n    constructor(status, statusText) {\n        super(`Registration of a Service Worker failed.`);\n        this.status = status;\n        this.statusText = statusText;\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, ServiceWorkerRegistrationError.prototype);\n    }\n}\nexport default ServiceWorkerRegistrationError;\n//# sourceMappingURL=ServiceWorkerRegistrationError.js.map","import { base64Encode } from '../utils/Encoding';\nimport Environment from '../Environment';\nclass MetricEvent {\n    getPropertiesAsJson() {\n        /* Origin and URL are available from the service worker as well */\n        return {\n            origin: location.origin,\n            url: location.href,\n            sdkVersion: Environment.version()\n        };\n    }\n}\nclass MetricEngagement {\n}\nexport var ApiUsageMetricKind;\n(function (ApiUsageMetricKind) {\n    ApiUsageMetricKind[\"HttpPermissionRequest\"] = \"HttpPermissionRequest\";\n    ApiUsageMetricKind[\"SyncHashedEmail\"] = \"SyncHashedEmail\";\n})(ApiUsageMetricKind || (ApiUsageMetricKind = {}));\nexport class ApiUsageMetricEvent extends MetricEvent {\n    constructor(apiName) {\n        super();\n        this.apiName = apiName;\n    }\n    getEventName() {\n        return 'api-usage';\n    }\n    getPropertiesAsJson() {\n        return Object.assign({ api: this.apiName.toString() }, super.getPropertiesAsJson());\n    }\n}\nexport class PageViewMetricEngagement extends MetricEngagement {\n    constructor() {\n        super();\n    }\n    getProfileName() {\n        return \"all_websites\";\n    }\n    getDateUtc() {\n        const date = new Date();\n        return `${date.getUTCMonth() + 1}_${date.getUTCDate()}_${date.getUTCFullYear()}`;\n    }\n    getOperationData() {\n        const payload = {\n            $add: {},\n            $ignore_time: true\n        };\n        payload[`$add`][`pageview_${this.getDateUtc()}`] = 1;\n        return payload;\n    }\n}\nexport default class MetricsManager {\n    constructor(isFeatureEnabled, mixpanelReportingToken) {\n        this.isFeatureEnabled = isFeatureEnabled;\n        this.mixpanelReportingToken = mixpanelReportingToken;\n    }\n    static get MIXPANEL_REPORTING_URL() {\n        return 'https://api.mixpanel.com';\n    }\n    isEnabled() {\n        return this.isFeatureEnabled && !!this.mixpanelReportingToken;\n    }\n    reportEvent(event) {\n        if (!this.isEnabled()) {\n            return Promise.resolve(null);\n        }\n        const queryParamsData = {\n            event: event.getEventName(),\n            properties: Object.assign({ token: this.mixpanelReportingToken }, event.getPropertiesAsJson())\n        };\n        const queryParams = base64Encode(JSON.stringify(queryParamsData));\n        const requestOptions = {\n            method: 'GET',\n            headers: new Headers(),\n            cache: 'no-cache',\n        };\n        return fetch(`${MetricsManager.MIXPANEL_REPORTING_URL}/track/?data=${queryParams}`, requestOptions);\n    }\n    reportEngagement(engagement) {\n        if (!this.isEnabled()) {\n            return Promise.resolve(null);\n        }\n        let queryParamsData = {\n            $token: this.mixpanelReportingToken,\n            $distinct_id: engagement.getProfileName(),\n        };\n        queryParamsData = Object.assign({}, queryParamsData, engagement.getOperationData());\n        const queryParams = base64Encode(JSON.stringify(queryParamsData));\n        const requestOptions = {\n            method: 'GET',\n            headers: new Headers(),\n            cache: 'no-cache',\n        };\n        return fetch(`${MetricsManager.MIXPANEL_REPORTING_URL}/engage/?data=${queryParams}`, requestOptions);\n    }\n    shouldCollectPageView() {\n        const date = new Date();\n        return ((date.getUTCMonth() + 1) <= 2 &&\n            date.getUTCDate() <= 10 &&\n            date.getUTCFullYear() <= 2018 &&\n            (date.getUTCMonth() + 1) >= 2 &&\n            date.getUTCDate() >= 8 &&\n            date.getUTCFullYear() >= 2018);\n    }\n    reportPageView() {\n        // Collect for a couple days from feature release date\n        if (this.shouldCollectPageView()) {\n            this.reportEngagement(new PageViewMetricEngagement());\n        }\n    }\n}\n//# sourceMappingURL=MetricsManager.js.map","import OneSignalError from './OneSignalError';\nimport { ApiUsageMetricEvent, ApiUsageMetricKind } from '../managers/MetricsManager';\nexport var DeprecatedApiReason;\n(function (DeprecatedApiReason) {\n    DeprecatedApiReason[DeprecatedApiReason[\"HttpPermissionRequest\"] = 0] = \"HttpPermissionRequest\";\n    DeprecatedApiReason[DeprecatedApiReason[\"SyncHashedEmail\"] = 1] = \"SyncHashedEmail\";\n})(DeprecatedApiReason || (DeprecatedApiReason = {}));\nexport class DeprecatedApiError extends OneSignalError {\n    constructor(reason) {\n        switch (reason) {\n            case DeprecatedApiReason.HttpPermissionRequest:\n                super('The HTTP permission request has been deprecated. Please remove any custom popups from your code.');\n                this.reportUsage(ApiUsageMetricKind.HttpPermissionRequest);\n                break;\n            case DeprecatedApiReason.SyncHashedEmail:\n                super('API syncHashedEmail() has been deprecated and will be removed in a future SDK release.' +\n                    ' Please remove any usages from your code.');\n                this.reportUsage(ApiUsageMetricKind.SyncHashedEmail);\n                break;\n        }\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, DeprecatedApiError.prototype);\n    }\n    reportUsage(apiKind) {\n        if (typeof OneSignal !== 'undefined' && OneSignal.context && OneSignal.context.metricsManager) {\n            OneSignal.context.metricsManager.reportEvent(new ApiUsageMetricEvent(apiKind));\n        }\n    }\n}\n//# sourceMappingURL=DeprecatedApiError.js.map","import OneSignalError from \"./OneSignalError\";\nexport var SubscriptionErrorReason;\n(function (SubscriptionErrorReason) {\n    SubscriptionErrorReason[SubscriptionErrorReason[\"InvalidSafariSetup\"] = 0] = \"InvalidSafariSetup\";\n    SubscriptionErrorReason[SubscriptionErrorReason[\"Blocked\"] = 1] = \"Blocked\";\n    SubscriptionErrorReason[SubscriptionErrorReason[\"Dismissed\"] = 2] = \"Dismissed\";\n})(SubscriptionErrorReason || (SubscriptionErrorReason = {}));\nexport default class SubscriptionError extends OneSignalError {\n    constructor(reason) {\n        switch (reason) {\n            case SubscriptionErrorReason.InvalidSafariSetup:\n                super('The Safari site URL, icon size, or push certificate is invalid, or Safari is in a private session.');\n                break;\n            case SubscriptionErrorReason.Blocked:\n                super('Notification permissions are blocked.');\n                break;\n            case SubscriptionErrorReason.Dismissed:\n                super('The notification permission prompt was dismissed.');\n                break;\n        }\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, SubscriptionError.prototype);\n    }\n}\n//# sourceMappingURL=SubscriptionError.js.map","import Environment from '../Environment';\nimport { WorkerMessengerCommand } from '../libraries/WorkerMessenger';\nimport Path from '../models/Path';\nimport SdkEnvironment from '../managers/SdkEnvironment';\nimport Database from '../services/Database';\nimport { IntegrationKind } from '../models/IntegrationKind';\nimport { WindowEnvironmentKind } from '../models/WindowEnvironmentKind';\nimport NotImplementedError from '../errors/NotImplementedError';\nimport Log from '../libraries/Log';\nimport Event from '../Event';\nimport ServiceWorkerRegistrationError from \"../errors/ServiceWorkerRegistrationError\";\nimport OneSignalUtils from \"../utils/OneSignalUtils\";\nimport ServiceWorkerHelper, { ServiceWorkerActiveState } from \"../helpers/ServiceWorkerHelper\";\nimport { Utils } from \"../context/shared/utils/Utils\";\nexport class ServiceWorkerManager {\n    constructor(context, config) {\n        this.context = context;\n        this.config = config;\n    }\n    // Gets details on the service-worker (if any) that controls the current page\n    static async getRegistration() {\n        return await ServiceWorkerHelper.getRegistration();\n    }\n    async getActiveState() {\n        /*\n          Note: This method can only be called on a secure origin. On an insecure\n          origin, it'll throw on getRegistration().\n        */\n        /*\n          We want to find out if the *current* page is currently controlled by an\n          active service worker.\n    \n          There are three ways (sort of) to do this:\n            - getRegistration()\n            - getRegistrations()\n            - navigator.serviceWorker.ready\n    \n          We want to use getRegistration(), since it will not return a value if the\n          page is not currently controlled by an active service worker.\n    \n          getRegistrations() returns all service worker registrations under the\n          origin (i.e. registrations in nested folders).\n    \n          navigator.serviceWorker.ready will hang indefinitely and never resolve if\n          no registration is active.\n        */\n        const integration = await SdkEnvironment.getIntegration();\n        if (integration === IntegrationKind.InsecureProxy) {\n            /* Service workers are not accessible on insecure origins */\n            return ServiceWorkerActiveState.Indeterminate;\n        }\n        else if (integration === IntegrationKind.SecureProxy) {\n            /* If the site setup is secure proxy, we're either on the top frame without access to the\n            registration, or the child proxy frame that does have access to the registration. */\n            const env = SdkEnvironment.getWindowEnv();\n            switch (env) {\n                case WindowEnvironmentKind.Host:\n                case WindowEnvironmentKind.CustomIframe:\n                    /* Both these top-ish frames will need to ask the proxy frame to access the service worker\n                    registration */\n                    const proxyFrameHost = OneSignal.proxyFrameHost;\n                    if (!proxyFrameHost) {\n                        /* On init, this function may be called. Return a null state for now */\n                        return ServiceWorkerActiveState.Indeterminate;\n                    }\n                    else {\n                        return await proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.SERVICE_WORKER_STATE);\n                    }\n                case WindowEnvironmentKind.OneSignalSubscriptionPopup:\n                    /* This is a top-level frame, so it can access the service worker registration */\n                    break;\n                case WindowEnvironmentKind.OneSignalSubscriptionModal:\n                    throw new NotImplementedError();\n            }\n        }\n        const workerRegistration = await ServiceWorkerManager.getRegistration();\n        if (!workerRegistration) {\n            /*\n              A site may have a service worker nested at /folder1/folder2/folder3, while the user is\n              currently on /folder1. The nested service worker does not control /folder1 though. Although\n              the nested service worker can receive push notifications without issue, it cannot perform\n              other SDK operations like checking whether existing tabs are optn eo the site on /folder1\n              (used to prevent opening unnecessary new tabs on notification click.)\n      \n              Because we rely on being able to communicate with the service worker for SDK operations, we\n              only say we're active if the service worker directly controls this page.\n             */\n            return ServiceWorkerActiveState.None;\n        }\n        else if (workerRegistration.installing) {\n            /*\n              Workers that are installing block for a while, since we can't use them until they're done\n              installing.\n             */\n            return ServiceWorkerActiveState.Installing;\n        }\n        else if (!workerRegistration.active) {\n            /*\n              Workers that are waiting won't be our service workers, since we use clients.claim() and\n              skipWaiting() to bypass the install and waiting stages.\n             */\n            return ServiceWorkerActiveState.ThirdParty;\n        }\n        // At this point, there is an active service worker registration controlling this page.\n        // We are now; 1. Getting the filename of the SW; 2. Checking if it is ours or a 3rd parties.\n        const swFileName = ServiceWorkerManager.activeSwFileName(workerRegistration);\n        const workerState = this.swActiveStateByFileName(swFileName);\n        /*\n          Our service worker registration can be both active and in the controlling scope of the current\n          page, but if the page was hard refreshed to bypass the cache (e.g. Ctrl + Shift + R), a\n          service worker will not control the page.\n    \n          For a third-party service worker, if it does not call clients.claim(), even if its\n          registration is both active and in the controlling scope of the current page,\n          navigator.serviceWorker.controller will still be null on the first page visit. So we only\n          check if the controller is null for our worker, which we know uses clients.claim().\n         */\n        if (!navigator.serviceWorker.controller && (workerState === ServiceWorkerActiveState.WorkerA ||\n            workerState === ServiceWorkerActiveState.WorkerB))\n            return ServiceWorkerActiveState.Bypassed;\n        return workerState;\n    }\n    // Get the file name of the active ServiceWorker\n    static activeSwFileName(workerRegistration) {\n        if (!workerRegistration.active)\n            return null;\n        const workerScriptPath = new URL(workerRegistration.active.scriptURL).pathname;\n        const swFileName = new Path(workerScriptPath).getFileName();\n        // If the current service worker is Akamai's\n        if (swFileName == \"akam-sw.js\") {\n            // Check if its importing a ServiceWorker under it's \"othersw\" query param\n            const searchParams = new URLSearchParams(new URL(workerRegistration.active.scriptURL).search);\n            const importedSw = searchParams.get(\"othersw\");\n            if (importedSw) {\n                Log.debug(\"Found a ServiceWorker under Akamai's akam-sw.js?othersw=\", importedSw);\n                return new Path(new URL(importedSw).pathname).getFileName();\n            }\n        }\n        return swFileName;\n    }\n    // Check if the ServiceWorker file name is ours or a third party's\n    swActiveStateByFileName(fileName) {\n        if (!fileName)\n            return ServiceWorkerActiveState.None;\n        if (fileName == this.config.workerAPath.getFileName())\n            return ServiceWorkerActiveState.WorkerA;\n        if (fileName == this.config.workerBPath.getFileName())\n            return ServiceWorkerActiveState.WorkerB;\n        return ServiceWorkerActiveState.ThirdParty;\n    }\n    async getWorkerVersion() {\n        return new Promise(async (resolve) => {\n            if (OneSignalUtils.isUsingSubscriptionWorkaround()) {\n                const proxyFrameHost = OneSignal.proxyFrameHost;\n                if (!proxyFrameHost) {\n                    /* On init, this function may be called. Return a null state for now */\n                    resolve(NaN);\n                }\n                else {\n                    const proxyWorkerVersion = await proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.GET_WORKER_VERSION);\n                    resolve(proxyWorkerVersion);\n                }\n            }\n            else {\n                this.context.workerMessenger.once(WorkerMessengerCommand.WorkerVersion, workerVersion => {\n                    resolve(workerVersion);\n                });\n                this.context.workerMessenger.unicast(WorkerMessengerCommand.WorkerVersion);\n            }\n        });\n    }\n    async shouldInstallWorker() {\n        if (!Environment.supportsServiceWorkers())\n            return false;\n        if (!OneSignal.config)\n            return false;\n        if (OneSignal.config.subdomain) {\n            // No, if configured to use our subdomain (AKA HTTP setup) AND this is on their page (HTTP or HTTPS).\n            // But since safari does not need subscription workaround, installing SW for session tracking.\n            if (OneSignal.environmentInfo.browserType !== \"safari\" &&\n                SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.Host) {\n                return false;\n            }\n        }\n        const workerState = await this.getActiveState();\n        // If there isn't a SW or it isn't OneSignal's only install our SW if notification permissions are enabled\n        // This prevents an unnessary install which saves bandwidth\n        if (workerState === ServiceWorkerActiveState.None || workerState === ServiceWorkerActiveState.ThirdParty) {\n            const permission = await OneSignal.context.permissionManager.getNotificationPermission(OneSignal.config.safariWebId);\n            return permission === \"granted\";\n        }\n        return this.workerNeedsUpdate();\n    }\n    /**\n     * Performs a service worker update by swapping out the current service worker\n     * with a content-identical but differently named alternate service worker\n     * file.\n     */\n    async workerNeedsUpdate() {\n        Log.info(\"[Service Worker Update] Checking service worker version...\");\n        let workerVersion;\n        try {\n            workerVersion = await Utils.timeoutPromise(this.getWorkerVersion(), 2000);\n        }\n        catch (e) {\n            Log.info(\"[Service Worker Update] Worker did not reply to version query; assuming older version and updating.\");\n            return true;\n        }\n        if (workerVersion !== Environment.version()) {\n            Log.info(`[Service Worker Update] Updating service worker from ${workerVersion} --> ${Environment.version()}.`);\n            return true;\n        }\n        Log.info(`[Service Worker Update] Service worker version is current at ${workerVersion} (no update required).`);\n        return false;\n    }\n    /**\n     * Installs a newer version of the OneSignal service worker.\n     *\n     * We have a couple different models of installing service workers:\n     *\n     * a) Originally, we provided users with two worker files:\n     * OneSignalSDKWorker.js and OneSignalSDKUpdaterWorker.js. Two workers were\n     * provided so each could be swapped with the other when the worker needed to\n     * update. The contents of both workers were identical; only the filenames\n     * were different, which is enough to update the worker.\n     *\n     * b) With AMP web push, users are to specify only the first worker file\n     * OneSignalSDKWorker.js, with an app ID parameter ?appId=12345. AMP web push\n     * is vendor agnostic and doesn't know about OneSignal, so all relevant\n     * information has to be passed to the service worker, which is the only\n     * vendor-specific file. So the service worker being installed is always\n     * OneSignalSDKWorker.js?appId=12345 and never OneSignalSDKUpdaterWorker.js.\n     * If AMP web push sees another worker like OneSignalSDKUpdaterWorker.js, or\n     * even the same OneSignalSDKWorker.js without the app ID query parameter, the\n     * user is considered unsubscribed.\n     *\n     * c) Due to b's restriction, we must always install\n     * OneSignalSDKWorker.js?appId=xxx. We also have to appropriately handle\n     * legacy cases:\n     *\n     *    c-1) Where developers have OneSignalSDKWorker.js or\n     *    OneSignalSDKUpdaterWorker.js alternatingly installed\n     *\n     *    c-2) Where developers running progressive web apps force-register\n     *    OneSignalSDKWorker.js\n     *\n     * Actually, users can customize the file names of Worker A / Worker B, but\n     * it's up to them to be consistent with their naming. For AMP web push, users\n     * can specify the full string to expect for the service worker. They can add\n     * additional query parameters, but this must then stay consistent.\n     *\n     * Installation Procedure\n     * ----------------------\n     *\n     * Worker A is always installed. If Worker A is already installed, Worker B is\n     * installed first, and then Worker A is installed again. This is necessary\n     * because AMP web push requires Worker A to be installed for the user to be\n     * considered subscribed.\n     */\n    async installWorker() {\n        if (!await this.shouldInstallWorker()) {\n            return;\n        }\n        const preInstallWorkerState = await this.getActiveState();\n        await this.installAlternatingWorker();\n        await new Promise(async (resolve) => {\n            const postInstallWorkerState = await this.getActiveState();\n            Log.debug(\"installWorker - Comparing pre and post states\", preInstallWorkerState, postInstallWorkerState);\n            if (preInstallWorkerState !== postInstallWorkerState &&\n                postInstallWorkerState !== ServiceWorkerActiveState.Installing) {\n                resolve();\n            }\n            else {\n                Log.debug(\"installWorker - Awaiting on navigator.serviceWorker's 'controllerchange' event\");\n                navigator.serviceWorker.addEventListener('controllerchange', async (e) => {\n                    const postInstallWorkerState = await this.getActiveState();\n                    if (postInstallWorkerState !== preInstallWorkerState &&\n                        postInstallWorkerState !== ServiceWorkerActiveState.Installing) {\n                        resolve();\n                    }\n                    else {\n                        Log.error(\"installWorker - SW's 'controllerchange' fired but no state change!\");\n                    }\n                });\n            }\n        });\n        if ((await this.getActiveState()) === ServiceWorkerActiveState.WorkerB) {\n            // If the worker is Worker B, reinstall Worker A\n            await this.installAlternatingWorker();\n        }\n        await this.establishServiceWorkerChannel();\n    }\n    async establishServiceWorkerChannel() {\n        const workerMessenger = this.context.workerMessenger;\n        workerMessenger.off();\n        workerMessenger.on(WorkerMessengerCommand.NotificationDisplayed, data => {\n            Log.debug(location.origin, 'Received notification display event from service worker.');\n            Event.trigger(OneSignal.EVENTS.NOTIFICATION_DISPLAYED, data);\n        });\n        workerMessenger.on(WorkerMessengerCommand.NotificationClicked, async (data) => {\n            let clickedListenerCallbackCount;\n            if (SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.OneSignalProxyFrame) {\n                clickedListenerCallbackCount = await new Promise(resolve => {\n                    const proxyFrame = OneSignal.proxyFrame;\n                    if (proxyFrame) {\n                        proxyFrame.messenger.message(OneSignal.POSTMAM_COMMANDS.GET_EVENT_LISTENER_COUNT, OneSignal.EVENTS.NOTIFICATION_CLICKED, (reply) => {\n                            let callbackCount = reply.data;\n                            resolve(callbackCount);\n                        });\n                    }\n                });\n            }\n            else\n                clickedListenerCallbackCount = OneSignal.emitter.numberOfListeners(OneSignal.EVENTS.NOTIFICATION_CLICKED);\n            if (clickedListenerCallbackCount === 0) {\n                /*\n                  A site's page can be open but not listening to the\n                  notification.clicked event because it didn't call\n                  addListenerForNotificationOpened(). In this case, if there are no\n                  detected event listeners, we should save the event, instead of firing\n                  it without anybody receiving it.\n        \n                  Or, since addListenerForNotificationOpened() only works once (you have\n                  to call it again each time), maybe it was only called once and the\n                  user isn't receiving the notification.clicked event for subsequent\n                  notifications on the same browser tab.\n        \n                  Example: notificationClickHandlerMatch: 'origin', tab is clicked,\n                           event fires without anybody listening, calling\n                           addListenerForNotificationOpened() returns no results even\n                           though a notification was just clicked.\n                */\n                Log.debug('notification.clicked event received, but no event listeners; storing event in IndexedDb for later retrieval.');\n                /* For empty notifications without a URL, use the current document's URL */\n                let url = data.url;\n                if (!data.url) {\n                    // Least likely to modify, since modifying this property changes the page's URL\n                    url = location.href;\n                }\n                await Database.put('NotificationOpened', { url: url, data: data, timestamp: Date.now() });\n            }\n            else\n                Event.trigger(OneSignal.EVENTS.NOTIFICATION_CLICKED, data);\n        });\n        workerMessenger.on(WorkerMessengerCommand.RedirectPage, data => {\n            Log.debug(`${SdkEnvironment.getWindowEnv().toString()} Picked up command.redirect to ${data}, forwarding to host page.`);\n            const proxyFrame = OneSignal.proxyFrame;\n            if (proxyFrame) {\n                proxyFrame.messenger.message(OneSignal.POSTMAM_COMMANDS.SERVICEWORKER_COMMAND_REDIRECT, data);\n            }\n        });\n        workerMessenger.on(WorkerMessengerCommand.NotificationDismissed, data => {\n            Event.trigger(OneSignal.EVENTS.NOTIFICATION_DISMISSED, data);\n        });\n        const isHttps = OneSignalUtils.isHttps();\n        const isSafari = OneSignalUtils.isSafari();\n        workerMessenger.on(WorkerMessengerCommand.AreYouVisible, (incomingPayload) => {\n            // For https sites in Chrome and Firefox service worker (SW) can get correct value directly.\n            // For Safari, unfortunately, we need this messaging workaround because SW always gets false.\n            if (isHttps && isSafari) {\n                const payload = {\n                    timestamp: incomingPayload.timestamp,\n                    focused: document.hasFocus(),\n                };\n                workerMessenger.directPostMessageToSW(WorkerMessengerCommand.AreYouVisibleResponse, payload);\n            }\n            else {\n                const httpPayload = { timestamp: incomingPayload.timestamp };\n                const proxyFrame = OneSignal.proxyFrame;\n                if (proxyFrame) {\n                    proxyFrame.messenger.message(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_REQUEST, httpPayload);\n                }\n            }\n        });\n    }\n    /**\n     * Installs the OneSignal service worker.\n     *\n     * Depending on the existing worker, the alternate swap worker may be\n     * installed or, for 3rd party workers, the existing worker may be uninstalled\n     * before installing ours.\n     */\n    async installAlternatingWorker() {\n        const workerState = await this.getActiveState();\n        if (workerState === ServiceWorkerActiveState.ThirdParty) {\n            Log.info(`[Service Worker Installation] 3rd party service worker detected.`);\n        }\n        const workerFullPath = ServiceWorkerHelper.getServiceWorkerHref(workerState, this.config);\n        const installUrlQueryParams = Utils.encodeHashAsUriComponent({\n            appId: this.context.appConfig.appId\n        });\n        const fullWorkerPath = `${workerFullPath}?${installUrlQueryParams}`;\n        const scope = `${OneSignalUtils.getBaseUrl()}${this.config.registrationOptions.scope}`;\n        Log.info(`[Service Worker Installation] Installing service worker ${fullWorkerPath} ${scope}.`);\n        try {\n            await navigator.serviceWorker.register(fullWorkerPath, { scope });\n        }\n        catch (error) {\n            Log.error(`[Service Worker Installation] Installing service worker failed ${error}`);\n            // Try accessing the service worker path directly to find out what the problem is and report it to OneSignal api.\n            // If we are inside the popup and service worker fails to register, it's not developer's fault.\n            // No need to report it to the api then.\n            const env = SdkEnvironment.getWindowEnv();\n            if (env === WindowEnvironmentKind.OneSignalSubscriptionPopup)\n                throw error;\n            const response = await fetch(fullWorkerPath);\n            if (response.status === 403 || response.status === 404)\n                throw new ServiceWorkerRegistrationError(response.status, response.statusText);\n            throw error;\n        }\n        Log.debug(`[Service Worker Installation] Service worker installed.`);\n    }\n}\n//# sourceMappingURL=ServiceWorkerManager.js.map","import Event from '../../Event';\nimport EventHelper from '../../helpers/EventHelper';\nimport MainHelper from '../../helpers/MainHelper';\nimport SdkEnvironment from '../../managers/SdkEnvironment';\nimport Postmam from '../../Postmam';\nimport Log from '../../libraries/Log';\n/**\n * Manager for an instance of the OneSignal proxy frame, for use from the main\n * page (not the iFrame itself).\n *\n * This is loaded as subdomain.onesignal.com/webPushIFrame or\n * subdomain.os.tc/webPushIFrame. *\n */\nexport default class SubscriptionPopupHost {\n    /**\n     *\n     * @param origin The URL object describing the origin to load.\n     */\n    constructor(origin, options) {\n        this.url = origin;\n        this.url.pathname = 'subscribe';\n        this.options = options || {};\n    }\n    /**\n     * Opens a new Window to subscribe the user.\n     */\n    load() {\n        // Instead of using URL query parameters, which are confusing and unsightly,\n        // post the data invisible\n        const postData = Object.assign({}, MainHelper.getPromptOptionsPostHash(), {\n            promptType: 'popup',\n            parentHostname: encodeURIComponent(location.hostname)\n        });\n        if (this.options.autoAccept) {\n            postData.autoAccept = true;\n        }\n        Log.info(`Opening a popup to ${this.url.toString()} with POST data:`, postData);\n        this.popupWindow = this.openWindowViaPost(this.url.toString(), postData, null);\n        this.establishCrossOriginMessaging();\n        this.loadPromise = {};\n        this.loadPromise.promise = new Promise((resolve, reject) => {\n            this.loadPromise.resolver = resolve;\n            this.loadPromise.rejector = reject;\n        });\n        // This can throw a TimeoutError, which should go up the stack\n        return this.loadPromise.promise;\n    }\n    // Arguments :\n    //  verb : 'GET'|'POST'\n    //  target : an optional opening target (a name, or \"_blank\"), defaults to \"_self\"\n    openWindowViaPost(url, data, overrides) {\n        var form = document.createElement(\"form\");\n        form.action = url;\n        form.method = 'POST';\n        form.target = \"onesignal-http-popup\";\n        var dualScreenLeft = window.screenLeft != undefined ? window.screenLeft : screen.left;\n        var dualScreenTop = window.screenTop != undefined ? window.screenTop : screen.top;\n        var thisWidth = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;\n        var thisHeight = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;\n        var childWidth = OneSignal._windowWidth;\n        var childHeight = OneSignal._windowHeight;\n        var left = ((thisWidth / 2) - (childWidth / 2)) + dualScreenLeft;\n        var top = ((thisHeight / 2) - (childHeight / 2)) + dualScreenTop;\n        if (overrides) {\n            if (overrides.childWidth) {\n                childWidth = overrides.childWidth;\n            }\n            if (overrides.childHeight) {\n                childHeight = overrides.childHeight;\n            }\n            if (overrides.left) {\n                left = overrides.left;\n            }\n            if (overrides.top) {\n                top = overrides.top;\n            }\n        }\n        const windowRef = window.open('about:blank', \"onesignal-http-popup\", `'scrollbars=yes, width=${childWidth}, height=${childHeight}, top=${top}, left=${left}`);\n        if (data) {\n            for (var key in data) {\n                var input = document.createElement(\"textarea\");\n                input.name = key;\n                input.value = typeof data[key] === \"object\" ? JSON.stringify(data[key]) : data[key];\n                form.appendChild(input);\n            }\n        }\n        form.style.display = 'none';\n        document.body.appendChild(form);\n        form.submit();\n        document.body.removeChild(form);\n        return windowRef;\n    }\n    establishCrossOriginMessaging() {\n        this.messenger = new Postmam(this.popupWindow, this.url.toString(), this.url.toString());\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.POPUP_BEGIN_MESSAGEPORT_COMMS, this.onBeginMessagePortCommunications.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_LOADED, this.onPopupLoaded.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_ACCEPTED, this.onPopupAccepted.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_REJECTED, this.onPopupRejected.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_CLOSING, this.onPopupClosing.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.SET_SESSION_COUNT, this.onSetSessionCount.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.WINDOW_TIMEOUT, this.onWindowTimeout.bind(this));\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.FINISH_REMOTE_REGISTRATION, this.onFinishingRegistrationRemotely.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT, this.onRemoteRetriggerEvent.bind(this));\n        this.messenger.startPostMessageReceive();\n    }\n    dispose() {\n        // Removes all events\n        this.messenger.destroy();\n    }\n    async onBeginMessagePortCommunications(_) {\n        Log.debug(`(${SdkEnvironment.getWindowEnv().toString()}) Successfully established cross-origin messaging with the popup window.`);\n        this.messenger.connect();\n        return false;\n    }\n    async onPopupLoaded(_) {\n        this.loadPromise.resolver();\n        Event.trigger('popupLoad');\n    }\n    async onPopupAccepted(_) {\n        MainHelper.triggerCustomPromptClicked('granted');\n    }\n    async onPopupRejected(_) {\n        MainHelper.triggerCustomPromptClicked('denied');\n    }\n    async onPopupClosing(_) {\n        Log.info('Popup window is closing, running cleanup events.');\n        Event.trigger(OneSignal.EVENTS.POPUP_CLOSING);\n        this.dispose();\n    }\n    async onSetSessionCount(message) {\n        Log.debug(SdkEnvironment.getWindowEnv().toString() + \" Marking current session as a continuing browsing session.\");\n        const { sessionCount } = message.data;\n        const context = OneSignal.context;\n        context.pageViewManager.setPageViewCount(sessionCount);\n    }\n    async onWindowTimeout(_) {\n        Log.debug(SdkEnvironment.getWindowEnv().toString() + \" Popup window timed out and was closed.\");\n        Event.trigger(OneSignal.EVENTS.POPUP_WINDOW_TIMEOUT);\n    }\n    async onFinishingRegistrationRemotely(message) {\n        Log.debug(location.origin, SdkEnvironment.getWindowEnv().toString() + \" Finishing HTTP popup registration inside the iFrame, sent from popup.\");\n        message.reply({ progress: true });\n        const { rawPushSubscription } = message.data;\n        if (this.messenger) {\n            this.messenger.stopPostMessageReceive();\n        }\n        const subscriptionManager = OneSignal.context.subscriptionManager;\n        await subscriptionManager.registerSubscription(rawPushSubscription);\n        await EventHelper.checkAndTriggerSubscriptionChanged();\n        await MainHelper.checkAndTriggerNotificationPermissionChanged();\n    }\n    onRemoteRetriggerEvent(message) {\n        // e.g. { eventName: 'subscriptionChange', eventData: true}\n        let { eventName, eventData } = message.data;\n        Event.trigger(eventName, eventData, message.source);\n        return false;\n    }\n    /**\n     * Shortcut method to messenger.message().\n     */\n    message() {\n        if (this.messenger) {\n            this.messenger.message.apply(this.messenger, arguments);\n        }\n    }\n}\n//# sourceMappingURL=SubscriptionPopupHost.js.map","/**\n * Used for VAPID, converts the VAPID public key into a byte format the browser accepts.\n */\nexport function base64ToUint8Array(base64String) {\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\n    const base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n    const rawData = atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n    for (let i = 0; i < rawData.length; ++i) {\n        outputArray[i] = rawData.charCodeAt(i);\n    }\n    return outputArray;\n}\n/**\n * Used for VAPID, converts a browser-provided ArrayBuffer of the applicationServerKey back to its string form.\n */\nexport function arrayBufferToBase64(arrayBuffer) {\n    var base64 = '';\n    var encodings = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n    var bytes = new Uint8Array(arrayBuffer);\n    var byteLength = bytes.byteLength;\n    var byteRemainder = byteLength % 3;\n    var mainLength = byteLength - byteRemainder;\n    var a, b, c, d;\n    var chunk;\n    // Main loop deals with bytes in chunks of 3\n    for (var i = 0; i < mainLength; i = i + 3) {\n        // Combine the three bytes into a single integer\n        chunk = (bytes[i] << 16) | (bytes[i + 1] << 8) | bytes[i + 2];\n        // Use bitmasks to extract 6-bit segments from the triplet\n        a = (chunk & 16515072) >> 18; // 16515072 = (2^6 - 1) << 18\n        b = (chunk & 258048) >> 12; // 258048   = (2^6 - 1) << 12\n        c = (chunk & 4032) >> 6; // 4032     = (2^6 - 1) << 6\n        d = chunk & 63; // 63       = 2^6 - 1\n        // Convert the raw binary segments to the appropriate ASCII encoding\n        base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d];\n    }\n    // Deal with the remaining bytes and padding\n    if (byteRemainder == 1) {\n        chunk = bytes[mainLength];\n        a = (chunk & 252) >> 2; // 252 = (2^6 - 1) << 2\n        // Set the 4 least significant bits to zero\n        b = (chunk & 3) << 4; // 3   = 2^2 - 1\n        base64 += encodings[a] + encodings[b] + '==';\n    }\n    else if (byteRemainder == 2) {\n        chunk = (bytes[mainLength] << 8) | bytes[mainLength + 1];\n        a = (chunk & 64512) >> 10; // 64512 = (2^6 - 1) << 10\n        b = (chunk & 1008) >> 4; // 1008  = (2^6 - 1) << 4\n        // Set the 2 least significant bits to zero\n        c = (chunk & 15) << 2; // 15    = 2^4 - 1\n        base64 += encodings[a] + encodings[b] + encodings[c] + '=';\n    }\n    return base64;\n}\n/**\n * From: https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\n */\nexport function base64Encode(str) {\n    // first we use encodeURIComponent to get percent-encoded UTF-8,\n    // then we convert the percent encodings into raw bytes which\n    // can be fed into btoa.\n    return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function toSolidBytes(match, p1) {\n        return String.fromCharCode('0x' + p1);\n    }));\n}\nexport function base64Decode(str) {\n    // Going backwards: from bytestream, to percent-encoding, to original string.\n    return decodeURIComponent(atob(str).split('').map(function (c) {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n    }).join(''));\n}\n//# sourceMappingURL=Encoding.js.map","import bowser from 'bowser';\nimport Event from '../Event';\nimport LimitStore from '../LimitStore';\nimport { NotificationPermission } from '../models/NotificationPermission';\nimport SdkEnvironment from '../managers/SdkEnvironment';\nimport { WindowEnvironmentKind } from '../models/WindowEnvironmentKind';\nimport SubscriptionModalHost from '../modules/frames/SubscriptionModalHost';\nimport Database from '../services/Database';\nimport { getConsoleStyle, once, triggerNotificationPermissionChanged } from '../utils';\nimport MainHelper from './MainHelper';\nimport SubscriptionHelper from './SubscriptionHelper';\nimport { SdkInitError, SdkInitErrorKind } from '../errors/SdkInitError';\nimport OneSignalApiShared from '../OneSignalApiShared';\nimport { WorkerMessengerCommand } from '../libraries/WorkerMessenger';\nimport { DynamicResourceLoader } from '../services/DynamicResourceLoader';\nimport { EmailDeviceRecord } from '../models/EmailDeviceRecord';\nimport { IntegrationKind } from '../models/IntegrationKind';\nimport { Subscription } from \"../models/Subscription\";\nimport Log from '../libraries/Log';\nimport Environment from '../Environment';\nimport Bell from '../bell/Bell';\nimport { CustomLink } from '../CustomLink';\nimport { ServiceWorkerManager } from \"../managers/ServiceWorkerManager\";\nimport SubscriptionPopupHost from \"../modules/frames/SubscriptionPopupHost\";\nimport { OneSignalUtils } from \"../utils/OneSignalUtils\";\nimport { DeprecatedApiError, DeprecatedApiReason } from \"../errors/DeprecatedApiError\";\nimport LocalStorage from '../utils/LocalStorage';\nexport default class InitHelper {\n    /** Main methods */\n    static async internalInit() {\n        Log.debug('Called %cinternalInit()', getConsoleStyle('code'));\n        // Always check for an updated service worker\n        await OneSignal.context.serviceWorkerManager.installWorker();\n        const sessionManager = OneSignal.context.sessionManager;\n        OneSignal.emitter.on(OneSignal.EVENTS.SESSION_STARTED, sessionManager.sendOnSessionUpdateFromPage.bind(sessionManager));\n        OneSignal.context.pageViewManager.incrementPageViewCount();\n        if (document.visibilityState !== 'visible') {\n            InitHelper.postponeSessionInitUntilPageIsInFocus();\n            return;\n        }\n        await InitHelper.sessionInit();\n    }\n    static postponeSessionInitUntilPageIsInFocus() {\n        once(document, 'visibilitychange', (_, destroyEventListener) => {\n            if (document.visibilityState === 'visible') {\n                destroyEventListener();\n                InitHelper.sessionInit();\n            }\n        }, true);\n    }\n    static async sessionInit() {\n        Log.debug(`Called %csessionInit()`, getConsoleStyle('code'));\n        if (OneSignal._sessionInitAlreadyRunning) {\n            Log.debug('Returning from sessionInit because it has already been called.');\n            return;\n        }\n        OneSignal._sessionInitAlreadyRunning = true;\n        try {\n            await InitHelper.doInitialize();\n        }\n        catch (err) {\n            if (err instanceof SdkInitError) {\n                return;\n            }\n            throw err;\n        }\n        /**\n         * We don't want to resubscribe if the user is opted out, and we can't check on HTTP, because the promise will\n         * prevent the popup from opening.\n         */\n        const isOptedOut = await OneSignal.internalIsOptedOut();\n        // saves isOptedOut to localStorage. used for require user interaction functionality\n        LocalStorage.setIsOptedOut(!!isOptedOut);\n        /**\n         * Auto-resubscribe is working only on HTTPS (and in safari)\n         * Should be called before autoprompting to make sure user gets a chance to be re-subscribed first.\n         */\n        if (!OneSignalUtils.isUsingSubscriptionWorkaround()) {\n            await InitHelper.handleAutoResubscribe(isOptedOut);\n        }\n        const isSubscribed = await OneSignal.privateIsPushNotificationsEnabled();\n        // saves isSubscribed to localStorage. used for require user interaction functionality\n        LocalStorage.setIsPushNotificationsEnabled(!!isSubscribed);\n        if (OneSignal.config.userConfig.promptOptions.autoPrompt && !isOptedOut && !isSubscribed) {\n            /*\n            * Chrome 63 on Android permission prompts are permanent without a dismiss option. To avoid\n            * permanent blocks, we want to replace sites automatically showing the native browser request\n            * with a slide prompt first.\n            * Same for Safari 12.1+ & Firefox 72+. It requires user interaction to request notification permissions.\n            * It simply wouldn't work to try to show native prompt from script.\n            */\n            const { environmentInfo } = OneSignal;\n            const { browserType, browserVersion, requiresUserInteraction } = environmentInfo;\n            const forceSlidedownOverNative = ((browserType === \"chrome\" && Number(browserVersion) >= 63 && (bowser.tablet || bowser.mobile)) ||\n                requiresUserInteraction);\n            const categoryOptions = OneSignal.context.appConfig.userConfig.promptOptions.slidedown.categories;\n            await OneSignal.context.promptsManager.internalShowAutoPrompt({\n                forceSlidedownOverNative,\n                categoryOptions\n            });\n        }\n        OneSignal._sessionInitAlreadyRunning = false;\n        await Event.trigger(OneSignal.EVENTS.SDK_INITIALIZED);\n    }\n    static async registerForPushNotifications(options = {}) {\n        if (options && options.modalPrompt) {\n            /* Show the HTTPS fullscreen modal permission message. */\n            OneSignal.subscriptionModalHost = new SubscriptionModalHost(OneSignal.config.appId, options);\n            await OneSignal.subscriptionModalHost.load();\n            return;\n        }\n        if (OneSignalUtils.isUsingSubscriptionWorkaround()) {\n            if (options.httpPermissionRequest) {\n                /*\n                 * Do not throw an error because it may cause the parent event handler to\n                 * throw and stop processing the rest of their code. Typically, for this\n                 * prompt sequence, a custom modal is being shown thanking the user for\n                 * granting permissions. Throwing an error might cause the modal to stay\n                 * on screen and not close.\n                 *\n                 * Only log an error for HTTP sites. A few HTTPS sites are mistakenly be\n                 * using this API instead of the parameter-less version to register for\n                 * push notifications.\n                 */\n                Log.error(new DeprecatedApiError(DeprecatedApiReason.HttpPermissionRequest));\n                return;\n            }\n            await InitHelper.loadSubscriptionPopup(options);\n            return;\n        }\n        /*\n         * We don't want to resubscribe if the user is opted out, and we can't check on HTTP, because the promise will\n         * prevent the popup from opening.\n         */\n        const isOptedOut = LocalStorage.getIsOptedOut();\n        if (!isOptedOut) {\n            await SubscriptionHelper.registerForPush();\n        }\n    }\n    /**\n     * This event occurs after init.\n     * For HTTPS sites, this event is called after init.\n     * For HTTP sites, this event is called after the iFrame is created,\n     *    and a message is received from the iFrame signaling cross-origin messaging is ready.\n     * @private\n     */\n    static async onSdkInitialized() {\n        const wasUserResubscribed = await InitHelper.processExpiringSubscriptions();\n        /**\n         * If user's subscription was expiring and we processed it, our backend would get a player#create request.\n         * If user was not subscribed before and autoPrompting is on, user would get subscribed through player#create if\n         *  he clicks allow in an automatic prompt.\n         * If user has granted notification permissions but cleared the data and autoResubscribe is on, we will\n         *  resubscribe with autoResubscribe flag.\n         * In all other cases we would send an on_session request.\n         */\n        const isExistingUser = await OneSignal.context.subscriptionManager.isAlreadyRegisteredWithOneSignal();\n        if (isExistingUser) {\n            OneSignal.context.sessionManager.setupSessionEventListeners();\n            if (!wasUserResubscribed) {\n                await OneSignal.context.updateManager.sendOnSessionUpdate();\n            }\n        }\n        else if (!OneSignal.config.userConfig.promptOptions.autoPrompt &&\n            !OneSignal.config.userConfig.autoResubscribe) {\n            await OneSignal.context.updateManager.sendOnSessionUpdate();\n        }\n        await Event.trigger(OneSignal.EVENTS.SDK_INITIALIZED_PUBLIC);\n    }\n    static async loadSubscriptionPopup(options) {\n        /**\n         * Users may be subscribed to either .onesignal.com or .os.tc. By this time\n         * that they are subscribing to the popup, the Proxy Frame has already been\n         * loaded and the user's subscription status has been obtained. We can then\n         * use the Proxy Frame present now and check its URL to see whether the user\n         * is finally subscribed to .onesignal.com or .os.tc.\n         */\n        OneSignal.subscriptionPopupHost = new SubscriptionPopupHost(OneSignal.proxyFrameHost.url, options);\n        await OneSignal.subscriptionPopupHost.load();\n    }\n    /** Helper methods */\n    static async storeInitialValues() {\n        const isPushEnabled = await OneSignal.privateIsPushNotificationsEnabled();\n        const notificationPermission = await OneSignal.privateGetNotificationPermission();\n        const isOptedOut = await OneSignal.internalIsOptedOut();\n        LimitStore.put('subscription.optedOut', isOptedOut);\n        await Database.put('Options', { key: 'isPushEnabled', value: isPushEnabled });\n        await Database.put('Options', {\n            key: 'notificationPermission',\n            value: notificationPermission\n        });\n    }\n    static async setWelcomeNotificationFlag() {\n        /*\n         * If the user has already granted permission, the user has previously\n         * already subscribed. Don't show welcome notifications if the user is\n         * automatically resubscribed.\n         */\n        const permission = await OneSignal.context.permissionManager.getNotificationPermission(OneSignal.context.appConfig.safariWebId);\n        if (permission === NotificationPermission.Granted) {\n            OneSignal.__doNotShowWelcomeNotification = true;\n        }\n    }\n    static async establishServiceWorkerChannel() {\n        if (navigator.serviceWorker &&\n            window.location.protocol === 'https:' &&\n            !await SdkEnvironment.isFrameContextInsecure()) {\n            try {\n                const registration = await ServiceWorkerManager.getRegistration();\n                if (registration && registration.active) {\n                    await OneSignal.context.serviceWorkerManager.establishServiceWorkerChannel();\n                }\n            }\n            catch (e) {\n                Log.error(e);\n            }\n        }\n    }\n    /** Entry method for any environment that sets expiring subscriptions. */\n    static async processExpiringSubscriptions() {\n        const context = OneSignal.context;\n        Log.debug(\"Checking subscription expiration...\");\n        const isSubscriptionExpiring = await context.subscriptionManager.isSubscriptionExpiring();\n        if (!isSubscriptionExpiring) {\n            Log.debug(\"Subscription is not considered expired.\");\n            return false;\n        }\n        const integrationKind = await SdkEnvironment.getIntegration();\n        const windowEnv = SdkEnvironment.getWindowEnv();\n        Log.debug(\"Subscription is considered expiring. Current Integration:\", integrationKind);\n        switch (integrationKind) {\n            /*\n              Resubscribe via the service worker.\n      \n              For Secure, we can definitely resubscribe via the current page, but for SecureProxy, we\n              used to not be able to subscribe for push within secure child frames. The common supported\n              and safe way is to resubscribe via the service worker.\n             */\n            case IntegrationKind.Secure:\n                const rawPushSubscription = await context.subscriptionManager.subscribe(1 /* SubscribeNew */);\n                await context.subscriptionManager.registerSubscription(rawPushSubscription);\n                break;\n            case IntegrationKind.SecureProxy:\n                if (windowEnv === WindowEnvironmentKind.OneSignalProxyFrame) {\n                    await this.registerSubscriptionInProxyFrame(context);\n                }\n                else {\n                    const proxyFrame = OneSignal.proxyFrameHost;\n                    await proxyFrame.runCommand(OneSignal.POSTMAM_COMMANDS.PROCESS_EXPIRING_SUBSCRIPTIONS);\n                }\n                break;\n            case IntegrationKind.InsecureProxy:\n                /*\n                  We can't really do anything here except remove a value checked by\n                  isPushNotificationsEnabled to simulate unsubscribing.\n                 */\n                await Database.remove(\"Ids\", \"registrationId\");\n                Log.debug(\"Unsubscribed expiring HTTP subscription by removing registration ID.\");\n                break;\n        }\n        return true;\n    }\n    static async registerSubscriptionInProxyFrame(context) {\n        const newSubscription = await new Promise(resolve => {\n            context.workerMessenger.once(WorkerMessengerCommand.SubscribeNew, subscription => {\n                resolve(Subscription.deserialize(subscription));\n            });\n            context.workerMessenger.unicast(WorkerMessengerCommand.SubscribeNew, context.appConfig);\n        });\n        Log.debug(\"Finished registering brand new subscription:\", newSubscription);\n        return newSubscription;\n    }\n    static async doInitialize() {\n        const promises = [];\n        // Store initial values of notification permission, user ID, and manual subscription status\n        // This is done so that the values can be later compared to see if anything changed\n        // This is done here for HTTPS, it is done after the call to _addSessionIframe in sessionInit for HTTP sites,\n        // since the iframe is needed for communication\n        promises.push(InitHelper.storeInitialValues());\n        promises.push(InitHelper.installNativePromptPermissionChangedHook());\n        promises.push(InitHelper.setWelcomeNotificationFlag());\n        promises.push(InitHelper.establishServiceWorkerChannel());\n        promises.push(InitHelper.showNotifyButton());\n        promises.push(InitHelper.showPromptsFromWebConfigEditor());\n        try {\n            await Promise.all(promises);\n        }\n        catch (e) {\n            Log.error(e);\n            throw new SdkInitError(SdkInitErrorKind.Unknown);\n        }\n    }\n    static async showNotifyButton() {\n        if (Environment.isBrowser() && !OneSignal.notifyButton) {\n            OneSignal.config.userConfig.notifyButton = OneSignal.config.userConfig.notifyButton || {};\n            if (OneSignal.config.userConfig.bell) {\n                // If both bell and notifyButton, notifyButton's options take precedence\n                OneSignal.config.userConfig.bell = Object.assign({}, OneSignal.config.userConfig.bell, OneSignal.config.userConfig.notifyButton);\n                OneSignal.config.userConfig.notifyButton = Object.assign({}, OneSignal.config.userConfig.notifyButton, OneSignal.config.userConfig.bell);\n            }\n            const displayPredicate = OneSignal.config.userConfig.notifyButton.displayPredicate;\n            if (displayPredicate && typeof displayPredicate === 'function') {\n                OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED, async () => {\n                    const predicateValue = await Promise.resolve(OneSignal.config.userConfig.notifyButton.displayPredicate());\n                    if (predicateValue !== false) {\n                        OneSignal.notifyButton = new Bell(OneSignal.config.userConfig.notifyButton);\n                        OneSignal.notifyButton.create();\n                    }\n                    else {\n                        Log.debug('Notify button display predicate returned false so not showing the notify button.');\n                    }\n                });\n            }\n            else {\n                OneSignal.notifyButton = new Bell(OneSignal.config.userConfig.notifyButton);\n                OneSignal.notifyButton.create();\n            }\n        }\n    }\n    static async updateEmailSessionCount() {\n        const context = OneSignal.context;\n        /* Both HTTP and HTTPS pages can update email session by API request without origin/push feature restrictions */\n        if (context.pageViewManager.isFirstPageView()) {\n            const emailProfile = await Database.getEmailProfile();\n            if (emailProfile.emailId) {\n                const emailDeviceRecord = new EmailDeviceRecord(emailProfile.emailAddress, emailProfile.identifierAuthHash);\n                emailDeviceRecord.appId = context.appConfig.appId;\n                await OneSignalApiShared.updateUserSession(emailProfile.emailId, emailDeviceRecord);\n            }\n        }\n    }\n    static async showPromptsFromWebConfigEditor() {\n        const config = OneSignal.config;\n        if (config.userConfig.promptOptions) {\n            await CustomLink.initialize(config.userConfig.promptOptions.customlink);\n        }\n    }\n    static async installNativePromptPermissionChangedHook() {\n        if (navigator.permissions && !(bowser.firefox && Number(bowser.version) <= 45)) {\n            OneSignal._usingNativePermissionHook = true;\n            // If the browser natively supports hooking the subscription prompt permission change event,\n            // use it instead of our SDK method\n            const permissionStatus = await navigator.permissions.query({ name: 'notifications' });\n            permissionStatus.onchange = function () {\n                triggerNotificationPermissionChanged();\n            };\n        }\n    }\n    static async saveInitOptions() {\n        let opPromises = [];\n        const persistNotification = OneSignal.config.userConfig.persistNotification;\n        opPromises.push(Database.put('Options', {\n            key: 'persistNotification',\n            value: persistNotification != null ? persistNotification : true\n        }));\n        let webhookOptions = OneSignal.config.userConfig.webhooks;\n        ['notification.displayed', 'notification.clicked', 'notification.dismissed'].forEach(event => {\n            if (webhookOptions && webhookOptions[event]) {\n                opPromises.push(Database.put('Options', { key: `webhooks.${event}`, value: webhookOptions[event] }));\n            }\n            else {\n                opPromises.push(Database.put('Options', { key: `webhooks.${event}`, value: false }));\n            }\n        });\n        if (webhookOptions && webhookOptions.cors) {\n            opPromises.push(Database.put('Options', { key: `webhooks.cors`, value: true }));\n        }\n        else {\n            opPromises.push(Database.put('Options', { key: `webhooks.cors`, value: false }));\n        }\n        if (OneSignal.config.userConfig.notificationClickHandlerMatch) {\n            opPromises.push(Database.put('Options', {\n                key: 'notificationClickHandlerMatch',\n                value: OneSignal.config.userConfig.notificationClickHandlerMatch\n            }));\n        }\n        else {\n            opPromises.push(Database.put('Options', { key: 'notificationClickHandlerMatch', value: 'exact' }));\n        }\n        if (OneSignal.config.userConfig.notificationClickHandlerAction) {\n            opPromises.push(Database.put('Options', {\n                key: 'notificationClickHandlerAction',\n                value: OneSignal.config.userConfig.notificationClickHandlerAction\n            }));\n        }\n        else {\n            opPromises.push(Database.put('Options', { key: 'notificationClickHandlerAction', value: 'navigate' }));\n        }\n        return Promise.all(opPromises);\n    }\n    static async initSaveState(overridingPageTitle) {\n        const appId = await MainHelper.getAppId();\n        const config = OneSignal.config;\n        await Database.put('Ids', { type: 'appId', id: appId });\n        const pageTitle = overridingPageTitle || config.siteName || document.title || 'Notification';\n        await Database.put('Options', { key: 'pageTitle', value: pageTitle });\n        Log.info(`OneSignal: Set pageTitle to be '${pageTitle}'.`);\n    }\n    static async handleAutoResubscribe(isOptedOut) {\n        Log.info(\"handleAutoResubscribe\", { autoResubscribe: OneSignal.config.userConfig.autoResubscribe, isOptedOut });\n        if (OneSignal.config.userConfig.autoResubscribe && !isOptedOut) {\n            const currentPermission = await OneSignal.context.permissionManager.getNotificationPermission(OneSignal.context.appConfig.safariWebId);\n            if (currentPermission == NotificationPermission.Granted) {\n                await SubscriptionHelper.registerForPush();\n            }\n        }\n    }\n    static async polyfillSafariFetch() {\n        // If Safari - add 'fetch' pollyfill if it isn't already added.\n        if (bowser.safari && typeof window.fetch == 'undefined') {\n            Log.debug('Loading fetch polyfill for Safari..');\n            try {\n                await new DynamicResourceLoader().loadFetchPolyfill();\n                Log.debug('Done loading fetch polyfill.');\n            }\n            catch (e) {\n                Log.debug('Error loading fetch polyfill:', e);\n            }\n        }\n    }\n    static errorIfInitAlreadyCalled() {\n        if (OneSignal._initCalled)\n            throw new SdkInitError(SdkInitErrorKind.MultipleInitialization);\n        OneSignal._initCalled = true;\n    }\n}\n//# sourceMappingURL=InitHelper.js.map","import SdkEnvironment from '../managers/SdkEnvironment';\nimport Database from '../services/Database';\nimport TimedLocalStorage from '../modules/TimedLocalStorage';\nimport Log from '../libraries/Log';\nimport { isUsingSubscriptionWorkaround } from '../utils';\nexport default class TestHelper {\n    /**\n     * Creates an expiring local storage entry to note that the user does not want to be disturbed.\n     */\n    static async markHttpsNativePromptDismissed() {\n        /**\n         * Note: LocalStorage is set both on subdomain.onesignal.com and the main site.\n         *\n         * When checking whether the prompt was previously dismissed, certain code cannot be\n         * asynchronous otherwise the browser treats it like a blocked popup, so LocalStorage is\n         * synchronous while IndexedDb access / PostMessage querying across origins are both\n         * asynchronous.\n         */\n        if (isUsingSubscriptionWorkaround()) {\n            try {\n                await new Promise((resolve, reject) => {\n                    OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.MARK_PROMPT_DISMISSED, {}, reply => {\n                        if (reply.data === OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE) {\n                            resolve();\n                        }\n                        else {\n                            reject();\n                        }\n                    });\n                });\n            }\n            catch (e) {\n                Log.debug(\"Proxy Frame possibly didn't not receive MARK_PROMPT_DISMISSED message\", e || \"\");\n            }\n        }\n        let dismissCount = await Database.get('Options', 'promptDismissCount');\n        if (!dismissCount) {\n            dismissCount = 0;\n        }\n        /**\n         * This will be run twice for HTTP sites, since we share IndexedDb, so we don't run it for HTTP sites.\n         */\n        if (!isUsingSubscriptionWorkaround()) {\n            dismissCount += 1;\n        }\n        let dismissDays = 3;\n        if (dismissCount == 2) {\n            dismissDays = 7;\n        }\n        else if (dismissCount > 2) {\n            dismissDays = 30;\n        }\n        Log.debug(`(${SdkEnvironment.getWindowEnv().toString()}) OneSignal: User dismissed the native notification prompt; reprompt after ${dismissDays} days.`);\n        await Database.put('Options', { key: 'promptDismissCount', value: dismissCount });\n        const dismissMinutes = dismissDays * 24 * 60;\n        return TimedLocalStorage.setItem('onesignal-notification-prompt', 'dismissed', dismissMinutes);\n    }\n}\n//# sourceMappingURL=TestHelper.js.map","import SdkEnvironment from \"../managers/SdkEnvironment\";\nimport { WindowEnvironmentKind } from \"../models/WindowEnvironmentKind\";\nimport Log from \"../libraries/Log\";\nimport LocalStorage from '../utils/LocalStorage';\nexport class PageViewManager {\n    constructor() {\n        this.incrementedPageViewCount = false;\n    }\n    getPageViewCount() {\n        try {\n            /*\n              sessionStorage may be supported by the browser but may not be available\n              as an API in incognito mode and in cases where the user disables\n              third-party cookies on some browsers.\n             */\n            const pageViewCountStr = sessionStorage.getItem(PageViewManager.SESSION_STORAGE_KEY_NAME);\n            const pageViewCount = pageViewCountStr ? parseInt(pageViewCountStr) : 0;\n            if (isNaN(pageViewCount)) {\n                return 0;\n            }\n            else {\n                return pageViewCount;\n            }\n        }\n        catch (e) {\n            /*\n              If we're in incognito mode or sessionStorage is otherwise unsupported,\n              pretend we're starting our first session.\n             */\n            return 0;\n        }\n    }\n    setPageViewCount(sessionCount) {\n        try {\n            sessionStorage.setItem(PageViewManager.SESSION_STORAGE_KEY_NAME, sessionCount.toString());\n            if (SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.OneSignalSubscriptionPopup) {\n                // If we're setting sessionStorage and we're in an Popup, we need to also set sessionStorage on the\n                // main page\n                if (OneSignal.subscriptionPopup) {\n                    OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.SET_SESSION_COUNT);\n                }\n            }\n        }\n        catch (e) {\n            /*\n              If sessionStorage isn't available, don't error.\n             */\n        }\n    }\n    /**\n     * Increments:\n     *    - session pageView count AND\n     *    - total pageView count\n     *\n     * at most once for the current page view.\n     *\n     * A flag is set to prevent incrementing the session count more than once for\n     * the current page view. If the page is refreshed, this in-memory variable\n     * will be automatically reset. Because of this, regardless of the number of\n     * times this method is called on the current page view, the page view count\n     * will only be incremented once.\n     *\n     * LocalStorage pageView count added for use in Delayed Prompts feature. This\n     * pageView count persists even past sessions since it is saved to local stor-\n     * age (as opposed to Session Storage which persists only for that tab)\n     */\n    incrementPageViewCount() {\n        if (this.incrementedPageViewCount) {\n            // For this method, we don't want to increment the session count more than\n            // once per pageview\n            return;\n        }\n        const newCountSingleTab = this.getPageViewCount() + 1;\n        const newCountAcrossTabs = this.getLocalPageViewCount() + 1;\n        this.setPageViewCount(newCountSingleTab);\n        this.setLocalPageViewCount(newCountAcrossTabs);\n        this.incrementedPageViewCount = true;\n        Log.debug(`Incremented page view count: newCountSingleTab: ${newCountSingleTab},\n      newCountAccrossTabs: ${newCountAcrossTabs}.`);\n    }\n    simulatePageNavigationOrRefresh() {\n        this.incrementedPageViewCount = false;\n    }\n    /**\n     * Returns true if this page is running OneSignal for the first time and has\n     * not been navigated or refreshed.\n     */\n    isFirstPageView() {\n        return this.getPageViewCount() === 1;\n    }\n    /**\n     * Returns Page Views saved to Local Storage (Persists Longer than Single Session)\n     */\n    getLocalPageViewCount() {\n        return LocalStorage.getLocalPageViewCount();\n    }\n    /**\n     * Sets Page Views to Local Storage\n     */\n    setLocalPageViewCount(count) {\n        LocalStorage.setLocalPageViewCount(count);\n    }\n}\nPageViewManager.SESSION_STORAGE_KEY_NAME = \"onesignal-pageview-count\";\n//# sourceMappingURL=PageViewManager.js.map","import bowser from \"bowser\";\nimport Database from \"../services/Database\";\nimport OneSignalApiShared from \"../OneSignalApiShared\";\nimport { ServiceWorkerManager } from \"./ServiceWorkerManager\";\nimport Environment from \"../Environment\";\nimport Event from \"../Event\";\nimport Log from \"../libraries/Log\";\nimport { ServiceWorkerActiveState } from \"../helpers/ServiceWorkerHelper\";\nimport SdkEnvironment from \"../managers/SdkEnvironment\";\nimport { NotificationPermission } from \"../models/NotificationPermission\";\nimport { RawPushSubscription } from \"../models/RawPushSubscription\";\nimport { SubscriptionStateKind } from \"../models/SubscriptionStateKind\";\nimport { WindowEnvironmentKind } from \"../models/WindowEnvironmentKind\";\nimport { PushDeviceRecord } from \"../models/PushDeviceRecord\";\nimport { IntegrationKind } from \"../models/IntegrationKind\";\nimport { InvalidStateError, InvalidStateReason } from \"../errors/InvalidStateError\";\nimport PushPermissionNotGrantedError from \"../errors/PushPermissionNotGrantedError\";\nimport { PushPermissionNotGrantedErrorReason } from \"../errors/PushPermissionNotGrantedError\";\nimport { SdkInitError, SdkInitErrorKind } from \"../errors/SdkInitError\";\nimport SubscriptionError from \"../errors/SubscriptionError\";\nimport { SubscriptionErrorReason } from \"../errors/SubscriptionError\";\nimport ServiceWorkerRegistrationError from \"../errors/ServiceWorkerRegistrationError\";\nimport NotImplementedError from \"../errors/NotImplementedError\";\nimport { PermissionUtils } from \"../utils/PermissionUtils\";\nimport { base64ToUint8Array } from \"../utils/Encoding\";\nexport class SubscriptionManager {\n    constructor(context, config) {\n        this.context = context;\n        this.config = config;\n    }\n    static isSafari() {\n        return Environment.isSafari();\n    }\n    /**\n     * Subscribes for a web push subscription.\n     *\n     * This method is aware of different subscription environments like subscribing from a webpage,\n     * service worker, or OneSignal HTTP popup and will select the correct method. This is intended to\n     * be the single public API for obtaining a raw web push subscription (i.e. what the browser\n     * returns from a successful subscription).\n     */\n    async subscribe(subscriptionStrategy) {\n        const env = SdkEnvironment.getWindowEnv();\n        switch (env) {\n            case WindowEnvironmentKind.CustomIframe:\n            case WindowEnvironmentKind.Unknown:\n            case WindowEnvironmentKind.OneSignalProxyFrame:\n                throw new InvalidStateError(InvalidStateReason.UnsupportedEnvironment);\n        }\n        let rawPushSubscription;\n        switch (env) {\n            case WindowEnvironmentKind.ServiceWorker:\n                rawPushSubscription = await this.subscribeFcmFromWorker(subscriptionStrategy);\n                break;\n            case WindowEnvironmentKind.Host:\n            case WindowEnvironmentKind.OneSignalSubscriptionModal:\n            case WindowEnvironmentKind.OneSignalSubscriptionPopup:\n                /*\n                  Check our notification permission before subscribing.\n        \n                  - If notifications are blocked, we can't subscribe.\n                  - If notifications are granted, the user should be completely resubscribed.\n                  - If notifications permissions are untouched, the user will be prompted and then\n                    subscribed.\n        \n                  Subscribing is only possible on the top-level frame, so there's no permission ambiguity\n                  here.\n                */\n                if ((await OneSignal.privateGetNotificationPermission()) === NotificationPermission.Denied)\n                    throw new PushPermissionNotGrantedError(PushPermissionNotGrantedErrorReason.Blocked);\n                if (SubscriptionManager.isSafari()) {\n                    rawPushSubscription = await this.subscribeSafari();\n                    /* Now that permissions have been granted, install the service worker */\n                    Log.info(\"Installing SW on Safari\");\n                    try {\n                        await this.context.serviceWorkerManager.installWorker();\n                        Log.info(\"SW on Safari successfully installed\");\n                    }\n                    catch (e) {\n                        Log.error(\"SW on Safari failed to install.\");\n                    }\n                }\n                else {\n                    rawPushSubscription = await this.subscribeFcmFromPage(subscriptionStrategy);\n                }\n                break;\n            default:\n                throw new InvalidStateError(InvalidStateReason.UnsupportedEnvironment);\n        }\n        return rawPushSubscription;\n    }\n    /**\n     * Creates a device record from the provided raw push subscription and forwards this device record\n     * to OneSignal to create or update the device ID.\n     *\n     * @param rawPushSubscription The raw push subscription obtained from calling subscribe(). This\n     * can be null, in which case OneSignal's device record is set to unsubscribed.\n     *\n     * @param subscriptionState Describes whether the device record is subscribed, unsubscribed, or in\n     * another state. By default, this is set from the availability of rawPushSubscription (exists:\n     * Subscribed, null: Unsubscribed). Other use cases may result in creation of a device record that\n     * warrants a special subscription state. For example, a device ID can be retrieved by providing\n     * an identifier, and a new device record will be created if the identifier didn't exist. These\n     * records are marked with a special subscription state for tracking purposes.\n     */\n    async registerSubscription(pushSubscription, subscriptionState) {\n        /*\n          This may be called after the RawPushSubscription has been serialized across a postMessage\n          frame. This means it will only have object properties and none of the functions. We have to\n          recreate the RawPushSubscription.\n    \n          Keep in mind pushSubscription can be null in cases where resubscription isn't possible\n          (blocked permission).\n        */\n        if (pushSubscription) {\n            pushSubscription = RawPushSubscription.deserialize(pushSubscription);\n        }\n        const deviceRecord = PushDeviceRecord.createFromPushSubscription(this.config.appId, pushSubscription, subscriptionState);\n        let newDeviceId = undefined;\n        if (await this.isAlreadyRegisteredWithOneSignal()) {\n            await this.context.updateManager.sendPlayerUpdate(deviceRecord);\n        }\n        else {\n            newDeviceId = await this.context.updateManager.sendPlayerCreate(deviceRecord);\n            if (newDeviceId) {\n                await this.associateSubscriptionWithEmail(newDeviceId);\n            }\n        }\n        const subscription = await Database.getSubscription();\n        subscription.deviceId = newDeviceId;\n        subscription.optedOut = false;\n        if (pushSubscription) {\n            if (SubscriptionManager.isSafari()) {\n                subscription.subscriptionToken = pushSubscription.safariDeviceToken;\n            }\n            else {\n                subscription.subscriptionToken = pushSubscription.w3cEndpoint ? pushSubscription.w3cEndpoint.toString() : null;\n            }\n        }\n        else {\n            subscription.subscriptionToken = null;\n        }\n        await Database.setSubscription(subscription);\n        if (SdkEnvironment.getWindowEnv() !== WindowEnvironmentKind.ServiceWorker) {\n            Event.trigger(OneSignal.EVENTS.REGISTERED);\n        }\n        if (typeof OneSignal !== \"undefined\") {\n            OneSignal._sessionInitAlreadyRunning = false;\n        }\n        return subscription;\n    }\n    /**\n     * Used before subscribing for push, we request notification permissions\n     * before installing the service worker to prevent non-subscribers from\n     * querying our server for an updated service worker every 24 hours.\n     */\n    static async requestPresubscribeNotificationPermission() {\n        return await SubscriptionManager.requestNotificationPermission();\n    }\n    async unsubscribe(strategy) {\n        if (strategy === 0 /* DestroySubscription */) {\n            throw new NotImplementedError();\n        }\n        else if (strategy === 1 /* MarkUnsubscribed */) {\n            if (SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.ServiceWorker) {\n                const { deviceId } = await Database.getSubscription();\n                await OneSignalApiShared.updatePlayer(this.context.appConfig.appId, deviceId, {\n                    notification_types: SubscriptionStateKind.MutedByApi\n                });\n                await Database.put('Options', { key: 'optedOut', value: true });\n            }\n            else {\n                throw new NotImplementedError();\n            }\n        }\n        else {\n            throw new NotImplementedError();\n        }\n    }\n    /**\n     * Calls Notification.requestPermission(), but returns a Promise instead of\n     * accepting a callback like the actual Notification.requestPermission();\n     *\n     * window.Notification.requestPermission: The callback was deprecated since Gecko 46 in favor of a Promise\n     */\n    static async requestNotificationPermission() {\n        const results = await window.Notification.requestPermission();\n        // TODO: Clean up our custom NotificationPermission enum\n        //         in favor of TS union type NotificationPermission instead of converting\n        return NotificationPermission[results];\n    }\n    /**\n     * Called after registering a subscription with OneSignal to associate this subscription with an\n     * email record if one exists.\n     */\n    async associateSubscriptionWithEmail(newDeviceId) {\n        const emailProfile = await Database.getEmailProfile();\n        if (!emailProfile.emailId) {\n            return;\n        }\n        // Update the push device record with a reference to the new email ID and email address\n        await OneSignalApiShared.updatePlayer(this.config.appId, newDeviceId, {\n            parent_player_id: emailProfile.emailId,\n            email: emailProfile.emailAddress\n        });\n    }\n    async isAlreadyRegisteredWithOneSignal() {\n        const { deviceId } = await Database.getSubscription();\n        return !!deviceId;\n    }\n    subscribeSafariPromptPermission() {\n        return new Promise(resolve => {\n            window.safari.pushNotification.requestPermission(`${SdkEnvironment.getOneSignalApiUrl().toString()}/safari`, this.config.safariWebId, {\n                app_id: this.config.appId\n            }, response => {\n                if (response.deviceToken) {\n                    resolve(response.deviceToken.toLowerCase());\n                }\n                else {\n                    resolve(null);\n                }\n            });\n        });\n    }\n    async subscribeSafari() {\n        const pushSubscriptionDetails = new RawPushSubscription();\n        if (!this.config.safariWebId) {\n            throw new SdkInitError(SdkInitErrorKind.MissingSafariWebId);\n        }\n        const { deviceToken: existingDeviceToken } = window.safari.pushNotification.permission(this.config.safariWebId);\n        pushSubscriptionDetails.existingSafariDeviceToken = existingDeviceToken;\n        if (!existingDeviceToken) {\n            /*\n              We're about to show the Safari native permission request. It can fail for a number of\n              reasons, e.g.:\n                - Setup-related reasons when developers just starting to get set up\n                  - Address bar URL doesn't match safari certificate allowed origins (case-sensitive)\n                  - Safari web ID doesn't match provided web ID\n                  - Browsing in a Safari private window\n                  - Bad icon DPI\n      \n              but shouldn't fail for sites that have already gotten Safari working.\n      \n              We'll show the permissionPromptDisplay event if the Safari user isn't already subscribed,\n              otherwise an already subscribed Safari user would not see the permission request again.\n             */\n            Event.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);\n        }\n        const deviceToken = await this.subscribeSafariPromptPermission();\n        PermissionUtils.triggerNotificationPermissionChanged();\n        if (deviceToken) {\n            pushSubscriptionDetails.setFromSafariSubscription(deviceToken);\n        }\n        else {\n            throw new SubscriptionError(SubscriptionErrorReason.InvalidSafariSetup);\n        }\n        return pushSubscriptionDetails;\n    }\n    async subscribeFcmFromPage(subscriptionStrategy) {\n        /*\n          Before installing the service worker, request notification permissions. If\n          the visitor doesn't grant permissions, this saves bandwidth bleeding from\n          an unused install service worker periodically fetching an updated version\n          from our CDN.\n        */\n        /*\n          Trigger the permissionPromptDisplay event to the best of our knowledge.\n        */\n        if (SdkEnvironment.getWindowEnv() !== WindowEnvironmentKind.ServiceWorker &&\n            window.Notification.permission === NotificationPermission.Default) {\n            await Event.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);\n            const permission = await SubscriptionManager.requestPresubscribeNotificationPermission();\n            /*\n              Notification permission changes are already broadcast by the page's\n              notificationpermissionchange handler. This means that allowing or\n              denying the permission prompt will cause double events. However, the\n              native event handler does not broadcast an event for dismissing the\n              prompt, because going from \"default\" permissions to \"default\"\n              permissions isn't a change. We specifically broadcast \"default\" to \"default\" changes.\n             */\n            if (permission === NotificationPermission.Default)\n                await PermissionUtils.triggerNotificationPermissionChanged(true);\n            // If the user did not grant push permissions, throw and exit\n            switch (permission) {\n                case NotificationPermission.Default:\n                    Log.debug('Exiting subscription and not registering worker because the permission was dismissed.');\n                    OneSignal._sessionInitAlreadyRunning = false;\n                    OneSignal._isRegisteringForPush = false;\n                    throw new PushPermissionNotGrantedError(PushPermissionNotGrantedErrorReason.Dismissed);\n                case NotificationPermission.Denied:\n                    Log.debug('Exiting subscription and not registering worker because the permission was blocked.');\n                    OneSignal._sessionInitAlreadyRunning = false;\n                    OneSignal._isRegisteringForPush = false;\n                    throw new PushPermissionNotGrantedError(PushPermissionNotGrantedErrorReason.Blocked);\n            }\n        }\n        /* Now that permissions have been granted, install the service worker */\n        try {\n            await this.context.serviceWorkerManager.installWorker();\n        }\n        catch (err) {\n            if (err instanceof ServiceWorkerRegistrationError) {\n                if (err.status === 403) {\n                    await this.context.subscriptionManager.registerFailedSubscription(SubscriptionStateKind.ServiceWorkerStatus403, this.context);\n                }\n                else if (err.status === 404) {\n                    await this.context.subscriptionManager.registerFailedSubscription(SubscriptionStateKind.ServiceWorkerStatus404, this.context);\n                }\n            }\n            throw err;\n        }\n        Log.debug('Waiting for the service worker to activate...');\n        const workerRegistration = await navigator.serviceWorker.ready;\n        Log.debug('Service worker is ready to continue subscribing.');\n        return await this.subscribeWithVapidKey(workerRegistration.pushManager, subscriptionStrategy);\n    }\n    async subscribeFcmFromWorker(subscriptionStrategy) {\n        /*\n          We're running inside of the service worker.\n    \n          Check to make sure our registration is activated, otherwise we can't\n          subscribe for push.\n    \n          HACK: Firefox doesn't set self.registration.active in the service worker\n          context. From a non-service worker context, like\n          navigator.serviceWorker.getRegistration().active, the property actually is\n          set, but it's just not set within the service worker context.\n    \n          Because of this, we're not able to check for this property on Firefox.\n         */\n        const swRegistration = self.registration;\n        if (!swRegistration.active && !bowser.firefox) {\n            throw new InvalidStateError(InvalidStateReason.ServiceWorkerNotActivated);\n            /*\n              Or should we wait for the service worker to be ready?\n      \n              await new Promise(resolve => self.onactivate = resolve);\n             */\n        }\n        /*\n          Check to make sure push permissions have been granted.\n         */\n        const pushPermission = await swRegistration.pushManager.permissionState({ userVisibleOnly: true });\n        if (pushPermission === 'denied') {\n            throw new PushPermissionNotGrantedError(PushPermissionNotGrantedErrorReason.Blocked);\n        }\n        else if (pushPermission === 'prompt') {\n            throw new PushPermissionNotGrantedError(PushPermissionNotGrantedErrorReason.Default);\n        }\n        return await this.subscribeWithVapidKey(swRegistration.pushManager, subscriptionStrategy);\n    }\n    /**\n     * Returns the correct VAPID key to use for subscription based on the browser type.\n     *\n     * If the VAPID key isn't present, undefined is returned instead of null.\n     */\n    getVapidKeyForBrowser() {\n        // Specifically return undefined instead of null if the key isn't available\n        let key = undefined;\n        if (bowser.firefox) {\n            /*\n              Firefox uses VAPID for application identification instead of\n              authentication, and so all apps share an identification key.\n             */\n            key = this.config.onesignalVapidPublicKey;\n        }\n        else {\n            /*\n              Chrome and Chrome-like browsers including Opera and Yandex use VAPID for\n              authentication, and so each app uses a uniquely generated key.\n             */\n            key = this.config.vapidPublicKey;\n        }\n        if (key) {\n            return base64ToUint8Array(key).buffer;\n        }\n        else {\n            return undefined;\n        }\n    }\n    /**\n     * Uses the browser's PushManager interface to actually subscribe for a web push subscription.\n     *\n     * @param pushManager An instance of the browser's push manager, either from the page or from the\n     * service worker.\n     *\n     * @param subscriptionStrategy Given an existing push subscription, describes whether the existing\n     * push subscription is resubscribed as-is leaving it unchanged, or unsubscribed to make room for\n     * a new push subscription.\n     */\n    async subscribeWithVapidKey(pushManager, subscriptionStrategy) {\n        /*\n          Always try subscribing using VAPID by providing an applicationServerKey, except for cases\n          where the user is already subscribed, handled below.\n         */\n        const existingPushSubscription = await pushManager.getSubscription();\n        /* Depending on the subscription strategy, handle existing subscription in various ways */\n        switch (subscriptionStrategy) {\n            case 0 /* ResubscribeExisting */:\n                if (!existingPushSubscription)\n                    break;\n                if (existingPushSubscription.options) {\n                    Log.debug(\"[Subscription Manager] An existing push subscription exists and it's options is not null.\");\n                }\n                else {\n                    Log.debug('[Subscription Manager] An existing push subscription exists and options is null. ' +\n                        'Unsubscribing from push first now.');\n                    /*\n                      NOTE: Only applies to rare edge case of migrating from senderId to a VAPID subscription\n                      There isn't a great solution if PushSubscriptionOptions (supported on Chrome 54+) isn't\n                      supported.\n          \n                      We want to subscribe the user, but we don't know whether the user was subscribed via\n                      GCM's manifest.json or FCM's VAPID.\n          \n                      This bug (https://bugs.chromium.org/p/chromium/issues/detail?id=692577) shows that a\n                      mismatched sender ID error is possible if you subscribe via FCM's VAPID while the user\n                      was originally subscribed via GCM's manifest.json (fails silently).\n          \n                      Because of this, we should unsubscribe the user from push first and then resubscribe\n                      them.\n                    */\n                    /* We're unsubscribing, so we want to store the created at timestamp */\n                    await SubscriptionManager.doPushUnsubscribe(existingPushSubscription);\n                }\n                break;\n            case 1 /* SubscribeNew */:\n                /* Since we want a new subscription every time with this strategy, just unsubscribe. */\n                if (existingPushSubscription) {\n                    await SubscriptionManager.doPushUnsubscribe(existingPushSubscription);\n                }\n                break;\n        }\n        // Actually subscribe the user to push\n        const [newPushSubscription, isNewSubscription] = await SubscriptionManager.doPushSubscribe(pushManager, this.getVapidKeyForBrowser());\n        // Update saved create and expired times\n        await SubscriptionManager.updateSubscriptionTime(isNewSubscription, newPushSubscription.expirationTime);\n        // Create our own custom object from the browser's native PushSubscription object\n        const pushSubscriptionDetails = RawPushSubscription.setFromW3cSubscription(newPushSubscription);\n        if (existingPushSubscription) {\n            pushSubscriptionDetails.existingW3cPushSubscription =\n                RawPushSubscription.setFromW3cSubscription(existingPushSubscription);\n        }\n        return pushSubscriptionDetails;\n    }\n    static async updateSubscriptionTime(updateCreatedAt, expirationTime) {\n        const bundle = await Database.getSubscription();\n        if (updateCreatedAt) {\n            bundle.createdAt = new Date().getTime();\n        }\n        bundle.expirationTime = expirationTime;\n        await Database.setSubscription(bundle);\n    }\n    static async doPushUnsubscribe(pushSubscription) {\n        Log.debug('[Subscription Manager] Unsubscribing existing push subscription.');\n        const result = await pushSubscription.unsubscribe();\n        Log.debug(`[Subscription Manager] Unsubscribing existing push subscription result: ${result}`);\n        return result;\n    }\n    // Subscribes the ServiceWorker for a pushToken.\n    // If there is an error doing so unsubscribe from existing and try again\n    //    - This handles subscribing to new server VAPID key if it has changed.\n    // return type - [PushSubscription, createdNewPushSubscription(boolean)]\n    static async doPushSubscribe(pushManager, applicationServerKey) {\n        if (!applicationServerKey) {\n            throw new Error(\"Missing required 'applicationServerKey' to subscribe for push notifications!\");\n        }\n        const subscriptionOptions = {\n            userVisibleOnly: true,\n            applicationServerKey: applicationServerKey\n        };\n        Log.debug('[Subscription Manager] Subscribing to web push with these options:', subscriptionOptions);\n        try {\n            const existingSubscription = await pushManager.getSubscription();\n            return [await pushManager.subscribe(subscriptionOptions), !existingSubscription];\n        }\n        catch (e) {\n            if (e.name == \"InvalidStateError\") {\n                // This exception is thrown if the key for the existing applicationServerKey is different,\n                //    so we must unregister first.\n                // In Chrome, e.message contains will be the following in this case for reference;\n                // Registration failed - A subscription with a different applicationServerKey (or gcm_sender_id) already exists;\n                //    to change the applicationServerKey, unsubscribe then resubscribe.\n                Log.warn(\"[Subscription Manager] Couldn't re-subscribe due to applicationServerKey changing, \" +\n                    \"unsubscribe and attempting to subscribe with new key.\", e);\n                const subscription = await pushManager.getSubscription();\n                if (subscription) {\n                    await SubscriptionManager.doPushUnsubscribe(subscription);\n                }\n                return [await pushManager.subscribe(subscriptionOptions), true];\n            }\n            else\n                throw e; // If some other error, bubble the exception up\n        }\n    }\n    async isSubscriptionExpiring() {\n        const integrationKind = await SdkEnvironment.getIntegration();\n        const windowEnv = SdkEnvironment.getWindowEnv();\n        switch (integrationKind) {\n            case IntegrationKind.Secure:\n                return await this.isSubscriptionExpiringForSecureIntegration();\n            case IntegrationKind.SecureProxy:\n                if (windowEnv === WindowEnvironmentKind.Host) {\n                    const proxyFrameHost = OneSignal.proxyFrameHost;\n                    if (!proxyFrameHost) {\n                        throw new InvalidStateError(InvalidStateReason.NoProxyFrame);\n                    }\n                    else {\n                        return await proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.SUBSCRIPTION_EXPIRATION_STATE);\n                    }\n                }\n                else {\n                    return await this.isSubscriptionExpiringForSecureIntegration();\n                }\n            case IntegrationKind.InsecureProxy:\n                /* If we're in an insecure frame context, check the stored expiration since we can't access\n                the actual push subscription. */\n                const { expirationTime } = await Database.getSubscription();\n                if (!expirationTime) {\n                    /* If an existing subscription does not have a stored expiration time, do not\n                    treat it as expired. The subscription may have been created before this feature was added,\n                    or the browser may not assign any expiration time. */\n                    return false;\n                }\n                /* The current time (in UTC) is past the expiration time (also in UTC) */\n                return new Date().getTime() >= expirationTime;\n        }\n    }\n    async isSubscriptionExpiringForSecureIntegration() {\n        const serviceWorkerState = await this.context.serviceWorkerManager.getActiveState();\n        if (!(serviceWorkerState === ServiceWorkerActiveState.WorkerA ||\n            serviceWorkerState === ServiceWorkerActiveState.WorkerB)) {\n            /* If the service worker isn't activated, there's no subscription to look for */\n            return false;\n        }\n        const serviceWorkerRegistration = await ServiceWorkerManager.getRegistration();\n        if (!serviceWorkerRegistration)\n            return false;\n        // It's possible to get here in Safari 11.1+ version\n        //   since they released support for service workers but not push api.\n        if (!serviceWorkerRegistration.pushManager)\n            return false;\n        const pushSubscription = await serviceWorkerRegistration.pushManager.getSubscription();\n        // Not subscribed to web push\n        if (!pushSubscription)\n            return false;\n        // No push subscription expiration time\n        if (!pushSubscription.expirationTime)\n            return false;\n        let { createdAt: subscriptionCreatedAt } = await Database.getSubscription();\n        if (!subscriptionCreatedAt) {\n            /* If we don't have a record of when the subscription was created, set it into the future to\n            guarantee expiration and obtain a new subscription */\n            const ONE_YEAR = 1000 * 60 * 60 * 24 * 365;\n            subscriptionCreatedAt = new Date().getTime() + ONE_YEAR;\n        }\n        const midpointExpirationTime = subscriptionCreatedAt + ((pushSubscription.expirationTime - subscriptionCreatedAt) / 2);\n        return !!pushSubscription.expirationTime && (\n        /* The current time (in UTC) is past the expiration time (also in UTC) */\n        new Date().getTime() >= pushSubscription.expirationTime ||\n            new Date().getTime() >= midpointExpirationTime);\n    }\n    /**\n     * Returns an object describing the user's actual push subscription state and opt-out status.\n     */\n    async getSubscriptionState() {\n        /* Safari should always return Secure because HTTP doesn't apply on Safari */\n        if (SubscriptionManager.isSafari()) {\n            return this.getSubscriptionStateForSecure();\n        }\n        const windowEnv = SdkEnvironment.getWindowEnv();\n        switch (windowEnv) {\n            case WindowEnvironmentKind.ServiceWorker:\n                const pushSubscription = await self.registration.pushManager.getSubscription();\n                const { optedOut } = await Database.getSubscription();\n                return {\n                    subscribed: !!pushSubscription,\n                    optedOut: !!optedOut\n                };\n            default:\n                /* Regular browser window environments */\n                const integration = await SdkEnvironment.getIntegration();\n                switch (integration) {\n                    case IntegrationKind.Secure:\n                        return this.getSubscriptionStateForSecure();\n                    case IntegrationKind.SecureProxy:\n                        switch (windowEnv) {\n                            case WindowEnvironmentKind.OneSignalProxyFrame:\n                            case WindowEnvironmentKind.OneSignalSubscriptionPopup:\n                            case WindowEnvironmentKind.OneSignalSubscriptionModal:\n                                return this.getSubscriptionStateForSecure();\n                            default:\n                                /* Re-run this command in the proxy frame */\n                                const proxyFrameHost = OneSignal.proxyFrameHost;\n                                const pushSubscriptionState = await proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.GET_SUBSCRIPTION_STATE);\n                                return pushSubscriptionState;\n                        }\n                    case IntegrationKind.InsecureProxy:\n                        return await this.getSubscriptionStateForInsecure();\n                    default:\n                        throw new InvalidStateError(InvalidStateReason.UnsupportedEnvironment);\n                }\n        }\n    }\n    async getSubscriptionStateForSecure() {\n        const { deviceId, optedOut } = await Database.getSubscription();\n        if (SubscriptionManager.isSafari()) {\n            const subscriptionState = window.safari.pushNotification.permission(this.config.safariWebId);\n            const isSubscribedToSafari = !!(subscriptionState.permission === \"granted\" &&\n                subscriptionState.deviceToken &&\n                deviceId);\n            return {\n                subscribed: isSubscribedToSafari,\n                optedOut: !!optedOut,\n            };\n        }\n        const workerState = await this.context.serviceWorkerManager.getActiveState();\n        const workerRegistration = await ServiceWorkerManager.getRegistration();\n        const notificationPermission = await this.context.permissionManager.getNotificationPermission(this.context.appConfig.safariWebId);\n        const isWorkerActive = (workerState === ServiceWorkerActiveState.WorkerA ||\n            workerState === ServiceWorkerActiveState.WorkerB);\n        if (!workerRegistration) {\n            /* You can't be subscribed without a service worker registration */\n            return {\n                subscribed: false,\n                optedOut: !!optedOut,\n            };\n        }\n        /*\n         * Removing pushSubscription from this method due to inconsistent behavior between browsers.\n         * Doesn't matter for re-subscribing, worker is present and active.\n         * Previous implementation for reference:\n         * const pushSubscription = await workerRegistration.pushManager.getSubscription();\n         * const isPushEnabled = !!(\n         *   pushSubscription &&\n         *   deviceId &&\n         *   notificationPermission === NotificationPermission.Granted &&\n         *   isWorkerActive\n         * );\n         */\n        const isPushEnabled = !!(deviceId &&\n            notificationPermission === NotificationPermission.Granted &&\n            isWorkerActive);\n        return {\n            subscribed: isPushEnabled,\n            optedOut: !!optedOut,\n        };\n    }\n    async getSubscriptionStateForInsecure() {\n        /* For HTTP, we need to rely on stored values; we never have access to the actual data */\n        const { deviceId, subscriptionToken, optedOut } = await Database.getSubscription();\n        const notificationPermission = await this.context.permissionManager.getNotificationPermission(this.context.appConfig.safariWebId);\n        const isPushEnabled = !!(deviceId &&\n            subscriptionToken &&\n            notificationPermission === NotificationPermission.Granted);\n        return {\n            subscribed: isPushEnabled,\n            optedOut: !!optedOut,\n        };\n    }\n    /**\n     * Broadcasting to the server the fact user tried to subscribe but there was an error during service worker registration.\n     * Do it only once for the first page view.\n     * @param subscriptionState Describes what went wrong with the service worker installation.\n     */\n    async registerFailedSubscription(subscriptionState, context) {\n        if (context.pageViewManager.isFirstPageView()) {\n            context.subscriptionManager.registerSubscription(new RawPushSubscription(), subscriptionState);\n            context.pageViewManager.incrementPageViewCount();\n        }\n    }\n}\n//# sourceMappingURL=SubscriptionManager.js.map","import { ServiceWorkerManager } from '../managers/ServiceWorkerManager';\nimport { SubscriptionManager } from '../managers/SubscriptionManager';\nimport Path from '../models/Path';\nimport SdkEnvironment from '../managers/SdkEnvironment';\nexport class ContextHelper {\n    static getServiceWorkerManager(context) {\n        const config = context.appConfig;\n        const envPrefix = SdkEnvironment.getBuildEnvPrefix();\n        const serviceWorkerManagerConfig = {\n            workerAPath: new Path(`/${envPrefix}OneSignalSDKWorker.js`),\n            workerBPath: new Path(`/${envPrefix}OneSignalSDKUpdaterWorker.js`),\n            registrationOptions: { scope: '/' }\n        };\n        if (config.userConfig) {\n            if (config.userConfig.path) {\n                serviceWorkerManagerConfig.workerAPath =\n                    new Path(`${config.userConfig.path}${envPrefix}${config.userConfig.serviceWorkerPath}`);\n                serviceWorkerManagerConfig.workerBPath =\n                    new Path(`${config.userConfig.path}${envPrefix}${config.userConfig.serviceWorkerUpdaterPath}`);\n            }\n            if (config.userConfig.serviceWorkerParam) {\n                serviceWorkerManagerConfig.registrationOptions = config.userConfig.serviceWorkerParam;\n            }\n        }\n        return new ServiceWorkerManager(context, serviceWorkerManagerConfig);\n    }\n    static getSubscriptionManager(context) {\n        const config = context.appConfig;\n        const subscriptionManagerConfig = {\n            safariWebId: config.safariWebId,\n            appId: config.appId,\n            vapidPublicKey: config.vapidPublicKey,\n            onesignalVapidPublicKey: config.onesignalVapidPublicKey,\n        };\n        return new SubscriptionManager(context, subscriptionManagerConfig);\n    }\n}\nexport default ContextHelper;\n//# sourceMappingURL=ContextHelper.js.map","import OneSignalApiShared from \"../OneSignalApiShared\";\nimport { SubscriptionStateKind } from '../models/SubscriptionStateKind';\nimport { NotSubscribedError, NotSubscribedReason } from \"../errors/NotSubscribedError\";\nimport MainHelper from '../helpers/MainHelper';\nimport Database from \"../services/Database\";\nimport Log from \"../libraries/Log\";\nimport Utils from \"../context/shared/utils/Utils\";\nimport { SessionOrigin } from \"../models/Session\";\nimport { logMethodCall } from '../utils';\nexport class UpdateManager {\n    constructor(context) {\n        this.context = context;\n        this.onSessionSent = context.pageViewManager.getPageViewCount() > 1;\n    }\n    async getDeviceId() {\n        const { deviceId } = await Database.getSubscription();\n        if (!deviceId) {\n            throw new NotSubscribedError(NotSubscribedReason.NoDeviceId);\n        }\n        return deviceId;\n    }\n    async createDeviceRecord() {\n        return MainHelper.createDeviceRecord(this.context.appConfig.appId);\n    }\n    async sendPlayerUpdate(deviceRecord) {\n        const existingUser = await this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal();\n        if (!existingUser) {\n            Log.debug(\"Not sending the update because user is not registered with OneSignal (no device id)\");\n            return;\n        }\n        const deviceId = await this.getDeviceId();\n        if (!deviceRecord) {\n            deviceRecord = await this.createDeviceRecord();\n        }\n        if (this.onSessionSent) {\n            await OneSignalApiShared.updatePlayer(this.context.appConfig.appId, deviceId, Object.assign({ notification_types: SubscriptionStateKind.Subscribed }, deviceRecord.serialize()));\n        }\n        else {\n            await this.sendOnSessionUpdate(deviceRecord);\n        }\n    }\n    // If user has been subscribed before, send the on_session update to our backend on the first page view.\n    async sendOnSessionUpdate(deviceRecord) {\n        if (this.onSessionSent) {\n            return;\n        }\n        if (!this.context.pageViewManager.isFirstPageView()) {\n            return;\n        }\n        const existingUser = await this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal();\n        if (!existingUser) {\n            Log.debug(\"Not sending the on session because user is not registered with OneSignal (no device id)\");\n            return;\n        }\n        const deviceId = await this.getDeviceId();\n        if (!deviceRecord) {\n            deviceRecord = await this.createDeviceRecord();\n        }\n        if (deviceRecord.subscriptionState !== SubscriptionStateKind.Subscribed &&\n            OneSignal.config.enableOnSession !== true) {\n            return;\n        }\n        try {\n            // Not sending on_session here but from SW instead.\n            // Not awaiting here on purpose\n            this.context.sessionManager.upsertSession(deviceId, deviceRecord, SessionOrigin.PlayerOnSession);\n            this.onSessionSent = true;\n        }\n        catch (e) {\n            Log.error(`Failed to update user session. Error \"${e.message}\" ${e.stack}`);\n        }\n    }\n    async sendPlayerCreate(deviceRecord) {\n        try {\n            const deviceId = await OneSignalApiShared.createUser(deviceRecord);\n            if (deviceId) {\n                Log.info(\"Subscribed to web push and registered with OneSignal\", deviceRecord, deviceId);\n                this.onSessionSent = true;\n                // Not awaiting here on purpose\n                this.context.sessionManager.upsertSession(deviceId, deviceRecord, SessionOrigin.PlayerCreate);\n                return deviceId;\n            }\n            Log.error(`Failed to create user.`);\n            return undefined;\n        }\n        catch (e) {\n            Log.error(`Failed to create user. Error \"${e.message}\" ${e.stack}`);\n            return undefined;\n        }\n    }\n    onSessionAlreadyCalled() {\n        return this.onSessionSent;\n    }\n    async sendExternalUserIdUpdate(externalUserId, authHash) {\n        const deviceId = await this.getDeviceId();\n        if (!authHash) {\n            authHash = await Database.getExternalUserIdAuthHash();\n        }\n        const payload = {\n            external_user_id: Utils.getValueOrDefault(externalUserId, \"\"),\n            external_user_id_auth_hash: Utils.getValueOrDefault(authHash, undefined)\n        };\n        return await OneSignalApiShared.updatePlayer(this.context.appConfig.appId, deviceId, payload);\n    }\n    async sendOutcomeDirect(appId, notificationIds, outcomeName, value) {\n        logMethodCall(\"sendOutcomeDirect\");\n        const deviceRecord = await this.createDeviceRecord();\n        const outcomeRequestData = {\n            app_id: appId,\n            id: outcomeName,\n            device_type: deviceRecord.deliveryPlatform,\n            notification_ids: notificationIds,\n            direct: true,\n        };\n        if (value !== undefined) {\n            outcomeRequestData.weight = value;\n        }\n        await OneSignalApiShared.sendOutcome(outcomeRequestData);\n    }\n    async sendOutcomeInfluenced(appId, notificationIds, outcomeName, value) {\n        logMethodCall(\"sendOutcomeInfluenced\");\n        const deviceRecord = await this.createDeviceRecord();\n        const outcomeRequestData = {\n            app_id: appId,\n            id: outcomeName,\n            device_type: deviceRecord.deliveryPlatform,\n            notification_ids: notificationIds,\n            direct: false,\n        };\n        if (value !== undefined) {\n            outcomeRequestData.weight = value;\n        }\n        await OneSignalApiShared.sendOutcome(outcomeRequestData);\n    }\n    async sendOutcomeUnattributed(appId, outcomeName, value) {\n        logMethodCall(\"sendOutcomeUnattributed\");\n        const deviceRecord = await this.createDeviceRecord();\n        const outcomeRequestData = {\n            app_id: appId,\n            id: outcomeName,\n            device_type: deviceRecord.deliveryPlatform,\n        };\n        if (value !== undefined) {\n            outcomeRequestData.weight = value;\n        }\n        await OneSignalApiShared.sendOutcome(outcomeRequestData);\n    }\n}\n//# sourceMappingURL=UpdateManager.js.map","import OneSignalError from './OneSignalError';\nexport default class AlreadySubscribedError extends OneSignalError {\n    constructor() {\n        super('This operation can only be performed when the user is not subscribed.');\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, AlreadySubscribedError.prototype);\n    }\n}\n//# sourceMappingURL=AlreadySubscribedError.js.map","import OneSignalError from \"./OneSignalError\";\nexport default class PermissionMessageDismissedError extends OneSignalError {\n    constructor() {\n        super('The permission message was previously dismissed.');\n        /**\n         * Important! Required to make sure the correct error type is detected during instanceof checks.\n         * Same applies to all derived classes.\n         * https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n         */\n        Object.setPrototypeOf(this, PermissionMessageDismissedError.prototype);\n    }\n}\n//# sourceMappingURL=PermissionMessageDismissedError.js.map","export function getLoadingIndicatorWithColor(color) {\n    return `<svg viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid\" width=\"24px\" height=\"24px\" fill=\"${color}\"> <g transform=\"rotate(0 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" begin=\"-0.916s\" repeatCount=\"indefinite\"/> </rect> </g> <g transform=\"rotate(30 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" begin=\"-0.833s\" repeatCount=\"indefinite\"/> </rect> </g> <g transform=\"rotate(60 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" begin=\"-0.75s\" repeatCount=\"indefinite\"/> </rect> </g> <g transform=\"rotate(90 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" repeatCount=\"indefinite\" begin=\"-0.666s\"/> </rect> </g> <g transform=\"rotate(120 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" repeatCount=\"indefinite\" begin=\"-0.583s\"/> </rect> </g> <g transform=\"rotate(150 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" repeatCount=\"indefinite\" begin=\"-0.5s\"/> </rect> </g> <g transform=\"rotate(180 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" repeatCount=\"indefinite\" begin=\"-0.416s\"/> </rect> </g> <g transform=\"rotate(210 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" repeatCount=\"indefinite\" begin=\"-0.333s\"/> </rect> </g> <g transform=\"rotate(240 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" repeatCount=\"indefinite\" begin=\"-0.25s\"/> </rect> </g> <g transform=\"rotate(270 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" repeatCount=\"indefinite\" begin=\"-0.166s\"/> </rect> </g> <g transform=\"rotate(300 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" repeatCount=\"indefinite\" begin=\"-0.083s\"/> </rect> </g> <g transform=\"rotate(330 50 50)\"> <rect x=\"46\" y=\"6\" rx=\"36.8\" ry=\"4.8\" width=\"8\" height=\"24\" > <animate attributeName=\"opacity\" values=\"1;0\" keyTimes=\"0;1\" dur=\"1s\" repeatCount=\"indefinite\" begin=\"0s\"/> </rect> </g> </svg>`;\n}\n//# sourceMappingURL=LoadingIndicator.js.map","export const SLIDEDOWN_CSS_CLASSES = {\n    allowButton: \"onesignal-slidedown-allow-button\",\n    body: \"slidedown-body\",\n    buttonIndicatorHolder: \"onesignal-button-indicator-holder\",\n    cancelButton: \"onesignal-slidedown-cancel-button\",\n    container: \"onesignal-slidedown-container\",\n    dialog: \"onesignal-slidedown-dialog\",\n    footer: \"slidedown-footer\",\n    reset: \"onesignal-reset\",\n    savingStateButton: \"onesignal-saving-state-button\",\n    slideUp: 'slide-up',\n    slideDown: 'slide-down',\n    closeSlidedown: 'close-slidedown',\n    icon: 'slidedown-body-icon',\n    message: 'slidedown-body-message',\n    defaultIcon: 'default-icon',\n    loadingContainer: \"onesignal-loading-container\",\n    clearfix: \"clearfix\"\n};\nexport const SLIDEDOWN_CSS_IDS = {\n    allowButton: \"onesignal-slidedown-allow-button\",\n    body: \"slidedown-body\",\n    buttonIndicatorHolder: \"onesignal-button-indicator-holder\",\n    cancelButton: \"onesignal-slidedown-cancel-button\",\n    container: \"onesignal-slidedown-container\",\n    dialog: \"onesignal-slidedown-dialog\",\n    footer: \"slidedown-footer\",\n    normalSlidedown: \"normal-slidedown\",\n    loadingContainer: \"onesignal-loading-container\",\n};\nexport const SLIDEDOWN_BUTTON_CLASSES = {\n    alignRight: 'align-right',\n    primary: 'primary',\n    secondary: 'secondary',\n    slidedownButton: 'slidedown-button'\n};\nexport const TAGGING_CONTAINER_CSS_CLASSES = {\n    categoryLabelInput: \"onesignal-category-label-input\",\n    categoryLabelText: \"onesignal-category-label-text\",\n    categoryLabel: \"onesignal-category-label\",\n    checkmark: \"onesignal-checkmark\",\n    taggingContainer: \"tagging-container\",\n    taggingContainerCol: \"tagging-container-col\",\n    loadingMessage: \"onesignal-loading-message\"\n};\nexport const TAGGING_CONTAINER_CSS_IDS = {\n    taggingContainer: \"tagging-container\",\n};\nexport const DEFAULT_ICON = `data:image/svg+xml,%3Csvg fill='none' xmlns='http://www.w3.org/2000/svg'` +\n    ` viewBox='0 0 40 40'%3E%3Cg clip-path='url(%23clip0)'%3E%3Cpath fill-rule='evenodd'` +\n    ` clip-rule='evenodd' d='M33.232 28.434a2.5 2.5 0 001.768.733 1.667 1.667 0 010 ` +\n    `3.333H5a1.667 1.667 0 110-3.333 2.5 2.5 0 002.5-2.5v-8.104A13.262 13.262 0 0118.333` +\n    ` 5.122V1.667a1.666 1.666 0 113.334 0v3.455A13.262 13.262 0 0132.5 18.563v8.104a2.5` +\n    ` 2.5 0 00.732 1.767zM16.273 35h7.454a.413.413 0 01.413.37 4.167 4.167 0 11-8.28 0` +\n    ` .417.417 0 01.413-.37z' fill='%23BDC4CB'/%3E%3C/g%3E%3Cdefs%3E%3CclipPath` +\n    ` id='clip0'%3E%3Cpath fill='%23fff' d='M0 0h40v40H0z'/%3E%3C/clipPath%3E%3C/defs%3E%3C/svg%3E`;\nexport const COLORS = {\n    greyLoadingIndicator: \"#95A1AC\",\n    whiteLoadingIndicator: \"#FFFFFF\"\n};\nexport const TAGGING_CONTAINER_STRINGS = {\n    fetchingPreferences: \"Fetching your preferences\"\n};\n//# sourceMappingURL=constants.js.map","import bowser from 'bowser';\nimport Event from '../Event';\nimport MainHelper from '../helpers/MainHelper';\nimport { addCssClass, addDomElement, getPlatformNotificationIcon, once, removeDomElement, removeCssClass, getDomElementOrStub } from '../utils';\nimport { SERVER_CONFIG_DEFAULTS_SLIDEDOWN } from '../config';\nimport { getLoadingIndicatorWithColor } from './LoadingIndicator';\nimport { getRetryIndicator } from './RetryIndicator';\nimport { SLIDEDOWN_CSS_CLASSES, SLIDEDOWN_CSS_IDS, COLORS } from \"./constants\";\nimport Log from '../../src/libraries/Log';\nimport { getSlidedownElement } from './SlidedownElement';\nexport default class Slidedown {\n    static get EVENTS() {\n        return {\n            ALLOW_CLICK: 'popoverAllowClick',\n            CANCEL_CLICK: 'popoverCancelClick',\n            SHOWN: 'popoverShown',\n            CLOSED: 'popoverClosed',\n        };\n    }\n    constructor(options) {\n        if (!options) {\n            options = MainHelper.getSlidedownPermissionMessageOptions(OneSignal.config.userConfig.promptOptions);\n        }\n        this.options = options;\n        this.categoryOptions = options.categories;\n        this.options.actionMessage = options.actionMessage.substring(0, 90);\n        this.options.acceptButtonText = options.acceptButtonText.substring(0, 16);\n        this.options.cancelButtonText = options.cancelButtonText.substring(0, 16);\n        this.notificationIcons = null;\n        this.isShowingFailureState = false;\n        if (!!this.categoryOptions) {\n            this.categoryOptions.positiveUpdateButton = this.categoryOptions.positiveUpdateButton.substring(0, 16),\n                this.categoryOptions.negativeUpdateButton = this.categoryOptions.negativeUpdateButton.substring(0, 16),\n                this.categoryOptions.updateMessage = this.categoryOptions.updateMessage.substring(0, 90),\n                // NOTE: will be configurable in the future\n                this.categoryOptions.savingButtonText = SERVER_CONFIG_DEFAULTS_SLIDEDOWN.savingText;\n            this.categoryOptions.errorButtonText = this.categoryOptions.positiveUpdateButton;\n        }\n    }\n    async create(isInUpdateMode) {\n        // TODO: dynamically change btns depending on if its first or repeat display of slidedown (subscribe vs update)\n        if (this.notificationIcons === null) {\n            const icons = await MainHelper.getNotificationIcons();\n            this.notificationIcons = icons;\n            // Remove any existing container\n            if (this.container.className.includes(SLIDEDOWN_CSS_CLASSES.container)) {\n                removeDomElement(`#${SLIDEDOWN_CSS_IDS.container}`);\n            }\n            const positiveButtonText = isInUpdateMode && !!this.categoryOptions ?\n                this.categoryOptions.positiveUpdateButton : this.options.acceptButtonText;\n            const negativeButtonText = isInUpdateMode && !!this.categoryOptions ?\n                this.categoryOptions.negativeUpdateButton : this.options.cancelButtonText;\n            const messageText = isInUpdateMode && !!this.categoryOptions ?\n                this.categoryOptions.updateMessage : this.options.actionMessage;\n            const icon = this.getPlatformNotificationIcon();\n            const slidedownElement = getSlidedownElement({\n                messageText,\n                icon,\n                positiveButtonText,\n                negativeButtonText\n            });\n            const slidedownContainer = document.createElement(\"div\");\n            const dialogContainer = document.createElement(\"div\");\n            // Insert the container\n            slidedownContainer.id = SLIDEDOWN_CSS_IDS.container;\n            addCssClass(slidedownContainer, SLIDEDOWN_CSS_CLASSES.container);\n            addCssClass(slidedownContainer, SLIDEDOWN_CSS_CLASSES.reset);\n            getDomElementOrStub('body').appendChild(slidedownContainer);\n            // Insert the dialog\n            dialogContainer.id = SLIDEDOWN_CSS_IDS.dialog;\n            addCssClass(dialogContainer, SLIDEDOWN_CSS_CLASSES.dialog);\n            dialogContainer.appendChild(slidedownElement);\n            this.container.appendChild(dialogContainer);\n            // Animate it in depending on environment\n            addCssClass(this.container, bowser.mobile ? SLIDEDOWN_CSS_CLASSES.slideUp : SLIDEDOWN_CSS_CLASSES.slideDown);\n            // Add click event handlers\n            this.allowButton.addEventListener('click', this.onSlidedownAllowed.bind(this));\n            this.cancelButton.addEventListener('click', this.onSlidedownCanceled.bind(this));\n            Event.trigger(Slidedown.EVENTS.SHOWN);\n        }\n    }\n    async onSlidedownAllowed(_) {\n        await Event.trigger(Slidedown.EVENTS.ALLOW_CLICK);\n    }\n    onSlidedownCanceled(_) {\n        Event.trigger(Slidedown.EVENTS.CANCEL_CLICK);\n        this.close();\n    }\n    close() {\n        addCssClass(this.container, SLIDEDOWN_CSS_CLASSES.closeSlidedown);\n        once(this.dialog, 'animationend', (event, destroyListenerFn) => {\n            if (event.target === this.dialog &&\n                (event.animationName === 'slideDownExit' || event.animationName === 'slideUpExit')) {\n                // Uninstall the event listener for animationend\n                removeDomElement(`#${SLIDEDOWN_CSS_IDS.container}`);\n                destroyListenerFn();\n                Event.trigger(Slidedown.EVENTS.CLOSED);\n            }\n        }, true);\n    }\n    /**\n     * only used with Category Slidedown\n     */\n    setSaveState(state) {\n        if (!this.categoryOptions) {\n            Log.debug(\"Slidedown private category options are not defined\");\n            return;\n        }\n        if (state) {\n            // note: savingButtonText is hardcoded in constructor. TODO: pull from config & set defaults for future release\n            this.allowButton.disabled = true;\n            this.allowButton.textContent = null;\n            this.allowButton.insertAdjacentElement('beforeend', this.getTextSpan(this.categoryOptions.savingButtonText));\n            this.allowButton.insertAdjacentElement('beforeend', this.getIndicatorHolder());\n            addDomElement(this.buttonIndicatorHolder, 'beforeend', getLoadingIndicatorWithColor(COLORS.whiteLoadingIndicator));\n            addCssClass(this.allowButton, 'disabled');\n            addCssClass(this.allowButton, SLIDEDOWN_CSS_CLASSES.savingStateButton);\n        }\n        else {\n            // positiveUpdateButton should be defined as written in MainHelper.getSlidedownPermissionMessageOptions\n            this.allowButton.textContent = this.categoryOptions.positiveUpdateButton;\n            removeDomElement(`#${SLIDEDOWN_CSS_CLASSES.buttonIndicatorHolder}`);\n            this.allowButton.disabled = false;\n            removeCssClass(this.allowButton, 'disabled');\n            removeCssClass(this.allowButton, SLIDEDOWN_CSS_CLASSES.savingStateButton);\n        }\n    }\n    setFailureState(state) {\n        if (!this.categoryOptions) {\n            Log.debug(\"Slidedown private category options are not defined\");\n            return;\n        }\n        if (state) {\n            // note: errorButtonText is hardcoded in constructor. TODO: pull from config & set defaults for future release\n            this.allowButton.textContent = null;\n            this.allowButton.insertAdjacentElement('beforeend', this.getTextSpan(this.categoryOptions.errorButtonText));\n            this.allowButton.insertAdjacentElement('beforeend', this.getIndicatorHolder());\n            addDomElement(this.buttonIndicatorHolder, 'beforeend', getRetryIndicator());\n            addCssClass(this.allowButton, 'onesignal-error-state-button');\n        }\n        else {\n            removeDomElement('#onesignal-button-indicator-holder');\n            removeCssClass(this.allowButton, 'onesignal-error-state-button');\n        }\n        this.isShowingFailureState = state;\n    }\n    getPlatformNotificationIcon() {\n        return getPlatformNotificationIcon(this.notificationIcons);\n    }\n    getIndicatorHolder() {\n        const indicatorHolder = document.createElement(\"div\");\n        indicatorHolder.id = SLIDEDOWN_CSS_IDS.buttonIndicatorHolder;\n        addCssClass(indicatorHolder, SLIDEDOWN_CSS_CLASSES.buttonIndicatorHolder);\n        return indicatorHolder;\n    }\n    getTextSpan(text) {\n        const textHolder = document.createElement(\"span\");\n        textHolder.textContent = text;\n        return textHolder;\n    }\n    get container() {\n        return getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.container}`);\n    }\n    get dialog() {\n        return getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.dialog}`);\n    }\n    get allowButton() {\n        return getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.allowButton}`);\n    }\n    get cancelButton() {\n        return getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.cancelButton}`);\n    }\n    get buttonIndicatorHolder() {\n        return getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.buttonIndicatorHolder}`);\n    }\n    get slidedownFooter() {\n        return getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.footer}`);\n    }\n}\nexport function manageNotifyButtonStateWhileSlidedownShows() {\n    const notifyButton = OneSignal.notifyButton;\n    if (notifyButton &&\n        notifyButton.options.enable &&\n        OneSignal.notifyButton.launcher.state !== 'hidden') {\n        OneSignal.notifyButton.launcher.waitUntilShown()\n            .then(() => {\n            OneSignal.notifyButton.launcher.hide();\n        });\n    }\n    OneSignal.emitter.once(Slidedown.EVENTS.CLOSED, () => {\n        if (OneSignal.notifyButton &&\n            OneSignal.notifyButton.options.enable) {\n            OneSignal.notifyButton.launcher.show();\n        }\n    });\n}\n//# sourceMappingURL=Slidedown.js.map","import { DEFAULT_ICON, SLIDEDOWN_CSS_IDS, SLIDEDOWN_CSS_CLASSES, SLIDEDOWN_BUTTON_CLASSES } from \"./constants\";\nimport { addCssClass } from '../../src/utils';\nexport function getSlidedownElement(dialogProps) {\n    const { icon, messageText, positiveButtonText, negativeButtonText } = dialogProps;\n    const finalIcon = icon === SLIDEDOWN_CSS_CLASSES.defaultIcon ? DEFAULT_ICON : icon;\n    const finalIconClass = icon === SLIDEDOWN_CSS_CLASSES.defaultIcon ? SLIDEDOWN_CSS_CLASSES.defaultIcon : '';\n    const normalSlidedown = document.createElement(\"div\");\n    const slidedownBody = document.createElement(\"div\");\n    const bodyMessage = document.createElement(\"div\");\n    const slidedownBodyIcon = document.createElement(\"div\");\n    const loadingContainer = document.createElement(\"div\");\n    const slidedownFooter = document.createElement(\"div\");\n    const positiveButton = document.createElement(\"button\");\n    const negativeButton = document.createElement(\"button\");\n    const clearfix = document.createElement(\"div\");\n    const clearfix2 = document.createElement(\"div\");\n    const image = document.createElement(\"img\");\n    addCssClass(slidedownBody, SLIDEDOWN_CSS_CLASSES.body);\n    addCssClass(slidedownBodyIcon, SLIDEDOWN_CSS_CLASSES.icon);\n    addCssClass(bodyMessage, SLIDEDOWN_CSS_CLASSES.message);\n    addCssClass(slidedownFooter, SLIDEDOWN_CSS_CLASSES.footer);\n    addCssClass(clearfix, SLIDEDOWN_CSS_CLASSES.clearfix);\n    addCssClass(clearfix2, SLIDEDOWN_CSS_CLASSES.clearfix);\n    addCssClass(positiveButton, SLIDEDOWN_BUTTON_CLASSES.alignRight);\n    addCssClass(positiveButton, SLIDEDOWN_BUTTON_CLASSES.primary);\n    addCssClass(positiveButton, SLIDEDOWN_BUTTON_CLASSES.slidedownButton);\n    addCssClass(negativeButton, SLIDEDOWN_BUTTON_CLASSES.alignRight);\n    addCssClass(negativeButton, SLIDEDOWN_BUTTON_CLASSES.secondary);\n    addCssClass(negativeButton, SLIDEDOWN_BUTTON_CLASSES.slidedownButton);\n    normalSlidedown.id = SLIDEDOWN_CSS_IDS.normalSlidedown;\n    slidedownBody.id = SLIDEDOWN_CSS_IDS.body;\n    loadingContainer.id = SLIDEDOWN_CSS_IDS.loadingContainer;\n    positiveButton.id = SLIDEDOWN_CSS_IDS.allowButton;\n    negativeButton.id = SLIDEDOWN_CSS_IDS.cancelButton;\n    slidedownFooter.id = SLIDEDOWN_CSS_IDS.footer;\n    if (finalIconClass) {\n        addCssClass(image, finalIconClass);\n    }\n    image.setAttribute(\"alt\", \"notification icon\");\n    image.setAttribute(\"src\", finalIcon || '');\n    bodyMessage.innerText = messageText || '';\n    positiveButton.innerText = positiveButtonText || '';\n    negativeButton.innerText = negativeButtonText || '';\n    slidedownBodyIcon.appendChild(image);\n    slidedownBody.appendChild(slidedownBodyIcon);\n    slidedownBody.appendChild(bodyMessage);\n    slidedownBody.appendChild(clearfix);\n    slidedownBody.appendChild(loadingContainer);\n    slidedownFooter.appendChild(positiveButton);\n    slidedownFooter.appendChild(negativeButton);\n    slidedownFooter.appendChild(clearfix2);\n    normalSlidedown.appendChild(slidedownBody);\n    normalSlidedown.appendChild(slidedownFooter);\n    return normalSlidedown;\n}\n//# sourceMappingURL=SlidedownElement.js.map","export function getRetryIndicator(color = \"#FFFFFF\") {\n    return `<svg width=\"16\" height=\"16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M6.711 2.652a5.489 5.489 0 00-4.044 4.05 5.513 5.513 0 00.104 2.968.167.167 0 00.25.089l.893-.588a.667.667 0 011.02.692l-.61 2.937a.667.667 0 01-.786.52L.6 12.713a.667.667 0 01-.232-1.21l.933-.615a.166.166 0 00.063-.2 7.167 7.167 0 018.828-9.516.833.833 0 01-.507 1.587 5.489 5.489 0 00-2.974-.108zM15.75 3.542c.09.096.15.216.172.346a.667.667 0 01-.301.681l-.898.564a.166.166 0 00-.066.2 7.167 7.167 0 01-8.77 9.514.835.835 0 01-.154-1.544.831.831 0 01.646-.048 5.5 5.5 0 006.856-6.949.167.167 0 00-.176-.114.164.164 0 00-.071.026l-.962.604a.667.667 0 01-1.005-.713l.667-2.924a.667.667 0 01.8-.502l2.925.667c.129.03.246.096.336.192z\" fill=\"${color}\"/></svg>`;\n}\n//# sourceMappingURL=RetryIndicator.js.map","export var DelayedPromptType;\n(function (DelayedPromptType) {\n    DelayedPromptType[\"Native\"] = \"native\";\n    DelayedPromptType[\"Slidedown\"] = \"slidedown\";\n})(DelayedPromptType || (DelayedPromptType = {}));\n//# sourceMappingURL=Prompts.js.map","// This is used by the OneSignalSDK.js shim\n// DO NOT add other imports since it is an ES5 target and dead code imports can't be clean up.\n// Checks if the browser supports push notifications by checking if specific\n//   classes and properties on them exist\nexport function isPushNotificationsSupported() {\n    return supportsVapidPush() || supportsSafariPush();\n}\nexport function isMacOSSafariInIframe() {\n    // Fallback detection for Safari on macOS in an iframe context\n    return window.top !== window && // isContextIframe\n        navigator.vendor === \"Apple Computer, Inc.\" && // isSafari\n        navigator.platform === \"MacIntel\"; // isMacOS\n}\nfunction supportsSafariPush() {\n    return (window.safari && typeof window.safari.pushNotification !== \"undefined\") ||\n        isMacOSSafariInIframe();\n}\n// Does the browser support the standard Push API\nfunction supportsVapidPush() {\n    return typeof PushSubscriptionOptions !== \"undefined\" &&\n        PushSubscriptionOptions.prototype.hasOwnProperty(\"applicationServerKey\");\n}\n/* Notes on browser results which lead the logic of the functions above */\n// Safari\n//   macOS - typeof safari.pushNotification == \"object\"\n//         - iframe context - typeof safari == \"undefined\"\n//   iOS -  typeof safari == \"undefined\"\n// Chrome\n//   HTTP & HTTPS - typeof PushSubscriptionOptions == \"function\"\n//   HTTP - navigator.serviceWorker == \"undefined\"\n// Firefox\n//   Normal - typeof PushSubscriptionOptions == \"function\"\n//     HTTP & HTTPS - typeof PushSubscriptionOptions == \"function\"\n//   ESR - typeof PushSubscriptionOptions == \"undefined\"\n//# sourceMappingURL=BrowserSupportsPush.js.map","import bowser from \"bowser\";\nimport { Browser } from '../models/Browser';\nimport { OneSignalUtils } from '../../../utils/OneSignalUtils';\nimport { isMacOSSafariInIframe } from '../utils/BrowserSupportsPush';\nimport Utils from '../../shared/utils/Utils';\n/**\n * EnvironmentInfoHelper is used to save page (\"browser\") context environment information to\n * the OneSignal object upon initialization\n */\nexport class EnvironmentInfoHelper {\n    static getEnvironmentInfo() {\n        return {\n            browserType: this.getBrowser(),\n            browserVersion: this.getBrowserVersion(),\n            isHttps: this.isHttps(),\n            isUsingSubscriptionWorkaround: this.isUsingSubscriptionWorkaround(),\n            isBrowserAndSupportsServiceWorkers: this.supportsServiceWorkers(),\n            requiresUserInteraction: this.requiresUserInteraction(),\n            osVersion: this.getOsVersion(),\n            canTalkToServiceWorker: this.canTalkToServiceWorker()\n        };\n    }\n    static getBrowser() {\n        if (bowser.chrome) {\n            return Browser.Chrome;\n        }\n        if (bowser.msedge) {\n            return Browser.Edge;\n        }\n        if (bowser.opera) {\n            return Browser.Opera;\n        }\n        if (bowser.firefox) {\n            return Browser.Firefox;\n        }\n        // use existing safari detection to be consistent\n        if (this.isMacOSSafari()) {\n            return Browser.Safari;\n        }\n        return Browser.Other;\n    }\n    // NOTE: Returns false in a ServiceWorker context\n    static isMacOSSafari() {\n        if (typeof window.safari !== \"undefined\") {\n            return true;\n        }\n        return isMacOSSafariInIframe();\n    }\n    static getBrowserVersion() {\n        return Utils.parseVersionString(bowser.version);\n    }\n    static isHttps() {\n        return window ? (window.location && window.location.protocol === 'https:') : false;\n    }\n    static isUsingSubscriptionWorkaround() {\n        return OneSignalUtils.isUsingSubscriptionWorkaround();\n    }\n    static supportsServiceWorkers() {\n        return (window.navigator && 'serviceWorker' in window.navigator);\n    }\n    static requiresUserInteraction() {\n        // Firefox 72+ requires user-interaction\n        if (this.getBrowser() === \"firefox\" && this.getBrowserVersion() >= 72) {\n            return true;\n        }\n        // Safari 12.1+ requires user-interaction\n        if (this.getBrowser() === \"safari\" && this.getBrowserVersion() >= 12.1) {\n            return true;\n        }\n        return false;\n    }\n    static getOsVersion() {\n        return bowser.osversion;\n    }\n    static canTalkToServiceWorker() {\n        return !!window.isSecureContext;\n    }\n}\n//# sourceMappingURL=EnvironmentInfoHelper.js.map","import { deepCopy } from '../../src/utils';\nexport default class TagUtils {\n    static convertTagsApiToBooleans(tags) {\n        const convertedTags = {};\n        Object.keys(tags).forEach(key => {\n            convertedTags[key] = tags[key] === \"1\" ? true : false;\n        });\n        return convertedTags;\n    }\n    static convertTagsBooleansToApi(tags) {\n        const convertedTags = {};\n        Object.keys(tags).forEach(key => {\n            convertedTags[key] = tags[key] === true ? \"1\" : \"0\";\n        });\n        return convertedTags;\n    }\n    /**\n     * Used in determining what Tag/Category preferences changed in order\n     * to only update what is necessary\n     * @param  {TagsObject} localTags - tags from taggingContainer with values of type \"number\"\n     * @param  {TagsObject} remoteTags - remote player tags with values of type \"number\"\n     * @returns array of keys of corresponding different values (finds difference)\n     */\n    static getObjectDifference(localTags, remoteTags) {\n        const finalTags = {};\n        // Going off local tags since it's our categories. Trying to find only changed tags and returning those\n        // as a final object.\n        Object.keys(localTags).forEach(key => {\n            // only if user's tag value did not change, skip it\n            if (remoteTags[key] === localTags[key]) {\n                return;\n            }\n            finalTags[key] = localTags[key];\n        });\n        return finalTags;\n    }\n    static markAllTagsAsSpecified(categoryArray, checked) {\n        categoryArray.forEach(category => {\n            category.checked = checked;\n        });\n    }\n    static isTagObjectEmpty(tags) {\n        return Object.keys(tags).length === 0;\n    }\n    /**\n     * Uses configured categories and remote player tags to calculate which boxes should be checked\n     * @param  {TagCategory[]} categories\n     * @param  {TagsObjectWithBoolean} existingPlayerTags?\n     */\n    static getCheckedTagCategories(categories, existingPlayerTags) {\n        if (!existingPlayerTags) {\n            return categories;\n        }\n        const isExistingPlayerTagsEmpty = TagUtils.isTagObjectEmpty(existingPlayerTags);\n        if (isExistingPlayerTagsEmpty) {\n            const categoriesCopy = deepCopy(categories);\n            TagUtils.markAllTagsAsSpecified(categoriesCopy, true);\n            return categoriesCopy;\n        }\n        const categoriesCopy = deepCopy(categories);\n        return categoriesCopy.map(category => {\n            const existingTagValue = existingPlayerTags[category.tag];\n            category.checked = TagUtils.getCheckedStatusForTagValue(existingTagValue);\n            return category;\n        });\n    }\n    static getCheckedStatusForTagValue(tagValue) {\n        // If user does not have tag assigned to them, consider it selected\n        if (tagValue === undefined) {\n            return true;\n        }\n        return tagValue;\n    }\n    static limitCategoriesToMaxCount(categories, max) {\n        const categoriesCopy = deepCopy(categories);\n        categoriesCopy.tags = categories.tags.slice(0, max);\n        return categoriesCopy;\n    }\n}\n//# sourceMappingURL=TagUtils.js.map","import { addDomElement, removeDomElement, addCssClass, removeCssClass, getDomElementOrStub } from '../utils';\nimport { getLoadingIndicatorWithColor } from './LoadingIndicator';\nimport { SLIDEDOWN_CSS_IDS, TAGGING_CONTAINER_CSS_CLASSES, TAGGING_CONTAINER_CSS_IDS, TAGGING_CONTAINER_STRINGS, COLORS, SLIDEDOWN_CSS_CLASSES } from './constants';\nimport TagUtils from '../../src/utils/TagUtils';\nexport default class TaggingContainer {\n    mount(remoteTagCategories, existingPlayerTags) {\n        const taggingContainer = this.generateHtml(remoteTagCategories, existingPlayerTags);\n        const body = getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.body}`);\n        body.appendChild(taggingContainer);\n        if (this.taggingContainer) {\n            this.taggingContainer.addEventListener('change', this.toggleCheckedTag);\n        }\n        const allowButton = getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.allowButton}`);\n        allowButton.disabled = false;\n        removeCssClass(allowButton, 'disabled');\n        removeDomElement(`#${SLIDEDOWN_CSS_IDS.loadingContainer}`);\n    }\n    load() {\n        const loadingContainer = getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.loadingContainer}`);\n        const allowButton = getDomElementOrStub(`#${SLIDEDOWN_CSS_IDS.allowButton}`);\n        const loadingMessageContainer = document.createElement(\"div\");\n        addCssClass(loadingContainer, `${SLIDEDOWN_CSS_CLASSES.loadingContainer}`);\n        addCssClass(loadingMessageContainer, TAGGING_CONTAINER_CSS_CLASSES.loadingMessage);\n        addCssClass(allowButton, 'disabled');\n        addDomElement(loadingContainer, 'beforeend', getLoadingIndicatorWithColor(COLORS.greyLoadingIndicator));\n        loadingMessageContainer.innerText = TAGGING_CONTAINER_STRINGS.fetchingPreferences;\n        loadingContainer.appendChild(loadingMessageContainer);\n        allowButton.disabled = true;\n    }\n    generateHtml(remoteTagCategories, existingPlayerTags) {\n        const checkedTagCategories = TagUtils.getCheckedTagCategories(remoteTagCategories, existingPlayerTags);\n        const firstColumnArr = checkedTagCategories.filter(elem => checkedTagCategories.indexOf(elem) % 2 === 0);\n        const secondColumnArr = checkedTagCategories.filter(elem => checkedTagCategories.indexOf(elem) % 2);\n        const firstColumnContainer = document.createElement(\"div\");\n        const secondColumnContainer = document.createElement(\"div\");\n        const taggingContainer = document.createElement(\"div\");\n        addCssClass(firstColumnContainer, TAGGING_CONTAINER_CSS_CLASSES.taggingContainerCol);\n        addCssClass(secondColumnContainer, TAGGING_CONTAINER_CSS_CLASSES.taggingContainerCol);\n        addCssClass(taggingContainer, TAGGING_CONTAINER_CSS_CLASSES.taggingContainer);\n        taggingContainer.id = TAGGING_CONTAINER_CSS_IDS.taggingContainer;\n        firstColumnArr.forEach(elem => {\n            firstColumnContainer.appendChild(this.getCategoryLabelElement(elem));\n        });\n        secondColumnArr.forEach(elem => {\n            secondColumnContainer.appendChild(this.getCategoryLabelElement(elem));\n        });\n        taggingContainer.appendChild(firstColumnContainer);\n        taggingContainer.appendChild(secondColumnContainer);\n        return taggingContainer;\n    }\n    getCategoryLabelElement(tagCategory) {\n        const { label } = tagCategory;\n        const labelElement = document.createElement(\"label\");\n        const labelSpan = document.createElement(\"span\");\n        const inputElement = document.createElement(\"input\");\n        const checkmarkSpan = document.createElement(\"span\");\n        const clear = document.createElement(\"div\");\n        const wrappingDiv = document.createElement(\"div\");\n        addCssClass(labelElement, TAGGING_CONTAINER_CSS_CLASSES.categoryLabel);\n        addCssClass(labelSpan, TAGGING_CONTAINER_CSS_CLASSES.categoryLabelText);\n        addCssClass(inputElement, TAGGING_CONTAINER_CSS_CLASSES.categoryLabelInput);\n        addCssClass(checkmarkSpan, TAGGING_CONTAINER_CSS_CLASSES.checkmark);\n        labelElement.title = label;\n        labelSpan.innerText = label;\n        inputElement.type = \"checkbox\";\n        inputElement.value = tagCategory.tag;\n        inputElement.checked = !!tagCategory.checked;\n        labelElement.appendChild(labelSpan);\n        labelElement.appendChild(inputElement);\n        labelElement.appendChild(checkmarkSpan);\n        clear.setAttribute(\"style\", \"clear:both\");\n        wrappingDiv.appendChild(labelElement);\n        wrappingDiv.appendChild(clear);\n        return wrappingDiv;\n    }\n    get taggingContainer() {\n        const selector = `#${SLIDEDOWN_CSS_IDS.body} > div.${TAGGING_CONTAINER_CSS_CLASSES.taggingContainer}`;\n        return getDomElementOrStub(selector);\n    }\n    toggleCheckedTag(e) {\n        const target = e.target;\n        if (target && target.getAttribute(\"type\") === \"checkbox\") {\n            const isChecked = target.checked;\n            target.setAttribute(\"checked\", isChecked.toString());\n        }\n    }\n    static getValuesFromTaggingContainer() {\n        const selector = `#${SLIDEDOWN_CSS_IDS.body} > div.${TAGGING_CONTAINER_CSS_CLASSES.taggingContainer}` +\n            `> div > div > label > input[type=checkbox]`;\n        const inputNodeArr = document.querySelectorAll(selector);\n        const tags = {};\n        inputNodeArr.forEach(node => {\n            tags[node.value] = node.checked;\n        });\n        return tags;\n    }\n}\n//# sourceMappingURL=TaggingContainer.js.map","import Log from \"../libraries/Log\";\nimport OneSignalUtils from \"../utils/OneSignalUtils\";\nimport { NotSubscribedError, NotSubscribedReason } from \"../errors/NotSubscribedError\";\nimport MainHelper from '../helpers/MainHelper';\nimport AlreadySubscribedError from '../errors/AlreadySubscribedError';\nimport PermissionMessageDismissedError from '../errors/PermissionMessageDismissedError';\nimport PushPermissionNotGrantedError from '../errors/PushPermissionNotGrantedError';\nimport { PushPermissionNotGrantedErrorReason } from '../errors/PushPermissionNotGrantedError';\nimport { PermissionPromptType } from '../models/PermissionPromptType';\nimport { InvalidStateError, InvalidStateReason } from '../errors/InvalidStateError';\nimport { NotificationPermission } from '../models/NotificationPermission';\nimport Slidedown, { manageNotifyButtonStateWhileSlidedownShows } from '../slidedown/Slidedown';\nimport { DelayedPromptType } from '../models/Prompts';\nimport TestHelper from '../helpers/TestHelper';\nimport InitHelper from '../helpers/InitHelper';\nimport { SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS } from '../config/index';\nimport { EnvironmentInfoHelper } from '../context/browser/helpers/EnvironmentInfoHelper';\nimport { awaitableTimeout } from '../utils/AwaitableTimeout';\nimport TaggingContainer from '../slidedown/TaggingContainer';\nimport TagUtils from '../utils/TagUtils';\nimport LocalStorage from '../utils/LocalStorage';\nimport PromptsHelper from '../helpers/PromptsHelper';\nexport class PromptsManager {\n    constructor(context) {\n        this.isAutoPromptShowing = false;\n        this.context = context;\n        this.eventHooksInstalled = false;\n    }\n    async checkIfAutoPromptShouldBeShown(options = { force: false }) {\n        /*\n        Only show the slidedown if:\n        - Notifications aren't already enabled\n        - The user isn't manually opted out (if the user was manually opted out, we don't want to prompt the user)\n        */\n        if (this.isAutoPromptShowing) {\n            throw new InvalidStateError(InvalidStateReason.RedundantPermissionMessage, {\n                permissionPromptType: PermissionPromptType.SlidedownPermissionMessage\n            });\n        }\n        const doNotPrompt = MainHelper.wasHttpsNativePromptDismissed();\n        if (doNotPrompt && !options.force && !options.isInUpdateMode) {\n            Log.info(new PermissionMessageDismissedError());\n            return false;\n        }\n        const permission = await OneSignal.privateGetNotificationPermission();\n        if (permission === NotificationPermission.Denied) {\n            Log.info(new PushPermissionNotGrantedError(PushPermissionNotGrantedErrorReason.Blocked));\n            return false;\n        }\n        const isEnabled = await OneSignal.privateIsPushNotificationsEnabled();\n        if (isEnabled && !options.isInUpdateMode) {\n            throw new AlreadySubscribedError();\n        }\n        const notOptedOut = await OneSignal.privateGetSubscription();\n        if (!notOptedOut) {\n            throw new NotSubscribedError(NotSubscribedReason.OptedOut);\n        }\n        return true;\n    }\n    async internalShowAutoPrompt(options = { force: false, forceSlidedownOverNative: false }) {\n        OneSignalUtils.logMethodCall(\"internalShowAutoPrompt\", options);\n        if (!OneSignal.config || !OneSignal.config.userConfig || !OneSignal.config.userConfig.promptOptions) {\n            Log.error(\"OneSignal config was not initialized correctly. Aborting.\");\n            return;\n        }\n        const { forceSlidedownOverNative } = options;\n        // user config prompt options\n        const userPromptOptions = OneSignal.config.userConfig.promptOptions;\n        if (!userPromptOptions.native.enabled && !userPromptOptions.slidedown.enabled) {\n            Log.error(\"No suitable prompt type enabled.\");\n            return;\n        }\n        const nativePromptOptions = this.getDelayedPromptOptions(userPromptOptions, DelayedPromptType.Native);\n        const isPageViewConditionMetForNative = this.isPageViewConditionMet(nativePromptOptions);\n        const slidedownPromptOptions = this.getDelayedPromptOptions(userPromptOptions, DelayedPromptType.Slidedown);\n        const isPageViewConditionMetForSlidedown = this.isPageViewConditionMet(slidedownPromptOptions);\n        const conditionMetWithNativeOptions = nativePromptOptions.enabled && isPageViewConditionMetForNative;\n        const conditionMetWithSlidedownOptions = slidedownPromptOptions.enabled && isPageViewConditionMetForSlidedown;\n        const forceSlidedownWithNativeOptions = forceSlidedownOverNative && conditionMetWithNativeOptions;\n        // show native prompt\n        if (conditionMetWithNativeOptions && !forceSlidedownWithNativeOptions) {\n            this.internalShowDelayedPrompt(DelayedPromptType.Native, nativePromptOptions.timeDelay || 0);\n            return;\n        }\n        // show slidedown prompt\n        if (conditionMetWithSlidedownOptions || forceSlidedownWithNativeOptions) {\n            const { timeDelay } = conditionMetWithSlidedownOptions ? slidedownPromptOptions : nativePromptOptions;\n            this.internalShowDelayedPrompt(DelayedPromptType.Slidedown, timeDelay || 0, options);\n        }\n    }\n    async internalShowDelayedPrompt(type, timeDelaySeconds, options) {\n        OneSignalUtils.logMethodCall(\"internalShowDelayedPrompt\");\n        if (typeof timeDelaySeconds !== \"number\") {\n            Log.error(\"internalShowDelayedPrompt: timeDelay not a number\");\n            return;\n        }\n        const { requiresUserInteraction } = EnvironmentInfoHelper.getEnvironmentInfo();\n        if (requiresUserInteraction && type === DelayedPromptType.Native) {\n            type = DelayedPromptType.Slidedown;\n        }\n        if (timeDelaySeconds > 0) {\n            await awaitableTimeout(timeDelaySeconds * 1000);\n        }\n        switch (type) {\n            case DelayedPromptType.Native:\n                this.internalShowNativePrompt();\n                break;\n            case DelayedPromptType.Slidedown:\n                this.internalShowSlidedownPrompt(options);\n                break;\n            default:\n                Log.error(\"Invalid Delayed Prompt type\");\n        }\n    }\n    async internalShowNativePrompt() {\n        OneSignalUtils.logMethodCall(\"internalShowNativePrompt\");\n        if (this.isAutoPromptShowing) {\n            Log.debug(\"Already showing autoprompt. Abort showing a native prompt.\");\n            return;\n        }\n        this.isAutoPromptShowing = true;\n        MainHelper.markHttpSlidedownShown();\n        await InitHelper.registerForPushNotifications();\n        this.isAutoPromptShowing = false;\n        TestHelper.markHttpsNativePromptDismissed();\n    }\n    async internalShowSlidedownPrompt(options = { force: false }) {\n        OneSignalUtils.logMethodCall(\"internalShowSlidedownPrompt\");\n        const { categoryOptions, isInUpdateMode } = options;\n        if (this.isAutoPromptShowing) {\n            Log.debug(\"Already showing slidedown. Abort.\");\n            return;\n        }\n        try {\n            const showPrompt = await this.checkIfAutoPromptShouldBeShown(options);\n            if (!showPrompt) {\n                return;\n            }\n        }\n        catch (e) {\n            Log.warn(\"checkIfAutoPromptShouldBeShown returned an error\", e);\n            return;\n        }\n        MainHelper.markHttpSlidedownShown();\n        const sdkStylesLoadResult = await this.context.dynamicResourceLoader.loadSdkStylesheet();\n        if (sdkStylesLoadResult !== 0 /* Loaded */) {\n            Log.debug('Not showing slidedown permission message because styles failed to load.');\n            return;\n        }\n        const slideDownOptions = MainHelper.getSlidedownPermissionMessageOptions(OneSignal.config.userConfig.promptOptions);\n        if (!this.eventHooksInstalled) {\n            this.installEventHooksForSlidedown();\n        }\n        OneSignal.slidedown = new Slidedown(slideDownOptions);\n        try {\n            if (PromptsHelper.isCategorySlidedownConfigured(this.context)) {\n                // show slidedown with tagging container\n                await OneSignal.slidedown.create(isInUpdateMode);\n                let tagsForComponent = {};\n                const taggingContainer = new TaggingContainer();\n                const tagCategoryArray = categoryOptions.tags;\n                if (isInUpdateMode) {\n                    taggingContainer.load();\n                    // updating. pull remote tags.\n                    const existingTags = await OneSignal.getTags();\n                    this.context.tagManager.storeRemotePlayerTags(existingTags);\n                    tagsForComponent = TagUtils.convertTagsApiToBooleans(existingTags);\n                }\n                else {\n                    // first subscription\n                    TagUtils.markAllTagsAsSpecified(tagCategoryArray, true);\n                }\n                taggingContainer.mount(tagCategoryArray, tagsForComponent);\n            }\n        }\n        catch (e) {\n            Log.error(\"OneSignal: Attempted to create tagging container with error\", e);\n        }\n        await OneSignal.slidedown.create();\n        Log.debug('Showing Slidedown.');\n    }\n    // Wrapper for existing method `internalShowSlidedownPrompt`. Inserts information about\n    // provided categories, then calls `internalShowSlidedownPrompt`.\n    async internalShowCategorySlidedown(options) {\n        const promptOptions = await this.context.appConfig.userConfig.promptOptions;\n        const categoryOptions = promptOptions.slidedown.categories;\n        if (!PromptsHelper.isCategorySlidedownConfigured(this.context)) {\n            Log.error(`OneSignal: no categories to display. Check your configuration on the ` +\n                `OneSignal dashboard or your custom code initialization.`);\n            return;\n        }\n        await this.internalShowSlidedownPrompt(Object.assign({}, options, { categoryOptions }));\n    }\n    installEventHooksForSlidedown() {\n        this.eventHooksInstalled = true;\n        manageNotifyButtonStateWhileSlidedownShows();\n        OneSignal.emitter.on(Slidedown.EVENTS.SHOWN, () => {\n            this.isAutoPromptShowing = true;\n        });\n        OneSignal.emitter.on(Slidedown.EVENTS.CLOSED, () => {\n            this.isAutoPromptShowing = false;\n        });\n        OneSignal.emitter.on(Slidedown.EVENTS.ALLOW_CLICK, async () => {\n            const { slidedown } = OneSignal;\n            if (slidedown.isShowingFailureState) {\n                slidedown.setFailureState(false);\n            }\n            const tags = TaggingContainer.getValuesFromTaggingContainer();\n            this.context.tagManager.storeTagValuesToUpdate(tags);\n            // use local storage permission to get around user-gesture sync requirement\n            const isPushEnabled = LocalStorage.getIsPushNotificationsEnabled();\n            if (isPushEnabled) {\n                OneSignal.slidedown.setSaveState(true);\n                // Sync Category Slidedown tags (isInUpdateMode = true)\n                try {\n                    await this.context.tagManager.sendTags(true);\n                }\n                catch (e) {\n                    Log.error(\"Failed to update tags\", e);\n                    // Display tag update error\n                    OneSignal.slidedown.setSaveState(false);\n                    OneSignal.slidedown.setFailureState(true);\n                    return;\n                }\n            }\n            else {\n                const autoAccept = !OneSignal.environmentInfo.requiresUserInteraction;\n                const options = { autoAccept, slidedown: true };\n                InitHelper.registerForPushNotifications(options);\n            }\n            if (OneSignal.slidedown) {\n                OneSignal.slidedown.close();\n            }\n            Log.debug(\"Setting flag to not show the slidedown to the user again.\");\n            TestHelper.markHttpsNativePromptDismissed();\n        });\n        OneSignal.emitter.once(Slidedown.EVENTS.CANCEL_CLICK, () => {\n            Log.debug(\"Setting flag to not show the slidedown to the user again.\");\n            TestHelper.markHttpsNativePromptDismissed();\n        });\n    }\n    isPageViewConditionMet(options) {\n        if (!options || typeof options.pageViews === \"undefined\") {\n            return false;\n        }\n        if (!options.autoPrompt || !options.enabled) {\n            return false;\n        }\n        const localPageViews = this.context.pageViewManager.getLocalPageViewCount();\n        return localPageViews >= options.pageViews;\n    }\n    getDelayedPromptOptions(promptOptions, type) {\n        const promptOptionsForSpecificType = promptOptions[type];\n        if (!promptOptions || !promptOptionsForSpecificType) {\n            return {\n                enabled: false,\n                autoPrompt: false,\n                timeDelay: SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.timeDelay,\n                pageViews: SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.pageViews\n            };\n        }\n        return {\n            enabled: promptOptionsForSpecificType.enabled,\n            autoPrompt: promptOptionsForSpecificType.autoPrompt,\n            timeDelay: promptOptionsForSpecificType.timeDelay,\n            pageViews: promptOptionsForSpecificType.pageViews\n        };\n    }\n}\n//# sourceMappingURL=PromptsManager.js.map","// timeout with option to await on it\nexport function awaitableTimeout(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n//# sourceMappingURL=AwaitableTimeout.js.map","import { SessionOrigin } from \"../../../models/Session\";\nimport MainHelper from \"../../../helpers/MainHelper\";\nimport Log from \"../../../libraries/Log\";\nimport { WorkerMessengerCommand } from \"../../../libraries/WorkerMessenger\";\nimport { OneSignalUtils } from \"../../../utils/OneSignalUtils\";\nimport { SubscriptionStateKind } from \"../../../models/SubscriptionStateKind\";\nimport OneSignalApiShared from \"../../../OneSignalApiShared\";\nimport Database from \"../../../services/Database\";\nexport class SessionManager {\n    constructor(context) {\n        this.onSessionSent = false;\n        this.context = context;\n    }\n    async notifySWToUpsertSession(deviceId, deviceRecord, sessionOrigin) {\n        const isHttps = OneSignalUtils.isHttps();\n        const payload = {\n            deviceId,\n            deviceRecord: deviceRecord.serialize(),\n            sessionThreshold: this.context.appConfig.sessionThreshold || 0,\n            enableSessionDuration: !!this.context.appConfig.enableSessionDuration,\n            sessionOrigin,\n            isHttps,\n            isSafari: OneSignalUtils.isSafari(),\n            outcomesConfig: this.context.appConfig.userConfig.outcomes,\n        };\n        if (this.context.environmentInfo.isBrowserAndSupportsServiceWorkers &&\n            !this.context.environmentInfo.isUsingSubscriptionWorkaround) {\n            Log.debug(\"Notify SW to upsert session\");\n            await this.context.workerMessenger.unicast(WorkerMessengerCommand.SessionUpsert, payload);\n        }\n        else if (this.context.environmentInfo.canTalkToServiceWorker &&\n            this.context.environmentInfo.isUsingSubscriptionWorkaround) {\n            Log.debug(\"Notify iframe to notify SW to upsert session\");\n            await OneSignal.proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.SESSION_UPSERT, payload);\n        }\n        else { // http w/o our iframe\n            // we probably shouldn't even be here\n            Log.debug(\"Notify upsert: do nothing\");\n        }\n    }\n    async notifySWToDeactivateSession(deviceId, deviceRecord, sessionOrigin) {\n        const isHttps = OneSignalUtils.isHttps();\n        const payload = {\n            deviceId,\n            deviceRecord: deviceRecord ? deviceRecord.serialize() : undefined,\n            sessionThreshold: this.context.appConfig.sessionThreshold,\n            enableSessionDuration: this.context.appConfig.enableSessionDuration,\n            sessionOrigin,\n            isHttps,\n            isSafari: OneSignalUtils.isSafari(),\n            outcomesConfig: this.context.appConfig.userConfig.outcomes,\n        };\n        if (this.context.environmentInfo.isBrowserAndSupportsServiceWorkers &&\n            !this.context.environmentInfo.isUsingSubscriptionWorkaround) {\n            Log.debug(\"Notify SW to deactivate session\");\n            await this.context.workerMessenger.unicast(WorkerMessengerCommand.SessionDeactivate, payload);\n        }\n        else if (this.context.environmentInfo.canTalkToServiceWorker &&\n            this.context.environmentInfo.isUsingSubscriptionWorkaround) {\n            Log.debug(\"Notify SW to deactivate session\");\n            await OneSignal.proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.SESSION_DEACTIVATE, payload);\n        }\n        else { // http w/o our iframe\n            // we probably shouldn't even be here\n            Log.debug(\"Notify deactivate: do nothing\");\n        }\n    }\n    async handleVisibilityChange() {\n        const visibilityState = document.visibilityState;\n        const [deviceId, deviceRecord] = await Promise.all([\n            MainHelper.getDeviceId(),\n            MainHelper.createDeviceRecord(this.context.appConfig.appId, true)\n        ]);\n        if (visibilityState === \"visible\") {\n            this.setupOnFocusAndOnBlurForSession();\n            Log.debug(\"handleVisibilityChange\", \"visible\", `hasFocus: ${document.hasFocus()}`);\n            if (document.hasFocus()) {\n                await this.notifySWToUpsertSession(deviceId, deviceRecord, SessionOrigin.VisibilityVisible);\n            }\n            return;\n        }\n        if (visibilityState === \"hidden\") {\n            Log.debug(\"handleVisibilityChange\", \"hidden\");\n            if (OneSignal.cache.focusHandler && OneSignal.cache.isFocusEventSetup) {\n                window.removeEventListener(\"focus\", OneSignal.cache.focusHandler, true);\n                OneSignal.cache.isFocusEventSetup = false;\n            }\n            if (OneSignal.cache.blurHandler && OneSignal.cache.isBlurEventSetup) {\n                window.removeEventListener(\"blur\", OneSignal.cache.blurHandler, true);\n                OneSignal.cache.isBlurEventSetup = false;\n            }\n            // TODO: (iryna) need to send deactivate from here?\n            const [deviceId, deviceRecord] = await Promise.all([\n                MainHelper.getDeviceId(),\n                MainHelper.createDeviceRecord(this.context.appConfig.appId)\n            ]);\n            await this.notifySWToDeactivateSession(deviceId, deviceRecord, SessionOrigin.VisibilityHidden);\n            return;\n        }\n        // it should never be anything else at this point\n        Log.warn(\"Unhandled visibility state happened\", visibilityState);\n    }\n    async handleOnBeforeUnload() {\n        // don't have much time on before unload\n        // have to skip adding device record to the payload\n        const isHttps = OneSignalUtils.isHttps();\n        const payload = {\n            sessionThreshold: this.context.appConfig.sessionThreshold,\n            enableSessionDuration: this.context.appConfig.enableSessionDuration,\n            sessionOrigin: SessionOrigin.BeforeUnload,\n            isHttps,\n            isSafari: OneSignalUtils.isSafari(),\n            outcomesConfig: this.context.appConfig.userConfig.outcomes,\n        };\n        if (isHttps) {\n            Log.debug(\"Notify SW to deactivate session (beforeunload)\");\n            this.context.workerMessenger.directPostMessageToSW(WorkerMessengerCommand.SessionDeactivate, payload);\n        }\n        else {\n            Log.debug(\"Notify iframe to notify SW to deactivate session (beforeunload)\");\n            await OneSignal.proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.SESSION_DEACTIVATE, payload);\n        }\n    }\n    async handleOnFocus(e) {\n        Log.debug(\"handleOnFocus\", e);\n        /**\n         * Firefox has 2 focus events with different targets (document and window).\n         * While Chrome only has one on window.\n         * Target check is important to avoid double-firing of the event.\n         */\n        if (e.target !== window) {\n            return;\n        }\n        const [deviceId, deviceRecord] = await Promise.all([\n            MainHelper.getDeviceId(),\n            MainHelper.createDeviceRecord(this.context.appConfig.appId, true)\n        ]);\n        await this.notifySWToUpsertSession(deviceId, deviceRecord, SessionOrigin.Focus);\n    }\n    async handleOnBlur(e) {\n        Log.debug(\"handleOnBlur\", e);\n        /**\n         * Firefox has 2 focus events with different targets (document and window).\n         * While Chrome only has one on window.\n         * Target check is important to avoid double-firing of the event.\n         */\n        if (e.target !== window) {\n            return;\n        }\n        const [deviceId, deviceRecord] = await Promise.all([\n            MainHelper.getDeviceId(),\n            MainHelper.createDeviceRecord(this.context.appConfig.appId)\n        ]);\n        await this.notifySWToDeactivateSession(deviceId, deviceRecord, SessionOrigin.Blur);\n    }\n    async upsertSession(deviceId, deviceRecord, sessionOrigin) {\n        const sessionPromise = this.notifySWToUpsertSession(deviceId, deviceRecord, sessionOrigin);\n        if (this.context.environmentInfo.isBrowserAndSupportsServiceWorkers ||\n            this.context.environmentInfo.isUsingSubscriptionWorkaround) {\n            if (!this.context.environmentInfo.canTalkToServiceWorker) {\n                this.onSessionSent = sessionOrigin === SessionOrigin.PlayerCreate;\n                OneSignal.emitter.emit(OneSignal.EVENTS.SESSION_STARTED);\n            }\n            else {\n                this.setupSessionEventListeners();\n            }\n        }\n        else if (!this.context.environmentInfo.isBrowserAndSupportsServiceWorkers &&\n            !this.context.environmentInfo.isUsingSubscriptionWorkaround) {\n            this.onSessionSent = sessionOrigin === SessionOrigin.PlayerCreate;\n            OneSignal.emitter.emit(OneSignal.EVENTS.SESSION_STARTED);\n        }\n        await sessionPromise;\n    }\n    setupSessionEventListeners() {\n        // Only want these events if it's using subscription workaround\n        if (!this.context.environmentInfo.isBrowserAndSupportsServiceWorkers &&\n            !this.context.environmentInfo.isUsingSubscriptionWorkaround) {\n            Log.debug(\"Not setting session event listeners. No service worker possible.\");\n            return;\n        }\n        if (!this.context.environmentInfo.canTalkToServiceWorker) {\n            Log.debug(\"Not setting session event listeners. Can't talk to ServiceWorker due being hosted on an HTTP page.\");\n            return;\n        }\n        // Page lifecycle events https://developers.google.com/web/updates/2018/07/page-lifecycle-api\n        this.setupOnFocusAndOnBlurForSession();\n        // To make sure we add these event listeners only once.\n        if (!OneSignal.cache.isVisibilityChangeEventSetup) {\n            // tracks switching to a different tab, fully covering page with another window, screen lock/unlock\n            document.addEventListener(\"visibilitychange\", this.handleVisibilityChange.bind(this), true);\n            OneSignal.cache.isVisibilityChangeEventSetup = true;\n        }\n        if (!OneSignal.cache.isBeforeUnloadEventSetup) {\n            // tracks closing of a tab / reloading / navigating away\n            window.addEventListener(\"beforeunload\", (e) => {\n                this.handleOnBeforeUnload();\n                // deleting value to not show confirmation dialog\n                delete e.returnValue;\n            }, true);\n            OneSignal.cache.isBeforeUnloadEventSetup = true;\n        }\n    }\n    setupOnFocusAndOnBlurForSession() {\n        Log.debug(\"setupOnFocusAndOnBlurForSession\");\n        if (!OneSignal.cache.focusHandler) {\n            OneSignal.cache.focusHandler = this.handleOnFocus.bind(this);\n        }\n        if (!OneSignal.cache.isFocusEventSetup) {\n            window.addEventListener(\"focus\", OneSignal.cache.focusHandler, true);\n            OneSignal.cache.isFocusEventSetup = true;\n        }\n        if (!OneSignal.cache.blurHandler) {\n            OneSignal.cache.blurHandler = this.handleOnBlur.bind(this);\n        }\n        if (!OneSignal.cache.isBlurEventSetup) {\n            window.addEventListener(\"blur\", OneSignal.cache.blurHandler, true);\n            OneSignal.cache.isBlurEventSetup = true;\n        }\n    }\n    static setupSessionEventListenersForHttp() {\n        if (!OneSignal.context || !OneSignal.context.sessionManager) {\n            Log.error(\"OneSignal.context not available for http to setup session event listeners.\");\n            return;\n        }\n        OneSignal.context.sessionManager.setupSessionEventListeners();\n    }\n    // If user has been subscribed before, send the on_session update to our backend on the first page view.\n    async sendOnSessionUpdateFromPage(deviceRecord) {\n        if (this.onSessionSent) {\n            return;\n        }\n        if (!this.context.pageViewManager.isFirstPageView()) {\n            return;\n        }\n        const existingUser = await this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal();\n        if (!existingUser) {\n            Log.debug(\"Not sending the on session because user is not registered with OneSignal (no device id)\");\n            return;\n        }\n        const deviceId = await MainHelper.getDeviceId();\n        if (!deviceRecord) {\n            deviceRecord = await MainHelper.createDeviceRecord(this.context.appConfig.appId);\n        }\n        if (deviceRecord.subscriptionState !== SubscriptionStateKind.Subscribed &&\n            OneSignal.config.enableOnSession !== true) {\n            return;\n        }\n        try {\n            const newPlayerId = await OneSignalApiShared.updateUserSession(deviceId, deviceRecord);\n            this.onSessionSent = true;\n            // If the returned player id is different, save the new id.\n            if (newPlayerId !== deviceId) {\n                const subscription = await Database.getSubscription();\n                subscription.deviceId = newPlayerId;\n                await Database.setSubscription(subscription);\n            }\n        }\n        catch (e) {\n            Log.error(`Failed to update user session. Error \"${e.message}\" ${e.stack}`);\n        }\n    }\n}\n//# sourceMappingURL=SessionManager.js.map","import Log from '../../../libraries/Log';\nimport TagUtils from '../../../utils/TagUtils';\n/**\n * Manages tags for the TaggingContainer\n */\nexport default class TagManager {\n    constructor(context) {\n        // local tags from tagging container\n        this.tagsFromTaggingContainer = {};\n        this.remoteTags = {};\n        this.context = context;\n    }\n    /**\n     * @returns Promise resolving TagsObject if successful, {} if no change detected, null if failed\n     */\n    async sendTags() {\n        Log.info(\"Category Slidedown Local Tags:\", this.tagsFromTaggingContainer);\n        const localTagsConvertedToApi = TagUtils.convertTagsBooleansToApi(this.tagsFromTaggingContainer);\n        const finalTagsObject = TagUtils.getObjectDifference(localTagsConvertedToApi, this.remoteTags);\n        const shouldSendUpdate = !TagUtils.isTagObjectEmpty(finalTagsObject);\n        if (shouldSendUpdate) {\n            return await OneSignal.sendTags(finalTagsObject);\n        }\n        Log.warn(\"OneSignal: no change detected in Category preferences. Skipping tag update.\");\n        // no change detected, return {}\n        return finalTagsObject;\n    }\n    /**\n     * @param  {TagsObject} tags - values of type \"boolean\"\n     * @returns void\n     */\n    storeTagValuesToUpdate(tags) {\n        this.tagsFromTaggingContainer = tags;\n    }\n    /**\n     * @param  {TagsObject} remoteTags - values of type \"number\"\n     * @returns void\n     */\n    storeRemotePlayerTags(remoteTags) {\n        this.context.tagManager.remoteTags = remoteTags;\n    }\n}\n//# sourceMappingURL=TagManager.js.map","import { WorkerMessenger } from '../libraries/WorkerMessenger';\nimport { DynamicResourceLoader } from '../services/DynamicResourceLoader';\nimport { PageViewManager } from '../managers/PageViewManager';\nimport PermissionManager from '../managers/PermissionManager';\nimport MetricsManager from '../managers/MetricsManager';\nimport ContextHelper from \"../helpers/ContextHelper\";\nimport { UpdateManager } from \"../managers/UpdateManager\";\nimport { PromptsManager } from \"../managers/PromptsManager\";\nimport { SessionManager } from \"../managers/sessionManager/page/SessionManager\";\nimport TagManager from '../managers/tagManager/page/TagManager';\nexport default class Context {\n    constructor(appConfig) {\n        this.appConfig = appConfig;\n        if (typeof OneSignal !== \"undefined\" && !!OneSignal.environmentInfo) {\n            this.environmentInfo = OneSignal.environmentInfo;\n        }\n        this.subscriptionManager = ContextHelper.getSubscriptionManager(this);\n        this.serviceWorkerManager = ContextHelper.getServiceWorkerManager(this);\n        this.pageViewManager = new PageViewManager();\n        this.permissionManager = new PermissionManager();\n        this.workerMessenger = new WorkerMessenger(this);\n        this.updateManager = new UpdateManager(this);\n        this.sessionManager = new SessionManager(this);\n        this.tagManager = new TagManager(this);\n        this.promptsManager = new PromptsManager(this);\n        this.dynamicResourceLoader = new DynamicResourceLoader();\n        this.metricsManager = new MetricsManager(appConfig.metrics.enable, appConfig.metrics.mixpanelReportingToken);\n    }\n}\n//# sourceMappingURL=Context.js.map","export var ConfigIntegrationKind;\n(function (ConfigIntegrationKind) {\n    ConfigIntegrationKind[\"TypicalSite\"] = \"typical\";\n    ConfigIntegrationKind[\"WordPress\"] = \"wordpress\";\n    ConfigIntegrationKind[\"Shopify\"] = \"shopify\";\n    ConfigIntegrationKind[\"Blogger\"] = \"blogger\";\n    ConfigIntegrationKind[\"Magento\"] = \"magento\";\n    ConfigIntegrationKind[\"Drupal\"] = \"drupal\";\n    ConfigIntegrationKind[\"SquareSpace\"] = \"squarespace\";\n    ConfigIntegrationKind[\"Joomla\"] = \"joomla\";\n    ConfigIntegrationKind[\"Weebly\"] = \"weebly\";\n    ConfigIntegrationKind[\"Wix\"] = \"wix\";\n    ConfigIntegrationKind[\"Custom\"] = \"custom\";\n})(ConfigIntegrationKind || (ConfigIntegrationKind = {}));\nexport var NotificationClickMatchBehavior;\n(function (NotificationClickMatchBehavior) {\n    NotificationClickMatchBehavior[\"Exact\"] = \"exact\";\n    NotificationClickMatchBehavior[\"Origin\"] = \"origin\";\n})(NotificationClickMatchBehavior || (NotificationClickMatchBehavior = {}));\nexport var NotificationClickActionBehavior;\n(function (NotificationClickActionBehavior) {\n    NotificationClickActionBehavior[\"Navigate\"] = \"navigate\";\n    NotificationClickActionBehavior[\"Focus\"] = \"focus\";\n})(NotificationClickActionBehavior || (NotificationClickActionBehavior = {}));\n//# sourceMappingURL=AppConfig.js.map","import { ConfigIntegrationKind } from \"../models/AppConfig\";\nimport { WindowEnvironmentKind } from \"../models/WindowEnvironmentKind\";\nimport { SdkInitError, SdkInitErrorKind } from \"../errors/SdkInitError\";\nimport SdkEnvironment from \"../managers/SdkEnvironment\";\nimport OneSignalUtils from \"../utils/OneSignalUtils\";\nimport Utils from \"../context/shared/utils/Utils\";\nimport MainHelper from './MainHelper';\nimport { SERVER_CONFIG_DEFAULTS_SESSION, SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS } from \"../config\";\nimport TagUtils from '../../src/utils/TagUtils';\nexport var IntegrationConfigurationKind;\n(function (IntegrationConfigurationKind) {\n    /**\n     * Configuration comes from the dashboard only.\n     */\n    IntegrationConfigurationKind[IntegrationConfigurationKind[\"Dashboard\"] = 0] = \"Dashboard\";\n    /**\n     * Configuration comes from user-provided JavaScript code only.\n     */\n    IntegrationConfigurationKind[IntegrationConfigurationKind[\"JavaScript\"] = 1] = \"JavaScript\";\n})(IntegrationConfigurationKind || (IntegrationConfigurationKind = {}));\nconst MAX_CATEGORIES = 10;\nexport class ConfigHelper {\n    static async getAppConfig(userConfig, downloadServerAppConfig) {\n        try {\n            if (!userConfig || !userConfig.appId || !OneSignalUtils.isValidUuid(userConfig.appId))\n                throw new SdkInitError(SdkInitErrorKind.InvalidAppId);\n            const serverConfig = await downloadServerAppConfig(userConfig.appId);\n            const appConfig = this.getMergedConfig(userConfig, serverConfig);\n            this.checkRestrictedOrigin(appConfig);\n            return appConfig;\n        }\n        catch (e) {\n            if (e) {\n                if (e.code === 1)\n                    throw new SdkInitError(SdkInitErrorKind.InvalidAppId);\n                else if (e.code === 2)\n                    throw new SdkInitError(SdkInitErrorKind.AppNotConfiguredForWebPush);\n            }\n            throw e;\n        }\n    }\n    static checkRestrictedOrigin(appConfig) {\n        if (appConfig.restrictedOriginEnabled) {\n            if (SdkEnvironment.getWindowEnv() !== WindowEnvironmentKind.ServiceWorker) {\n                if (window.top === window &&\n                    !Utils.contains(window.location.hostname, \".os.tc\") &&\n                    !Utils.contains(window.location.hostname, \".onesignal.com\") &&\n                    !this.doesCurrentOriginMatchConfigOrigin(appConfig.origin)) {\n                    throw new SdkInitError(SdkInitErrorKind.WrongSiteUrl, {\n                        siteUrl: appConfig.origin\n                    });\n                }\n            }\n        }\n    }\n    static doesCurrentOriginMatchConfigOrigin(configOrigin) {\n        try {\n            return location.origin === new URL(configOrigin).origin;\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    static getIntegrationCapabilities(integration) {\n        switch (integration) {\n            case ConfigIntegrationKind.Custom:\n            case ConfigIntegrationKind.WordPress:\n                return { configuration: IntegrationConfigurationKind.JavaScript };\n            default:\n                return { configuration: IntegrationConfigurationKind.Dashboard };\n        }\n    }\n    static getMergedConfig(userConfig, serverConfig) {\n        const configIntegrationKind = this.getConfigIntegrationKind(serverConfig);\n        const subdomain = this.getSubdomainForConfigIntegrationKind(configIntegrationKind, userConfig, serverConfig);\n        const allowLocalhostAsSecureOrigin = (serverConfig.config.setupBehavior ?\n            serverConfig.config.setupBehavior.allowLocalhostAsSecureOrigin :\n            userConfig.allowLocalhostAsSecureOrigin);\n        const isUsingSubscriptionWorkaround = OneSignalUtils.internalIsUsingSubscriptionWorkaround(subdomain, allowLocalhostAsSecureOrigin);\n        const mergedUserConfig = this.getUserConfigForConfigIntegrationKind(configIntegrationKind, userConfig, serverConfig, isUsingSubscriptionWorkaround);\n        return {\n            appId: serverConfig.app_id,\n            subdomain,\n            siteName: serverConfig.config.siteInfo.name,\n            origin: serverConfig.config.origin,\n            httpUseOneSignalCom: serverConfig.config.http_use_onesignal_com,\n            restrictedOriginEnabled: serverConfig.features.restrict_origin && serverConfig.features.restrict_origin.enable,\n            metrics: {\n                enable: serverConfig.features.metrics.enable,\n                mixpanelReportingToken: serverConfig.features.metrics.mixpanel_reporting_token\n            },\n            safariWebId: serverConfig.config.safari_web_id,\n            vapidPublicKey: serverConfig.config.vapid_public_key,\n            onesignalVapidPublicKey: serverConfig.config.onesignal_vapid_public_key,\n            userConfig: mergedUserConfig,\n            // default confirmed deliveries feature to off\n            receiveReceiptsEnable: serverConfig.features.receive_receipts_enable || false,\n            enableOnSession: Utils.valueOrDefault(serverConfig.features.enable_on_session, SERVER_CONFIG_DEFAULTS_SESSION.enableOnSessionForUnsubcribed),\n            sessionThreshold: Utils.valueOrDefault(serverConfig.features.session_threshold, SERVER_CONFIG_DEFAULTS_SESSION.reportingThreshold),\n            enableSessionDuration: Utils.valueOrDefault(serverConfig.features.web_on_focus_enabled, SERVER_CONFIG_DEFAULTS_SESSION.enableOnFocus)\n        };\n    }\n    static getConfigIntegrationKind(serverConfig) {\n        if (serverConfig.config.integration)\n            return serverConfig.config.integration.kind;\n        return ConfigIntegrationKind.Custom;\n    }\n    static getCustomLinkConfig(serverConfig) {\n        const initialState = {\n            enabled: false,\n            style: \"button\",\n            size: \"medium\",\n            unsubscribeEnabled: false,\n            text: {\n                explanation: \"\",\n                subscribe: \"\",\n                unsubscribe: \"\",\n            },\n            color: {\n                button: \"\",\n                text: \"\",\n            }\n        };\n        if (!serverConfig || !serverConfig.config ||\n            !serverConfig.config.staticPrompts || !serverConfig.config.staticPrompts.customlink ||\n            !serverConfig.config.staticPrompts.customlink.enabled) {\n            return initialState;\n        }\n        const customlink = serverConfig.config.staticPrompts.customlink;\n        return {\n            enabled: customlink.enabled,\n            style: customlink.style,\n            size: customlink.size,\n            unsubscribeEnabled: customlink.unsubscribeEnabled,\n            text: customlink.text ? {\n                subscribe: customlink.text.subscribe,\n                unsubscribe: customlink.text.unsubscribe,\n                explanation: customlink.text.explanation,\n            } : initialState.text,\n            color: customlink.color ? {\n                button: customlink.color.button,\n                text: customlink.color.text,\n            } : initialState.color,\n        };\n    }\n    /**\n     * Used for Custom Code Integration Type\n     * @param  {AppUserConfigPromptOptions|undefined} promptOptions\n     * @param  {ServerAppConfigPrompt} defaultsFromServer\n     * @param  {AppUserConfig} wholeUserConfig\n     * @param  {boolean=false} isUsingSubscriptionWorkaround\n     * @returns AppUserConfigPromptOptions\n     */\n    static injectDefaultsIntoPromptOptions(promptOptions, defaultsFromServer, wholeUserConfig, isUsingSubscriptionWorkaround = false) {\n        let customlinkUser = { enabled: false };\n        if (promptOptions && promptOptions.customlink) {\n            customlinkUser = promptOptions.customlink;\n        }\n        const customlinkDefaults = defaultsFromServer.customlink;\n        const promptOptionsConfig = Object.assign({}, promptOptions, { customlink: {\n                enabled: Utils.getValueOrDefault(customlinkUser.enabled, customlinkDefaults.enabled),\n                style: Utils.getValueOrDefault(customlinkUser.style, customlinkDefaults.style),\n                size: Utils.getValueOrDefault(customlinkUser.size, customlinkDefaults.size),\n                unsubscribeEnabled: Utils.getValueOrDefault(customlinkUser.unsubscribeEnabled, customlinkDefaults.unsubscribeEnabled),\n                text: {\n                    subscribe: Utils.getValueOrDefault(customlinkUser.text ? customlinkUser.text.subscribe : undefined, customlinkDefaults.text.subscribe),\n                    unsubscribe: Utils.getValueOrDefault(customlinkUser.text ? customlinkUser.text.unsubscribe : undefined, customlinkDefaults.text.unsubscribe),\n                    explanation: Utils.getValueOrDefault(customlinkUser.text ? customlinkUser.text.explanation : undefined, customlinkDefaults.text.explanation),\n                },\n                color: {\n                    button: Utils.getValueOrDefault(customlinkUser.color ? customlinkUser.color.button : undefined, customlinkDefaults.color.button),\n                    text: Utils.getValueOrDefault(customlinkUser.color ? customlinkUser.color.text : undefined, customlinkDefaults.color.text),\n                },\n            } });\n        if (promptOptionsConfig.slidedown) {\n            promptOptionsConfig.slidedown.enabled = !!promptOptionsConfig.slidedown.enabled;\n            promptOptionsConfig.slidedown.autoPrompt = promptOptionsConfig.slidedown.hasOwnProperty(\"autoPrompt\") ?\n                !!promptOptionsConfig.slidedown.enabled && !!promptOptionsConfig.slidedown.autoPrompt :\n                !!promptOptionsConfig.slidedown.enabled;\n            promptOptionsConfig.slidedown.pageViews = Utils.getValueOrDefault(promptOptionsConfig.slidedown.pageViews, SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.pageViews);\n            promptOptionsConfig.slidedown.timeDelay = Utils.getValueOrDefault(promptOptionsConfig.slidedown.timeDelay, SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.timeDelay);\n            if (promptOptionsConfig.slidedown.categories) {\n                const { categories } = promptOptionsConfig.slidedown;\n                promptOptionsConfig.slidedown.categories = TagUtils.limitCategoriesToMaxCount(categories, MAX_CATEGORIES);\n            }\n        }\n        else {\n            promptOptionsConfig.slidedown = MainHelper.getSlidedownPermissionMessageOptions(promptOptionsConfig);\n            promptOptionsConfig.slidedown.enabled = false;\n            promptOptionsConfig.slidedown.autoPrompt = false;\n            promptOptionsConfig.slidedown.pageViews = SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.pageViews;\n            promptOptionsConfig.slidedown.timeDelay = SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.timeDelay;\n        }\n        if (promptOptionsConfig.native) {\n            promptOptionsConfig.native.enabled = !!promptOptionsConfig.native.enabled;\n            promptOptionsConfig.native.autoPrompt = promptOptionsConfig.native.hasOwnProperty(\"autoPrompt\") ?\n                !!promptOptionsConfig.native.enabled && !!promptOptionsConfig.native.autoPrompt :\n                !!promptOptionsConfig.native.enabled;\n            promptOptionsConfig.native.pageViews = Utils.getValueOrDefault(promptOptionsConfig.native.pageViews, SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.pageViews);\n            promptOptionsConfig.native.timeDelay = Utils.getValueOrDefault(promptOptionsConfig.native.timeDelay, SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.timeDelay);\n        }\n        else {\n            promptOptionsConfig.native = {\n                enabled: false,\n                autoPrompt: false,\n                pageViews: SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.pageViews,\n                timeDelay: SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.timeDelay\n            };\n        }\n        /**\n         * If autoRegister is true, show native prompt for https and slidedown for http ignoring any other related\n         * prompt options.\n         */\n        if (wholeUserConfig.autoRegister === true) {\n            if (isUsingSubscriptionWorkaround) {\n                // disable native prompt\n                promptOptionsConfig.native.enabled = false;\n                promptOptionsConfig.native.autoPrompt = false;\n                // enable slidedown & make it autoPrompt\n                promptOptionsConfig.slidedown.enabled = true;\n                promptOptionsConfig.slidedown.autoPrompt = true;\n            }\n            else {\n                //enable native prompt & make it autoPrompt\n                promptOptionsConfig.native.enabled = true;\n                promptOptionsConfig.native.autoPrompt = true;\n                //leave slidedown settings without change\n            }\n        }\n        promptOptionsConfig.autoPrompt = promptOptionsConfig.native.autoPrompt ||\n            promptOptionsConfig.slidedown.autoPrompt;\n        return promptOptionsConfig;\n    }\n    /**\n     * Used only with Dashboard Configuration\n     * @param  {ServerAppConfig} serverConfig\n     * @returns AppUserConfigPromptOptions\n     */\n    static getPromptOptionsForDashboardConfiguration(serverConfig) {\n        const staticPrompts = serverConfig.config.staticPrompts;\n        const native = staticPrompts.native ? {\n            enabled: staticPrompts.native.enabled,\n            autoPrompt: staticPrompts.native.enabled && staticPrompts.native.autoPrompt !== false,\n            pageViews: Utils.getValueOrDefault(staticPrompts.native.pageViews, SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.pageViews),\n            timeDelay: Utils.getValueOrDefault(staticPrompts.native.timeDelay, SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.timeDelay)\n        } : {\n            enabled: false,\n            autoPrompt: false,\n            pageViews: SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.pageViews,\n            timeDelay: SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.timeDelay\n        };\n        let categories = undefined;\n        if (staticPrompts.slidedown.categories) {\n            categories = TagUtils.limitCategoriesToMaxCount(staticPrompts.slidedown.categories, MAX_CATEGORIES);\n        }\n        const slidedown = {\n            enabled: staticPrompts.slidedown.enabled,\n            // for backwards compatibility if not specifically false, then assume true for autoPrompt on slidedown\n            autoPrompt: staticPrompts.slidedown.enabled &&\n                staticPrompts.slidedown.autoPrompt !== false,\n            pageViews: Utils.getValueOrDefault(staticPrompts.slidedown.pageViews, SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.pageViews),\n            timeDelay: Utils.getValueOrDefault(staticPrompts.slidedown.timeDelay, SERVER_CONFIG_DEFAULTS_PROMPT_DELAYS.timeDelay),\n            actionMessage: staticPrompts.slidedown.actionMessage,\n            acceptButtonText: staticPrompts.slidedown.acceptButton,\n            cancelButtonText: staticPrompts.slidedown.cancelButton,\n            categories,\n        };\n        return {\n            autoPrompt: native.autoPrompt || slidedown.autoPrompt,\n            native,\n            slidedown,\n            fullscreen: {\n                enabled: staticPrompts.fullscreen.enabled,\n                actionMessage: staticPrompts.fullscreen.actionMessage,\n                acceptButton: staticPrompts.fullscreen.acceptButton,\n                cancelButton: staticPrompts.fullscreen.cancelButton,\n                title: staticPrompts.fullscreen.title,\n                message: staticPrompts.fullscreen.message,\n                caption: staticPrompts.fullscreen.caption,\n                autoAcceptTitle: staticPrompts.fullscreen.autoAcceptTitle,\n            },\n            customlink: this.getCustomLinkConfig(serverConfig),\n        };\n    }\n    static getUserConfigForConfigIntegrationKind(configIntegrationKind, userConfig, serverConfig, isUsingSubscriptionWorkaround = false) {\n        const integrationCapabilities = this.getIntegrationCapabilities(configIntegrationKind);\n        switch (integrationCapabilities.configuration) {\n            case IntegrationConfigurationKind.Dashboard:\n                /*\n                  Ignores code-based initialization configuration and uses dashboard configuration only.\n                 */\n                return {\n                    appId: serverConfig.app_id,\n                    autoRegister: false,\n                    autoResubscribe: serverConfig.config.autoResubscribe,\n                    path: serverConfig.config.serviceWorker.path,\n                    serviceWorkerPath: serverConfig.config.serviceWorker.workerName,\n                    serviceWorkerUpdaterPath: serverConfig.config.serviceWorker.updaterWorkerName,\n                    serviceWorkerParam: { scope: serverConfig.config.serviceWorker.registrationScope },\n                    subdomainName: serverConfig.config.siteInfo.proxyOrigin,\n                    promptOptions: this.getPromptOptionsForDashboardConfiguration(serverConfig),\n                    welcomeNotification: {\n                        disable: !serverConfig.config.welcomeNotification.enable,\n                        title: serverConfig.config.welcomeNotification.title,\n                        message: serverConfig.config.welcomeNotification.message,\n                        url: serverConfig.config.welcomeNotification.url\n                    },\n                    notifyButton: {\n                        enable: serverConfig.config.staticPrompts.bell.enabled,\n                        displayPredicate: serverConfig.config.staticPrompts.bell.hideWhenSubscribed ?\n                            () => {\n                                return OneSignal.isPushNotificationsEnabled()\n                                    .then((isPushEnabled) => {\n                                    /* The user is subscribed, so we want to return \"false\" to hide the notify button */\n                                    return !isPushEnabled;\n                                });\n                            } :\n                            null,\n                        size: serverConfig.config.staticPrompts.bell.size,\n                        position: serverConfig.config.staticPrompts.bell.location,\n                        showCredit: false,\n                        offset: {\n                            bottom: `${serverConfig.config.staticPrompts.bell.offset.bottom}px`,\n                            left: `${serverConfig.config.staticPrompts.bell.offset.left}px`,\n                            right: `${serverConfig.config.staticPrompts.bell.offset.right}px`\n                        },\n                        colors: {\n                            'circle.background': serverConfig.config.staticPrompts.bell.color.main,\n                            'circle.foreground': serverConfig.config.staticPrompts.bell.color.accent,\n                            'badge.background': 'black',\n                            'badge.foreground': 'white',\n                            'badge.bordercolor': 'black',\n                            'pulse.color': serverConfig.config.staticPrompts.bell.color.accent,\n                            'dialog.button.background.hovering': serverConfig.config.staticPrompts.bell.color.main,\n                            'dialog.button.background.active': serverConfig.config.staticPrompts.bell.color.main,\n                            'dialog.button.background': serverConfig.config.staticPrompts.bell.color.main,\n                            'dialog.button.foreground': 'white',\n                        },\n                        text: {\n                            'tip.state.unsubscribed': serverConfig.config.staticPrompts.bell.tooltip.unsubscribed,\n                            'tip.state.subscribed': serverConfig.config.staticPrompts.bell.tooltip.subscribed,\n                            'tip.state.blocked': serverConfig.config.staticPrompts.bell.tooltip.blocked,\n                            'message.prenotify': serverConfig.config.staticPrompts.bell.tooltip.unsubscribed,\n                            'message.action.subscribing': serverConfig.config.staticPrompts.bell.message.subscribing,\n                            'message.action.subscribed': serverConfig.config.staticPrompts.bell.message.subscribing,\n                            'message.action.resubscribed': serverConfig.config.staticPrompts.bell.message.subscribing,\n                            'message.action.unsubscribed': serverConfig.config.staticPrompts.bell.message.unsubscribing,\n                            'dialog.main.title': serverConfig.config.staticPrompts.bell.dialog.main.title,\n                            'dialog.main.button.subscribe': serverConfig.config.staticPrompts.bell.dialog.main.subscribeButton,\n                            'dialog.main.button.unsubscribe': serverConfig.config.staticPrompts.bell.dialog.main.unsubscribeButton,\n                            'dialog.blocked.title': serverConfig.config.staticPrompts.bell.dialog.blocked.title,\n                            'dialog.blocked.message': serverConfig.config.staticPrompts.bell.dialog.blocked.message,\n                        },\n                    },\n                    persistNotification: serverConfig.config.notificationBehavior ?\n                        serverConfig.config.notificationBehavior.display.persist : undefined,\n                    webhooks: {\n                        cors: serverConfig.config.webhooks.corsEnable,\n                        'notification.displayed': serverConfig.config.webhooks.notificationDisplayedHook,\n                        'notification.clicked': serverConfig.config.webhooks.notificationClickedHook,\n                        'notification.dismissed': serverConfig.config.webhooks.notificationDismissedHook,\n                    },\n                    notificationClickHandlerMatch: serverConfig.config.notificationBehavior ?\n                        serverConfig.config.notificationBehavior.click.match : undefined,\n                    notificationClickHandlerAction: serverConfig.config.notificationBehavior ?\n                        serverConfig.config.notificationBehavior.click.action : undefined,\n                    allowLocalhostAsSecureOrigin: serverConfig.config.setupBehavior ?\n                        serverConfig.config.setupBehavior.allowLocalhostAsSecureOrigin : undefined,\n                    requiresUserPrivacyConsent: userConfig.requiresUserPrivacyConsent,\n                    outcomes: {\n                        direct: serverConfig.config.outcomes.direct,\n                        indirect: {\n                            enabled: serverConfig.config.outcomes.indirect.enabled,\n                            influencedTimePeriodMin: serverConfig.config.outcomes.indirect.notification_attribution.minutes_since_displayed,\n                            influencedNotificationsLimit: serverConfig.config.outcomes.indirect.notification_attribution.limit,\n                        },\n                        unattributed: serverConfig.config.outcomes.unattributed,\n                    }\n                };\n            case IntegrationConfigurationKind.JavaScript:\n                /*\n                  Ignores dashboard configuration and uses code-based configuration only.\n                  Except injecting some default values for prompts.\n                */\n                const config = Object.assign({}, userConfig, { promptOptions: this.injectDefaultsIntoPromptOptions(userConfig.promptOptions, serverConfig.config.staticPrompts, userConfig, isUsingSubscriptionWorkaround) }, {\n                    serviceWorkerParam: typeof OneSignal !== 'undefined' && !!OneSignal.SERVICE_WORKER_PARAM\n                        ? OneSignal.SERVICE_WORKER_PARAM\n                        : { scope: '/' },\n                    serviceWorkerPath: typeof OneSignal !== 'undefined' && !!OneSignal.SERVICE_WORKER_PATH\n                        ? OneSignal.SERVICE_WORKER_PATH\n                        : 'OneSignalSDKWorker.js',\n                    serviceWorkerUpdaterPath: typeof OneSignal !== 'undefined' && !!OneSignal.SERVICE_WORKER_UPDATER_PATH\n                        ? OneSignal.SERVICE_WORKER_UPDATER_PATH\n                        : 'OneSignalSDKUpdaterWorker.js',\n                    path: !!userConfig.path ? userConfig.path : '/'\n                }, { outcomes: {\n                        direct: serverConfig.config.outcomes.direct,\n                        indirect: {\n                            enabled: serverConfig.config.outcomes.indirect.enabled,\n                            influencedTimePeriodMin: serverConfig.config.outcomes.indirect.notification_attribution.minutes_since_displayed,\n                            influencedNotificationsLimit: serverConfig.config.outcomes.indirect.notification_attribution.limit,\n                        },\n                        unattributed: serverConfig.config.outcomes.unattributed,\n                    } });\n                if (userConfig.hasOwnProperty(\"autoResubscribe\")) {\n                    config.autoResubscribe = !!userConfig.autoResubscribe;\n                }\n                else if (userConfig.hasOwnProperty(\"autoRegister\")) {\n                    config.autoResubscribe = !!userConfig.autoRegister;\n                }\n                else {\n                    config.autoResubscribe = !!serverConfig.config.autoResubscribe;\n                }\n                return config;\n        }\n    }\n    /**\n     * Describes how to merge a dashboard-set subdomain with a/lack of user-supplied subdomain.\n     */\n    static getSubdomainForConfigIntegrationKind(configIntegrationKind, userConfig, serverConfig) {\n        const integrationCapabilities = this.getIntegrationCapabilities(configIntegrationKind);\n        const userValue = userConfig.subdomainName;\n        let serverValue = '';\n        switch (integrationCapabilities.configuration) {\n            case IntegrationConfigurationKind.Dashboard:\n                serverValue = serverConfig.config.siteInfo.proxyOriginEnabled ?\n                    serverConfig.config.siteInfo.proxyOrigin :\n                    undefined;\n                break;\n            case IntegrationConfigurationKind.JavaScript:\n                serverValue = serverConfig.config.subdomain;\n                break;\n        }\n        if (serverValue && !this.shouldUseServerConfigSubdomain(userValue, integrationCapabilities)) {\n            return undefined;\n        }\n        else {\n            return serverValue;\n        }\n    }\n    static shouldUseServerConfigSubdomain(userProvidedSubdomain, capabilities) {\n        switch (capabilities.configuration) {\n            case IntegrationConfigurationKind.Dashboard:\n                /*\n                  Dashboard config using the new web config editor always takes precedence.\n                 */\n                return true;\n            case IntegrationConfigurationKind.JavaScript:\n                /*\n                 * An HTTPS site may be using either a native push integration or a fallback\n                 * subdomain integration. Our SDK decides the integration based on whether\n                 * init option subdomainName appears and the site's protocol.\n                 *\n                 * To avoid having developers write JavaScript to customize the SDK,\n                 * configuration properties like subdomainName are downloaded on page start.\n                 *\n                 * New developers setting up web push can omit subdomainName, but existing\n                 * developers already having written code to configure OneSignal aren't\n                 * removing their code.\n                 *\n                 * When an HTTPS site is configured with a subdomain on the server-side, we do\n                 * not apply it even though we've downloaded this configuration unless the\n                 * user also declares it manually in their initialization code.\n                 */\n                switch (location.protocol) {\n                    case 'https:':\n                        return !!userProvidedSubdomain;\n                    case 'http:':\n                        return true;\n                    default:\n                        return false;\n                }\n        }\n    }\n}\n//# sourceMappingURL=ConfigHelper.js.map","import JSONP from 'jsonp';\nimport SdkEnvironment from \"./managers/SdkEnvironment\";\nimport { WindowEnvironmentKind } from './models/WindowEnvironmentKind';\nimport OneSignalApiSW from \"./OneSignalApiSW\";\nimport OneSignalApiShared from \"./OneSignalApiShared\";\nexport default class OneSignalApi {\n    static getPlayer(appId, playerId) {\n        return OneSignalApiShared.getPlayer(appId, playerId);\n    }\n    static updatePlayer(appId, playerId, options) {\n        return OneSignalApiShared.updatePlayer(appId, playerId, options);\n    }\n    static sendNotification(appId, playerIds, titles, contents, url, icon, data, buttons) {\n        return OneSignalApiShared.sendNotification(appId, playerIds, titles, contents, url, icon, data, buttons);\n    }\n    static jsonpLib(url, fn) {\n        JSONP(url, null, fn);\n    }\n    static async downloadServerAppConfig(appId) {\n        if (SdkEnvironment.getWindowEnv() !== WindowEnvironmentKind.ServiceWorker) {\n            return await new Promise((resolve, reject) => {\n                // Due to CloudFlare's algorithms, the .js extension is required for proper caching. Don't remove it!\n                OneSignalApi.jsonpLib(`${SdkEnvironment.getOneSignalApiUrl().toString()}/sync/${appId}/web`, (err, data) => {\n                    if (err)\n                        reject(err);\n                    else {\n                        if (data.success)\n                            resolve(data);\n                        else // For JSONP, we return a 200 even for errors, there's a success: false param\n                            reject(data);\n                    }\n                });\n            });\n        }\n        else {\n            return await OneSignalApiSW.downloadServerAppConfig(appId);\n        }\n    }\n    static async createUser(deviceRecord) {\n        return await OneSignalApiShared.createUser(deviceRecord);\n    }\n    static async createEmailRecord(appConfig, emailProfile, pushDeviceRecordId) {\n        return await OneSignalApiShared.createEmailRecord(appConfig, emailProfile, pushDeviceRecordId);\n    }\n    static async updateEmailRecord(appConfig, emailProfile, pushDeviceRecordId) {\n        return await OneSignalApiShared.updateEmailRecord(appConfig, emailProfile, pushDeviceRecordId);\n    }\n    static async logoutEmail(appConfig, emailProfile, deviceId) {\n        return await OneSignalApiShared.logoutEmail(appConfig, emailProfile, deviceId);\n    }\n    static async updateUserSession(userId, deviceRecord) {\n        return await OneSignalApiShared.updateUserSession(userId, deviceRecord);\n    }\n}\n//# sourceMappingURL=OneSignalApi.js.map","import OneSignalApi from '../OneSignalApi';\nimport { ConfigHelper } from \"../helpers/ConfigHelper\";\n/**\n * Handles downloading settings from OneSignal and performing any other initialization-related tasks.\n */\nexport default class ConfigManager {\n    /**\n     * Downloads configuration from the OneSignal dashboard, merges it with user-supplied configuration from JavaScript\n     * code, and returns Web SDK-specific configuration.\n     */\n    async getAppConfig(userConfig) {\n        return await ConfigHelper.getAppConfig(userConfig, OneSignalApi.downloadServerAppConfig);\n    }\n    /**\n     * Merges configuration downloaded from the OneSignal dashboard with user-provided JavaScript configuration to produce\n     * a final web SDK-specific configuration.\n     */\n    getMergedConfig(userConfig, serverConfig) {\n        return ConfigHelper.getMergedConfig(userConfig, serverConfig);\n    }\n}\n//# sourceMappingURL=ConfigManager.js.map","import SubscriptionHelper from '../../helpers/SubscriptionHelper';\nimport Context from '../../models/Context';\nimport ConfigManager from '../../managers/ConfigManager';\nimport LocalStorage from '../../utils/LocalStorage';\nimport { EnvironmentInfoHelper } from \"../../context/browser/helpers/EnvironmentInfoHelper\";\nexport default class RemoteFrame {\n    constructor(initOptions) {\n        this.options = {\n            appId: initOptions.appId,\n            subdomain: initOptions.subdomainName,\n            origin: initOptions.origin,\n            siteName: initOptions.siteName,\n            metrics: {\n                enable: false,\n                mixpanelReportingToken: null\n            },\n            userConfig: {}\n        };\n    }\n    /**\n     * Loads the messenger on the iFrame to communicate with the host page and\n     * assigns init options to an iFrame-only initialization of OneSignal.\n     *\n     * Our main host page will wait for all iFrame scripts to complete since the\n     * host page uses the iFrame onload event to begin sending handshake messages\n     * to the iFrame.\n     *\n     * There is no load timeout here; the iFrame initializes it scripts and waits\n     * forever for the first handshake message.\n     */\n    async initialize() {\n        const creator = window.opener || window.parent;\n        if (creator == window) {\n            document.write(`<span style='font-size: 14px; color: red; font-family: sans-serif;'>OneSignal: This page cannot be directly opened, and must be opened as a result of a subscription call.</span>`);\n            return Promise.resolve();\n        }\n        // The rest of our SDK isn't refactored enough yet to accept typed objects\n        // Within this class, we can use them, but when we assign them to\n        // OneSignal.config, assign the simple string versions\n        const rasterizedOptions = Object.assign({}, this.options);\n        rasterizedOptions.appId = rasterizedOptions.appId;\n        /* This is necessary, otherwise the subdomain is lost after ConfigManager.getAppConfig */\n        rasterizedOptions.subdomainName = rasterizedOptions.subdomain;\n        rasterizedOptions.origin = rasterizedOptions.origin;\n        OneSignal.config = rasterizedOptions || {};\n        const appConfig = await new ConfigManager().getAppConfig(rasterizedOptions);\n        OneSignal.environmentInfo = EnvironmentInfoHelper.getEnvironmentInfo();\n        OneSignal.context = new Context(appConfig);\n        OneSignal.context.workerMessenger.listen(true);\n        OneSignal.initialized = true;\n        this.loadPromise = {};\n        this.loadPromise.promise = new Promise((resolve, reject) => {\n            this.loadPromise.resolver = resolve;\n            this.loadPromise.rejector = reject;\n        });\n        this.establishCrossOriginMessaging();\n        return this.loadPromise.promise;\n    }\n    establishCrossOriginMessaging() { }\n    dispose() {\n        // Removes all events\n        this.messenger.destroy();\n    }\n    finishInitialization() {\n        this.loadPromise.resolver();\n    }\n    async subscribe() {\n        // Do not register OneSignalSDKUpdaterWorker.js for HTTP popup sites; the file does not exist\n        const isPushEnabled = LocalStorage.getIsPushNotificationsEnabled();\n        const windowCreator = opener || parent;\n        if (!isPushEnabled) {\n            SubscriptionHelper.registerForPush();\n        }\n        else {\n            if (windowCreator) {\n                window.close();\n            }\n        }\n    }\n}\n//# sourceMappingURL=RemoteFrame.js.map","import Event from '../../Event';\nimport InitHelper from '../../helpers/InitHelper';\nimport TestHelper from '../../helpers/TestHelper';\nimport SdkEnvironment from '../../managers/SdkEnvironment';\nimport Postmam from '../../Postmam';\nimport Database from '../../services/Database';\nimport { unsubscribeFromPush } from '../../utils';\nimport RemoteFrame from './RemoteFrame';\nimport Log from '../../libraries/Log';\nimport { WorkerMessengerCommand } from \"../../libraries/WorkerMessenger\";\n/**\n * The actual OneSignal proxy frame contents / implementation, that is loaded\n * into the iFrame URL as subdomain.onesignal.com/webPushIFrame or\n * subdomain.os.tc/webPushIFrame. *\n */\nexport default class ProxyFrame extends RemoteFrame {\n    /**\n     * Loads the messenger on the iFrame to communicate with the host page and\n     * assigns init options to an iFrame-only initialization of OneSignal.\n     *\n     * Our main host page will wait for all iFrame scripts to complete since the\n     * host page uses the iFrame onload event to begin sending handshake messages\n     * to the iFrame.\n     *\n     * There is no load timeout here; the iFrame initializes it scripts and waits\n     * forever for the first handshake message.\n     */\n    initialize() {\n        const promise = super.initialize();\n        Event.trigger('httpInitialize');\n        return promise;\n    }\n    establishCrossOriginMessaging() {\n        if (this.messenger) {\n            this.messenger.destroy();\n        }\n        this.messenger = new Postmam(window, this.options.origin, this.options.origin);\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.CONNECTED, this.onMessengerConnect.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.IFRAME_POPUP_INITIALIZE, this.onProxyFrameInitializing.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION, this.onRemoteNotificationPermission.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET, this.onRemoteDatabaseGet.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET_ALL, this.onRemoteDatabaseGetAll.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_PUT, this.onRemoteDatabasePut.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_REMOVE, this.onRemoteDatabaseRemove.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.UNSUBSCRIBE_FROM_PUSH, this.onUnsubscribeFromPush.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.MARK_PROMPT_DISMISSED, this.onMarkPromptDismissed.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.IS_SUBSCRIBED, this.onIsSubscribed.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.UNSUBSCRIBE_PROXY_FRAME, this.onUnsubscribeProxyFrame.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.SERVICE_WORKER_STATE, this.onServiceWorkerState.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.GET_WORKER_VERSION, this.onWorkerVersion.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.SUBSCRIPTION_EXPIRATION_STATE, this.onSubscriptionExpirationState.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.PROCESS_EXPIRING_SUBSCRIPTIONS, this.onProcessExpiringSubscriptions.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.GET_SUBSCRIPTION_STATE, this.onGetSubscriptionState.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.SESSION_UPSERT, this.onSessionUpsert.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.SESSION_DEACTIVATE, this.onSessionDeactivate.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_REQUEST, this.onAreYouVisibleRequest.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_RESPONSE, this.onAreYouVisibleResponse.bind(this));\n        this.messenger.listen();\n    }\n    retriggerRemoteEvent(eventName, eventData) {\n        this.messenger.message(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT, { eventName, eventData });\n    }\n    async onMessengerConnect(_) {\n        Log.debug(`(${SdkEnvironment.getWindowEnv().toString()}) Successfully established cross-origin communication.`);\n        this.finishInitialization();\n        return false;\n    }\n    async onProxyFrameInitializing(message) {\n        Log.info(`(${SdkEnvironment.getWindowEnv().toString()}) The iFrame has just received initOptions from the host page!`);\n        const config = Object.assign({}, message.data.hostInitOptions, OneSignal.config, { pageUrl: message.data.pageUrl });\n        OneSignal.config = config;\n        InitHelper.installNativePromptPermissionChangedHook();\n        // 3/30/16: For HTTP sites, put the host page URL as default URL if one doesn't exist already\n        const defaultUrl = await Database.get('Options', 'defaultUrl');\n        if (!defaultUrl) {\n            await Database.put('Options', { key: 'defaultUrl', value: new URL(OneSignal.config.pageUrl).origin });\n        }\n        /**\n         * When a user is on http://example.com and receives a notification, we want to open a new window only if the\n         * notification's URL is different from http://example.com. The service worker, which only controls\n         * subdomain.onesignal.com, doesn't know that the host URL is http://example.com. Although defaultUrl above\n         * sets the HTTP's origin, this can be modified if users call setDefaultTitle(). lastKnownHostUrl therefore\n         * stores the last visited full page URL.\n         */\n        await Database.put('Options', { key: 'lastKnownHostUrl', value: OneSignal.config.pageUrl });\n        await InitHelper.initSaveState();\n        await InitHelper.storeInitialValues();\n        await InitHelper.saveInitOptions();\n        if (navigator.serviceWorker && window.location.protocol === 'https:') {\n            try {\n                const context = OneSignal.context;\n                context.serviceWorkerManager.establishServiceWorkerChannel();\n            }\n            catch (e) {\n                Log.error(`Error interacting with Service Worker inside an HTTP-hosted iFrame:`, e);\n            }\n        }\n        message.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE);\n    }\n    async onRemoteNotificationPermission(message) {\n        const context = OneSignal.context;\n        const permission = await context.permissionManager.getReportedNotificationPermission(context.appConfig.safariWebId);\n        message.reply(permission);\n        return false;\n    }\n    async onRemoteDatabaseGet(message) {\n        // retrievals is an array of key-value pairs e.g. [{table: 'Ids', keys:\n        // 'someId'}, {table: 'Ids', keys: 'someId'}]\n        const retrievals = message.data;\n        const retrievalOpPromises = [];\n        for (let retrieval of retrievals) {\n            const { table, key } = retrieval;\n            retrievalOpPromises.push(Database.get(table, key));\n        }\n        const results = await Promise.all(retrievalOpPromises);\n        message.reply(results);\n        return false;\n    }\n    async onRemoteDatabaseGetAll(message) {\n        const table = message.data.table;\n        const results = await Database.getAll(table);\n        message.reply(results);\n        return false;\n    }\n    async onRemoteDatabasePut(message) {\n        // insertions is an array of key-value pairs e.g. [table: {'Options': keypath: {key: persistNotification, value: '...'}}, {table: 'Ids', keypath: {type: 'userId', id: '...'}]\n        // It's formatted that way because our IndexedDB database is formatted that way\n        const insertions = message.data;\n        let insertionOpPromises = [];\n        for (let insertion of insertions) {\n            let { table, keypath } = insertion;\n            insertionOpPromises.push(Database.put(table, keypath));\n        }\n        await Promise.all(insertionOpPromises);\n        message.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE);\n        return false;\n    }\n    async onRemoteDatabaseRemove(message) {\n        // removals is an array of key-value pairs e.g. [table: {'Options': keypath: {key: persistNotification, value: '...'}}, {table: 'Ids', keypath: {type: 'userId', id: '...'}]\n        // It's formatted that way because our IndexedDB database is formatted that way\n        const removals = message.data;\n        let removalOpPromises = [];\n        for (let removal of removals) {\n            let { table, keypath } = removal;\n            removalOpPromises.push(Database.remove(table, keypath));\n        }\n        await Promise.all(removalOpPromises);\n        message.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE);\n        return false;\n    }\n    async onUnsubscribeFromPush(message) {\n        Log.debug('(Reposted from iFrame -> Host) User unsubscribed but permission granted. Re-prompting the user for push.');\n        try {\n            await unsubscribeFromPush();\n            message.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE);\n        }\n        catch (e) {\n            Log.debug('Failed to unsubscribe from push remotely:', e);\n        }\n    }\n    async onMarkPromptDismissed(message) {\n        Log.debug('(Reposted from iFrame -> Host) Marking prompt as dismissed.');\n        await TestHelper.markHttpsNativePromptDismissed();\n        message.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE);\n        return false;\n    }\n    async onIsSubscribed(message) {\n        const isSubscribed = await OneSignal.isPushNotificationsEnabled();\n        message.reply(isSubscribed);\n        return false;\n    }\n    async onUnsubscribeProxyFrame(message) {\n        const isSubscribed = await OneSignal.isPushNotificationsEnabled();\n        if (isSubscribed) {\n            /*\n              Set a flag to prevent a notification from being sent from OneSignal's\n              side. The subscription stored locally on the browser is live and\n              messageable, but we can't query it or unsubscribe from it since we're on\n              an insecure origin. The most we can do is have our SDK delete the stored\n              information to pretend we're not subscribed on both the client SDK side\n              and the server side.\n            */\n            // Set a flag remotely to prevent notifications from being sent\n            await OneSignal.setSubscription(false);\n            // Orphan the subscription by removing data stored about it\n            // This causes our SDK to think we're no longer subscribed on this frame\n            await OneSignal.database.rebuild();\n        }\n        message.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE);\n        return false;\n    }\n    async onServiceWorkerState(message) {\n        const context = OneSignal.context;\n        const result = await context.serviceWorkerManager.getActiveState();\n        message.reply(result);\n        return false;\n    }\n    async onWorkerVersion(message) {\n        const context = OneSignal.context;\n        const result = await context.serviceWorkerManager.getWorkerVersion();\n        message.reply(result);\n        return false;\n    }\n    async onSubscriptionExpirationState(message) {\n        const context = OneSignal.context;\n        const result = await context.subscriptionManager.isSubscriptionExpiring();\n        message.reply(result);\n        return false;\n    }\n    async onProcessExpiringSubscriptions(message) {\n        const context = OneSignal.context;\n        const result = await InitHelper.processExpiringSubscriptions();\n        message.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE);\n        return false;\n    }\n    async onGetSubscriptionState(message) {\n        const context = OneSignal.context;\n        const result = await context.subscriptionManager.getSubscriptionState();\n        message.reply(result);\n        return false;\n    }\n    async onSessionUpsert(message) {\n        const context = OneSignal.context;\n        const payload = message.data;\n        context.workerMessenger.directPostMessageToSW(WorkerMessengerCommand.SessionUpsert, payload);\n        message.reply(true);\n    }\n    async onSessionDeactivate(message) {\n        const context = OneSignal.context;\n        const payload = message.data;\n        context.workerMessenger.directPostMessageToSW(WorkerMessengerCommand.SessionDeactivate, payload);\n        message.reply(true);\n    }\n    async onAreYouVisibleRequest(message) {\n        Log.debug(\"onAreYouVisibleRequest iframe\", message);\n    }\n    async onAreYouVisibleResponse(message) {\n        Log.debug(\"onAreYouVisibleResponse iframe\", message);\n        const context = OneSignal.context;\n        const payload = message.data;\n        context.workerMessenger.directPostMessageToSW(WorkerMessengerCommand.AreYouVisibleResponse, payload);\n        message.reply(true);\n    }\n}\n//# sourceMappingURL=ProxyFrame.js.map","import Postmam from '../../Postmam';\nimport RemoteFrame from './RemoteFrame';\n/**\n * The actual OneSignal proxy frame contents / implementation, that is loaded\n * into the iFrame URL as subdomain.onesignal.com/webPushIFrame or\n * subdomain.os.tc/webPushIFrame. *\n */\nexport default class SubscriptionModal extends RemoteFrame {\n    constructor(initOptions) {\n        super(initOptions);\n    }\n    establishCrossOriginMessaging() {\n        if (this.messenger) {\n            this.messenger.destroy();\n        }\n        this.messenger = new Postmam(window.parent, this.options.origin, this.options.origin);\n    }\n}\n//# sourceMappingURL=SubscriptionModal.js.map","import SdkEnvironment from '../../managers/SdkEnvironment';\nimport Postmam from '../../Postmam';\nimport RemoteFrame from './RemoteFrame';\nimport Log from '../../libraries/Log';\n/**\n * The actual OneSignal proxy frame contents / implementation, that is loaded\n * into the iFrame URL as subdomain.onesignal.com/webPushIFrame or\n * subdomain.os.tc/webPushIFrame. *\n */\nexport default class SubscriptionPopup extends RemoteFrame {\n    constructor(initOptions) {\n        super(initOptions);\n    }\n    /**\n     * Loads the messenger on the iFrame to communicate with the host page and\n     * assigns init options to an iFrame-only initialization of OneSignal.\n     *\n     * Our main host page will wait for all iFrame scripts to complete since the\n     * host page uses the iFrame onload event to begin sending handshake messages\n     * to the iFrame.\n     *\n     * There is no load timeout here; the iFrame initializes it scripts and waits\n     * forever for the first handshake message.\n     */\n    // initialize() is implemented by base RemoteFrame class\n    establishCrossOriginMessaging() {\n        this.messenger = new Postmam(window.opener, this.options.origin, this.options.origin);\n        this.messenger.once(OneSignal.POSTMAM_COMMANDS.CONNECTED, this.onMessengerConnected.bind(this));\n        // The host page will receive this event, and then call connect()\n        this.messenger.postMessage(OneSignal.POSTMAM_COMMANDS.POPUP_BEGIN_MESSAGEPORT_COMMS, null);\n        this.messenger.listen();\n    }\n    onMessengerConnected(_) {\n        Log.debug(`(${SdkEnvironment.getWindowEnv().toString()}) The host page is now ready to receive commands from the HTTP popup.`);\n        this.finishInitialization();\n    }\n}\n//# sourceMappingURL=SubscriptionPopup.js.map","import Event from '../Event';\nimport LegacyManager from '../managers/LegacyManager';\nimport SdkEnvironment from '../managers/SdkEnvironment';\nimport { WindowEnvironmentKind } from '../models/WindowEnvironmentKind';\nimport ProxyFrame from '../modules/frames/ProxyFrame';\nimport SubscriptionModal from '../modules/frames/SubscriptionModal';\nimport SubscriptionPopup from '../modules/frames/SubscriptionPopup';\nimport { getConsoleStyle } from '../utils';\nimport Log from '../libraries/Log';\nexport default class HttpHelper {\n    // Http only - Only called from iframe's init.js\n    static async initHttp(options) {\n        Log.debug(`Called %cinitHttp(${JSON.stringify(options, null, 4)})`, getConsoleStyle('code'));\n        switch (SdkEnvironment.getWindowEnv()) {\n            case WindowEnvironmentKind.OneSignalProxyFrame:\n                OneSignal.proxyFrame = new ProxyFrame(options);\n                await OneSignal.proxyFrame.initialize();\n                /**\n                 * Our Rails-side subscription popup/modal depends on\n                 * OneSignal.iframePostmam, OneSignal.popupPostmam, and\n                 * OneSignal.modalPostmam, which don't exist anymore.\n                 */\n                LegacyManager.ensureBackwardsCompatibility(OneSignal);\n                break;\n            case WindowEnvironmentKind.OneSignalSubscriptionPopup:\n                OneSignal.subscriptionPopup = new SubscriptionPopup(options);\n                await OneSignal.subscriptionPopup.initialize();\n                /**\n                 * Our Rails-side subscription popup/modal depends on\n                 * OneSignal.iframePostmam, OneSignal.popupPostmam, and\n                 * OneSignal.modalPostmam, which don't exist anymore.\n                 */\n                LegacyManager.ensureBackwardsCompatibility(OneSignal);\n                Event.trigger('httpInitialize');\n                break;\n            case WindowEnvironmentKind.OneSignalSubscriptionModal:\n                OneSignal.subscriptionModal = new SubscriptionModal(options);\n                /*\n                  WARNING: Do not await on modal initialization; the modal uses direct\n                  postmessage and does not establish a \"connection\" to wait on\n                */\n                /*\n                  WARNING: The establishCrossOriginMessaging() statement is necessary.\n                  The common base class implementation of initialize() does an\n                  asynchronous download of settings, but the modal needs the 'messenger'\n                  variable (created by calling establishCrossOriginmessaging()) to exist\n                  immediately. The hacky way to solve this for now is to force this part\n                  of the initialization earlier.\n                */\n                OneSignal.subscriptionModal.establishCrossOriginMessaging();\n                OneSignal.subscriptionModal.initialize();\n                /* Our Rails-side subscription popup/modal depends on\n                 * OneSignal.iframePostmam, OneSignal.popupPostmam, and\n                 * OneSignal.modalPostmam, which don't exist anymore.\n                 */\n                LegacyManager.ensureBackwardsCompatibility(OneSignal);\n                Event.trigger('httpInitialize');\n                break;\n            default:\n                Log.error(\"Unsupported HTTP initialization branch.\");\n                break;\n        }\n    }\n}\n//# sourceMappingURL=HttpHelper.js.map","import Environment from '../../Environment';\nimport Event from '../../Event';\nimport Postmam from '../../Postmam';\nimport { timeoutPromise, triggerNotificationPermissionChanged, deepCopy } from '../../utils';\nimport Log from '../../libraries/Log';\n/**\n * Manager for an instance of the OneSignal proxy frame, for use from the main\n * page (not the iFrame itself).\n *\n * This is loaded as subdomain.onesignal.com/webPushIFrame or\n * subdomain.os.tc/webPushIFrame. *\n */\nexport default class ProxyFrameHost {\n    /**\n     * How long to wait to load the proxy frame before timing out.\n     */\n    static get LOAD_TIMEOUT_MS() {\n        return 15000;\n    }\n    /**\n     *\n     * @param origin The URL object describing the origin to load.\n     */\n    constructor(origin) {\n        this.url = origin;\n        this.url.pathname = 'webPushIframe';\n    }\n    /**\n     * Creates and loads an iFrame on the DOM, replacing any existing iFrame of\n     * the same URL.\n     *\n     * Rejects with a TimeoutError if the frame doesn't load within a specified time.\n     */\n    async load() {\n        /*\n          This class removes existing iFrames with the same URL. This prevents\n          multiple iFrames to the same origin, which can cause issues with\n          cross-origin messaging.\n        */\n        Log.debug('Opening an iFrame to', this.url.toString());\n        this.removeFrame();\n        const iframe = document.createElement(\"iframe\");\n        iframe.style.display = \"none\";\n        iframe.src = this.url.toString();\n        iframe.sandbox = 'allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation';\n        this.loadPromise = {};\n        this.loadPromise.promise = new Promise((resolve, reject) => {\n            this.loadPromise.resolver = resolve;\n            this.loadPromise.rejector = reject;\n        });\n        document.body.appendChild(iframe);\n        iframe.onload = this.onFrameLoad.bind(this);\n        this.element = iframe;\n        // Display a timeout warning if frame doesn't load in time, but don't prevent it from loading if the network is just slow\n        timeoutPromise(this.loadPromise.promise, ProxyFrameHost.LOAD_TIMEOUT_MS).catch(() => {\n            if (window === window.top) {\n                Log.warn(`OneSignal: Loading the required iFrame ${this.url.toString()} timed out. Check that the Site URL onesignal.com dashboard web config is ${location.origin}. Only the Site URL specified there is allowed to use load the iFrame.`);\n            }\n        });\n        return this.loadPromise.promise;\n    }\n    removeFrame() {\n        if (!Environment.isBrowser())\n            return;\n        const existingInstance = document.querySelector(`iframe[src='${this.url.toString()}']`);\n        if (existingInstance)\n            existingInstance.remove();\n    }\n    onFrameLoad(_) {\n        this.establishCrossOriginMessaging();\n    }\n    establishCrossOriginMessaging() {\n        if (this.messenger) {\n            // Remove all previous events; window message events should not go to any previous listeners\n            this.messenger.destroy();\n        }\n        this.messenger = new Postmam(this.element.contentWindow, this.url.toString(), this.url.toString());\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.CONNECTED, this.onMessengerConnect.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT, this.onRemoteRetriggerEvent.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION_CHANGED, this.onRemoteNotificationPermissionChanged.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.REQUEST_HOST_URL, this.onRequestHostUrl.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.SERVICEWORKER_COMMAND_REDIRECT, this.onServiceWorkerCommandRedirect.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.GET_EVENT_LISTENER_COUNT, this.onGetEventListenerCount.bind(this));\n        this.messenger.on(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_REQUEST, this.onAreYouVisibleRequest.bind(this));\n        this.messenger.connect();\n    }\n    dispose() {\n        // Removes all events\n        if (this.messenger) {\n            this.messenger.destroy();\n        }\n        this.removeFrame();\n    }\n    async onMessengerConnect(_) {\n        Log.debug(`Successfully established cross-origin communication for iFrame at ${this.url.toString()}`);\n        this.messenger.message(OneSignal.POSTMAM_COMMANDS.IFRAME_POPUP_INITIALIZE, {\n            hostInitOptions: deepCopy(OneSignal.config),\n            pageUrl: window.location.href,\n        }, (reply) => {\n            if (reply.data === OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE) {\n                this.loadPromise.resolver();\n                // This needs to be initialized so that isSubscribed() can be called to\n                // determine whether the user is subscribed to Frame A or B\n                //Event.trigger(OneSignal.EVENTS.SDK_INITIALIZED);\n            }\n            return false;\n        });\n    }\n    onRemoteRetriggerEvent(message) {\n        // e.g. { eventName: 'subscriptionChange', eventData: true}\n        let { eventName, eventData } = message.data;\n        Event.trigger(eventName, eventData, message.source);\n        return false;\n    }\n    onRemoteNotificationPermissionChanged(message) {\n        let { forceUpdatePermission } = message.data;\n        triggerNotificationPermissionChanged(forceUpdatePermission);\n        return false;\n    }\n    onRequestHostUrl(message) {\n        message.reply(location.href);\n        return false;\n    }\n    onServiceWorkerCommandRedirect(message) {\n        const url = message.data;\n        if (url && url.startsWith(\"http\")) {\n            window.location.href = url;\n        }\n        return false;\n    }\n    onGetEventListenerCount(message) {\n        const eventName = message.data;\n        Log.debug('(Reposted from iFrame -> Host) Getting event listener count for ', eventName);\n        message.reply(OneSignal.emitter.numberOfListeners(eventName));\n        return false;\n    }\n    isSubscribed() {\n        return new Promise(resolve => {\n            this.messenger.message(OneSignal.POSTMAM_COMMANDS.IS_SUBSCRIBED, null, (reply) => {\n                resolve(reply.data);\n            });\n        });\n    }\n    unsubscribeFromPush() {\n        return new Promise(resolve => {\n            this.messenger.message(OneSignal.POSTMAM_COMMANDS.UNSUBSCRIBE_PROXY_FRAME, null, (_reply) => { resolve(); });\n        });\n    }\n    getProxyServiceWorkerActiveState() {\n        return new Promise((resolve, reject) => {\n            this.message(OneSignal.POSTMAM_COMMANDS.SERVICE_WORKER_STATE, null, (reply) => {\n                resolve(reply.data);\n            });\n        });\n    }\n    async runCommand(command, payload = null) {\n        const result = await new Promise((resolve, _reject) => {\n            this.message(command, payload, (reply) => {\n                resolve(reply.data);\n            });\n        });\n        return result;\n    }\n    onAreYouVisibleRequest(event) {\n        Log.debug(\"onAreYouVisibleRequest page\", event);\n        const response = {\n            timestamp: event.data.timestamp,\n            focused: document.hasFocus(),\n        };\n        this.message(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_RESPONSE, response);\n    }\n    /**\n     * Shortcut method to messenger.message().\n     */\n    message(..._) {\n        this.messenger.message.apply(this.messenger, arguments);\n    }\n}\n//# sourceMappingURL=ProxyFrameHost.js.map","import { EnvironmentKind } from '../models/EnvironmentKind';\nimport ProxyFrameHost from '../modules/frames/ProxyFrameHost';\nimport SdkEnvironment from './SdkEnvironment';\nimport { Utils } from '../context/shared/utils/Utils';\nexport default class AltOriginManager {\n    constructor() {\n    }\n    /*\n    * This loads all possible iframes that a site could be subscribed to\n    * (os.tc & onesignal.com) then checks to see we are subscribed to any.\n    * If we find what we are subscribed to both unsubscribe from onesignal.com.\n    * This method prefers os.tc over onesignal.com where possible.\n    */\n    static async discoverAltOrigin(appConfig) {\n        const iframeUrls = AltOriginManager.getOneSignalProxyIframeUrls(appConfig);\n        const allProxyFrameHosts = [];\n        for (const iframeUrl of iframeUrls) {\n            const proxyFrameHost = new ProxyFrameHost(iframeUrl);\n            // A TimeoutError could happen here; it gets rejected out of this entire loop\n            await proxyFrameHost.load();\n            allProxyFrameHosts.push(proxyFrameHost);\n        }\n        const subscribedProxyFrameHosts = await AltOriginManager.subscribedProxyFrameHosts(allProxyFrameHosts);\n        await AltOriginManager.removeDuplicatedAltOriginSubscription(subscribedProxyFrameHosts);\n        let preferredProxyFrameHost;\n        if (subscribedProxyFrameHosts.length === 0) {\n            // Use the first (preferred) host (os.tc in this case) if not subscribed to any\n            preferredProxyFrameHost = allProxyFrameHosts[0];\n        }\n        else {\n            // Otherwise if their was one or more use the highest preferred one in the list\n            preferredProxyFrameHost = subscribedProxyFrameHosts[0];\n        }\n        // Remove all other unneeded iframes from the page\n        for (const proxyFrameHost of allProxyFrameHosts) {\n            if (preferredProxyFrameHost !== proxyFrameHost) {\n                proxyFrameHost.dispose();\n            }\n        }\n        return preferredProxyFrameHost;\n    }\n    static async subscribedProxyFrameHosts(proxyFrameHosts) {\n        const subscribed = [];\n        for (const proxyFrameHost of proxyFrameHosts) {\n            if (await proxyFrameHost.isSubscribed()) {\n                subscribed.push(proxyFrameHost);\n            }\n        }\n        return subscribed;\n    }\n    /*\n    * If the user is subscribed to more than OneSignal subdomain (AKA HTTP setup)\n    * unsubscribe them from ones lower in the list.\n    * Example: Such as being being subscribed to mysite.os.tc & mysite.onesignal.com\n    */\n    static async removeDuplicatedAltOriginSubscription(subscribedProxyFrameHosts) {\n        // Not subscribed or subscribed to just one domain, nothing to do, no duplicates\n        if (subscribedProxyFrameHosts.length < 2) {\n            return;\n        }\n        // At this point we have 2+ subscriptions\n        // Keep only the first (highest priority) domain and unsubscribe the rest.\n        const toUnsubscribeProxyFrameHosts = subscribedProxyFrameHosts.slice(1);\n        for (const dupSubscribedHost of toUnsubscribeProxyFrameHosts) {\n            await dupSubscribedHost.unsubscribeFromPush();\n        }\n    }\n    /**\n     * Only used for sites using a OneSignal subdomain (AKA HTTP setup).\n     *\n     * Returns the array of possible URL in which the push subscription and\n     * IndexedDb site data will be stored.\n     *\n     * This URL was typically subdomain.onesignal.com, until we switched\n     * to subdomain.os.tc for a shorter origin to fit into Mac's native\n     * notifications on Chrome 59+.\n     *\n     * Because a user may be subscribed to subdomain.onesignal.com or\n     * subdomain.os.tc, we have to load both in certain scenarios to determine\n     * which the user is subscribed to; hence, this method returns an array of\n     * possible URLs.\n     *\n     * Order of URL is in priority order of one should be used.\n     */\n    static getCanonicalSubscriptionUrls(config, buildEnv = SdkEnvironment.getApiEnv()) {\n        const subscriptionDomain = AltOriginManager.getWildcardLegacySubscriptionDomain(buildEnv);\n        const legacyDomainUrl = new URL(`https://${config.subdomain}.${subscriptionDomain}`);\n        // Staging and Dev don't support going through the os.tc domain\n        if (buildEnv !== EnvironmentKind.Production) {\n            return [legacyDomainUrl];\n        }\n        // Use os.tc as a first pick\n        const urls = [new URL(`https://${config.subdomain}.os.tc`)];\n        if (config.httpUseOneSignalCom) {\n            urls.push(legacyDomainUrl);\n        }\n        return urls;\n    }\n    /**\n     * Get the wildcard part of the legacy subscription domain.\n     * Examples: onesignal.com, staging.onesignal.com, or localhost\n     */\n    static getWildcardLegacySubscriptionDomain(buildEnv) {\n        const apiUrl = SdkEnvironment.getOneSignalApiUrl(buildEnv);\n        // Prod and Dev support domains like *.onesignal.com and *.localhost \n        let envSubdomainParts = 2;\n        if (buildEnv === EnvironmentKind.Staging) {\n            // Allow up to 3 parts so *.staging.onesignal.com works.\n            envSubdomainParts = 3;\n        }\n        return Utils.lastParts(apiUrl.host, \".\", envSubdomainParts);\n    }\n    /**\n     * Returns the URL of the OneSignal proxy iFrame helper.\n     */\n    static getOneSignalProxyIframeUrls(config) {\n        const urls = AltOriginManager.getCanonicalSubscriptionUrls(config);\n        for (const url of urls) {\n            url.pathname = 'webPushIframe';\n        }\n        return urls;\n    }\n}\n//# sourceMappingURL=AltOriginManager.js.map","export class ValidatorUtils {\n    static isValidUrl(url, options) {\n        if (options && options.allowNull && url === null)\n            return true;\n        else if (options && options.allowEmpty && (url === null || url === undefined))\n            return true;\n        else {\n            try {\n                const parsedUrl = new URL(url);\n                if (options && options.requireHttps) {\n                    return parsedUrl.protocol === 'https:';\n                }\n                else\n                    return true;\n            }\n            catch (e) {\n                return false;\n            }\n        }\n    }\n    static isValidBoolean(bool, options) {\n        if (options && options.allowNull && bool === null)\n            return true;\n        else\n            return bool === true || bool === false;\n    }\n    static isValidArray(array, options) {\n        if (options && options.allowNull && array === null)\n            return true;\n        else if (options && options.allowEmpty && (array === null || array === undefined))\n            return true;\n        else\n            return array instanceof Array;\n    }\n}\n//# sourceMappingURL=ValidatorUtils.js.map","import OneSignalError from \"../errors/OneSignalError\";\nexport class ProcessOneSignalPushCalls {\n    static processItem(oneSignalInstance, item) {\n        if (typeof (item) === \"function\")\n            item();\n        else if (Array.isArray(item)) {\n            if (item.length == 0)\n                throw new OneSignalError(\"Empty array is not valid!\");\n            const functionName = item.shift();\n            if (functionName == null || typeof (functionName) === \"undefined\")\n                throw new OneSignalError(\"First element in array must be the OneSignal function name\");\n            const oneSignalFunction = oneSignalInstance[functionName.toString()];\n            if (typeof (oneSignalFunction) !== \"function\")\n                throw new OneSignalError(`No OneSignal function with the name '${functionName}'`);\n            oneSignalFunction.apply(oneSignalInstance, item);\n        }\n        else\n            throw new OneSignalError(\"Only accepts function and Array types!\");\n    }\n}\n//# sourceMappingURL=ProcessOneSignalPushCalls.js.map","import bowser from 'bowser';\nimport Environment from './Environment';\nimport { InvalidArgumentError, InvalidArgumentReason } from './errors/InvalidArgumentError';\nimport { InvalidStateError, InvalidStateReason } from './errors/InvalidStateError';\nimport { NotSubscribedError, NotSubscribedReason } from './errors/NotSubscribedError';\nimport { SdkInitError, SdkInitErrorKind } from './errors/SdkInitError';\nimport Event from './Event';\nimport EventHelper from './helpers/EventHelper';\nimport HttpHelper from './helpers/HttpHelper';\nimport InitHelper from './helpers/InitHelper';\nimport MainHelper from './helpers/MainHelper';\nimport SubscriptionHelper from './helpers/SubscriptionHelper';\nimport TestHelper from './helpers/TestHelper';\nimport LimitStore from './LimitStore';\nimport AltOriginManager from './managers/AltOriginManager';\nimport LegacyManager from './managers/LegacyManager';\nimport SdkEnvironment from './managers/SdkEnvironment';\nimport Context from './models/Context';\nimport { NotificationPermission } from './models/NotificationPermission';\nimport { WindowEnvironmentKind } from './models/WindowEnvironmentKind';\nimport OneSignalApi from './OneSignalApi';\nimport Database from './services/Database';\nimport IndexedDb from './services/IndexedDb';\nimport { awaitOneSignalInitAndSupported, awaitSdkEvent, executeCallback, getConsoleStyle, isValidEmail, logMethodCall, } from './utils';\nimport { ValidatorUtils } from './utils/ValidatorUtils';\nimport { DeviceRecord } from './models/DeviceRecord';\nimport TimedLocalStorage from './modules/TimedLocalStorage';\nimport { EmailProfile } from './models/EmailProfile';\nimport { EmailDeviceRecord } from './models/EmailDeviceRecord';\nimport Emitter from './libraries/Emitter';\nimport Log from './libraries/Log';\nimport ConfigManager from \"./managers/ConfigManager\";\nimport OneSignalUtils from \"./utils/OneSignalUtils\";\nimport { ProcessOneSignalPushCalls } from \"./utils/ProcessOneSignalPushCalls\";\nimport { EnvironmentInfoHelper } from './context/browser/helpers/EnvironmentInfoHelper';\nimport { SessionManager } from './managers/sessionManager/page/SessionManager';\nimport OutcomesHelper from \"./helpers/shared/OutcomesHelper\";\nimport { OutcomeAttributionType } from \"./models/Outcomes\";\nimport LocalStorage from './utils/LocalStorage';\nexport default class OneSignal {\n    /**\n     * Pass in the full URL of the default page you want to open when a notification is clicked.\n     * @PublicApi\n     */\n    static async setDefaultNotificationUrl(url) {\n        if (!ValidatorUtils.isValidUrl(url, { allowNull: true }))\n            throw new InvalidArgumentError('url', InvalidArgumentReason.Malformed);\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('setDefaultNotificationUrl', url);\n        const appState = await Database.getAppState();\n        appState.defaultNotificationUrl = url;\n        await Database.setAppState(appState);\n    }\n    /**\n     * Sets the default title to display on notifications. Will default to the site name provided\n     * on the dashboard if you don't call this.\n     * @remarks Either DB value defaultTitle or pageTitle is used when showing a notification title.\n     * @PublicApi\n     */\n    static async setDefaultTitle(title) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('setDefaultTitle', title);\n        const appState = await Database.getAppState();\n        appState.defaultNotificationTitle = title;\n        await Database.setAppState(appState);\n    }\n    /**\n     * @PublicApi\n     */\n    static async setEmail(email, options) {\n        if (!email) {\n            throw new InvalidArgumentError('email', InvalidArgumentReason.Empty);\n        }\n        if (!isValidEmail(email)) {\n            throw new InvalidArgumentError('email', InvalidArgumentReason.Malformed);\n        }\n        const isIdentifierAuthHashDefined = options && !!options.identifierAuthHash;\n        const isEmailAuthHashDefined = options && !!options.emailAuthHash;\n        const authHash = isIdentifierAuthHashDefined ? options.identifierAuthHash :\n            (isEmailAuthHashDefined ? options.emailAuthHash : undefined);\n        if (!!authHash) {\n            if (isIdentifierAuthHashDefined && isEmailAuthHashDefined) {\n                Log.error(\"Both `emailAuthHash` and `identifierAuthHash` provided.\");\n                throw new InvalidArgumentError('options', InvalidArgumentReason.Malformed);\n            }\n            // identifierAuthHash / emailAuthHash are expected to be a 64 character SHA-256 hex hash\n            const isIdentifierAuthHashMalformed = isIdentifierAuthHashDefined && options.identifierAuthHash.length !== 64;\n            const isEmailAuthHashIsMalformed = isEmailAuthHashDefined && options.emailAuthHash.length !== 64;\n            if (isIdentifierAuthHashMalformed) {\n                throw new InvalidArgumentError('options.identifierAuthHash', InvalidArgumentReason.Malformed);\n            }\n            if (isEmailAuthHashIsMalformed) {\n                throw new InvalidArgumentError('options.emailAuthHash', InvalidArgumentReason.Malformed);\n            }\n        }\n        logMethodCall('setEmail', email, options);\n        await awaitOneSignalInitAndSupported();\n        const appConfig = await Database.getAppConfig();\n        const { deviceId } = await Database.getSubscription();\n        const existingEmailProfile = await Database.getEmailProfile();\n        const newEmailProfile = new EmailProfile(existingEmailProfile.emailId, email, authHash);\n        const isExistingEmailSaved = !!existingEmailProfile.emailId;\n        if (isExistingEmailSaved) {\n            // If we already have a saved email player ID, make a PUT call to update the existing email record\n            newEmailProfile.emailId = await OneSignalApi.updateEmailRecord(appConfig, newEmailProfile, deviceId);\n        }\n        else {\n            // Otherwise, make a POST call to create a new email record\n            newEmailProfile.emailId = await OneSignalApi.createEmailRecord(appConfig, newEmailProfile, deviceId);\n        }\n        // If we are subscribed to web push\n        const isExistingPushRecordSaved = deviceId;\n        // And if we previously saved an email ID and it's different from the new returned ID\n        const emailPreviouslySavedAndDifferent = !isExistingEmailSaved ||\n            existingEmailProfile.emailId !== newEmailProfile.emailId;\n        // Or if we previously saved an email and the email changed\n        const emailPreviouslySavedAndChanged = !existingEmailProfile.emailAddress ||\n            newEmailProfile.emailAddress !== existingEmailProfile.emailAddress;\n        if (!!deviceId && isExistingPushRecordSaved && (emailPreviouslySavedAndDifferent || emailPreviouslySavedAndChanged)) {\n            const authHash = await OneSignal.database.getExternalUserIdAuthHash();\n            // Then update the push device record with a reference to the new email ID and email address\n            await OneSignalApi.updatePlayer(appConfig.appId, deviceId, {\n                parent_player_id: newEmailProfile.emailId,\n                email: newEmailProfile.emailAddress,\n                external_user_id_auth_hash: authHash\n            });\n        }\n        // email record update / create call returned successfully\n        if (!!newEmailProfile.emailId) {\n            await Database.setEmailProfile(newEmailProfile);\n        }\n        return newEmailProfile.emailId;\n    }\n    /**\n     * @PublicApi\n     */\n    static async logoutEmail() {\n        await awaitOneSignalInitAndSupported();\n        const appConfig = await Database.getAppConfig();\n        const emailProfile = await Database.getEmailProfile();\n        const { deviceId } = await Database.getSubscription();\n        if (!emailProfile.emailId) {\n            Log.warn(new NotSubscribedError(NotSubscribedReason.NoEmailSet));\n            return;\n        }\n        if (!deviceId) {\n            Log.warn(new NotSubscribedError(NotSubscribedReason.NoDeviceId));\n            return;\n        }\n        if (!await OneSignalApi.logoutEmail(appConfig, emailProfile, deviceId)) {\n            Log.warn(\"Failed to logout email.\");\n            return;\n        }\n        await Database.setEmailProfile(new EmailProfile());\n    }\n    /**\n     * Returns true if the current browser supports web push.\n     * @PublicApi\n     */\n    static isPushNotificationsSupported() {\n        logMethodCall('isPushNotificationsSupported');\n        /*\n          Push notification support is checked in the initial entry code. If in an unsupported environment, a stubbed empty\n          version of the SDK will be loaded instead. This file will only be loaded if push notifications are supported.\n         */\n        return true;\n    }\n    static async initializeConfig(options) {\n        const appConfig = await new ConfigManager().getAppConfig(options);\n        Log.debug(`OneSignal: Final web app config: %c${JSON.stringify(appConfig, null, 4)}`, getConsoleStyle('code'));\n        // TODO: environmentInfo is explicitly dependent on existence of OneSignal.config. Needs refactor.\n        // Workaround to temp assign config so that it can be used in context.\n        OneSignal.config = appConfig;\n        OneSignal.environmentInfo = EnvironmentInfoHelper.getEnvironmentInfo();\n        OneSignal.context = new Context(appConfig);\n        OneSignal.config = OneSignal.context.appConfig;\n    }\n    /**\n     * Initializes the SDK, called by the developer.\n     * @PublicApi\n     */\n    static async init(options) {\n        logMethodCall('init');\n        await InitHelper.polyfillSafariFetch();\n        InitHelper.errorIfInitAlreadyCalled();\n        await OneSignal.initializeConfig(options);\n        if (!OneSignal.config) {\n            throw new Error(\"OneSignal config not initialized!\");\n        }\n        if (bowser.safari && !OneSignal.config.safariWebId) {\n            /**\n             * Don't throw an error for missing Safari config; many users set up\n             * support on Chrome/Firefox and don't intend to support Safari but don't\n             * place conditional initialization checks.\n             */\n            Log.warn(new SdkInitError(SdkInitErrorKind.MissingSafariWebId));\n            return;\n        }\n        if (OneSignal.config.userConfig.requiresUserPrivacyConsent) {\n            const providedConsent = await Database.getProvideUserConsent();\n            if (!providedConsent) {\n                OneSignal.pendingInit = true;\n                return;\n            }\n        }\n        await OneSignal.delayedInit();\n    }\n    static async delayedInit() {\n        OneSignal.pendingInit = false;\n        // Ignore Promise as doesn't return until the service worker becomes active.\n        OneSignal.context.workerMessenger.listen();\n        async function __init() {\n            if (OneSignal.__initAlreadyCalled)\n                return;\n            OneSignal.__initAlreadyCalled = true;\n            OneSignal.emitter.on(OneSignal.EVENTS.NATIVE_PROMPT_PERMISSIONCHANGED, EventHelper.onNotificationPermissionChange);\n            OneSignal.emitter.on(OneSignal.EVENTS.SUBSCRIPTION_CHANGED, EventHelper._onSubscriptionChanged);\n            OneSignal.emitter.on(OneSignal.EVENTS.SDK_INITIALIZED, InitHelper.onSdkInitialized);\n            if (OneSignalUtils.isUsingSubscriptionWorkaround()) {\n                /**\n                 * The user may have forgot to choose a subdomain in his web app setup.\n                 *\n                 * Or, the user may have an HTTP & HTTPS site while using an HTTPS-only\n                 * config on both variants. This would cause the HTTPS site to work\n                 * perfectly, while causing errors and preventing web push from working\n                 * on the HTTP site.\n                 */\n                if (!OneSignal.config || !OneSignal.config.subdomain)\n                    throw new SdkInitError(SdkInitErrorKind.MissingSubdomain);\n                /**\n                 * We'll need to set up page activity tracking events on the main page but we can do so\n                 * only after the main initialization in the iframe is successful and a new session\n                 * is initiated.\n                 */\n                OneSignal.emitter.on(OneSignal.EVENTS.SESSION_STARTED, SessionManager.setupSessionEventListenersForHttp);\n                /**\n                 * The iFrame may never load (e.g. OneSignal might be down), in which\n                 * case the rest of the SDK's initialization will be blocked. This is a\n                 * good thing! We don't want to access IndexedDb before we know which\n                 * origin to store data on.\n                 */\n                OneSignal.proxyFrameHost = await AltOriginManager.discoverAltOrigin(OneSignal.config);\n            }\n            window.addEventListener('focus', () => {\n                // Checks if permission changed every time a user focuses on the page,\n                //     since a user has to click out of and back on the page to check permissions\n                MainHelper.checkAndTriggerNotificationPermissionChanged();\n            });\n            await InitHelper.initSaveState();\n            await InitHelper.saveInitOptions();\n            if (SdkEnvironment.getWindowEnv() === WindowEnvironmentKind.CustomIframe)\n                await Event.trigger(OneSignal.EVENTS.SDK_INITIALIZED);\n            else\n                await InitHelper.internalInit();\n        }\n        if (document.readyState === 'complete' || document.readyState === 'interactive')\n            await __init();\n        else {\n            Log.debug('OneSignal: Waiting for DOMContentLoaded or readyStateChange event before continuing' +\n                ' initialization...');\n            window.addEventListener('DOMContentLoaded', () => { __init(); });\n            document.onreadystatechange = () => {\n                if (document.readyState === 'complete' || document.readyState === 'interactive')\n                    __init();\n            };\n        }\n    }\n    /**\n     * Call after user accepts your user consent agreement\n     * @PublicApi\n     */\n    static async provideUserConsent(consent) {\n        await Database.setProvideUserConsent(consent);\n        if (consent && OneSignal.pendingInit)\n            await OneSignal.delayedInit();\n    }\n    /**\n     * Prompts the user to subscribe using the remote local notification workaround for HTTP sites.\n     * @PublicApi\n     */\n    static async showHttpPermissionRequest(options) {\n        Log.debug('Called showHttpPermissionRequest(), redirecting to HTTP prompt.');\n        OneSignal.showHttpPrompt(options).catch(e => Log.info(e));\n    }\n    /**\n     * Shows a sliding modal prompt on the page for users to trigger the HTTP popup window to subscribe.\n     * @PublicApi\n     */\n    static async showHttpPrompt(options) {\n        await awaitOneSignalInitAndSupported();\n        await OneSignal.context.promptsManager.internalShowSlidedownPrompt(options);\n    }\n    /**\n     * Shows a native browser prompt.\n     * @PublicApi\n     */\n    static async showNativePrompt() {\n        await awaitOneSignalInitAndSupported();\n        await OneSignal.context.promptsManager.internalShowNativePrompt();\n    }\n    /**\n     * Shows a sliding modal prompt on the page for users.\n     * @PublicApi\n     */\n    static async showSlidedownPrompt(options) {\n        await awaitOneSignalInitAndSupported();\n        await OneSignal.context.promptsManager.internalShowSlidedownPrompt(options);\n    }\n    static async showCategorySlidedown(options) {\n        await awaitOneSignalInitAndSupported();\n        const isPushEnabled = LocalStorage.getIsPushNotificationsEnabled();\n        await OneSignal.context.promptsManager.internalShowCategorySlidedown(Object.assign({}, options, { isInUpdateMode: isPushEnabled }));\n    }\n    /**\n     * Prompts the user to subscribe.\n     * @PublicApi\n     */\n    static async registerForPushNotifications(options) {\n        if (!OneSignal.initialized) {\n            await new Promise((resolve, _reject) => {\n                OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED, async () => {\n                    await InitHelper.registerForPushNotifications(options);\n                    return resolve();\n                });\n            });\n        }\n        else\n            return await InitHelper.registerForPushNotifications(options);\n    }\n    /**\n     * Returns a promise that resolves to the browser's current notification permission as\n     *    'default', 'granted', or 'denied'.\n     * @param callback A callback function that will be called when the browser's current notification permission\n     *           has been obtained, with one of 'default', 'granted', or 'denied'.\n     * @PublicApi\n     */\n    static async getNotificationPermission(onComplete) {\n        await awaitOneSignalInitAndSupported();\n        return OneSignal.privateGetNotificationPermission(onComplete);\n    }\n    static async privateGetNotificationPermission(onComplete) {\n        const permission = await OneSignal.context.permissionManager.getNotificationPermission(OneSignal.config.safariWebId);\n        if (onComplete)\n            onComplete(permission);\n        return permission;\n    }\n    /**\n     * @PublicApi\n     */\n    static async getTags(callback) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('getTags', callback);\n        const { appId } = await Database.getAppConfig();\n        const { deviceId } = await Database.getSubscription();\n        if (!deviceId) {\n            // TODO: Throw an error here in future v2; for now it may break existing client implementations.\n            Log.info(new NotSubscribedError(NotSubscribedReason.NoDeviceId));\n            return null;\n        }\n        const { tags } = await OneSignalApi.getPlayer(appId, deviceId);\n        executeCallback(callback, tags);\n        return tags;\n    }\n    /**\n     * @PublicApi\n     */\n    static async sendTag(key, value, callback) {\n        const tag = {};\n        tag[key] = value;\n        return await OneSignal.sendTags(tag, callback);\n    }\n    /**\n     * @PublicApi\n     */\n    static async sendTags(tags, callback) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('sendTags', tags, callback);\n        if (!tags || Object.keys(tags).length === 0) {\n            // TODO: Throw an error here in future v2; for now it may break existing client implementations.\n            Log.info(new InvalidArgumentError('tags', InvalidArgumentReason.Empty));\n            return null;\n        }\n        // Our backend considers false as removing a tag, so convert false -> \"false\" to allow storing as a value\n        Object.keys(tags).forEach(key => {\n            if (tags[key] === false)\n                tags[key] = \"false\";\n        });\n        const { appId } = await Database.getAppConfig();\n        const emailProfile = await Database.getEmailProfile();\n        if (emailProfile.emailId) {\n            const emailOptions = {\n                tags,\n                identifier_auth_hash: emailProfile.identifierAuthHash\n            };\n            await OneSignalApi.updatePlayer(appId, emailProfile.emailId, emailOptions);\n        }\n        const { deviceId } = await Database.getSubscription();\n        if (!deviceId) {\n            await awaitSdkEvent(OneSignal.EVENTS.REGISTERED);\n        }\n        // After the user subscribes, he will have a device ID, so get it again\n        const { deviceId: newDeviceId } = await Database.getSubscription();\n        const authHash = await Database.getExternalUserIdAuthHash();\n        const options = { tags };\n        if (!!authHash) {\n            options.external_user_id_auth_hash = authHash;\n        }\n        await OneSignalApi.updatePlayer(appId, newDeviceId, options);\n        executeCallback(callback, tags);\n        return tags;\n    }\n    /**\n     * @PublicApi\n     */\n    static async deleteTag(tag) {\n        return await OneSignal.deleteTags([tag]);\n    }\n    /**\n     * @PublicApi\n     */\n    static async deleteTags(tags, callback) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('deleteTags', tags, callback);\n        if (!ValidatorUtils.isValidArray(tags))\n            throw new InvalidArgumentError('tags', InvalidArgumentReason.Malformed);\n        if (tags.length === 0) {\n            // TODO: Throw an error here in future v2; for now it may break existing client implementations.\n            Log.info(new InvalidArgumentError('tags', InvalidArgumentReason.Empty));\n        }\n        const tagsToSend = {};\n        for (const tag of tags) {\n            tagsToSend[tag] = '';\n        }\n        const deletedTags = await OneSignal.sendTags(tagsToSend);\n        if (deletedTags) {\n            const deletedTagKeys = Object.keys(deletedTags);\n            executeCallback(callback, deletedTagKeys);\n            return deletedTagKeys;\n        }\n        return [];\n    }\n    /**\n     * @PublicApi\n     */\n    static async setExternalUserId(externalUserId, authHash) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall(\"setExternalUserId\");\n        if (!!authHash) {\n            if (authHash.length !== 64) {\n                throw new InvalidArgumentError('options.identifierAuthHash', InvalidArgumentReason.Malformed);\n            }\n        }\n        const isExistingUser = await this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal();\n        if (!isExistingUser) {\n            await awaitSdkEvent(OneSignal.EVENTS.REGISTERED);\n        }\n        const response = await OneSignal.context.updateManager.sendExternalUserIdUpdate(externalUserId, authHash);\n        if (response && response.success) {\n            OneSignal.database.setExternalUserId(externalUserId, authHash);\n        }\n    }\n    /**\n    * @PublicApi\n    */\n    static async getExternalUserId() {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall(\"getExternalUserId\");\n        return await OneSignal.database.getExternalUserId();\n    }\n    /**\n     * @PublicApi\n     */\n    static async removeExternalUserId() {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall(\"removeExternalUserId\");\n        const isExistingUser = await this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal();\n        if (!isExistingUser) {\n            Log.warn(\"User is not subscribed, cannot remove external user id.\");\n            return;\n        }\n        await OneSignal.context.updateManager.sendExternalUserIdUpdate(undefined),\n            await OneSignal.database.setExternalUserId(undefined);\n    }\n    /**\n     * @PublicApi\n     */\n    static async addListenerForNotificationOpened(callback) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('addListenerForNotificationOpened', callback);\n        OneSignal.emitter.once(OneSignal.EVENTS.NOTIFICATION_CLICKED, notification => {\n            executeCallback(callback, notification);\n        });\n        if (OneSignal.config) {\n            EventHelper.fireStoredNotificationClicks(OneSignal.config.pageUrl || OneSignal.config.userConfig.pageUrl);\n        }\n    }\n    /**\n     * @PublicApi\n     * @Deprecated\n     */\n    static async getIdsAvailable(callback) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('getIdsAvailable', callback);\n        const { deviceId, subscriptionToken } = await Database.getSubscription();\n        const bundle = {\n            userId: deviceId,\n            registrationId: subscriptionToken\n        };\n        executeCallback(callback, bundle);\n        return bundle;\n    }\n    /**\n     * Returns a promise that resolves to true if all required conditions\n     * for push messaging are met; otherwise resolves to false.\n     * @param callback A callback function that will be called when the current subscription status has been obtained.\n     * @PublicApi\n     */\n    static async isPushNotificationsEnabled(callback) {\n        await awaitOneSignalInitAndSupported();\n        return OneSignal.privateIsPushNotificationsEnabled(callback);\n    }\n    static async privateIsPushNotificationsEnabled(callback) {\n        logMethodCall('isPushNotificationsEnabled', callback);\n        const context = OneSignal.context;\n        const subscriptionState = await context.subscriptionManager.getSubscriptionState();\n        executeCallback(callback, subscriptionState.subscribed && !subscriptionState.optedOut);\n        return subscriptionState.subscribed && !subscriptionState.optedOut;\n    }\n    /**\n     * @PublicApi\n     */\n    static async setSubscription(newSubscription) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('setSubscription', newSubscription);\n        const appConfig = await Database.getAppConfig();\n        const { appId } = appConfig;\n        const subscription = await Database.getSubscription();\n        const { deviceId } = subscription;\n        if (!appConfig.appId)\n            throw new InvalidStateError(InvalidStateReason.MissingAppId);\n        if (!ValidatorUtils.isValidBoolean(newSubscription))\n            throw new InvalidArgumentError('newSubscription', InvalidArgumentReason.Malformed);\n        if (!deviceId) {\n            // TODO: Throw an error here in future v2; for now it may break existing client implementations.\n            Log.info(new NotSubscribedError(NotSubscribedReason.NoDeviceId));\n            return;\n        }\n        const options = {\n            notification_types: MainHelper.getNotificationTypeFromOptIn(newSubscription)\n        };\n        const authHash = await Database.getExternalUserIdAuthHash();\n        if (!!authHash) {\n            options.external_user_id_auth_hash = authHash;\n        }\n        subscription.optedOut = !newSubscription;\n        await OneSignalApi.updatePlayer(appId, deviceId, options);\n        await Database.setSubscription(subscription);\n        EventHelper.onInternalSubscriptionSet(subscription.optedOut);\n        EventHelper.checkAndTriggerSubscriptionChanged();\n    }\n    /**\n     * @PendingPublicApi\n     */\n    static async isOptedOut(callback) {\n        await awaitOneSignalInitAndSupported();\n        return OneSignal.internalIsOptedOut(callback);\n    }\n    static async internalIsOptedOut(callback) {\n        logMethodCall('isOptedOut', callback);\n        const { optedOut } = await Database.getSubscription();\n        executeCallback(callback, optedOut);\n        return optedOut;\n    }\n    /**\n     * Returns a promise that resolves once the manual subscription override has been set.\n     * @private\n     * @PendingPublicApi\n     */\n    static async optOut(doOptOut, callback) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('optOut', doOptOut, callback);\n        if (!ValidatorUtils.isValidBoolean(doOptOut))\n            throw new InvalidArgumentError('doOptOut', InvalidArgumentReason.Malformed);\n        await OneSignal.setSubscription(!doOptOut);\n        executeCallback(callback);\n    }\n    /**\n     * Returns a promise that resolves to the stored OneSignal email ID if one is set; otherwise null.\n     * @param callback A function accepting one parameter for the OneSignal email ID.\n     * @PublicApi\n     */\n    static async getEmailId(callback) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('getEmailId', callback);\n        const emailProfile = await Database.getEmailProfile();\n        const emailId = emailProfile.emailId;\n        executeCallback(callback, emailId);\n        return emailId;\n    }\n    /**\n     * Returns a promise that resolves to the stored OneSignal user ID if one is set; otherwise null.\n     * @param callback A function accepting one parameter for the OneSignal user ID.\n     * @PublicApi\n     */\n    static async getUserId(callback) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('getUserId', callback);\n        const subscription = await Database.getSubscription();\n        const deviceId = subscription.deviceId;\n        executeCallback(callback, deviceId);\n        return deviceId;\n    }\n    /**\n     * Returns a promise that resolves to the stored push token if one is set; otherwise null.\n     * @PublicApi\n     */\n    static async getRegistrationId(callback) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('getRegistrationId', callback);\n        const subscription = await Database.getSubscription();\n        const subscriptionToken = subscription.subscriptionToken;\n        executeCallback(callback, subscriptionToken);\n        return subscriptionToken;\n    }\n    /**\n     * Returns a promise that resolves to false if setSubscription(false) is \"in effect\". Otherwise returns true.\n     * This means a return value of true does not mean the user is subscribed, only that the user did not call\n     * setSubcription(false).\n     * @private\n     * @PublicApi (given to customers)\n     */\n    static async getSubscription(callback) {\n        await awaitOneSignalInitAndSupported();\n        return await OneSignal.privateGetSubscription(callback);\n    }\n    static async privateGetSubscription(callback) {\n        logMethodCall('getSubscription', callback);\n        const subscription = await Database.getSubscription();\n        const subscriptionStatus = !subscription.optedOut;\n        executeCallback(callback, subscriptionStatus);\n        return subscriptionStatus;\n    }\n    /**\n     * @PublicApi\n     */\n    static async sendSelfNotification(title = 'OneSignal Test Message', message = 'This is an example notification.', url = `${new URL(location.href).origin}?_osp=do_not_open`, icon, data, buttons) {\n        await awaitOneSignalInitAndSupported();\n        logMethodCall('sendSelfNotification', title, message, url, icon, data, buttons);\n        const appConfig = await Database.getAppConfig();\n        const subscription = await Database.getSubscription();\n        if (!appConfig.appId)\n            throw new InvalidStateError(InvalidStateReason.MissingAppId);\n        if (!(await OneSignal.isPushNotificationsEnabled()))\n            throw new NotSubscribedError(NotSubscribedReason.NoDeviceId);\n        if (!ValidatorUtils.isValidUrl(url))\n            throw new InvalidArgumentError('url', InvalidArgumentReason.Malformed);\n        if (!ValidatorUtils.isValidUrl(icon, { allowEmpty: true, requireHttps: true }))\n            throw new InvalidArgumentError('icon', InvalidArgumentReason.Malformed);\n        if (subscription.deviceId) {\n            await OneSignalApi.sendNotification(appConfig.appId, [subscription.deviceId], { en: title }, { en: message }, url, icon, data, buttons);\n        }\n    }\n    /**\n     * Used to load OneSignal asynchronously from a webpage\n     * Allows asynchronous function queuing while the SDK loads in the browser with <script src=\"...\" async/>\n     * @PublicApi\n     * @param item - Ether a function or an arry with a OneSignal function name followed by it's parameters\n     * @Example\n     *  OneSignal.push([\"functionName\", param1, param2]);\n     *  OneSignal.push(function() { OneSignal.functionName(param1, param2); });\n     */\n    static push(item) {\n        ProcessOneSignalPushCalls.processItem(OneSignal, item);\n    }\n    /**\n     * Used to subscribe to OneSignal events such as \"subscriptionChange\"\n     * Fires each time the event occurs\n     * @param event - Event name to subscribe to\n     * @param listener - Listener to fire when event happens\n     * @PublicApi\n     */\n    static on(event, listener) {\n        return this.emitter.on(event, listener);\n    }\n    /**\n     * Used to un-subscribe from OneSignal events such as \"subscriptionChange\"\n     * @param event - Event name to un-subscribe from\n     * @param listener - Event listener to remove from the collection for a specified event\n     * @PublicApi\n     */\n    static off(event, listener) {\n        return this.emitter.off(event, listener);\n    }\n    /**\n     * Used to subscribe to OneSignal events such as \"subscriptionChange\"\n     * Fires only once\n     * @param event - Event name to subscribe to\n     * @param listener - Listener to fire when event happens\n     * @PublicApi\n     */\n    static once(event, listener) {\n        return this.emitter.once(event, listener);\n    }\n    static async sendOutcome(outcomeName, outcomeWeight) {\n        const config = OneSignal.config.userConfig.outcomes;\n        if (!config) {\n            Log.error(`Could not send ${outcomeName}. No outcomes config found.`);\n            return;\n        }\n        const outcomesHelper = new OutcomesHelper(OneSignal.config.appId, config, outcomeName, false);\n        if (typeof outcomeWeight !== \"undefined\" && typeof outcomeWeight !== \"number\") {\n            Log.error(\"Outcome weight can only be a number if present.\");\n            return;\n        }\n        if (!await outcomesHelper.beforeOutcomeSend()) {\n            return;\n        }\n        const outcomeAttribution = await outcomesHelper.getAttribution();\n        await outcomesHelper.send({\n            type: outcomeAttribution.type,\n            notificationIds: outcomeAttribution.notificationIds,\n            weight: outcomeWeight\n        });\n    }\n    static async sendUniqueOutcome(outcomeName) {\n        const config = OneSignal.config.userConfig.outcomes;\n        if (!config) {\n            Log.error(`Could not send ${outcomeName}. No outcomes config found.`);\n            return;\n        }\n        const outcomesHelper = new OutcomesHelper(OneSignal.config.appId, config, outcomeName, true);\n        if (!await outcomesHelper.beforeOutcomeSend()) {\n            return;\n        }\n        const outcomeAttribution = await outcomesHelper.getAttribution();\n        if (outcomeAttribution.type === OutcomeAttributionType.NotSupported) {\n            Log.warn(\"You are on a free plan. Please upgrade to use this functionality.\");\n            return;\n        }\n        // all notifs in attribution window\n        const { notificationIds } = outcomeAttribution;\n        // only new notifs that ought to be attributed\n        const newNotifsToAttributeWithOutcome = await outcomesHelper.getNotifsToAttributeWithUniqueOutcome(notificationIds);\n        if (!outcomesHelper.shouldSendUnique(outcomeAttribution, newNotifsToAttributeWithOutcome)) {\n            Log.warn(`'${outcomeName}' was already reported for all notifications.`);\n            return;\n        }\n        await outcomesHelper.send({\n            type: outcomeAttribution.type,\n            notificationIds: newNotifsToAttributeWithOutcome,\n        });\n    }\n}\nOneSignal.VERSION = Environment.version();\nOneSignal._VERSION = Environment.version();\nOneSignal.sdkEnvironment = SdkEnvironment;\nOneSignal._notificationOpenedCallbacks = [];\nOneSignal._idsAvailable_callback = [];\nOneSignal._defaultLaunchURL = null;\nOneSignal.config = null;\nOneSignal._sessionInitAlreadyRunning = false;\nOneSignal._isNotificationEnabledCallback = [];\nOneSignal._subscriptionSet = true;\nOneSignal.modalUrl = null;\nOneSignal._windowWidth = 650;\nOneSignal._windowHeight = 568;\nOneSignal._isNewVisitor = false;\nOneSignal._channel = null;\nOneSignal.timedLocalStorage = TimedLocalStorage;\nOneSignal.initialized = false;\nOneSignal.notifyButton = null;\nOneSignal.store = LimitStore;\nOneSignal.environment = Environment;\nOneSignal.database = Database;\nOneSignal.event = Event;\nOneSignal.browser = bowser;\nOneSignal.slidedown = null;\nOneSignal.log = Log;\nOneSignal.api = OneSignalApi;\nOneSignal.indexedDb = IndexedDb;\nOneSignal.mainHelper = MainHelper;\nOneSignal.subscriptionHelper = SubscriptionHelper;\nOneSignal.httpHelper = HttpHelper;\nOneSignal.eventHelper = EventHelper;\nOneSignal.initHelper = InitHelper;\nOneSignal.testHelper = TestHelper;\nOneSignal.pendingInit = true;\nOneSignal.emitter = new Emitter();\nOneSignal.cache = {};\n/**\n * The additional path to the worker file.\n *\n * Usually just the filename (in case the file is named differently), but also supports cases where the folder\n * is different.\n *\n * However, the init options 'path' should be used to specify the folder path instead since service workers will not\n * auto-update correctly on HTTPS site load if the config init options 'path' is not set.\n */\nOneSignal.SERVICE_WORKER_UPDATER_PATH = 'OneSignalSDKUpdaterWorker.js';\nOneSignal.SERVICE_WORKER_PATH = 'OneSignalSDKWorker.js';\n/**\n * By default, the service worker is expected to be accessible at the root scope. If the service worker is only\n * available with in a sub-directory, SERVICE_WORKER_PARAM must be changed to the sub-directory (with a trailing\n * slash). This would allow pages to function correctly as not to block the service worker ready call, which would\n * hang indefinitely if we requested root scope registration but the service was only available in a child scope.\n */\nOneSignal.SERVICE_WORKER_PARAM = { scope: '/' };\nOneSignal._LOGGING = false;\nOneSignal.LOGGING = false;\nOneSignal._usingNativePermissionHook = false;\nOneSignal._initCalled = false;\nOneSignal.__initAlreadyCalled = false;\nOneSignal.checkAndWipeUserSubscription = function () { };\nOneSignal.DeviceRecord = DeviceRecord;\nOneSignal.EmailDeviceRecord = EmailDeviceRecord;\nOneSignal.notificationPermission = NotificationPermission;\n/**\n * Used by Rails-side HTTP popup. Must keep the same name.\n * @InternalApi\n */\nOneSignal._initHttp = HttpHelper.initHttp;\n/**\n * Used by Rails-side HTTP popup. Must keep the same name.\n * @InternalApi\n */\nOneSignal._initPopup = () => OneSignal.subscriptionPopup.subscribe();\nOneSignal.POSTMAM_COMMANDS = {\n    CONNECTED: 'connect',\n    REMOTE_NOTIFICATION_PERMISSION: 'postmam.remoteNotificationPermission',\n    REMOTE_DATABASE_GET: 'postmam.remoteDatabaseGet',\n    REMOTE_DATABASE_GET_ALL: 'postmam.remoteDatabaseGetAll',\n    REMOTE_DATABASE_PUT: 'postmam.remoteDatabasePut',\n    REMOTE_DATABASE_REMOVE: 'postmam.remoteDatabaseRemove',\n    REMOTE_OPERATION_COMPLETE: 'postman.operationComplete',\n    REMOTE_RETRIGGER_EVENT: 'postmam.remoteRetriggerEvent',\n    MODAL_LOADED: 'postmam.modalPrompt.loaded',\n    MODAL_PROMPT_ACCEPTED: 'postmam.modalPrompt.accepted',\n    MODAL_PROMPT_REJECTED: 'postmam.modalPrompt.canceled',\n    POPUP_LOADED: 'postmam.popup.loaded',\n    POPUP_ACCEPTED: 'postmam.popup.accepted',\n    POPUP_REJECTED: 'postmam.popup.canceled',\n    POPUP_CLOSING: 'postman.popup.closing',\n    REMOTE_NOTIFICATION_PERMISSION_CHANGED: 'postmam.remoteNotificationPermissionChanged',\n    IFRAME_POPUP_INITIALIZE: 'postmam.iframePopupInitialize',\n    UNSUBSCRIBE_FROM_PUSH: 'postmam.unsubscribeFromPush',\n    SET_SESSION_COUNT: 'postmam.setSessionCount',\n    REQUEST_HOST_URL: 'postmam.requestHostUrl',\n    WINDOW_TIMEOUT: 'postmam.windowTimeout',\n    FINISH_REMOTE_REGISTRATION: 'postmam.finishRemoteRegistration',\n    FINISH_REMOTE_REGISTRATION_IN_PROGRESS: 'postmam.finishRemoteRegistrationInProgress',\n    POPUP_BEGIN_MESSAGEPORT_COMMS: 'postmam.beginMessagePortComms',\n    SERVICEWORKER_COMMAND_REDIRECT: 'postmam.command.redirect',\n    MARK_PROMPT_DISMISSED: 'postmam.markPromptDismissed',\n    IS_SUBSCRIBED: 'postmam.isSubscribed',\n    UNSUBSCRIBE_PROXY_FRAME: 'postman.unsubscribeProxyFrame',\n    GET_EVENT_LISTENER_COUNT: 'postmam.getEventListenerCount',\n    SERVICE_WORKER_STATE: 'postmam.serviceWorkerState',\n    GET_WORKER_VERSION: 'postmam.getWorkerVersion',\n    SUBSCRIPTION_EXPIRATION_STATE: 'postmam.subscriptionExpirationState',\n    PROCESS_EXPIRING_SUBSCRIPTIONS: 'postmam.processExpiringSubscriptions',\n    GET_SUBSCRIPTION_STATE: 'postmam.getSubscriptionState',\n    SESSION_UPSERT: 'postmam.sessionUpsert',\n    SESSION_DEACTIVATE: 'postmam.sessionDeactivate',\n    ARE_YOU_VISIBLE_REQUEST: 'postmam.areYouVisibleRequest',\n    ARE_YOU_VISIBLE_RESPONSE: 'postmam.areYouVisibleResponse',\n};\nOneSignal.EVENTS = {\n    /**\n     * Occurs when the user clicks the \"Continue\" or \"No Thanks\" button on the HTTP popup or HTTPS modal prompt.\n     * For HTTP sites (and HTTPS sites using the modal prompt), this event is fired before the native permission\n     * prompt is shown. This event is mostly used for HTTP sites.\n     */\n    CUSTOM_PROMPT_CLICKED: 'customPromptClick',\n    /**\n     * Occurs when the user clicks \"Allow\" or \"Block\" on the native permission prompt on Chrome, Firefox, or Safari.\n     * This event is used for both HTTP and HTTPS sites and occurs after the user actually grants notification\n     * permissions for the site. Occurs before the user is actually subscribed to push notifications.\n     */\n    NATIVE_PROMPT_PERMISSIONCHANGED: 'notificationPermissionChange',\n    /**\n     * Occurs after the user is officially subscribed to push notifications. The service worker is fully registered\n     * and activated and the user is eligible to receive push notifications at any point after this.\n     */\n    SUBSCRIPTION_CHANGED: 'subscriptionChange',\n    /**\n     * Occurs after a POST call to OneSignal's server to send the welcome notification has completed. The actual\n     * notification arrives shortly after.\n     */\n    WELCOME_NOTIFICATION_SENT: 'sendWelcomeNotification',\n    /**\n     * Occurs when a notification is displayed.\n     */\n    NOTIFICATION_DISPLAYED: 'notificationDisplay',\n    /**\n     * Occurs when a notification is dismissed by the user either clicking 'X' or clearing all notifications\n     * (available in Android). This event is NOT called if the user clicks the notification's body or any of the\n     * action buttons.\n     */\n    NOTIFICATION_DISMISSED: 'notificationDismiss',\n    /**\n     * New event replacing legacy addNotificationOpenedHandler(). Used when the notification was clicked.\n     */\n    NOTIFICATION_CLICKED: 'notificationClick',\n    /**\n     * Occurs after the document ready event fires and, for HTTP sites, the iFrame to subdomain.onesignal.com has\n     * loaded.\n     * Before this event, IndexedDB access is not possible for HTTP sites.\n     */\n    SDK_INITIALIZED: 'initializeInternal',\n    /**\n     * Occurs after the SDK finishes its final internal initialization. The final initialization event.\n     */\n    SDK_INITIALIZED_PUBLIC: 'initialize',\n    /**\n     * Occurs after the user subscribes to push notifications and a new user entry is created on OneSignal's server,\n     * and also occurs when the user begins a new site session and the last_session and last_active is updated on\n     * OneSignal's server.\n     */\n    REGISTERED: 'register',\n    /**\n     * Occurs as the HTTP popup is closing.\n     */\n    POPUP_CLOSING: 'popupClose',\n    /**\n     * Occurs when the native permission prompt is displayed.\n     */\n    PERMISSION_PROMPT_DISPLAYED: 'permissionPromptDisplay',\n    /**\n     * For internal testing only. Used for all sorts of things.\n     */\n    TEST_INIT_OPTION_DISABLED: 'testInitOptionDisabled',\n    TEST_WOULD_DISPLAY: 'testWouldDisplay',\n    POPUP_WINDOW_TIMEOUT: 'popupWindowTimeout',\n    SESSION_STARTED: \"os.sessionStarted\",\n};\nLegacyManager.ensureBackwardsCompatibility(OneSignal);\nLog.info(`%cOneSignal Web SDK loaded (version ${OneSignal._VERSION},\n  ${SdkEnvironment.getWindowEnv().toString()} environment).`, getConsoleStyle('bold'));\nLog.debug(`Current Page URL: ${typeof location === \"undefined\" ? \"NodeJS\" : location.href}`);\nLog.debug(`Browser Environment: ${bowser.name} ${bowser.version}`);\n//# sourceMappingURL=OneSignal.js.map","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\r\n} catch (e) {\r\n\t// This works if the window reference is available\r\n\tif (typeof window === \"object\") g = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n","module.exports = function() {\r\n\tthrow new Error(\"define cannot be used indirect\");\r\n};\r\n"],"sourceRoot":""}